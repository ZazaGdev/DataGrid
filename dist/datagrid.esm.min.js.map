{"version":3,"file":"datagrid.esm.min.js","sources":["../src/core/EventBus.js","../src/utils/helpers.js","../src/core/TableState.js","../src/utils/dom.js","../src/core/TableRenderer.js","../src/modules/RowManager.js","../src/utils/data.js","../src/modules/GroupManager.js","../src/modules/EditManager.js","../src/modules/ExportManager.js","../src/modules/ThemeManager.js","../src/core/Table.js"],"sourcesContent":["/**\n * EventBus - Lightweight pub/sub event system for decoupled communication\n *\n * This enables modules to communicate without direct dependencies,\n * improving maintainability and allowing for efficient cascade updates.\n */\n\nexport class EventBus {\n  constructor() {\n    /** @type {Map<string, Set<Function>>} */\n    this._listeners = new Map()\n\n    /** @type {Map<string, Function>} */\n    this._onceListeners = new Map() // TODO: Implement once listeners if needed\n\n    /** @type {boolean} */\n    this._isBatching = false\n\n    /** @type {Array<{event: string, data: any}>} */\n    this._batchQueue = []\n  }\n\n  /**\n   * Subscribe to an event\n   * @param {string} event - Event name\n   * @param {Function} callback - Handler function\n   * @returns {Function} Unsubscribe function\n   */\n  on(event, callback) {\n    if (!this._listeners.has(event)) {\n      this._listeners.set(event, new Set())\n    }\n    this._listeners.get(event).add(callback)\n\n    // Return unsubscribe function\n    return () => this.off(event, callback)\n  }\n\n  /**\n   * Subscribe to an event once\n   * @param {string} event - Event name\n   * @param {Function} callback - Handler function\n   */\n  once(event, callback) {\n    const wrapper = (data) => {\n      this.off(event, wrapper)\n      callback(data)\n    }\n    this.on(event, wrapper)\n  }\n\n  /**\n   * Unsubscribe from an event\n   * @param {string} event - Event name\n   * @param {Function} callback - Handler function\n   */\n  off(event, callback) {\n    if (this._listeners.has(event)) {\n      this._listeners.get(event).delete(callback)\n    }\n  }\n\n  /**\n   * Emit an event\n   * @param {string} event - Event name\n   * @param {any} data - Event data\n   */\n  emit(event, data) {\n    if (this._isBatching) {\n      this._batchQueue.push({ event, data })\n      return\n    }\n\n    if (this._listeners.has(event)) {\n      this._listeners.get(event).forEach((callback) => {\n        try {\n          callback(data)\n        } catch (error) {\n          console.error(`Error in event handler for \"${event}\":`, error)\n        }\n      })\n    }\n  }\n\n  /**\n   * Start batching events (for performance during bulk updates)\n   */\n  startBatch() {\n    this._isBatching = true\n    this._batchQueue = []\n  }\n\n  /**\n   * End batching and emit all queued events\n   * Deduplicates events of the same type, keeping latest data\n   */\n  endBatch() {\n    this._isBatching = false\n\n    // Deduplicate: for CELL_CHANGE events, use rowId:columnName as key\n    // For other events, use just the event name\n    const eventMap = new Map()\n    this._batchQueue.forEach(({ event, data }) => {\n      let key = event\n\n      // For cell-specific events, create unique key per cell\n      if (event === TableEvents.CELL_CHANGE && data.rowId && data.columnName) {\n        key = `${event}:${data.rowId}:${data.columnName}`\n      } else if (event === TableEvents.ROW_CHANGE && data.rowId) {\n        key = `${event}:${data.rowId}`\n      }\n\n      eventMap.set(key, { event, data })\n    })\n\n    // Emit deduplicated events\n    eventMap.forEach(({ event, data }) => {\n      this.emit(event, data)\n    })\n\n    this._batchQueue = []\n  }\n\n  /**\n   * Remove all listeners\n   */\n  destroy() {\n    this._listeners.clear()\n    this._batchQueue = []\n  }\n}\n\n// Predefined event types for consistency\nexport const TableEvents = {\n  // State events\n  STATE_CHANGE: \"state:change\",\n  DATA_CHANGE: \"data:change\",\n\n  // Row events\n  ROW_CLICK: \"row:click\",\n  ROW_CHANGE: \"row:change\",\n  ROW_ADD: \"row:add\",\n  ROW_DELETE: \"row:delete\",\n\n  // Cell events\n  CELL_CHANGE: \"cell:change\",\n  CELL_FOCUS: \"cell:focus\",\n  CELL_BLUR: \"cell:blur\",\n\n  // Row total events\n  ROW_TOTAL_CHANGE: \"rowTotal:change\",\n\n  // Group events\n  GROUP_TOGGLE: \"group:toggle\",\n  GROUP_EXPAND_ALL: \"group:expandAll\",\n  GROUP_COLLAPSE_ALL: \"group:collapseAll\",\n\n  // Mode events\n  MODE_CHANGE: \"mode:change\",\n\n  // Lifecycle events\n  BEFORE_RENDER: \"lifecycle:beforeRender\",\n  RENDER: \"lifecycle:render\",\n  AFTER_RENDER: \"lifecycle:afterRender\",\n  DESTROY: \"lifecycle:destroy\",\n\n  // Scroll events\n  SCROLL: \"scroll:update\",\n\n  // Export events\n  EXPORT_START: \"export:start\",\n  EXPORT_COMPLETE: \"export:complete\",\n}\n","/**\n * General Helpers - Utility functions for data manipulation\n */\n\n/**\n * Generate a unique ID\n * @returns {string}\n */\nexport function generateId() {\n  return `et_${Date.now().toString(36)}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n/**\n * Deep clone an object/array\n * @param {any} obj - Object to clone\n * @returns {any}\n */\nexport function deepClone(obj) {\n  if (obj === null || typeof obj !== 'object') {\n    return obj;\n  }\n  \n  if (obj instanceof Date) {\n    return new Date(obj.getTime());\n  }\n  \n  if (obj instanceof Set) {\n    return new Set([...obj].map(item => deepClone(item)));\n  }\n  \n  if (obj instanceof Map) {\n    return new Map([...obj].map(([key, value]) => [deepClone(key), deepClone(value)]));\n  }\n  \n  if (Array.isArray(obj)) {\n    return obj.map(item => deepClone(item));\n  }\n  \n  const cloned = {};\n  for (const key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      cloned[key] = deepClone(obj[key]);\n    }\n  }\n  return cloned;\n}\n\n/**\n * Deep equality check\n * @param {any} a - First value\n * @param {any} b - Second value\n * @returns {boolean}\n */\nexport function deepEqual(a, b) {\n  if (a === b) return true;\n  \n  if (a === null || b === null) return false;\n  if (typeof a !== typeof b) return false;\n  \n  if (typeof a !== 'object') return a === b;\n  \n  if (Array.isArray(a) !== Array.isArray(b)) return false;\n  \n  if (Array.isArray(a)) {\n    if (a.length !== b.length) return false;\n    return a.every((item, index) => deepEqual(item, b[index]));\n  }\n  \n  const keysA = Object.keys(a);\n  const keysB = Object.keys(b);\n  \n  if (keysA.length !== keysB.length) return false;\n  \n  return keysA.every(key => deepEqual(a[key], b[key]));\n}\n\n/**\n * Get nested property value using dot notation\n * @param {Object} obj - Source object\n * @param {string} path - Property path (e.g., 'a.b.c')\n * @param {any} [defaultValue] - Default value if not found\n * @returns {any}\n */\nexport function getNestedValue(obj, path, defaultValue = undefined) {\n  const keys = path.split('.');\n  let result = obj;\n  \n  for (const key of keys) {\n    if (result === null || result === undefined) {\n      return defaultValue;\n    }\n    result = result[key];\n  }\n  \n  return result === undefined ? defaultValue : result;\n}\n\n/**\n * Set nested property value using dot notation\n * @param {Object} obj - Target object\n * @param {string} path - Property path\n * @param {any} value - Value to set\n */\nexport function setNestedValue(obj, path, value) {\n  const keys = path.split('.');\n  let current = obj;\n  \n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i];\n    if (!(key in current)) {\n      current[key] = {};\n    }\n    current = current[key];\n  }\n  \n  current[keys[keys.length - 1]] = value;\n}\n\n/**\n * Debounce a function\n * @param {Function} func - Function to debounce\n * @param {number} wait - Wait time in ms\n * @returns {Function}\n */\nexport function debounce(func, wait) {\n  let timeout;\n  \n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func.apply(this, args);\n    };\n    \n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n\n/**\n * Throttle a function\n * @param {Function} func - Function to throttle\n * @param {number} limit - Time limit in ms\n * @returns {Function}\n */\nexport function throttle(func, limit) {\n  let inThrottle;\n  \n  return function executedFunction(...args) {\n    if (!inThrottle) {\n      func.apply(this, args);\n      inThrottle = true;\n      setTimeout(() => (inThrottle = false), limit);\n    }\n  };\n}\n\n/**\n * Escape HTML special characters\n * @param {string} str - String to escape\n * @returns {string}\n */\nexport function escapeHtml(str) {\n  if (str === null || str === undefined) return '';\n  \n  const htmlEscapes = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;'\n  };\n  \n  return String(str).replace(/[&<>\"']/g, char => htmlEscapes[char]);\n}\n\n/**\n * Format number with thousands separator\n * @param {number} num - Number to format\n * @param {string} [separator=','] - Thousands separator\n * @returns {string}\n */\nexport function formatNumber(num, separator = ',') {\n  if (num === null || num === undefined || isNaN(num)) return '';\n  return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, separator);\n}\n\n/**\n * Parse a value to number safely\n * @param {any} value - Value to parse\n * @param {number} [defaultValue=0] - Default if parsing fails\n * @returns {number}\n */\nexport function toNumber(value, defaultValue = 0) {\n  if (value === null || value === undefined || value === '') {\n    return defaultValue;\n  }\n  const parsed = parseFloat(value);\n  return isNaN(parsed) ? defaultValue : parsed;\n}\n\n/**\n * Group array of objects by a key\n * @param {Array<Object>} array - Array to group\n * @param {string|Function} key - Key to group by\n * @returns {Object}\n */\nexport function groupBy(array, key) {\n  return array.reduce((result, item) => {\n    const groupKey = typeof key === 'function' ? key(item) : item[key];\n    (result[groupKey] = result[groupKey] || []).push(item);\n    return result;\n  }, {});\n}\n\n/**\n * Sort array of objects by multiple keys\n * @param {Array<Object>} array - Array to sort\n * @param {Array<{key: string, order?: 'asc'|'desc'}>} sortBy - Sort configuration\n * @returns {Array<Object>}\n */\nexport function sortByMultiple(array, sortBy) {\n  return [...array].sort((a, b) => {\n    for (const { key, order = 'asc' } of sortBy) {\n      const valueA = a[key];\n      const valueB = b[key];\n      \n      let comparison = 0;\n      \n      if (valueA < valueB) comparison = -1;\n      if (valueA > valueB) comparison = 1;\n      \n      if (comparison !== 0) {\n        return order === 'desc' ? -comparison : comparison;\n      }\n    }\n    return 0;\n  });\n}\n\n/**\n * Sum values in an array\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function sum(values) {\n  return values.reduce((acc, val) => acc + (toNumber(val)), 0);\n}\n\n/**\n * Calculate average of values\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function average(values) {\n  if (values.length === 0) return 0;\n  return sum(values) / values.length;\n}\n\n/**\n * Find minimum value\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function min(values) {\n  const nums = values.filter(v => !isNaN(toNumber(v)));\n  return nums.length ? Math.min(...nums.map(toNumber)) : 0;\n}\n\n/**\n * Find maximum value\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function max(values) {\n  const nums = values.filter(v => !isNaN(toNumber(v)));\n  return nums.length ? Math.max(...nums.map(toNumber)) : 0;\n}\n\n/**\n * Chunk array into smaller arrays\n * @param {Array} array - Array to chunk\n * @param {number} size - Chunk size\n * @returns {Array<Array>}\n */\nexport function chunk(array, size) {\n  const chunks = [];\n  for (let i = 0; i < array.length; i += size) {\n    chunks.push(array.slice(i, i + size));\n  }\n  return chunks;\n}\n\n/**\n * Create a range of numbers\n * @param {number} start - Start value\n * @param {number} end - End value\n * @param {number} [step=1] - Step value\n * @returns {Array<number>}\n */\nexport function range(start, end, step = 1) {\n  const result = [];\n  for (let i = start; i <= end; i += step) {\n    result.push(i);\n  }\n  return result;\n}\n","/**\n * TableState - Centralized state management with change tracking\n *\n * Manages all table data and state with efficient change detection\n * and cascade update support for totals, groups, and computed values.\n */\n\nimport { EventBus, TableEvents } from \"./EventBus.js\"\nimport { deepClone, deepEqual, generateId } from \"../utils/helpers.js\"\n\nexport class TableState {\n  /**\n   * @param {EventBus} eventBus - Event bus instance\n   * @param {Object} initialState - Initial state configuration\n   */\n  constructor(eventBus, initialState = {}) {\n    /** @type {EventBus} */\n    this._eventBus = eventBus\n\n    /** @type {Object} Internal state */\n    this._state = {\n      // Core data\n      data: [],\n      originalData: [],\n\n      // Column definitions\n      columns: [],\n\n      // UI state\n      mode: \"view\", // 'view' | 'edit'\n\n      // Group state\n      groups: {},\n      groupedData: null,\n      collapsedGroups: new Set(),\n\n      // Focus state\n      focusedCell: null,\n\n      // Computed values cache\n      computedCache: new Map(),\n\n      // Dirty tracking\n      dirtyRows: new Set(),\n      dirtyColumns: new Map(),\n\n      // Configuration\n      config: {\n        fixedFirstColumn: false,\n        enableGrouping: false,\n        groupBy: null,\n        enableInfoRows: false,\n        enableRowTotals: false,\n        ...initialState.config,\n      },\n    }\n\n    // Apply initial data\n    if (initialState.data) {\n      this.setData(initialState.data)\n    }\n    if (initialState.columns) {\n      this.setColumns(initialState.columns)\n    }\n  }\n\n  // ============================================\n  // Data Management\n  // ============================================\n\n  /**\n   * Set table data\n   * @param {Array<Object>} data - Row data array\n   */\n  setData(data) {\n    this._state.originalData = deepClone(data)\n    this._state.data = this._normalizeData(data)\n    this._state.dirtyRows.clear()\n    this._invalidateCache()\n\n    if (this._state.config.enableGrouping && this._state.config.groupBy) {\n      this._computeGroups()\n    }\n\n    this._eventBus.emit(TableEvents.DATA_CHANGE, {\n      data: this._state.data,\n      source: \"setData\",\n    })\n  }\n\n  /**\n   * Get current data (returns a copy to prevent mutation)\n   * @returns {Array<Object>}\n   */\n  getData() {\n    return deepClone(this._state.data)\n  }\n\n  /**\n   * Get a single row by ID\n   * @param {string|number} rowId - Row identifier\n   * @returns {Object|null}\n   */\n  getRow(rowId) {\n    const row = this._state.data.find((r) => r._id === rowId)\n    return row ? deepClone(row) : null\n  }\n\n  /**\n   * Update a specific cell value\n   * @param {string|number} rowId - Row identifier\n   * @param {string} columnName - Column name\n   * @param {any} value - New value\n   * @param {Object} options - Update options\n   */\n  updateCell(rowId, columnName, value, options = {}) {\n    const rowIndex = this._state.data.findIndex((r) => r._id === rowId)\n    if (rowIndex === -1) return\n\n    const row = this._state.data[rowIndex]\n    const oldValue = row[columnName]\n\n    // Skip if value hasn't changed\n    if (deepEqual(oldValue, value)) return\n\n    // Update the value\n    row[columnName] = value\n\n    // Mark as dirty\n    this._state.dirtyRows.add(rowId)\n    if (!this._state.dirtyColumns.has(rowId)) {\n      this._state.dirtyColumns.set(rowId, new Set())\n    }\n    this._state.dirtyColumns.get(rowId).add(columnName)\n\n    // Invalidate affected cache\n    this._invalidateCacheForRow(rowId, columnName)\n\n    // Emit cell change event\n    this._eventBus.emit(TableEvents.CELL_CHANGE, {\n      rowId,\n      rowIndex,\n      columnName,\n      oldValue,\n      newValue: value,\n      row: deepClone(row),\n    })\n\n    // Emit row change event\n    this._eventBus.emit(TableEvents.ROW_CHANGE, {\n      rowId,\n      rowIndex,\n      columnName,\n      row: deepClone(row),\n      dirtyColumns: Array.from(this._state.dirtyColumns.get(rowId) || []),\n    })\n\n    // Trigger cascade updates if needed\n    if (!options.skipCascade) {\n      this._triggerCascadeUpdate(rowId, columnName, value)\n    }\n  }\n\n  /**\n   * Batch update multiple cells (more efficient for bulk changes)\n   * @param {Array<{rowId, columnName, value}>} updates - Array of updates\n   */\n  batchUpdate(updates) {\n    this._eventBus.startBatch()\n\n    updates.forEach(({ rowId, columnName, value }) => {\n      this.updateCell(rowId, columnName, value, { skipCascade: true })\n    })\n\n    // Compute cascade updates once for all changes\n    this._computeAllCascades()\n\n    this._eventBus.endBatch()\n\n    this._eventBus.emit(TableEvents.DATA_CHANGE, {\n      data: this._state.data,\n      source: \"batchUpdate\",\n      updatedRows: updates.map((u) => u.rowId),\n    })\n  }\n\n  // ============================================\n  // Column Management\n  // ============================================\n\n  /**\n   * Set column definitions\n   * @param {Array<Object>} columns - Column configuration array\n   */\n  setColumns(columns) {\n    this._state.columns = columns.map((col, index) => ({\n      ...col,\n      _index: index,\n      _id: col.id || col.data || `col_${index}`,\n    }))\n\n    this._eventBus.emit(TableEvents.STATE_CHANGE, {\n      property: \"columns\",\n      value: this._state.columns,\n    })\n  }\n\n  /**\n   * Get column definitions\n   * @returns {Array<Object>}\n   */\n  getColumns() {\n    const columns = [...this._state.columns]\n\n    // Append row total column if enabled\n    if (this._state.config.enableRowTotals) {\n      // Default format: $X,XXX\n      const defaultFormat = (value) =>\n        value !== null && value !== undefined\n          ? `$${Number(value).toLocaleString()}`\n          : \"$0\"\n\n      columns.push({\n        data: \"_rowTotal\",\n        title: \"Total\",\n        type: \"number\",\n        editable: false,\n        aggregate: \"sum\",\n        _id: \"_rowTotal\",\n        _index: columns.length,\n        _isRowTotal: true,\n        format: this._state.config.rowTotalsFormat || defaultFormat,\n      })\n    }\n\n    return columns\n  }\n\n  /**\n   * Get a column by name/id\n   * @param {string} columnId - Column identifier\n   * @returns {Object|null}\n   */\n  getColumn(columnId) {\n    // Check for row total column\n    if (columnId === \"_rowTotal\" && this._state.config.enableRowTotals) {\n      // Default format: $X,XXX\n      const defaultFormat = (value) =>\n        value !== null && value !== undefined\n          ? `$${Number(value).toLocaleString()}`\n          : \"$0\"\n\n      return {\n        data: \"_rowTotal\",\n        title: \"Total\",\n        type: \"number\",\n        editable: false,\n        aggregate: \"sum\",\n        _id: \"_rowTotal\",\n        _isRowTotal: true,\n        format: this._state.config.rowTotalsFormat || defaultFormat,\n      }\n    }\n\n    return this._state.columns.find(\n      (c) => c._id === columnId || c.data === columnId\n    )\n  }\n\n  // ============================================\n  // Mode Management\n  // ============================================\n\n  /**\n   * Set table mode\n   * @param {'view'|'edit'} mode - Table mode\n   */\n  setMode(mode) {\n    if (mode !== \"view\" && mode !== \"edit\") {\n      console.warn(`Invalid mode: ${mode}. Must be 'view' or 'edit'.`)\n      return\n    }\n\n    const oldMode = this._state.mode\n    this._state.mode = mode\n\n    this._eventBus.emit(TableEvents.MODE_CHANGE, {\n      oldMode,\n      newMode: mode,\n    })\n  }\n\n  /**\n   * Get current mode\n   * @returns {'view'|'edit'}\n   */\n  getMode() {\n    return this._state.mode\n  }\n\n  /**\n   * Check if in edit mode\n   * @returns {boolean}\n   */\n  isEditMode() {\n    return this._state.mode === \"edit\"\n  }\n\n  // ============================================\n  // Group Management\n  // ============================================\n\n  /**\n   * Toggle group visibility\n   * @param {string} groupId - Group identifier\n   */\n  toggleGroup(groupId) {\n    if (this._state.collapsedGroups.has(groupId)) {\n      this._state.collapsedGroups.delete(groupId)\n    } else {\n      this._state.collapsedGroups.add(groupId)\n    }\n\n    this._eventBus.emit(TableEvents.GROUP_TOGGLE, {\n      groupId,\n      collapsed: this._state.collapsedGroups.has(groupId),\n    })\n  }\n\n  /**\n   * Check if a group is collapsed\n   * @param {string} groupId - Group identifier\n   * @returns {boolean}\n   */\n  isGroupCollapsed(groupId) {\n    return this._state.collapsedGroups.has(groupId)\n  }\n\n  /**\n   * Get grouped data structure\n   * @returns {Object|null}\n   */\n  getGroupedData() {\n    return this._state.groupedData\n  }\n\n  /**\n   * Get ungrouped rows (rows without a group value)\n   * @returns {Array}\n   */\n  getUngroupedRows() {\n    return this._state.ungroupedRows || []\n  }\n\n  /**\n   * Get info rows (informational header rows)\n   * @returns {Array}\n   */\n  getInfoRows() {\n    return this._state.infoRows || []\n  }\n\n  /**\n   * Expand all groups\n   */\n  expandAllGroups() {\n    this._state.collapsedGroups.clear()\n    this._eventBus.emit(TableEvents.GROUP_EXPAND_ALL, {})\n  }\n\n  /**\n   * Collapse all groups\n   */\n  collapseAllGroups() {\n    if (this._state.groupedData) {\n      Object.keys(this._state.groupedData).forEach((groupId) => {\n        this._state.collapsedGroups.add(groupId)\n      })\n    }\n    this._eventBus.emit(TableEvents.GROUP_COLLAPSE_ALL, {})\n  }\n\n  // ============================================\n  // Dirty State Management\n  // ============================================\n\n  /**\n   * Get all dirty (modified) rows\n   * @returns {Array<Object>}\n   */\n  getDirtyRows() {\n    return this._state.data\n      .filter((row) => this._state.dirtyRows.has(row._id))\n      .map((row) => deepClone(row))\n  }\n\n  /**\n   * Check if a row is dirty\n   * @param {string|number} rowId - Row identifier\n   * @returns {boolean}\n   */\n  isRowDirty(rowId) {\n    return this._state.dirtyRows.has(rowId)\n  }\n\n  /**\n   * Clear dirty state (e.g., after save)\n   */\n  clearDirty() {\n    this._state.dirtyRows.clear()\n    this._state.dirtyColumns.clear()\n    this._state.originalData = deepClone(this._state.data)\n  }\n\n  /**\n   * Revert all changes to original data\n   */\n  revertChanges() {\n    this.setData(this._state.originalData)\n  }\n\n  // ============================================\n  // Configuration\n  // ============================================\n\n  /**\n   * Update configuration\n   * @param {Object} config - Configuration updates\n   */\n  setConfig(config) {\n    this._state.config = { ...this._state.config, ...config }\n\n    if (config.groupBy !== undefined) {\n      this._computeGroups()\n    }\n\n    this._eventBus.emit(TableEvents.STATE_CHANGE, {\n      property: \"config\",\n      value: this._state.config,\n    })\n  }\n\n  /**\n   * Get current configuration\n   * @returns {Object}\n   */\n  getConfig() {\n    return { ...this._state.config }\n  }\n\n  // ============================================\n  // Private Methods\n  // ============================================\n\n  /**\n   * Normalize data by adding internal IDs\n   * @private\n   */\n  _normalizeData(data) {\n    return data.map((row, index) => ({\n      ...row,\n      _id: row._id || row.id || generateId(),\n      _index: index,\n      _type: row._type || \"data\", // 'data' | 'infoRow' | 'group-header' | 'total'\n    }))\n  }\n\n  /**\n   * Compute group structure from data\n   * @private\n   */\n  _computeGroups() {\n    const { groupBy } = this._state.config\n    if (!groupBy) {\n      this._state.groupedData = null\n      return\n    }\n\n    const groups = {}\n    const ungroupedRows = []\n    const infoRows = []\n\n    this._state.data.forEach((row) => {\n      // Info rows are rendered separately at the top\n      if (row._type === \"infoRow\") {\n        infoRows.push(row)\n        return\n      }\n\n      // Only include data rows in groups\n      if (row._type !== \"data\") return\n\n      const groupKey =\n        typeof groupBy === \"function\" ? groupBy(row) : row[groupBy]\n\n      // Handle rows without a group value\n      if (groupKey === null || groupKey === undefined || groupKey === \"\") {\n        ungroupedRows.push(row)\n        return\n      }\n\n      if (!groups[groupKey]) {\n        groups[groupKey] = {\n          id: groupKey,\n          label: groupKey,\n          rows: [],\n          totals: {},\n        }\n      }\n      groups[groupKey].rows.push(row)\n    })\n\n    // Store ungrouped rows and info rows separately\n    this._state.groupedData = groups\n    this._state.ungroupedRows = ungroupedRows\n    this._state.infoRows = infoRows\n  }\n\n  /**\n   * Invalidate entire computed cache\n   * @private\n   */\n  _invalidateCache() {\n    this._state.computedCache.clear()\n  }\n\n  /**\n   * Invalidate cache for specific row/column\n   * @private\n   */\n  _invalidateCacheForRow(rowId, columnName) {\n    // Invalidate direct cache\n    this._state.computedCache.delete(`${rowId}:${columnName}`)\n\n    // Invalidate dependent caches (totals, cumulative, etc.)\n    const column = this.getColumn(columnName)\n    if (column && column.affectsColumns) {\n      column.affectsColumns.forEach((affectedCol) => {\n        this._state.computedCache.forEach((_, key) => {\n          if (key.includes(`:${affectedCol}`)) {\n            this._state.computedCache.delete(key)\n          }\n        })\n      })\n    }\n  }\n\n  /**\n   * Trigger cascade updates for dependent rows/cells\n   * @private\n   */\n  _triggerCascadeUpdate(rowId, columnName, value) {\n    const column = this.getColumn(columnName)\n    if (!column) return\n\n    // Check for cascade configuration\n    if (column.cascade) {\n      column.cascade({\n        rowId,\n        columnName,\n        value,\n        state: this,\n        updateCell: (rId, cName, val) => {\n          this.updateCell(rId, cName, val, { skipCascade: true })\n        },\n      })\n    }\n\n    // Note: Group totals are recalculated by GroupManager which listens for CELL_CHANGE events\n  }\n\n  /**\n   * Compute all cascade updates (for batch operations)\n   * @private\n   */\n  _computeAllCascades() {\n    // Note: Group totals are recalculated by GroupManager which listens for DATA_CHANGE events\n  }\n\n  /**\n   * Destroy state and cleanup\n   */\n  destroy() {\n    this._state.data = []\n    this._state.columns = []\n    this._state.computedCache.clear()\n    this._state.dirtyRows.clear()\n    this._state.dirtyColumns.clear()\n    this._state.collapsedGroups.clear()\n  }\n}\n","/**\n * DOM Utilities - Helper functions for DOM manipulation\n */\n\n/**\n * Create an element with attributes\n * @param {string} tag - HTML tag name\n * @param {Object} [attributes] - Attributes to set\n * @returns {HTMLElement}\n */\nexport function createElement(tag, attributes = {}) {\n  const element = document.createElement(tag)\n  setAttributes(element, attributes)\n  return element\n}\n\n/**\n * Set multiple attributes on an element\n * @param {HTMLElement} element - Target element\n * @param {Object} attributes - Attributes object\n */\nexport function setAttributes(element, attributes) {\n  Object.entries(attributes).forEach(([key, value]) => {\n    if (key === \"class\") {\n      element.className = value\n    } else if (key === \"style\" && typeof value === \"object\") {\n      Object.assign(element.style, value)\n    } else if (key.startsWith(\"data-\")) {\n      element.setAttribute(key, value)\n    } else if (key in element) {\n      element[key] = value\n    } else {\n      element.setAttribute(key, value)\n    }\n  })\n}\n\n/**\n * Add one or more classes to an element\n * @param {HTMLElement} element - Target element\n * @param {...string} classNames - Class names to add\n */\nexport function addClass(element, ...classNames) {\n  classNames.forEach((className) => {\n    if (className) {\n      element.classList.add(className)\n    }\n  })\n}\n\n/**\n * Remove one or more classes from an element\n * @param {HTMLElement} element - Target element\n * @param {...string} classNames - Class names to remove\n */\nexport function removeClass(element, ...classNames) {\n  classNames.forEach((className) => {\n    if (className) {\n      element.classList.remove(className)\n    }\n  })\n}\n\n/**\n * Toggle a class on an element\n * @param {HTMLElement} element - Target element\n * @param {string} className - Class name to toggle\n * @param {boolean} [force] - Force add or remove\n * @returns {boolean} - Whether class is now present\n */\nexport function toggleClass(element, className, force) {\n  return element.classList.toggle(className, force)\n}\n\n/**\n * Check if element has a class\n * @param {HTMLElement} element - Target element\n * @param {string} className - Class name to check\n * @returns {boolean}\n */\nexport function hasClass(element, className) {\n  return element.classList.contains(className)\n}\n\n/**\n * Find closest ancestor matching selector\n * @param {HTMLElement} element - Starting element\n * @param {string} selector - CSS selector\n * @returns {HTMLElement|null}\n */\nexport function closest(element, selector) {\n  return element.closest(selector)\n}\n\n/**\n * Query selector wrapper\n * @param {string} selector - CSS selector\n * @param {HTMLElement} [context=document] - Context element\n * @returns {HTMLElement|null}\n */\nexport function $(selector, context = document) {\n  return context.querySelector(selector)\n}\n\n/**\n * Query selector all wrapper\n * @param {string} selector - CSS selector\n * @param {HTMLElement} [context=document] - Context element\n * @returns {NodeListOf<HTMLElement>}\n */\nexport function $$(selector, context = document) {\n  return context.querySelectorAll(selector)\n}\n\n/**\n * Get element's offset relative to document\n * @param {HTMLElement} element - Target element\n * @returns {{top: number, left: number}}\n */\nexport function getOffset(element) {\n  const rect = element.getBoundingClientRect()\n  return {\n    top: rect.top + window.scrollY,\n    left: rect.left + window.scrollX,\n  }\n}\n\n/**\n * Get element dimensions including padding and border\n * @param {HTMLElement} element - Target element\n * @returns {{width: number, height: number}}\n */\nexport function getOuterDimensions(element) {\n  return {\n    width: element.offsetWidth,\n    height: element.offsetHeight,\n  }\n}\n\n/**\n * Get element dimensions excluding padding and border\n * @param {HTMLElement} element - Target element\n * @returns {{width: number, height: number}}\n */\nexport function getInnerDimensions(element) {\n  const style = getComputedStyle(element)\n  return {\n    width:\n      element.clientWidth -\n      parseFloat(style.paddingLeft) -\n      parseFloat(style.paddingRight),\n    height:\n      element.clientHeight -\n      parseFloat(style.paddingTop) -\n      parseFloat(style.paddingBottom),\n  }\n}\n\n/**\n * Scroll element into view with options\n * @param {HTMLElement} element - Target element\n * @param {Object} [options] - ScrollIntoView options\n */\nexport function scrollIntoView(element, options = {}) {\n  element.scrollIntoView({\n    behavior: \"smooth\",\n    block: \"nearest\",\n    inline: \"nearest\",\n    ...options,\n  })\n}\n\n/**\n * Delegate event handling\n * @param {HTMLElement} parent - Parent element\n * @param {string} eventType - Event type\n * @param {string} selector - Child selector\n * @param {Function} handler - Event handler\n * @returns {Function} - Cleanup function\n */\nexport function delegate(parent, eventType, selector, handler) {\n  const listener = (event) => {\n    const target = event.target.closest(selector)\n    if (target && parent.contains(target)) {\n      handler.call(target, event, target)\n    }\n  }\n\n  parent.addEventListener(eventType, listener)\n\n  return () => parent.removeEventListener(eventType, listener)\n}\n\n/**\n * Create document fragment from HTML string\n * @param {string} html - HTML string\n * @returns {DocumentFragment}\n */\nexport function createFragment(html) {\n  const template = document.createElement(\"template\")\n  template.innerHTML = html.trim()\n  return template.content\n}\n\n/**\n * Empty an element's contents\n * @param {HTMLElement} element - Target element\n */\nexport function empty(element) {\n  while (element.firstChild) {\n    element.removeChild(element.firstChild)\n  }\n}\n\n/**\n * Check if element is visible in viewport\n * @param {HTMLElement} element - Target element\n * @returns {boolean}\n */\nexport function isInViewport(element) {\n  const rect = element.getBoundingClientRect()\n  return (\n    rect.top >= 0 &&\n    rect.left >= 0 &&\n    rect.bottom <=\n      (window.innerHeight || document.documentElement.clientHeight) &&\n    rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n  )\n}\n\n/**\n * Throttle function execution\n * @param {Function} func - Function to throttle\n * @param {number} wait - Wait time in milliseconds\n * @returns {Function} - Throttled function\n */\nexport function throttle(func, wait) {\n  let timeout = null\n  let lastRan = null\n\n  return function (...args) {\n    if (!lastRan) {\n      func.apply(this, args)\n      lastRan = Date.now()\n    } else {\n      clearTimeout(timeout)\n      timeout = setTimeout(() => {\n        if (Date.now() - lastRan >= wait) {\n          func.apply(this, args)\n          lastRan = Date.now()\n        }\n      }, wait - (Date.now() - lastRan))\n    }\n  }\n}\n\n/**\n * Debounce function execution\n * @param {Function} func - Function to debounce\n * @param {number} wait - Wait time in milliseconds\n * @returns {Function} - Debounced function\n */\nexport function debounce(func, wait) {\n  let timeout\n  return function (...args) {\n    clearTimeout(timeout)\n    timeout = setTimeout(() => func.apply(this, args), wait)\n  }\n}\n","/**\r\n * TableRenderer - Handles all DOM rendering operations\r\n *\r\n * Responsible for creating and updating the table DOM structure\r\n * with efficient differential updates for performance.\r\n */\r\n\r\nimport { TableEvents } from \"./EventBus.js\"\r\nimport {\r\n  createElement,\r\n  addClass,\r\n  removeClass,\r\n  setAttributes,\r\n} from \"../utils/dom.js\"\r\nimport { escapeHtml } from \"../utils/helpers.js\"\r\n\r\nexport class TableRenderer {\r\n  /**\r\n   * @param {HTMLElement} container - Container element\r\n   * @param {TableState} state - Table state instance\r\n   */\r\n  constructor(container, state) {\r\n    this._container = container\r\n    this._state = state\r\n    this._eventBus = state._eventBus\r\n\r\n    /** @type {HTMLElement} */\r\n    this._tableWrapper = null\r\n\r\n    /** @type {HTMLElement} */\r\n    this._table = null\r\n\r\n    /** @type {HTMLElement} */\r\n    this._thead = null\r\n\r\n    /** @type {HTMLElement} */\r\n    this._tbody = null\r\n\r\n    /** @type {Map<string, HTMLElement>} */\r\n    this._rowElements = new Map()\r\n\r\n    /** @type {Map<string, HTMLElement>} */\r\n    this._cellElements = new Map()\r\n\r\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\r\n    this._unsubscribers = []\r\n\r\n    // Subscribe to state changes\r\n    this._setupEventListeners()\r\n  }\r\n\r\n  /**\r\n   * Main render method\r\n   */\r\n  render() {\r\n    const config = this._state.getConfig()\r\n\r\n    // Create structure if it doesn't exist\r\n    if (!this._tableWrapper) {\r\n      this._createStructure()\r\n    }\r\n\r\n    // Update container classes based on config\r\n    this._updateContainerClasses(config)\r\n\r\n    // Render header\r\n    this._renderHeader()\r\n\r\n    // Render body based on grouping config\r\n    if (config.enableGrouping && this._state.getGroupedData()) {\r\n      this._renderGroupedBody()\r\n    } else {\r\n      this._renderBody()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a single cell without full re-render\r\n   * @param {string} rowId - Row identifier\r\n   * @param {string} columnName - Column name\r\n   * @param {any} value - New value\r\n   */\r\n  updateCell(rowId, columnName, value) {\r\n    const cellKey = `${rowId}:${columnName}`\r\n    const cell = this._cellElements.get(cellKey)\r\n\r\n    if (cell) {\r\n      const column = this._state.getColumn(columnName)\r\n      this._renderCellContent(cell, value, column, this._state.getRow(rowId))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a single row without full re-render\r\n   * @param {string} rowId - Row identifier\r\n   */\r\n  updateRow(rowId) {\r\n    const rowElement = this._rowElements.get(rowId)\r\n    const rowData = this._state.getRow(rowId)\r\n\r\n    if (rowElement && rowData) {\r\n      const columns = this._state.getColumns()\r\n      columns.forEach((column) => {\r\n        const cellKey = `${rowId}:${column.data}`\r\n        const cell = this._cellElements.get(cellKey)\r\n        if (cell) {\r\n          this._renderCellContent(cell, rowData[column.data], column, rowData)\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get cell element by row and column\r\n   * @param {string} rowId - Row identifier\r\n   * @param {string} columnName - Column name\r\n   * @returns {HTMLElement|null}\r\n   */\r\n  getCellElement(rowId, columnName) {\r\n    return this._cellElements.get(`${rowId}:${columnName}`) || null\r\n  }\r\n\r\n  /**\r\n   * Get row element by ID\r\n   * @param {string} rowId - Row identifier\r\n   * @returns {HTMLElement|null}\r\n   */\r\n  getRowElement(rowId) {\r\n    return this._rowElements.get(rowId) || null\r\n  }\r\n\r\n  /**\r\n   * Cleanup and destroy\r\n   */\r\n  destroy() {\r\n    // Unsubscribe from all event listeners\r\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\r\n    this._unsubscribers = []\r\n\r\n    // Clear element caches\r\n    this._rowElements.clear()\r\n    this._cellElements.clear()\r\n\r\n    // Remove DOM elements\r\n    if (this._tableWrapper) {\r\n      this._tableWrapper.remove()\r\n    }\r\n  }\r\n\r\n  // ============================================\r\n  // Private Methods\r\n  // ============================================\r\n\r\n  /**\r\n   * Setup event listeners for state changes\r\n   * @private\r\n   */\r\n  _setupEventListeners() {\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(\r\n        TableEvents.CELL_CHANGE,\r\n        ({ rowId, columnName, newValue }) => {\r\n          this.updateCell(rowId, columnName, newValue)\r\n        }\r\n      )\r\n    )\r\n\r\n    // Listen for data changes (row add/delete) to re-render\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.DATA_CHANGE, () => {\r\n        this.render()\r\n      })\r\n    )\r\n\r\n    // Listen for row total changes (emitted by GroupManager after calculation)\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.ROW_TOTAL_CHANGE, ({ rowId, newValue }) => {\r\n        this.updateCell(rowId, \"_rowTotal\", newValue)\r\n      })\r\n    )\r\n\r\n    // Listen for group totals updates to re-render group headers\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.STATE_CHANGE, ({ property, groupId }) => {\r\n        if (property === \"groupTotals\") {\r\n          // Re-render group headers to show updated aggregates\r\n          this._updateGroupHeaders(groupId)\r\n        }\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.MODE_CHANGE, () => {\r\n        this.render()\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.GROUP_TOGGLE, ({ groupId, collapsed }) => {\r\n        this._toggleGroupVisibility(groupId, collapsed)\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.GROUP_EXPAND_ALL, () => {\r\n        this._setAllGroupsVisibility(false)\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.GROUP_COLLAPSE_ALL, () => {\r\n        this._setAllGroupsVisibility(true)\r\n      })\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Create the base DOM structure\r\n   * @private\r\n   */\r\n  _createStructure() {\r\n    addClass(this._container, \"dg-container\")\r\n\r\n    // Create wrapper for scroll handling\r\n    this._tableWrapper = createElement(\"div\", { class: \"dg-table-wrapper\" })\r\n\r\n    // Create table\r\n    this._table = createElement(\"table\", { class: \"dg-table\" })\r\n\r\n    // Create header\r\n    this._thead = createElement(\"thead\", { class: \"dg-thead\" })\r\n\r\n    // Create body\r\n    this._tbody = createElement(\"tbody\", { class: \"dg-tbody\" })\r\n\r\n    // Assemble\r\n    this._table.appendChild(this._thead)\r\n    this._table.appendChild(this._tbody)\r\n    this._tableWrapper.appendChild(this._table)\r\n    this._container.appendChild(this._tableWrapper)\r\n  }\r\n\r\n  /**\r\n   * Update container classes based on config\r\n   * @private\r\n   */\r\n  _updateContainerClasses(config) {\r\n    const mode = this._state.getMode()\r\n\r\n    // Mode classes\r\n    removeClass(this._container, \"dg-mode-view\", \"dg-mode-edit\")\r\n    addClass(this._container, `dg-mode-${mode}`)\r\n\r\n    // Feature classes\r\n    if (config.fixedFirstColumn) {\r\n      addClass(this._container, \"dg-fixed-first-column\")\r\n    } else {\r\n      removeClass(this._container, \"dg-fixed-first-column\")\r\n    }\r\n\r\n    if (config.enableGrouping) {\r\n      addClass(this._container, \"dg-grouped\")\r\n    } else {\r\n      removeClass(this._container, \"dg-grouped\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render table header\r\n   * @private\r\n   */\r\n  _renderHeader() {\r\n    const columns = this._state.getColumns()\r\n    const config = this._state.getConfig()\r\n\r\n    this._thead.innerHTML = \"\"\r\n\r\n    const headerRow = createElement(\"tr\", { class: \"dg-header-row\" })\r\n\r\n    let visibleIndex = 0\r\n    columns.forEach((column) => {\r\n      if (column.visible === false) return\r\n\r\n      const th = createElement(\"th\", {\r\n        class: \"dg-header-cell\",\r\n        \"data-column\": column.data,\r\n        \"data-column-index\": visibleIndex,\r\n      })\r\n\r\n      // Fixed first column\r\n      if (visibleIndex === 0 && config.fixedFirstColumn) {\r\n        addClass(th, \"dg-cell-fixed\")\r\n      }\r\n\r\n      // Row total column header\r\n      if (column._isRowTotal) {\r\n        addClass(th, \"dg-header-row-total\")\r\n      }\r\n\r\n      // Header content\r\n      const headerContent = createElement(\"div\", { class: \"dg-header-content\" })\r\n      headerContent.textContent = column.title || column.data\r\n      th.appendChild(headerContent)\r\n\r\n      // Column width\r\n      if (column.width) {\r\n        th.style.width =\r\n          typeof column.width === \"number\" ? `${column.width}px` : column.width\r\n      }\r\n\r\n      headerRow.appendChild(th)\r\n      visibleIndex++\r\n    })\r\n\r\n    this._thead.appendChild(headerRow)\r\n  }\r\n\r\n  /**\r\n   * Render table body (ungrouped)\r\n   * @private\r\n   */\r\n  _renderBody() {\r\n    const data = this._state.getData()\r\n    const columns = this._state.getColumns()\r\n\r\n    this._tbody.innerHTML = \"\"\r\n    this._rowElements.clear()\r\n    this._cellElements.clear()\r\n\r\n    data.forEach((row) => {\r\n      const rowElement = this._createRowElement(row, columns)\r\n      this._tbody.appendChild(rowElement)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Render table body (grouped)\r\n   * @private\r\n   */\r\n  _renderGroupedBody() {\r\n    const groupedData = this._state.getGroupedData()\r\n    const ungroupedRows = this._state.getUngroupedRows()\r\n    const infoRows = this._state.getInfoRows()\r\n    const columns = this._state.getColumns()\r\n\r\n    this._tbody.innerHTML = \"\"\r\n    this._rowElements.clear()\r\n    this._cellElements.clear()\r\n\r\n    // Render info rows first (at the top, not part of any group)\r\n    if (infoRows && infoRows.length > 0) {\r\n      infoRows.forEach((row) => {\r\n        const rowElement = this._createRowElement(row, columns, null)\r\n        addClass(rowElement, \"dg-row-info\")\r\n        this._tbody.appendChild(rowElement)\r\n      })\r\n    }\r\n\r\n    // Render grouped rows\r\n    Object.entries(groupedData).forEach(([groupId, group]) => {\r\n      // Group header row (includes aggregate values)\r\n      const groupHeader = this._createGroupHeaderRow(groupId, group, columns)\r\n      this._tbody.appendChild(groupHeader)\r\n\r\n      // Group rows\r\n      const isCollapsed = this._state.isGroupCollapsed(groupId)\r\n      group.rows.forEach((row) => {\r\n        const rowElement = this._createRowElement(row, columns, groupId)\r\n        if (isCollapsed) {\r\n          addClass(rowElement, \"dg-row-hidden\")\r\n        }\r\n        this._tbody.appendChild(rowElement)\r\n      })\r\n    })\r\n\r\n    // Render ungrouped rows at the end (rows without a group value)\r\n    if (ungroupedRows.length > 0) {\r\n      ungroupedRows.forEach((row) => {\r\n        const rowElement = this._createRowElement(row, columns, null)\r\n        addClass(rowElement, \"dg-row-ungrouped\")\r\n        this._tbody.appendChild(rowElement)\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a data row element\r\n   * @private\r\n   */\r\n  _createRowElement(row, columns, groupId = null) {\r\n    const config = this._state.getConfig()\r\n    const isInfoRow = row._type === \"infoRow\"\r\n\r\n    const tr = createElement(\"tr\", {\r\n      class: `dg-row ${isInfoRow ? \"dg-row-info-row\" : \"dg-row-data\"}`,\r\n      \"data-row-id\": row._id,\r\n      \"data-row-index\": row._index,\r\n    })\r\n\r\n    if (groupId) {\r\n      tr.setAttribute(\"data-group\", groupId)\r\n    }\r\n\r\n    // Mark dirty rows\r\n    if (this._state.isRowDirty(row._id)) {\r\n      addClass(tr, \"dg-row-dirty\")\r\n    }\r\n\r\n    // Row click handler\r\n    tr.addEventListener(\"click\", (e) => {\r\n      if (!e.target.closest(\".dg-cell-input\")) {\r\n        this._eventBus.emit(TableEvents.ROW_CLICK, {\r\n          rowId: row._id,\r\n          rowIndex: row._index,\r\n          row: this._state.getRow(row._id),\r\n          event: e,\r\n        })\r\n      }\r\n    })\r\n\r\n    // Create cells\r\n    let visibleIndex = 0\r\n    columns.forEach((column) => {\r\n      if (column.visible === false) return\r\n\r\n      const td = this._createCellElement(row, column, visibleIndex, config)\r\n      tr.appendChild(td)\r\n\r\n      // Store reference\r\n      this._cellElements.set(`${row._id}:${column.data}`, td)\r\n      visibleIndex++\r\n    })\r\n\r\n    // Store reference\r\n    this._rowElements.set(row._id, tr)\r\n\r\n    return tr\r\n  }\r\n\r\n  /**\r\n   * Create a cell element\r\n   * @private\r\n   */\r\n  _createCellElement(row, column, index, config) {\r\n    const td = createElement(\"td\", {\r\n      class: \"dg-cell\",\r\n      \"data-column\": column.data,\r\n    })\r\n\r\n    // Fixed first column\r\n    if (index === 0 && config.fixedFirstColumn) {\r\n      addClass(td, \"dg-cell-fixed\")\r\n    }\r\n\r\n    // Row total column\r\n    if (column._isRowTotal) {\r\n      addClass(td, \"dg-cell-row-total\")\r\n    }\r\n\r\n    // Cell type classes\r\n    if (column.type) {\r\n      addClass(td, `dg-cell-${column.type}`)\r\n    }\r\n\r\n    // Alignment\r\n    if (column.align) {\r\n      td.style.textAlign = column.align\r\n    }\r\n\r\n    // Render content\r\n    this._renderCellContent(td, row[column.data], column, row)\r\n\r\n    return td\r\n  }\r\n\r\n  /**\r\n   * Render cell content based on mode and column config\r\n   * @private\r\n   */\r\n  _renderCellContent(cell, value, column, row) {\r\n    const isEditMode = this._state.isEditMode()\r\n    // Check column, row type, and row-level editable override\r\n    const isEditable =\r\n      column.editable !== false &&\r\n      row._type !== \"infoRow\" &&\r\n      row._editable !== false\r\n\r\n    cell.innerHTML = \"\"\r\n\r\n    if (isEditMode && isEditable) {\r\n      // Edit mode - render input\r\n      const input = this._createInputElement(value, column, row)\r\n      cell.appendChild(input)\r\n    } else {\r\n      // View mode - render display value\r\n      const displayValue = this._formatDisplayValue(value, column, row)\r\n\r\n      if (column.render) {\r\n        // Custom render function\r\n        const rendered = column.render(value, row, column)\r\n        if (typeof rendered === \"string\") {\r\n          cell.innerHTML = rendered\r\n        } else if (rendered instanceof HTMLElement) {\r\n          cell.appendChild(rendered)\r\n        }\r\n      } else {\r\n        cell.textContent = displayValue\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create input element for edit mode\r\n   * @private\r\n   */\r\n  _createInputElement(value, column, row) {\r\n    const type = column.inputType || column.type || \"text\"\r\n\r\n    let input\r\n\r\n    if (type === \"select\" && column.options) {\r\n      input = createElement(\"select\", { class: \"dg-cell-input dg-cell-select\" })\r\n      column.options.forEach((opt) => {\r\n        const option = createElement(\"option\", { value: opt.value || opt })\r\n        option.textContent = opt.label || opt\r\n        if ((opt.value || opt) === value) {\r\n          option.selected = true\r\n        }\r\n        input.appendChild(option)\r\n      })\r\n    } else if (type === \"textarea\") {\r\n      input = createElement(\"textarea\", {\r\n        class: \"dg-cell-input dg-cell-textarea\",\r\n        value: value || \"\",\r\n      })\r\n      input.textContent = value || \"\"\r\n    } else {\r\n      input = createElement(\"input\", {\r\n        class: \"dg-cell-input\",\r\n        type: type === \"number\" ? \"number\" : \"text\",\r\n        value: value ?? \"\",\r\n      })\r\n\r\n      if (type === \"number\") {\r\n        if (column.min !== undefined) input.min = column.min\r\n        if (column.max !== undefined) input.max = column.max\r\n        if (column.step !== undefined) input.step = column.step\r\n      }\r\n    }\r\n\r\n    // Input event handlers\r\n    input.addEventListener(\"focus\", () => {\r\n      this._eventBus.emit(TableEvents.CELL_FOCUS, {\r\n        rowId: row._id,\r\n        columnName: column.data,\r\n        value,\r\n      })\r\n    })\r\n\r\n    input.addEventListener(\"blur\", () => {\r\n      this._eventBus.emit(TableEvents.CELL_BLUR, {\r\n        rowId: row._id,\r\n        columnName: column.data,\r\n        value: input.value,\r\n      })\r\n    })\r\n\r\n    input.addEventListener(\"change\", (e) => {\r\n      let newValue = e.target.value\r\n\r\n      // Type coercion\r\n      if (type === \"number\") {\r\n        newValue = newValue === \"\" ? null : parseFloat(newValue)\r\n      }\r\n\r\n      this._state.updateCell(row._id, column.data, newValue)\r\n\r\n      // Column-specific onChange\r\n      if (column.onChange) {\r\n        column.onChange({\r\n          value: newValue,\r\n          rowId: row._id,\r\n          row: this._state.getRow(row._id),\r\n          column,\r\n        })\r\n      }\r\n    })\r\n\r\n    return input\r\n  }\r\n\r\n  /**\r\n   * Format value for display\r\n   * @private\r\n   */\r\n  _formatDisplayValue(value, column, row) {\r\n    if (value === null || value === undefined) {\r\n      return column.defaultValue ?? \"\"\r\n    }\r\n\r\n    // Info rows display values as-is without column formatting\r\n    if (row._type === \"infoRow\") {\r\n      return String(value)\r\n    }\r\n\r\n    if (column.format) {\r\n      return column.format(value, row, column)\r\n    }\r\n\r\n    if (column.type === \"number\" && typeof value === \"number\") {\r\n      return column.decimals !== undefined\r\n        ? value.toFixed(column.decimals)\r\n        : value.toString()\r\n    }\r\n\r\n    if (column.type === \"currency\") {\r\n      const formatted = new Intl.NumberFormat(\"en-US\", {\r\n        style: \"currency\",\r\n        currency: column.currency || \"USD\",\r\n      }).format(value)\r\n      return formatted\r\n    }\r\n\r\n    if (column.type === \"date\" && value) {\r\n      const date = new Date(value)\r\n      return date.toLocaleDateString()\r\n    }\r\n\r\n    return String(value)\r\n  }\r\n\r\n  /**\r\n   * Create group header row\r\n   * @private\r\n   */\r\n  _createGroupHeaderRow(groupId, group, columns) {\r\n    const config = this._state.getConfig()\r\n    const isCollapsed = this._state.isGroupCollapsed(groupId)\r\n    const visibleColumns = columns.filter((c) => c.visible !== false)\r\n\r\n    const tr = createElement(\"tr\", {\r\n      class: \"dg-row dg-row-group-header\",\r\n      \"data-group\": groupId,\r\n    })\r\n\r\n    // Use pre-calculated totals from GroupManager\r\n    const aggregates = group.totals || {}\r\n\r\n    visibleColumns.forEach((column, index) => {\r\n      const td = createElement(\"td\", {\r\n        class: \"dg-cell dg-cell-group-header\",\r\n        \"data-column\": column.data,\r\n      })\r\n\r\n      // Fixed first column\r\n      if (index === 0 && config.fixedFirstColumn) {\r\n        addClass(td, \"dg-cell-fixed\")\r\n      }\r\n\r\n      // Row total column\r\n      if (column._isRowTotal) {\r\n        addClass(td, \"dg-cell-row-total\")\r\n      }\r\n\r\n      // First column: show toggle + group label\r\n      if (index === 0) {\r\n        const toggleContent = createElement(\"div\", {\r\n          class: \"dg-group-header-content\",\r\n        })\r\n\r\n        const toggleIcon = createElement(\"span\", {\r\n          class: `dg-group-toggle-icon ${\r\n            isCollapsed ? \"dg-collapsed\" : \"dg-expanded\"\r\n          }`,\r\n        })\r\n        toggleIcon.innerHTML = isCollapsed ? \"\" : \"\"\r\n\r\n        const groupLabel = createElement(\"span\", { class: \"dg-group-label\" })\r\n        groupLabel.textContent = group.label || groupId\r\n\r\n        const groupCount = createElement(\"span\", { class: \"dg-group-count\" })\r\n        groupCount.textContent = `(${group.rows.length})`\r\n\r\n        toggleContent.appendChild(toggleIcon)\r\n        toggleContent.appendChild(groupLabel)\r\n        toggleContent.appendChild(groupCount)\r\n        td.appendChild(toggleContent)\r\n      } else if (column.aggregate && aggregates[column.data] !== undefined) {\r\n        // Show aggregate value from GroupManager\r\n        td.textContent = this._formatDisplayValue(\r\n          aggregates[column.data],\r\n          column,\r\n          {}\r\n        )\r\n        addClass(td, \"dg-cell-aggregate\")\r\n      }\r\n\r\n      // Alignment\r\n      if (column.align) {\r\n        td.style.textAlign = column.align\r\n      }\r\n\r\n      tr.appendChild(td)\r\n    })\r\n\r\n    // Click handler for toggle\r\n    tr.addEventListener(\"click\", () => {\r\n      this._state.toggleGroup(groupId)\r\n    })\r\n\r\n    return tr\r\n  }\r\n\r\n  /**\r\n   * Create totals row for a group\r\n   * @private\r\n   */\r\n  _createTotalsRow(totals, columns, groupId) {\r\n    const config = this._state.getConfig()\r\n\r\n    const tr = createElement(\"tr\", {\r\n      class: \"dg-row dg-row-totals\",\r\n      \"data-group\": groupId,\r\n    })\r\n\r\n    columns.forEach((column, index) => {\r\n      if (column.visible === false) return\r\n\r\n      const td = createElement(\"td\", {\r\n        class: \"dg-cell dg-cell-total\",\r\n        \"data-column\": column.data,\r\n      })\r\n\r\n      if (index === 0 && config.fixedFirstColumn) {\r\n        addClass(td, \"dg-cell-fixed\")\r\n      }\r\n\r\n      if (totals[column.data] !== undefined) {\r\n        td.textContent = this._formatDisplayValue(\r\n          totals[column.data],\r\n          column,\r\n          {}\r\n        )\r\n      }\r\n\r\n      tr.appendChild(td)\r\n    })\r\n\r\n    return tr\r\n  }\r\n\r\n  /**\r\n   * Toggle group visibility\r\n   * @private\r\n   */\r\n  _toggleGroupVisibility(groupId, collapsed) {\r\n    const rows = this._tbody.querySelectorAll(\r\n      `[data-group=\"${groupId}\"]:not(.dg-row-group-header)`\r\n    )\r\n    const header = this._tbody.querySelector(\r\n      `.dg-row-group-header[data-group=\"${groupId}\"]`\r\n    )\r\n\r\n    rows.forEach((row) => {\r\n      if (collapsed) {\r\n        addClass(row, \"dg-row-hidden\")\r\n      } else {\r\n        removeClass(row, \"dg-row-hidden\")\r\n      }\r\n    })\r\n\r\n    // Update toggle icon\r\n    if (header) {\r\n      const icon = header.querySelector(\".dg-group-toggle-icon\")\r\n      if (icon) {\r\n        icon.innerHTML = collapsed ? \"\" : \"\"\r\n        if (collapsed) {\r\n          removeClass(icon, \"dg-expanded\")\r\n          addClass(icon, \"dg-collapsed\")\r\n        } else {\r\n          removeClass(icon, \"dg-collapsed\")\r\n          addClass(icon, \"dg-expanded\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set visibility for all groups\r\n   * @private\r\n   */\r\n  _setAllGroupsVisibility(collapsed) {\r\n    const groupedData = this._state.getGroupedData()\r\n    if (groupedData) {\r\n      Object.keys(groupedData).forEach((groupId) => {\r\n        this._toggleGroupVisibility(groupId, collapsed)\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update group header cells with new aggregate values\r\n   * @private\r\n   * @param {string} [groupId] - Specific group, or all if not provided\r\n   */\r\n  _updateGroupHeaders(groupId = null) {\r\n    // Guard: ensure tbody exists before trying to update\r\n    if (!this._tbody) return\r\n\r\n    const groupedData = this._state.getGroupedData()\r\n    if (!groupedData) return\r\n\r\n    const columns = this._state.getColumns()\r\n    const groupsToUpdate = groupId ? [groupId] : Object.keys(groupedData)\r\n\r\n    groupsToUpdate.forEach((gId) => {\r\n      const group = groupedData[gId]\r\n      if (!group) return\r\n\r\n      const headerRow = this._tbody.querySelector(\r\n        `.dg-row-group-header[data-group=\"${gId}\"]`\r\n      )\r\n      if (!headerRow) return\r\n\r\n      // Update each aggregate cell in the header\r\n      columns.forEach((column) => {\r\n        if (column.aggregate && group.totals[column.data] !== undefined) {\r\n          const cell = headerRow.querySelector(`[data-column=\"${column.data}\"]`)\r\n          if (cell && !cell.querySelector(\".dg-group-header-content\")) {\r\n            cell.textContent = this._formatDisplayValue(\r\n              group.totals[column.data],\r\n              column,\r\n              {}\r\n            )\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n}\r\n","/**\n * RowManager - Handles row-related operations\n *\n * Manages row CRUD operations and row types.\n */\n\nimport { TableEvents } from \"../core/EventBus.js\"\nimport { generateId, deepClone } from \"../utils/helpers.js\"\n\nexport class RowManager {\n  /**\n   * @param {TableState} state - Table state instance\n   * @param {EventBus} eventBus - Event bus instance\n   */\n  constructor(state, eventBus) {\n    this._state = state\n    this._eventBus = eventBus\n\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\n    this._unsubscribers = []\n\n    // Setup event listeners\n    this._setupListeners()\n  }\n\n  /**\n   * Add a new row\n   * @param {Object} rowData - Row data\n   * @param {Object} [options] - Options\n   * @param {number} [options.index] - Insert at specific index\n   * @param {string} [options.groupId] - Group to add row to\n   * @param {string} [options.afterRowId] - Insert after specific row\n   * @param {string} [options.type='data'] - Row type\n   * @returns {Object} Added row\n   */\n  addRow(rowData, options = {}) {\n    const data = this._state.getData()\n    const { index, groupId, afterRowId, type = \"data\" } = options\n\n    const newRow = {\n      ...rowData,\n      _id: rowData._id || generateId(),\n      _type: type,\n    }\n\n    let insertIndex = data.length\n\n    if (index !== undefined) {\n      insertIndex = Math.max(0, Math.min(index, data.length))\n    } else if (afterRowId) {\n      const afterIndex = data.findIndex((r) => r._id === afterRowId)\n      if (afterIndex !== -1) {\n        insertIndex = afterIndex + 1\n      }\n    } else if (groupId) {\n      // Find last row in group\n      const config = this._state.getConfig()\n      const groupBy = config.groupBy\n      for (let i = data.length - 1; i >= 0; i--) {\n        const rowGroup =\n          typeof groupBy === \"function\" ? groupBy(data[i]) : data[i][groupBy]\n        if (rowGroup === groupId) {\n          insertIndex = i + 1\n          break\n        }\n      }\n\n      // Set group key on new row\n      if (typeof groupBy === \"string\") {\n        newRow[groupBy] = groupId\n      }\n    }\n\n    // Insert row\n    data.splice(insertIndex, 0, newRow)\n\n    // Update indices\n    data.forEach((row, idx) => {\n      row._index = idx\n    })\n\n    this._state.setData(data)\n\n    this._eventBus.emit(TableEvents.ROW_ADD, {\n      row: newRow,\n      index: insertIndex,\n    })\n\n    return newRow\n  }\n\n  /**\n   * Add an info row (informational row)\n   * @param {string} parentRowId - Parent row ID\n   * @param {Object} infoRowData - Info row data\n   * @returns {Object} Added info row\n   */\n  addInfoRow(parentRowId, infoRowData) {\n    return this.addRow(infoRowData, {\n      afterRowId: parentRowId,\n      type: \"infoRow\",\n    })\n  }\n\n  /**\n   * Delete a row\n   * @param {string} rowId - Row ID to delete\n   * @returns {boolean} Success\n   */\n  deleteRow(rowId) {\n    const data = this._state.getData()\n    const rowIndex = data.findIndex((r) => r._id === rowId)\n\n    if (rowIndex === -1) {\n      return false\n    }\n\n    const deletedRow = data[rowIndex]\n    data.splice(rowIndex, 1)\n\n    // Update indices\n    data.forEach((row, idx) => {\n      row._index = idx\n    })\n\n    this._state.setData(data)\n\n    this._eventBus.emit(TableEvents.ROW_DELETE, {\n      rowId,\n      row: deletedRow,\n      index: rowIndex,\n    })\n\n    return true\n  }\n\n  /**\n   * Delete multiple rows\n   * @param {Array<string>} rowIds - Row IDs to delete\n   * @returns {number} Number of deleted rows\n   */\n  deleteRows(rowIds) {\n    let deletedCount = 0\n    const rowIdSet = new Set(rowIds)\n    const data = this._state.getData()\n\n    const filteredData = data.filter((row) => {\n      if (rowIdSet.has(row._id)) {\n        deletedCount++\n        return false\n      }\n      return true\n    })\n\n    if (deletedCount > 0) {\n      // Update indices\n      filteredData.forEach((row, idx) => {\n        row._index = idx\n      })\n\n      this._state.setData(filteredData)\n    }\n\n    return deletedCount\n  }\n\n  /**\n   * Duplicate a row\n   * @param {string} rowId - Row ID to duplicate\n   * @returns {Object|null} Duplicated row\n   */\n  duplicateRow(rowId) {\n    const row = this._state.getRow(rowId)\n    if (!row) return null\n\n    const { _id, _index, ...rowData } = row\n\n    return this.addRow(rowData, {\n      afterRowId: rowId,\n    })\n  }\n\n  /**\n   * Move row to a new position\n   * @param {string} rowId - Row ID to move\n   * @param {number} newIndex - New index\n   * @returns {boolean} Success\n   */\n  moveRow(rowId, newIndex) {\n    const data = this._state.getData()\n    const currentIndex = data.findIndex((r) => r._id === rowId)\n\n    if (currentIndex === -1) return false\n\n    const [movedRow] = data.splice(currentIndex, 1)\n    data.splice(newIndex, 0, movedRow)\n\n    // Update indices\n    data.forEach((row, idx) => {\n      row._index = idx\n    })\n\n    this._state.setData(data)\n\n    return true\n  }\n\n  /**\n   * Get rows by type\n   * @param {string} type - Row type ('data', 'infoRow', 'total', etc.)\n   * @returns {Array<Object>}\n   */\n  getRowsByType(type) {\n    return this._state.getData().filter((row) => row._type === type)\n  }\n\n  /**\n   * Get data rows only (excludes info rows, totals, etc.)\n   * @returns {Array<Object>}\n   */\n  getDataRows() {\n    return this.getRowsByType(\"data\")\n  }\n\n  /**\n   * Get info rows for a parent row\n   * @param {string} parentRowId - Parent row ID\n   * @returns {Array<Object>}\n   */\n  getInfoRows(parentRowId) {\n    const data = this._state.getData()\n    const parentIndex = data.findIndex((r) => r._id === parentRowId)\n\n    if (parentIndex === -1) return []\n\n    const infoRows = []\n    for (let i = parentIndex + 1; i < data.length; i++) {\n      if (data[i]._type === \"infoRow\") {\n        infoRows.push(data[i])\n      } else {\n        break // Info rows are contiguous after parent\n      }\n    }\n\n    return infoRows\n  }\n\n  /**\n   * Setup internal event listeners\n   * @private\n   */\n  _setupListeners() {\n    // No event listeners needed currently\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy() {\n    // Unsubscribe from all event listeners\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\n    this._unsubscribers = []\n  }\n}\n","/**\n * Data Utilities - Functions for data transformation and manipulation\n */\n\nimport { sum, average, min, max, toNumber, groupBy } from \"./helpers.js\"\n\n/**\n * Aggregate functions registry\n */\nexport const AggregateTypes = {\n  SUM: \"sum\",\n  AVG: \"average\",\n  MIN: \"min\",\n  MAX: \"max\",\n  COUNT: \"count\",\n  FIRST: \"first\",\n  LAST: \"last\",\n}\n\n/**\n * Built-in aggregate functions\n */\nexport const aggregates = {\n  [AggregateTypes.SUM]: (values) => sum(values),\n  [AggregateTypes.AVG]: (values) => average(values),\n  [AggregateTypes.MIN]: (values) => min(values),\n  [AggregateTypes.MAX]: (values) => max(values),\n  [AggregateTypes.COUNT]: (values) => values.length,\n  [AggregateTypes.FIRST]: (values) => values[0],\n  [AggregateTypes.LAST]: (values) => values[values.length - 1],\n}\n\n/**\n * Get aggregate function by type\n * @param {string|Function} type - Aggregate type or custom function\n * @returns {Function}\n */\nexport function getAggregateFunction(type) {\n  if (typeof type === \"function\") {\n    return type\n  }\n  return aggregates[type] || aggregates[AggregateTypes.SUM]\n}\n\n/**\n * Calculate group totals for all groups\n * @param {Object} groupedData - Grouped data object\n * @param {Array<Object>} columns - Column definitions\n * @returns {Object} - Groups with totals\n */\nexport function calculateGroupTotals(groupedData, columns) {\n  const result = {}\n\n  Object.entries(groupedData).forEach(([groupKey, rows]) => {\n    const totals = {}\n\n    columns.forEach((column) => {\n      if (column.aggregate) {\n        const values = rows\n          .map((row) => row[column.data])\n          .filter((v) => v !== null && v !== undefined)\n        const aggregateFn = getAggregateFunction(column.aggregate)\n        totals[column.data] = aggregateFn(values, rows)\n      }\n    })\n\n    result[groupKey] = {\n      rows,\n      totals,\n      count: rows.length,\n    }\n  })\n\n  return result\n}\n\n/**\n * Calculate grand totals for all data\n * @param {Array<Object>} data - All data rows\n * @param {Array<Object>} columns - Column definitions\n * @returns {Object} - Grand totals object\n */\nexport function calculateGrandTotals(data, columns) {\n  const totals = {}\n\n  columns.forEach((column) => {\n    if (column.aggregate) {\n      const values = data\n        .filter((row) => row._type === \"data\")\n        .map((row) => row[column.data])\n        .filter((v) => v !== null && v !== undefined)\n\n      const aggregateFn = getAggregateFunction(column.aggregate)\n      totals[column.data] = aggregateFn(values, data)\n    }\n  })\n\n  return totals\n}\n\n/**\n * Calculate cumulative values for a column\n * @param {Array<Object>} data - Data rows\n * @param {string} columnName - Column to calculate cumulative for\n * @param {string} [targetColumn] - Column to store result (defaults to columnName_cumulative)\n * @returns {Array<Object>} - Data with cumulative values\n */\nexport function calculateCumulative(data, columnName, targetColumn = null) {\n  const target = targetColumn || `${columnName}_cumulative`\n  let cumulative = 0\n\n  return data.map((row) => {\n    if (row._type !== \"data\") {\n      return { ...row, [target]: null }\n    }\n\n    cumulative += toNumber(row[columnName])\n    return { ...row, [target]: cumulative }\n  })\n}\n\n/**\n * Calculate percentage of total for each row\n * @param {Array<Object>} data - Data rows\n * @param {string} columnName - Column to calculate percentage for\n * @param {string} [targetColumn] - Column to store result\n * @returns {Array<Object>} - Data with percentage values\n */\nexport function calculatePercentage(data, columnName, targetColumn = null) {\n  const target = targetColumn || `${columnName}_percentage`\n  const total = sum(\n    data.filter((r) => r._type === \"data\").map((r) => toNumber(r[columnName]))\n  )\n\n  return data.map((row) => {\n    if (row._type !== \"data\" || total === 0) {\n      return { ...row, [target]: null }\n    }\n\n    const value = toNumber(row[columnName])\n    return { ...row, [target]: (value / total) * 100 }\n  })\n}\n\n/**\n * Filter data by criteria\n * @param {Array<Object>} data - Data to filter\n * @param {Object|Function} criteria - Filter criteria or function\n * @returns {Array<Object>}\n */\nexport function filterData(data, criteria) {\n  if (typeof criteria === \"function\") {\n    return data.filter(criteria)\n  }\n\n  return data.filter((row) => {\n    return Object.entries(criteria).every(([key, value]) => {\n      if (value === null || value === undefined) return true\n\n      if (typeof value === \"object\" && value !== null) {\n        // Handle comparison operators\n        if (\"$gt\" in value) return row[key] > value.$gt\n        if (\"$gte\" in value) return row[key] >= value.$gte\n        if (\"$lt\" in value) return row[key] < value.$lt\n        if (\"$lte\" in value) return row[key] <= value.$lte\n        if (\"$ne\" in value) return row[key] !== value.$ne\n        if (\"$in\" in value) return value.$in.includes(row[key])\n        if (\"$nin\" in value) return !value.$nin.includes(row[key])\n        if (\"$contains\" in value)\n          return String(row[key])\n            .toLowerCase()\n            .includes(value.$contains.toLowerCase())\n      }\n\n      return row[key] === value\n    })\n  })\n}\n\n/**\n * Flatten nested data structure\n * @param {Array<Object>} data - Data with potential children\n * @param {string} [childrenKey='children'] - Key containing child rows\n * @returns {Array<Object>} - Flat array\n */\nexport function flattenData(data, childrenKey = \"children\") {\n  const result = []\n\n  const flatten = (rows, level = 0, parentId = null) => {\n    rows.forEach((row) => {\n      const { [childrenKey]: children, ...rowData } = row\n\n      result.push({\n        ...rowData,\n        _level: level,\n        _parentId: parentId,\n        _hasChildren: children && children.length > 0,\n      })\n\n      if (children && children.length > 0) {\n        flatten(children, level + 1, row._id || row.id)\n      }\n    })\n  }\n\n  flatten(data)\n  return result\n}\n\n/**\n * Build tree structure from flat data\n * @param {Array<Object>} data - Flat data array\n * @param {string} [parentKey='parentId'] - Parent ID key\n * @returns {Array<Object>} - Tree structure\n */\nexport function buildTree(data, parentKey = \"parentId\") {\n  const map = new Map()\n  const roots = []\n\n  // Create map of all items\n  data.forEach((item) => {\n    map.set(item._id || item.id, { ...item, children: [] })\n  })\n\n  // Build tree\n  data.forEach((item) => {\n    const node = map.get(item._id || item.id)\n    const parentId = item[parentKey]\n\n    if (parentId && map.has(parentId)) {\n      map.get(parentId).children.push(node)\n    } else {\n      roots.push(node)\n    }\n  })\n\n  return roots\n}\n\n/**\n * Transform data for export\n * @param {Array<Object>} data - Data to transform\n * @param {Array<Object>} columns - Column definitions\n * @param {Object} [options] - Transform options\n * @returns {Array<Object>} - Transformed data\n */\nexport function transformForExport(data, columns, options = {}) {\n  const {\n    includeHidden = false,\n    formatValues = true,\n    excludeTypes = [\"infoRow\"],\n  } = options\n\n  const visibleColumns = columns.filter(\n    (col) => includeHidden || col.visible !== false\n  )\n\n  return data\n    .filter((row) => !excludeTypes.includes(row._type))\n    .map((row) => {\n      const transformed = {}\n\n      visibleColumns.forEach((column) => {\n        let value = row[column.data]\n\n        if (formatValues && column.format) {\n          value = column.format(value, row, column)\n        } else if (\n          formatValues &&\n          column.type === \"number\" &&\n          column.decimals !== undefined\n        ) {\n          value = toNumber(value).toFixed(column.decimals)\n        }\n\n        transformed[column.title || column.data] = value\n      })\n\n      return transformed\n    })\n}\n\n/**\n * Validate data against column definitions\n * @param {Array<Object>} data - Data to validate\n * @param {Array<Object>} columns - Column definitions\n * @returns {{valid: boolean, errors: Array<Object>}}\n */\nexport function validateData(data, columns) {\n  const errors = []\n\n  data.forEach((row, rowIndex) => {\n    columns.forEach((column) => {\n      if (\n        column.required &&\n        (row[column.data] === null ||\n          row[column.data] === undefined ||\n          row[column.data] === \"\")\n      ) {\n        errors.push({\n          rowIndex,\n          rowId: row._id,\n          column: column.data,\n          type: \"required\",\n          message: `${column.title || column.data} is required`,\n        })\n      }\n\n      if (\n        column.validator &&\n        row[column.data] !== null &&\n        row[column.data] !== undefined\n      ) {\n        const validationResult = column.validator(row[column.data], row, column)\n        if (validationResult !== true) {\n          errors.push({\n            rowIndex,\n            rowId: row._id,\n            column: column.data,\n            type: \"validation\",\n            message:\n              validationResult ||\n              `Invalid value for ${column.title || column.data}`,\n          })\n        }\n      }\n\n      if (\n        column.type === \"number\" &&\n        row[column.data] !== null &&\n        row[column.data] !== undefined\n      ) {\n        const numValue = toNumber(row[column.data], NaN)\n        if (isNaN(numValue)) {\n          errors.push({\n            rowIndex,\n            rowId: row._id,\n            column: column.data,\n            type: \"type\",\n            message: `${column.title || column.data} must be a number`,\n          })\n        } else {\n          if (column.min !== undefined && numValue < column.min) {\n            errors.push({\n              rowIndex,\n              rowId: row._id,\n              column: column.data,\n              type: \"range\",\n              message: `${column.title || column.data} must be at least ${\n                column.min\n              }`,\n            })\n          }\n          if (column.max !== undefined && numValue > column.max) {\n            errors.push({\n              rowIndex,\n              rowId: row._id,\n              column: column.data,\n              type: \"range\",\n              message: `${column.title || column.data} must be at most ${\n                column.max\n              }`,\n            })\n          }\n        }\n      }\n    })\n  })\n\n  return {\n    valid: errors.length === 0,\n    errors,\n  }\n}\n","/**\n * GroupManager - Handles row grouping operations\n *\n * Manages group creation, expansion/collapse, and group totals.\n */\n\nimport { TableEvents } from \"../core/EventBus.js\"\nimport { calculateGroupTotals, calculateGrandTotals } from \"../utils/data.js\"\nimport { sum, average, min, max } from \"../utils/helpers.js\"\n\nexport class GroupManager {\n  /**\n   * @param {TableState} state - Table state instance\n   * @param {EventBus} eventBus - Event bus instance\n   */\n  constructor(state, eventBus) {\n    this._state = state\n    this._eventBus = eventBus\n\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\n    this._unsubscribers = []\n\n    // Setup event listeners\n    this._setupListeners()\n\n    // Calculate initial totals if grouping is enabled\n    if (this._state.getConfig().enableGrouping) {\n      this.recalculateTotals()\n    }\n\n    // Calculate initial row totals if enabled\n    if (this._state.getConfig().enableRowTotals) {\n      this.recalculateRowTotals()\n    }\n  }\n\n  /**\n   * Calculate row total (sum of all numeric columns with aggregate) for a single row\n   * @param {Object} row - Row data\n   * @returns {number} Row total\n   */\n  calculateRowTotal(row) {\n    const columns = this._state.getColumns()\n    let total = 0\n\n    columns.forEach((column) => {\n      // Only sum columns that have aggregate defined (indicating they're numeric summable columns)\n      if (column.aggregate && column.data !== \"_rowTotal\") {\n        const value = row[column.data]\n        if (value !== null && value !== undefined && !isNaN(value)) {\n          total += Number(value)\n        }\n      }\n    })\n\n    return total\n  }\n\n  /**\n   * Recalculate row totals for all data rows\n   */\n  recalculateRowTotals() {\n    const config = this._state.getConfig()\n    if (!config.enableRowTotals) return\n\n    const data = this._state._state.data\n\n    data.forEach((row) => {\n      if (row._type === \"data\") {\n        row._rowTotal = this.calculateRowTotal(row)\n      }\n    })\n  }\n\n  /**\n   * Update row total for a specific row\n   * @param {string} rowId - Row identifier\n   */\n  updateRowTotal(rowId) {\n    const config = this._state.getConfig()\n    if (!config.enableRowTotals) return\n\n    const data = this._state._state.data\n    const row = data.find((r) => r._id === rowId)\n\n    if (row && row._type === \"data\") {\n      const oldTotal = row._rowTotal\n      row._rowTotal = this.calculateRowTotal(row)\n\n      // Emit event so TableRenderer can update the cell\n      if (oldTotal !== row._rowTotal) {\n        this._eventBus.emit(TableEvents.ROW_TOTAL_CHANGE, {\n          rowId,\n          oldValue: oldTotal,\n          newValue: row._rowTotal,\n        })\n      }\n    }\n  }\n\n  /**\n   * Get group information by ID\n   * @param {string} groupId - Group identifier\n   * @returns {Object|null}\n   */\n  getGroup(groupId) {\n    const groupedData = this._state.getGroupedData()\n    return groupedData ? groupedData[groupId] : null\n  }\n\n  /**\n   * Get all group IDs\n   * @returns {Array<string>}\n   */\n  getGroupIds() {\n    const groupedData = this._state.getGroupedData()\n    return groupedData ? Object.keys(groupedData) : []\n  }\n\n  /**\n   * Get rows in a specific group\n   * @param {string} groupId - Group identifier\n   * @returns {Array<Object>}\n   */\n  getGroupRows(groupId) {\n    const group = this.getGroup(groupId)\n    return group ? group.rows : []\n  }\n\n  /**\n   * Get group totals\n   * @param {string} groupId - Group identifier\n   * @returns {Object}\n   */\n  getGroupTotals(groupId) {\n    const group = this.getGroup(groupId)\n    return group ? group.totals : {}\n  }\n\n  /**\n   * Calculate and update group totals\n   * @param {string} [groupId] - Specific group, or all if not provided\n   */\n  recalculateTotals(groupId = null) {\n    const groupedData = this._state.getGroupedData()\n    const columns = this._state.getColumns()\n    const config = this._state.getConfig()\n\n    if (!groupedData) return\n\n    const groupsToUpdate = groupId\n      ? [groupId].filter((id) => groupedData[id])\n      : Object.keys(groupedData)\n\n    groupsToUpdate.forEach((gId) => {\n      const group = groupedData[gId]\n      const totals = {}\n\n      // Filter to only data rows (exclude infoRows and other special types)\n      const dataRows = group.rows.filter((row) => row._type === \"data\")\n\n      columns.forEach((column) => {\n        if (column.aggregate && column.data !== \"_rowTotal\") {\n          const values = dataRows\n            .map((row) => row[column.data])\n            .filter((v) => v !== null && v !== undefined && !isNaN(v))\n\n          totals[column.data] = this._calculateAggregate(\n            column.aggregate,\n            values,\n            dataRows\n          )\n        }\n      })\n\n      // Calculate row total for the group header (sum of all aggregated column totals)\n      if (config.enableRowTotals) {\n        let groupRowTotal = 0\n        columns.forEach((column) => {\n          if (\n            column.aggregate &&\n            column.data !== \"_rowTotal\" &&\n            totals[column.data] !== undefined\n          ) {\n            groupRowTotal += totals[column.data]\n          }\n        })\n        totals._rowTotal = groupRowTotal\n      }\n\n      group.totals = totals\n    })\n\n    this._eventBus.emit(TableEvents.STATE_CHANGE, {\n      property: \"groupTotals\",\n      groupId,\n    })\n  }\n\n  /**\n   * Get grand totals (across all groups)\n   * @returns {Object}\n   */\n  getGrandTotals() {\n    const data = this._state.getData().filter((r) => r._type === \"data\")\n    const columns = this._state.getColumns()\n\n    return calculateGrandTotals(data, columns)\n  }\n\n  /**\n   * Toggle group expansion\n   * @param {string} groupId - Group identifier\n   * @returns {boolean} New collapsed state\n   */\n  toggle(groupId) {\n    this._state.toggleGroup(groupId)\n    return this._state.isGroupCollapsed(groupId)\n  }\n\n  /**\n   * Expand a specific group\n   * @param {string} groupId - Group identifier\n   */\n  expand(groupId) {\n    if (this._state.isGroupCollapsed(groupId)) {\n      this._state.toggleGroup(groupId)\n    }\n  }\n\n  /**\n   * Collapse a specific group\n   * @param {string} groupId - Group identifier\n   */\n  collapse(groupId) {\n    if (!this._state.isGroupCollapsed(groupId)) {\n      this._state.toggleGroup(groupId)\n    }\n  }\n\n  /**\n   * Expand all groups\n   */\n  expandAll() {\n    this._state.expandAllGroups()\n  }\n\n  /**\n   * Collapse all groups\n   */\n  collapseAll() {\n    this._state.collapseAllGroups()\n  }\n\n  /**\n   * Check if group is collapsed\n   * @param {string} groupId - Group identifier\n   * @returns {boolean}\n   */\n  isCollapsed(groupId) {\n    return this._state.isGroupCollapsed(groupId)\n  }\n\n  /**\n   * Get expansion state of all groups\n   * @returns {Object<string, boolean>}\n   */\n  getExpansionState() {\n    const groupIds = this.getGroupIds()\n    const state = {}\n\n    groupIds.forEach((id) => {\n      state[id] = !this._state.isGroupCollapsed(id)\n    })\n\n    return state\n  }\n\n  /**\n   * Set expansion state for all groups\n   * @param {Object<string, boolean>} state - Expansion state map\n   */\n  setExpansionState(state) {\n    Object.entries(state).forEach(([groupId, expanded]) => {\n      if (expanded) {\n        this.expand(groupId)\n      } else {\n        this.collapse(groupId)\n      }\n    })\n  }\n\n  /**\n   * Move row to a different group\n   * @param {string} rowId - Row ID to move\n   * @param {string} targetGroupId - Target group ID\n   */\n  moveRowToGroup(rowId, targetGroupId) {\n    const config = this._state.getConfig()\n    const groupBy = config.groupBy\n\n    if (typeof groupBy !== \"string\") {\n      console.warn(\"Cannot move row when groupBy is a function\")\n      return\n    }\n\n    this._state.updateCell(rowId, groupBy, targetGroupId)\n    this.recalculateTotals()\n  }\n\n  /**\n   * Get group statistics\n   * @param {string} groupId - Group identifier\n   * @returns {Object}\n   */\n  getGroupStats(groupId) {\n    const group = this.getGroup(groupId)\n    if (!group) return null\n\n    const columns = this._state.getColumns()\n    const stats = {\n      rowCount: group.rows.length,\n      columns: {},\n    }\n\n    columns.forEach((column) => {\n      if (column.type === \"number\") {\n        const values = group.rows\n          .map((row) => row[column.data])\n          .filter((v) => v !== null && v !== undefined && !isNaN(v))\n\n        stats.columns[column.data] = {\n          sum: sum(values),\n          average: average(values),\n          min: min(values),\n          max: max(values),\n          count: values.length,\n        }\n      }\n    })\n\n    return stats\n  }\n\n  /**\n   * Calculate aggregate value\n   * @private\n   */\n  _calculateAggregate(aggregateType, values, rows) {\n    if (typeof aggregateType === \"function\") {\n      return aggregateType(values, rows)\n    }\n\n    switch (aggregateType) {\n      case \"sum\":\n        return sum(values)\n      case \"average\":\n      case \"avg\":\n        return average(values)\n      case \"min\":\n        return min(values)\n      case \"max\":\n        return max(values)\n      case \"count\":\n        return values.length\n      case \"first\":\n        return values[0]\n      case \"last\":\n        return values[values.length - 1]\n      default:\n        return sum(values)\n    }\n  }\n\n  /**\n   * Setup internal event listeners\n   * @private\n   */\n  _setupListeners() {\n    // Recalculate totals when cells change\n    this._unsubscribers.push(\n      this._eventBus.on(TableEvents.CELL_CHANGE, ({ rowId, columnName }) => {\n        const column = this._state.getColumn(columnName)\n        const config = this._state.getConfig()\n\n        // Update row total for this row if enabled\n        if (config.enableRowTotals && column && column.aggregate) {\n          this.updateRowTotal(rowId)\n        }\n\n        // Update group totals if grouping is enabled\n        if (column && column.aggregate && config.enableGrouping) {\n          // Find which group this row belongs to\n          const row = this._state.getRow(rowId)\n          if (row) {\n            const groupBy = config.groupBy\n            const groupId =\n              typeof groupBy === \"function\" ? groupBy(row) : row[groupBy]\n            this.recalculateTotals(groupId)\n          }\n        }\n      })\n    )\n\n    // Recalculate all totals when data changes\n    this._unsubscribers.push(\n      this._eventBus.on(TableEvents.DATA_CHANGE, () => {\n        const config = this._state.getConfig()\n\n        if (config.enableRowTotals) {\n          this.recalculateRowTotals()\n        }\n\n        if (config.enableGrouping) {\n          this.recalculateTotals()\n        }\n      })\n    )\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy() {\n    // Unsubscribe from all event listeners\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\n    this._unsubscribers = []\n  }\n}\n","/**\r\n * EditManager - Handles edit mode operations\r\n *\r\n * Manages view/edit mode switching, keyboard navigation,\r\n * and cell editing behavior.\r\n */\r\n\r\nimport { TableEvents } from \"../core/EventBus.js\"\r\nimport { addClass, removeClass, $ } from \"../utils/dom.js\"\r\n\r\nexport class EditManager {\r\n  /**\r\n   * @param {TableState} state - Table state instance\r\n   * @param {EventBus} eventBus - Event bus instance\r\n   * @param {TableRenderer} renderer - Table renderer instance\r\n   */\r\n  constructor(state, eventBus, renderer) {\r\n    this._state = state\r\n    this._eventBus = eventBus\r\n    this._renderer = renderer\r\n\r\n    /** @type {{rowId: string, columnName: string}|null} */\r\n    this._focusedCell = null\r\n\r\n    /** @type {boolean} */\r\n    this._isEditing = false\r\n\r\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\r\n    this._unsubscribers = []\r\n\r\n    // Setup event listeners\r\n    this._setupListeners()\r\n  }\r\n\r\n  /**\r\n   * Enter edit mode\r\n   */\r\n  enterEditMode() {\r\n    this._state.setMode(\"edit\")\r\n  }\r\n\r\n  /**\r\n   * Enter view mode\r\n   */\r\n  enterViewMode() {\r\n    this._state.setMode(\"view\")\r\n    this._focusedCell = null\r\n  }\r\n\r\n  /**\r\n   * Toggle between modes\r\n   * @returns {'view'|'edit'} New mode\r\n   */\r\n  toggleMode() {\r\n    const currentMode = this._state.getMode()\r\n    const newMode = currentMode === \"view\" ? \"edit\" : \"view\"\r\n    this._state.setMode(newMode)\r\n    return newMode\r\n  }\r\n\r\n  /**\r\n   * Check if currently in edit mode\r\n   * @returns {boolean}\r\n   */\r\n  isEditMode() {\r\n    return this._state.isEditMode()\r\n  }\r\n\r\n  /**\r\n   * Focus a specific cell\r\n   * @param {string} rowId - Row identifier\r\n   * @param {string} columnName - Column name\r\n   */\r\n  focusCell(rowId, columnName) {\r\n    this._focusedCell = { rowId, columnName }\r\n\r\n    // If in edit mode, focus the input\r\n    if (this._state.isEditMode()) {\r\n      const cell = this._renderer.getCellElement(rowId, columnName)\r\n      if (cell) {\r\n        const input = cell.querySelector(\".dg-cell-input\")\r\n        if (input) {\r\n          input.focus()\r\n          if (input.select) {\r\n            input.select()\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this._eventBus.emit(TableEvents.CELL_FOCUS, {\r\n      rowId,\r\n      columnName,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Get currently focused cell\r\n   * @returns {{rowId: string, columnName: string}|null}\r\n   */\r\n  getFocusedCell() {\r\n    return this._focusedCell\r\n  }\r\n\r\n  /**\r\n   * Move focus to adjacent cell\r\n   * @param {'up'|'down'|'left'|'right'} direction - Direction to move\r\n   */\r\n  moveFocus(direction) {\r\n    if (!this._focusedCell) return\r\n\r\n    const { rowId, columnName } = this._focusedCell\r\n    const data = this._state.getData()\r\n    const columns = this._state.getColumns().filter((c) => c.visible !== false)\r\n\r\n    const rowIndex = data.findIndex((r) => r._id === rowId)\r\n    const colIndex = columns.findIndex((c) => c.data === columnName)\r\n\r\n    if (rowIndex === -1 || colIndex === -1) return\r\n\r\n    let newRowIndex = rowIndex\r\n    let newColIndex = colIndex\r\n\r\n    switch (direction) {\r\n      case \"up\":\r\n        newRowIndex = Math.max(0, rowIndex - 1)\r\n        break\r\n      case \"down\":\r\n        newRowIndex = Math.min(data.length - 1, rowIndex + 1)\r\n        break\r\n      case \"left\":\r\n        newColIndex = Math.max(0, colIndex - 1)\r\n        break\r\n      case \"right\":\r\n        newColIndex = Math.min(columns.length - 1, colIndex + 1)\r\n        break\r\n    }\r\n\r\n    // Skip non-editable rows (like totals) when moving vertically\r\n    if (direction === \"up\" || direction === \"down\") {\r\n      const targetRow = data[newRowIndex]\r\n      if (targetRow && targetRow._type !== \"data\") {\r\n        // Try to skip to next valid row\r\n        const step = direction === \"up\" ? -1 : 1\r\n        while (newRowIndex >= 0 && newRowIndex < data.length) {\r\n          if (data[newRowIndex]._type === \"data\") break\r\n          newRowIndex += step\r\n        }\r\n\r\n        // Clamp to valid range\r\n        newRowIndex = Math.max(0, Math.min(data.length - 1, newRowIndex))\r\n      }\r\n    }\r\n\r\n    const newRow = data[newRowIndex]\r\n    const newColumn = columns[newColIndex]\r\n\r\n    if (newRow && newColumn) {\r\n      this.focusCell(newRow._id, newColumn.data)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start editing current cell (for inline edit on click)\r\n   */\r\n  startEditing() {\r\n    if (!this._focusedCell || !this._state.isEditMode()) return\r\n\r\n    this._isEditing = true\r\n    const { rowId, columnName } = this._focusedCell\r\n\r\n    const cell = this._renderer.getCellElement(rowId, columnName)\r\n    if (cell) {\r\n      addClass(cell, \"dg-cell-editing\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop editing current cell\r\n   */\r\n  stopEditing() {\r\n    if (!this._focusedCell) return\r\n\r\n    this._isEditing = false\r\n    const { rowId, columnName } = this._focusedCell\r\n\r\n    const cell = this._renderer.getCellElement(rowId, columnName)\r\n    if (cell) {\r\n      removeClass(cell, \"dg-cell-editing\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if currently editing a cell\r\n   * @returns {boolean}\r\n   */\r\n  isEditing() {\r\n    return this._isEditing\r\n  }\r\n\r\n  /**\r\n   * Cancel current edit and revert value\r\n   */\r\n  cancelEdit() {\r\n    if (!this._focusedCell || !this._isEditing) return\r\n\r\n    const { rowId, columnName } = this._focusedCell\r\n    const originalData = this._state._state.originalData\r\n    const originalRow = originalData.find((r) => r._id === rowId)\r\n\r\n    if (originalRow) {\r\n      this._state.updateCell(rowId, columnName, originalRow[columnName])\r\n    }\r\n\r\n    this.stopEditing()\r\n  }\r\n\r\n  /**\r\n   * Commit current edit\r\n   */\r\n  commitEdit() {\r\n    if (!this._focusedCell || !this._isEditing) return\r\n\r\n    const { rowId, columnName } = this._focusedCell\r\n    const cell = this._renderer.getCellElement(rowId, columnName)\r\n\r\n    if (cell) {\r\n      const input = cell.querySelector(\".dg-cell-input\")\r\n      if (input) {\r\n        // Trigger change event\r\n        input.dispatchEvent(new Event(\"change\", { bubbles: true }))\r\n      }\r\n    }\r\n\r\n    this.stopEditing()\r\n  }\r\n\r\n  /**\r\n   * Setup keyboard navigation\r\n   * @private\r\n   */\r\n  _setupListeners() {\r\n    // Handle keyboard navigation\r\n    document.addEventListener(\"keydown\", (e) => {\r\n      if (!this._state.isEditMode()) return\r\n\r\n      switch (e.key) {\r\n        case \"Tab\":\r\n          e.preventDefault()\r\n          this.moveFocus(e.shiftKey ? \"left\" : \"right\")\r\n          break\r\n\r\n        case \"Enter\":\r\n          if (this._isEditing) {\r\n            e.preventDefault()\r\n            this.commitEdit()\r\n            this.moveFocus(\"down\")\r\n          }\r\n          break\r\n\r\n        case \"Escape\":\r\n          if (this._isEditing) {\r\n            e.preventDefault()\r\n            this.cancelEdit()\r\n          }\r\n          break\r\n\r\n        case \"ArrowUp\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"up\")\r\n          }\r\n          break\r\n\r\n        case \"ArrowDown\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"down\")\r\n          }\r\n          break\r\n\r\n        case \"ArrowLeft\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"left\")\r\n          }\r\n          break\r\n\r\n        case \"ArrowRight\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"right\")\r\n          }\r\n          break\r\n      }\r\n    })\r\n\r\n    // Track cell focus\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.CELL_FOCUS, ({ rowId, columnName }) => {\r\n        this._focusedCell = { rowId, columnName }\r\n      })\r\n    )\r\n\r\n    // Track cell blur\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.CELL_BLUR, () => {\r\n        this._isEditing = false\r\n      })\r\n    )\r\n\r\n    // Clear focus when mode changes to view\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.MODE_CHANGE, ({ newMode }) => {\r\n        if (newMode === \"view\") {\r\n          this._focusedCell = null\r\n          this._isEditing = false\r\n        }\r\n      })\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy() {\r\n    // Unsubscribe from all event listeners\r\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\r\n    this._unsubscribers = []\r\n\r\n    this._focusedCell = null\r\n    this._isEditing = false\r\n  }\r\n}\r\n","/**\n * ExportManager - Handles data export operations\n *\n * Exports table data to CSV and Excel formats.\n */\n\nimport { TableEvents } from \"../core/EventBus.js\"\nimport { transformForExport } from \"../utils/data.js\"\n\nexport class ExportManager {\n  /**\n   * @param {TableState} state - Table state instance\n   * @param {EventBus} eventBus - Event bus instance\n   */\n  constructor(state, eventBus) {\n    this._state = state\n    this._eventBus = eventBus\n  }\n\n  /**\n   * Export to CSV string\n   * @param {Object} [options] - Export options\n   * @param {string} [options.delimiter=','] - Field delimiter\n   * @param {boolean} [options.includeHeaders=true] - Include header row\n   * @param {boolean} [options.includeHidden=false] - Include hidden columns\n   * @param {Array<string>} [options.columns] - Specific columns to export\n   * @param {Function} [options.filter] - Row filter function\n   * @returns {string} CSV string\n   */\n  toCSV(options = {}) {\n    const {\n      delimiter = \",\",\n      includeHeaders = true,\n      includeHidden = false,\n      columns: columnFilter = null,\n      filter = null,\n    } = options\n\n    this._eventBus.emit(TableEvents.EXPORT_START, { format: \"csv\" })\n\n    let data = this._state.getData()\n    let columns = this._state.getColumns()\n\n    // Filter columns\n    if (columnFilter) {\n      columns = columns.filter((col) => columnFilter.includes(col.data))\n    } else if (!includeHidden) {\n      columns = columns.filter((col) => col.visible !== false)\n    }\n\n    // Filter rows\n    if (filter) {\n      data = data.filter(filter)\n    }\n\n    // Build CSV\n    const rows = []\n\n    // Header row\n    if (includeHeaders) {\n      const headerRow = columns.map((col) =>\n        this._escapeCSV(col.title || col.data, delimiter)\n      )\n      rows.push(headerRow.join(delimiter))\n    }\n\n    // Data rows\n    data.forEach((row) => {\n      if (row._type !== \"data\" && row._type !== \"infoRow\") return\n\n      const csvRow = columns.map((col) => {\n        let value = row[col.data]\n\n        // Format value if formatter exists\n        if (col.exportFormat) {\n          value = col.exportFormat(value, row, col)\n        } else if (col.format) {\n          value = col.format(value, row, col)\n        }\n\n        return this._escapeCSV(value, delimiter)\n      })\n\n      rows.push(csvRow.join(delimiter))\n    })\n\n    const csvString = rows.join(\"\\n\")\n\n    this._eventBus.emit(TableEvents.EXPORT_COMPLETE, {\n      format: \"csv\",\n      rowCount: rows.length - (includeHeaders ? 1 : 0),\n    })\n\n    return csvString\n  }\n\n  /**\n   * Export to Excel-compatible format (simplified XLSX-like)\n   * For full XLSX support, integrate with SheetJS\n   * @param {Object} [options] - Export options\n   * @returns {Object} Excel data structure\n   */\n  toExcel(options = {}) {\n    const {\n      sheetName = \"Sheet1\",\n      includeHeaders = true,\n      includeHidden = false,\n      columns: columnFilter = null,\n      filter = null,\n    } = options\n\n    this._eventBus.emit(TableEvents.EXPORT_START, { format: \"excel\" })\n\n    let data = this._state.getData()\n    let columns = this._state.getColumns()\n\n    // Filter columns\n    if (columnFilter) {\n      columns = columns.filter((col) => columnFilter.includes(col.data))\n    } else if (!includeHidden) {\n      columns = columns.filter((col) => col.visible !== false)\n    }\n\n    // Filter rows\n    if (filter) {\n      data = data.filter(filter)\n    }\n\n    // Build Excel data structure\n    const worksheetData = []\n\n    // Header row\n    if (includeHeaders) {\n      worksheetData.push(columns.map((col) => col.title || col.data))\n    }\n\n    // Data rows\n    data.forEach((row) => {\n      if (row._type !== \"data\" && row._type !== \"infoRow\") return\n\n      const excelRow = columns.map((col) => {\n        let value = row[col.data]\n\n        // Keep numbers as numbers for Excel\n        if (col.type === \"number\" && typeof value === \"number\") {\n          return value\n        }\n\n        // Format other values\n        if (col.exportFormat) {\n          value = col.exportFormat(value, row, col)\n        }\n\n        return value\n      })\n\n      worksheetData.push(excelRow)\n    })\n\n    const result = {\n      sheets: [\n        {\n          name: sheetName,\n          data: worksheetData,\n          columns: columns.map((col) => ({\n            width: col.width || 100,\n            type: col.type || \"string\",\n          })),\n        },\n      ],\n    }\n\n    this._eventBus.emit(TableEvents.EXPORT_COMPLETE, {\n      format: \"excel\",\n      rowCount: worksheetData.length - (includeHeaders ? 1 : 0),\n    })\n\n    return result\n  }\n\n  /**\n   * Download export as file\n   * @param {'csv'|'excel'} format - Export format\n   * @param {string} [filename] - File name (without extension)\n   * @param {Object} [options] - Export options\n   */\n  download(format, filename = \"table-export\", options = {}) {\n    if (format === \"csv\") {\n      this._downloadCSV(filename, options)\n    } else if (format === \"excel\") {\n      this._downloadExcel(filename, options)\n    }\n  }\n\n  /**\n   * Download as CSV file\n   * @private\n   */\n  _downloadCSV(filename, options) {\n    const csv = this.toCSV(options)\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" })\n    this._downloadBlob(blob, `${filename}.csv`)\n  }\n\n  /**\n   * Download as Excel file (using CSV with .xls extension for basic support)\n   * For full XLSX support, integrate with SheetJS\n   * @private\n   */\n  _downloadExcel(filename, options) {\n    // Basic Excel export using tab-delimited format\n    const csv = this.toCSV({ ...options, delimiter: \"\\t\" })\n    const blob = new Blob([csv], {\n      type: \"application/vnd.ms-excel;charset=utf-8;\",\n    })\n    this._downloadBlob(blob, `${filename}.xls`)\n  }\n\n  /**\n   * Download blob as file\n   * @private\n   */\n  _downloadBlob(blob, filename) {\n    const link = document.createElement(\"a\")\n\n    if (link.download !== undefined) {\n      const url = URL.createObjectURL(blob)\n      link.setAttribute(\"href\", url)\n      link.setAttribute(\"download\", filename)\n      link.style.visibility = \"hidden\"\n      document.body.appendChild(link)\n      link.click()\n      document.body.removeChild(link)\n      URL.revokeObjectURL(url)\n    }\n  }\n\n  /**\n   * Escape value for CSV\n   * @private\n   */\n  _escapeCSV(value, delimiter = \",\") {\n    if (value === null || value === undefined) {\n      return \"\"\n    }\n\n    const stringValue = String(value)\n\n    // Check if escaping is needed\n    if (\n      stringValue.includes(delimiter) ||\n      stringValue.includes('\"') ||\n      stringValue.includes(\"\\n\") ||\n      stringValue.includes(\"\\r\")\n    ) {\n      // Escape double quotes and wrap in quotes\n      return `\"${stringValue.replace(/\"/g, '\"\"')}\"`\n    }\n\n    return stringValue\n  }\n\n  /**\n   * Get export preview (first N rows)\n   * @param {number} [rowCount=5] - Number of rows to preview\n   * @param {'csv'|'excel'} [format='csv'] - Format to preview\n   * @returns {string|Object}\n   */\n  preview(rowCount = 5, format = \"csv\") {\n    const data = this._state.getData().slice(0, rowCount)\n    const columns = this._state.getColumns().filter((c) => c.visible !== false)\n\n    if (format === \"csv\") {\n      // Build preview CSV\n      const headers = columns.map((c) => c.title || c.data).join(\",\")\n      const rows = data.map((row) =>\n        columns.map((col) => this._escapeCSV(row[col.data])).join(\",\")\n      )\n      return [headers, ...rows].join(\"\\n\")\n    }\n\n    return {\n      headers: columns.map((c) => c.title || c.data),\n      rows: data.map((row) => columns.map((col) => row[col.data])),\n    }\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy() {\n    // Nothing specific to cleanup\n  }\n}\n","/**\r\n * ThemeManager - Handles theme customization\r\n *\r\n * Allows users to customize table colors through configuration.\r\n * Falls back to default CSS variables if not specified.\r\n */\r\n\r\nexport class ThemeManager {\r\n  /**\r\n   * @param {HTMLElement} container - Table container element\r\n   * @param {Object} [theme] - Theme configuration\r\n   */\r\n  constructor(container, theme = {}) {\r\n    this._container = container\r\n\r\n    /** @type {Object} Default theme */\r\n    this._defaultTheme = {\r\n      // Row colors\r\n      rowEven: null, // Falls back to --dg-color-bg-alt\r\n      rowOdd: null, // Falls back to --dg-color-bg\r\n      rowHover: null, // Falls back to --dg-color-bg-hover\r\n      rowSelected: null, // Falls back to --dg-color-bg-selected\r\n\r\n      // Border colors\r\n      borderLight: null, // Falls back to --dg-color-border\r\n      borderStrong: null, // Falls back to --dg-color-border-strong\r\n\r\n      // Header colors\r\n      headerBackground: null, // Falls back to --dg-color-bg-alt\r\n      headerText: null, // Falls back to --dg-color-text\r\n\r\n      // Cell colors\r\n      cellBackground: null, // Falls back to --dg-color-bg\r\n      cellText: null, // Falls back to --dg-color-text\r\n\r\n      // Sticky/Fixed column colors\r\n      fixedBackground: null, // Inherits from row\r\n      fixedShadow: null, // Falls back to --dg-shadow-fixed\r\n      fixedBorderColor: null, // Falls back to --dg-fixed-border-color\r\n      fixedBorderWidth: null, // Falls back to --dg-fixed-border-width\r\n\r\n      // Interactive colors\r\n      primary: null, // Falls back to --dg-color-primary\r\n      primaryHover: null, // Falls back to --dg-color-primary-hover\r\n\r\n      // Status colors\r\n      success: null, // Falls back to --dg-color-success\r\n      warning: null, // Falls back to --dg-color-warning\r\n      error: null, // Falls back to --dg-color-error\r\n\r\n      // Row totals column colors\r\n      rowTotalBackground: null, // Falls back to --dg-row-total-bg\r\n      rowTotalBackgroundAlt: null, // Falls back to --dg-row-total-bg-alt\r\n      rowTotalText: null, // Falls back to --dg-row-total-text\r\n      rowTotalHeaderBackground: null, // Falls back to --dg-row-total-header-bg\r\n      rowTotalBorderColor: null, // Falls back to --dg-row-total-border-color\r\n\r\n      // Ungrouped rows colors\r\n      ungroupedRowBackground: null, // Falls back to --dg-ungrouped-row-bg\r\n      ungroupedRowBackgroundAlt: null, // Falls back to --dg-ungrouped-row-bg-alt\r\n      ungroupedRowBackgroundHover: null, // Falls back to --dg-ungrouped-row-bg-hover\r\n      ungroupedRowText: null, // Falls back to --dg-ungrouped-row-text\r\n    }\r\n\r\n    this._theme = { ...this._defaultTheme, ...theme }\r\n    this._applyTheme()\r\n  }\r\n\r\n  /**\r\n   * Resolve a theme value - if it starts with '--', wrap it in var()\r\n   * This allows passing CSS variable names like '--bc-c-primary-500'\r\n   * @private\r\n   * @param {string} value - The theme value\r\n   * @returns {string} - Resolved value (wrapped in var() if CSS variable)\r\n   */\r\n  _resolveValue(value) {\r\n    if (!value) return value\r\n    // If value starts with '--', it's a CSS variable reference\r\n    if (typeof value === \"string\" && value.startsWith(\"--\")) {\r\n      return `var(${value})`\r\n    }\r\n    return value\r\n  }\r\n\r\n  /**\r\n   * Apply theme to container\r\n   * @private\r\n   */\r\n  _applyTheme() {\r\n    const style = this._container.style\r\n\r\n    // Row colors\r\n    if (this._theme.rowEven) {\r\n      style.setProperty(\r\n        \"--dg-color-bg-alt\",\r\n        this._resolveValue(this._theme.rowEven)\r\n      )\r\n    }\r\n    if (this._theme.rowOdd) {\r\n      style.setProperty(\"--dg-color-bg\", this._resolveValue(this._theme.rowOdd))\r\n    }\r\n    if (this._theme.rowHover) {\r\n      style.setProperty(\r\n        \"--dg-color-bg-hover\",\r\n        this._resolveValue(this._theme.rowHover)\r\n      )\r\n    }\r\n    if (this._theme.rowSelected) {\r\n      style.setProperty(\r\n        \"--dg-color-bg-selected\",\r\n        this._resolveValue(this._theme.rowSelected)\r\n      )\r\n    }\r\n\r\n    // Border colors\r\n    if (this._theme.borderLight) {\r\n      style.setProperty(\r\n        \"--dg-color-border\",\r\n        this._resolveValue(this._theme.borderLight)\r\n      )\r\n    }\r\n    if (this._theme.borderStrong) {\r\n      style.setProperty(\r\n        \"--dg-color-border-strong\",\r\n        this._resolveValue(this._theme.borderStrong)\r\n      )\r\n    }\r\n\r\n    // Header colors\r\n    if (this._theme.headerBackground) {\r\n      style.setProperty(\r\n        \"--dg-color-header-bg\",\r\n        this._resolveValue(this._theme.headerBackground)\r\n      )\r\n    }\r\n    if (this._theme.headerText) {\r\n      style.setProperty(\r\n        \"--dg-color-header-text\",\r\n        this._resolveValue(this._theme.headerText)\r\n      )\r\n    }\r\n\r\n    // Cell colors\r\n    if (this._theme.cellBackground) {\r\n      style.setProperty(\r\n        \"--dg-color-cell-bg\",\r\n        this._resolveValue(this._theme.cellBackground)\r\n      )\r\n    }\r\n    if (this._theme.cellText) {\r\n      style.setProperty(\r\n        \"--dg-color-text\",\r\n        this._resolveValue(this._theme.cellText)\r\n      )\r\n    }\r\n\r\n    // Fixed column\r\n    if (this._theme.fixedShadow) {\r\n      style.setProperty(\r\n        \"--dg-shadow-fixed\",\r\n        this._resolveValue(this._theme.fixedShadow)\r\n      )\r\n    }\r\n    if (this._theme.fixedBorderColor) {\r\n      style.setProperty(\r\n        \"--dg-fixed-border-color\",\r\n        this._resolveValue(this._theme.fixedBorderColor)\r\n      )\r\n    }\r\n    if (this._theme.fixedBorderWidth) {\r\n      style.setProperty(\r\n        \"--dg-fixed-border-width\",\r\n        this._resolveValue(this._theme.fixedBorderWidth)\r\n      )\r\n    }\r\n\r\n    // Interactive colors\r\n    if (this._theme.primary) {\r\n      style.setProperty(\r\n        \"--dg-color-primary\",\r\n        this._resolveValue(this._theme.primary)\r\n      )\r\n    }\r\n    if (this._theme.primaryHover) {\r\n      style.setProperty(\r\n        \"--dg-color-primary-hover\",\r\n        this._resolveValue(this._theme.primaryHover)\r\n      )\r\n    }\r\n\r\n    // Status colors\r\n    if (this._theme.success) {\r\n      style.setProperty(\r\n        \"--dg-color-success\",\r\n        this._resolveValue(this._theme.success)\r\n      )\r\n    }\r\n    if (this._theme.warning) {\r\n      style.setProperty(\r\n        \"--dg-color-warning\",\r\n        this._resolveValue(this._theme.warning)\r\n      )\r\n    }\r\n    if (this._theme.error) {\r\n      style.setProperty(\r\n        \"--dg-color-error\",\r\n        this._resolveValue(this._theme.error)\r\n      )\r\n    }\r\n\r\n    // Row totals column\r\n    if (this._theme.rowTotalBackground) {\r\n      style.setProperty(\r\n        \"--dg-row-total-bg\",\r\n        this._resolveValue(this._theme.rowTotalBackground)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalBackgroundAlt) {\r\n      style.setProperty(\r\n        \"--dg-row-total-bg-alt\",\r\n        this._resolveValue(this._theme.rowTotalBackgroundAlt)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalText) {\r\n      style.setProperty(\r\n        \"--dg-row-total-text\",\r\n        this._resolveValue(this._theme.rowTotalText)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalHeaderBackground) {\r\n      style.setProperty(\r\n        \"--dg-row-total-header-bg\",\r\n        this._resolveValue(this._theme.rowTotalHeaderBackground)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalBorderColor) {\r\n      style.setProperty(\r\n        \"--dg-row-total-border-color\",\r\n        this._resolveValue(this._theme.rowTotalBorderColor)\r\n      )\r\n    }\r\n\r\n    // Ungrouped rows\r\n    if (this._theme.ungroupedRowBackground) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-bg\",\r\n        this._resolveValue(this._theme.ungroupedRowBackground)\r\n      )\r\n    }\r\n    if (this._theme.ungroupedRowBackgroundAlt) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-bg-alt\",\r\n        this._resolveValue(this._theme.ungroupedRowBackgroundAlt)\r\n      )\r\n    }\r\n    if (this._theme.ungroupedRowBackgroundHover) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-bg-hover\",\r\n        this._resolveValue(this._theme.ungroupedRowBackgroundHover)\r\n      )\r\n    }\r\n    if (this._theme.ungroupedRowText) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-text\",\r\n        this._resolveValue(this._theme.ungroupedRowText)\r\n      )\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update theme at runtime\r\n   * @param {Object} theme - Partial theme configuration to merge\r\n   */\r\n  updateTheme(theme) {\r\n    this._theme = { ...this._theme, ...theme }\r\n    this._applyTheme()\r\n  }\r\n\r\n  /**\r\n   * Reset to default theme\r\n   */\r\n  resetTheme() {\r\n    const style = this._container.style\r\n\r\n    // Remove all custom properties\r\n    Object.keys(this._theme).forEach(() => {\r\n      style.removeProperty(\"--dg-color-bg-alt\")\r\n      style.removeProperty(\"--dg-color-bg\")\r\n      style.removeProperty(\"--dg-color-bg-hover\")\r\n      style.removeProperty(\"--dg-color-bg-selected\")\r\n      style.removeProperty(\"--dg-color-border\")\r\n      style.removeProperty(\"--dg-color-border-strong\")\r\n      style.removeProperty(\"--dg-color-header-bg\")\r\n      style.removeProperty(\"--dg-color-header-text\")\r\n      style.removeProperty(\"--dg-color-cell-bg\")\r\n      style.removeProperty(\"--dg-color-text\")\r\n      style.removeProperty(\"--dg-shadow-fixed\")\r\n      style.removeProperty(\"--dg-fixed-border-color\")\r\n      style.removeProperty(\"--dg-fixed-border-width\")\r\n      style.removeProperty(\"--dg-color-primary\")\r\n      style.removeProperty(\"--dg-color-primary-hover\")\r\n      style.removeProperty(\"--dg-color-success\")\r\n      style.removeProperty(\"--dg-color-warning\")\r\n      style.removeProperty(\"--dg-color-error\")\r\n      style.removeProperty(\"--dg-row-total-bg\")\r\n      style.removeProperty(\"--dg-row-total-bg-alt\")\r\n      style.removeProperty(\"--dg-row-total-text\")\r\n      style.removeProperty(\"--dg-row-total-header-bg\")\r\n      style.removeProperty(\"--dg-row-total-border-color\")\r\n      style.removeProperty(\"--dg-ungrouped-row-bg\")\r\n      style.removeProperty(\"--dg-ungrouped-row-bg-alt\")\r\n      style.removeProperty(\"--dg-ungrouped-row-bg-hover\")\r\n      style.removeProperty(\"--dg-ungrouped-row-text\")\r\n    })\r\n\r\n    this._theme = { ...this._defaultTheme }\r\n  }\r\n\r\n  /**\r\n   * Get current theme\r\n   * @returns {Object} Current theme configuration\r\n   */\r\n  getTheme() {\r\n    return { ...this._theme }\r\n  }\r\n}\r\n","/**\n * Table - Main orchestrator class for the editable table\n *\n * This is the primary entry point that coordinates all modules,\n * manages the lifecycle, and exposes the public API.\n */\n\nimport { EventBus, TableEvents } from \"./EventBus.js\"\nimport { TableState } from \"./TableState.js\"\nimport { TableRenderer } from \"./TableRenderer.js\"\nimport { RowManager } from \"../modules/RowManager.js\"\nimport { GroupManager } from \"../modules/GroupManager.js\"\nimport { EditManager } from \"../modules/EditManager.js\"\nimport { ExportManager } from \"../modules/ExportManager.js\"\nimport { ThemeManager } from \"../modules/ThemeManager.js\"\nimport { addClass, removeClass } from \"../utils/dom.js\"\n\n/**\n * @typedef {Object} TableConfig\n * @property {HTMLElement|string} container - Container element or selector\n * @property {Array<Object>} columns - Column definitions\n * @property {Array<Object>} data - Table data\n * @property {boolean} [fixedFirstColumn=false] - Enable fixed first column\n * @property {boolean} [enableGrouping=false] - Enable row grouping\n * @property {string|Function} [groupBy] - Group by column name or function\n * @property {boolean} [enableInfoRows=false] - Enable info rows\n * @property {boolean} [enableRowTotals=false] - Enable row totals column\n * @property {Function} [rowTotalsFormat] - Format function for row totals column\n * @property {'view'|'edit'} [mode='view'] - Initial mode\n * @property {Function} [onRowClick] - Row click callback\n * @property {Function} [onRender] - Render complete callback\n * @property {Function} [onChange] - Table data change callback\n * @property {Function} [onRowChange] - Individual row change callback\n * @property {Object} [theme] - Theme customization\n */\n\nexport class Table {\n  /**\n   * Create a new Table instance\n   * @param {TableConfig} config - Table configuration\n   */\n  constructor(config) {\n    this._validateConfig(config)\n\n    // Store configuration\n    this._config = {\n      fixedFirstColumn: false,\n      enableGrouping: false,\n      enableInfoRows: false,\n      enableRowTotals: false,\n      mode: \"view\",\n      ...config,\n    }\n\n    // Get container element\n    this._container =\n      typeof config.container === \"string\"\n        ? document.querySelector(config.container)\n        : config.container\n\n    if (!this._container) {\n      throw new Error(\"Table: Container element not found\")\n    }\n\n    // Initialize core systems\n    this._eventBus = new EventBus()\n    this._state = new TableState(this._eventBus, {\n      data: config.data || [],\n      columns: config.columns || [],\n      config: {\n        fixedFirstColumn: config.fixedFirstColumn,\n        enableGrouping: config.enableGrouping,\n        groupBy: config.groupBy,\n        enableInfoRows: config.enableInfoRows,\n        enableRowTotals: config.enableRowTotals,\n        rowTotalsFormat: config.rowTotalsFormat,\n      },\n    })\n\n    // Initialize modules\n    this._initModules()\n\n    // Set initial mode\n    this._state.setMode(config.mode || \"view\")\n\n    // Register callbacks\n    this._registerCallbacks()\n\n    // Initial render\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Data\n  // ============================================\n\n  /**\n   * Get current table data\n   * @returns {Array<Object>}\n   */\n  getData() {\n    return this._state.getData()\n  }\n\n  /**\n   * Set table data\n   * @param {Array<Object>} data - New data array\n   */\n  setData(data) {\n    this._state.setData(data)\n    this._render()\n  }\n\n  /**\n   * Get a single row by ID\n   * @param {string|number} rowId - Row identifier\n   * @returns {Object|null}\n   */\n  getRow(rowId) {\n    return this._state.getRow(rowId)\n  }\n\n  /**\n   * Update a specific cell\n   * @param {string|number} rowId - Row identifier\n   * @param {string} columnName - Column name\n   * @param {any} value - New value\n   */\n  updateCell(rowId, columnName, value) {\n    this._state.updateCell(rowId, columnName, value)\n  }\n\n  /**\n   * Batch update multiple cells\n   * @param {Array<{rowId, columnName, value}>} updates - Updates array\n   */\n  batchUpdate(updates) {\n    this._state.batchUpdate(updates)\n  }\n\n  /**\n   * Add a new row\n   * @param {Object} rowData - Row data\n   * @param {Object} [options] - Options (position, groupId, etc.)\n   */\n  addRow(rowData, options = {}) {\n    this._rowManager.addRow(rowData, options)\n  }\n\n  /**\n   * Delete a row\n   * @param {string|number} rowId - Row identifier\n   */\n  deleteRow(rowId) {\n    this._rowManager.deleteRow(rowId)\n  }\n\n  /**\n   * Get all modified rows\n   * @returns {Array<Object>}\n   */\n  getDirtyRows() {\n    return this._state.getDirtyRows()\n  }\n\n  /**\n   * Clear dirty state\n   */\n  clearDirty() {\n    this._state.clearDirty()\n  }\n\n  /**\n   * Revert all changes\n   */\n  revertChanges() {\n    this._state.revertChanges()\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Columns\n  // ============================================\n\n  /**\n   * Get column definitions\n   * @returns {Array<Object>}\n   */\n  getColumns() {\n    return this._state.getColumns()\n  }\n\n  /**\n   * Update column definitions\n   * @param {Array<Object>} columns - New column definitions\n   */\n  setColumns(columns) {\n    this._state.setColumns(columns)\n    this._render()\n  }\n\n  /**\n   * Show/hide a column\n   * @param {string} columnId - Column identifier\n   * @param {boolean} visible - Visibility state\n   */\n  setColumnVisibility(columnId, visible) {\n    const columns = this._state.getColumns()\n    const updatedColumns = columns.map((col) => {\n      if (col._id === columnId || col.data === columnId) {\n        return { ...col, visible }\n      }\n      return col\n    })\n    this._state.setColumns(updatedColumns)\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Mode\n  // ============================================\n\n  /**\n   * Get current mode\n   * @returns {'view'|'edit'}\n   */\n  getMode() {\n    return this._state.getMode()\n  }\n\n  /**\n   * Set table mode\n   * @param {'view'|'edit'} mode - Mode to set\n   */\n  setMode(mode) {\n    this._state.setMode(mode)\n  }\n\n  /**\n   * Toggle between view and edit mode\n   */\n  toggleMode() {\n    const currentMode = this._state.getMode()\n    this._state.setMode(currentMode === \"view\" ? \"edit\" : \"view\")\n  }\n\n  // ============================================\n  // Public API - Groups\n  // ============================================\n\n  /**\n   * Toggle a group's visibility\n   * @param {string} groupId - Group identifier\n   */\n  toggleGroup(groupId) {\n    this._state.toggleGroup(groupId)\n  }\n\n  /**\n   * Expand all groups\n   */\n  expandAllGroups() {\n    this._state.expandAllGroups()\n  }\n\n  /**\n   * Collapse all groups\n   */\n  collapseAllGroups() {\n    this._state.collapseAllGroups()\n  }\n\n  // ============================================\n  // Public API - Export\n  // ============================================\n\n  /**\n   * Export table to CSV\n   * @param {Object} [options] - Export options\n   * @returns {string} CSV string\n   */\n  exportCSV(options = {}) {\n    return this._exportManager.toCSV(options)\n  }\n\n  /**\n   * Export table to Excel\n   * @param {Object} [options] - Export options\n   */\n  exportExcel(options = {}) {\n    return this._exportManager.toExcel(options)\n  }\n\n  /**\n   * Download export as file\n   * @param {'csv'|'excel'} format - Export format\n   * @param {string} [filename] - File name\n   */\n  download(format, filename) {\n    this._exportManager.download(format, filename)\n  }\n\n  // ============================================\n  // Public API - Utilities\n  // ============================================\n\n  /**\n   * Force re-render of the table\n   */\n  render() {\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Theme\n  // ============================================\n\n  /**\n   * Update theme at runtime\n   * @param {Object} theme - Partial theme configuration\n   */\n  updateTheme(theme) {\n    this._themeManager.updateTheme(theme)\n  }\n\n  /**\n   * Reset to default theme\n   */\n  resetTheme() {\n    this._themeManager.resetTheme()\n  }\n\n  /**\n   * Get current theme\n   * @returns {Object} Current theme configuration\n   */\n  getTheme() {\n    return this._themeManager.getTheme()\n  }\n\n  /**\n   * Subscribe to table events\n   * @param {string} event - Event name\n   * @param {Function} callback - Event handler\n   * @returns {Function} Unsubscribe function\n   */\n  on(event, callback) {\n    return this._eventBus.on(event, callback)\n  }\n\n  /**\n   * Unsubscribe from table events\n   * @param {string} event - Event name\n   * @param {Function} callback - Event handler\n   */\n  off(event, callback) {\n    this._eventBus.off(event, callback)\n  }\n\n  /**\n   * Destroy the table instance\n   */\n  destroy() {\n    this._eventBus.emit(TableEvents.DESTROY, {})\n\n    // Destroy modules\n    this._renderer.destroy()\n    this._themeManager.resetTheme()\n    this._rowManager.destroy()\n    this._groupManager.destroy()\n    this._editManager.destroy()\n    this._exportManager.destroy()\n\n    // Destroy core\n    this._state.destroy()\n    this._eventBus.destroy()\n\n    // Clear container\n    this._container.innerHTML = \"\"\n    removeClass(this._container, \"dg-container\")\n  }\n\n  // ============================================\n  // Private Methods\n  // ============================================\n\n  /**\n   * Validate configuration\n   * @private\n   */\n  _validateConfig(config) {\n    if (!config) {\n      throw new Error(\"Table: Configuration object is required\")\n    }\n    if (!config.container) {\n      throw new Error(\"Table: Container element or selector is required\")\n    }\n    if (!config.columns || !Array.isArray(config.columns)) {\n      throw new Error(\"Table: Columns array is required\")\n    }\n  }\n\n  /**\n   * Initialize all modules\n   * @private\n   */\n  _initModules() {\n    // Initialize renderer first\n    this._renderer = new TableRenderer(this._container, this._state)\n\n    // Initialize theme manager\n    this._themeManager = new ThemeManager(this._container, this._config.theme)\n\n    // Initialize feature modules\n    this._rowManager = new RowManager(this._state, this._eventBus)\n    this._groupManager = new GroupManager(this._state, this._eventBus)\n    this._editManager = new EditManager(\n      this._state,\n      this._eventBus,\n      this._renderer\n    )\n    this._exportManager = new ExportManager(this._state, this._eventBus)\n  }\n\n  /**\n   * Register user callbacks\n   * @private\n   */\n  _registerCallbacks() {\n    const { onRowClick, onRender, onChange, onRowChange } = this._config\n\n    if (onRowClick) {\n      this._eventBus.on(TableEvents.ROW_CLICK, onRowClick)\n    }\n\n    if (onRender) {\n      this._eventBus.on(TableEvents.AFTER_RENDER, onRender)\n    }\n\n    if (onChange) {\n      this._eventBus.on(TableEvents.DATA_CHANGE, onChange)\n    }\n\n    if (onRowChange) {\n      this._eventBus.on(TableEvents.ROW_CHANGE, onRowChange)\n    }\n  }\n\n  /**\n   * Render the table\n   * @private\n   */\n  _render() {\n    this._eventBus.emit(TableEvents.BEFORE_RENDER, {})\n    this._renderer.render()\n    this._eventBus.emit(TableEvents.RENDER, {})\n\n    // Use requestAnimationFrame to ensure DOM is ready\n    requestAnimationFrame(() => {\n      this._eventBus.emit(TableEvents.AFTER_RENDER, {\n        rowCount: this._state.getData().length,\n        columnCount: this._state.getColumns().length,\n      })\n    })\n  }\n}\n\n// Expose event types for external use\nTable.Events = TableEvents\n"],"names":["EventBus","constructor","this","_listeners","Map","_onceListeners","_isBatching","_batchQueue","on","event","callback","has","set","Set","get","add","off","once","wrapper","data","delete","emit","push","forEach","error","console","startBatch","endBatch","eventMap","key","TableEvents","CELL_CHANGE","rowId","columnName","ROW_CHANGE","destroy","clear","STATE_CHANGE","DATA_CHANGE","ROW_CLICK","ROW_ADD","ROW_DELETE","CELL_FOCUS","CELL_BLUR","ROW_TOTAL_CHANGE","GROUP_TOGGLE","GROUP_EXPAND_ALL","GROUP_COLLAPSE_ALL","MODE_CHANGE","BEFORE_RENDER","RENDER","AFTER_RENDER","DESTROY","SCROLL","EXPORT_START","EXPORT_COMPLETE","generateId","Date","now","toString","Math","random","substr","deepClone","obj","getTime","map","item","value","Array","isArray","cloned","Object","prototype","hasOwnProperty","call","deepEqual","a","b","length","every","index","keysA","keys","keysB","toNumber","defaultValue","parsed","parseFloat","isNaN","sum","values","reduce","acc","val","average","min","nums","filter","v","max","TableState","eventBus","initialState","_eventBus","_state","originalData","columns","mode","groups","groupedData","collapsedGroups","focusedCell","computedCache","dirtyRows","dirtyColumns","config","fixedFirstColumn","enableGrouping","groupBy","enableInfoRows","enableRowTotals","setData","setColumns","_normalizeData","_invalidateCache","_computeGroups","source","getData","getRow","row","find","r","_id","updateCell","options","rowIndex","findIndex","oldValue","_invalidateCacheForRow","newValue","from","skipCascade","_triggerCascadeUpdate","batchUpdate","updates","_computeAllCascades","updatedRows","u","col","_index","id","property","getColumns","defaultFormat","Number","toLocaleString","title","type","editable","aggregate","_isRowTotal","format","rowTotalsFormat","getColumn","columnId","c","setMode","warn","oldMode","newMode","getMode","isEditMode","toggleGroup","groupId","collapsed","isGroupCollapsed","getGroupedData","getUngroupedRows","ungroupedRows","getInfoRows","infoRows","expandAllGroups","collapseAllGroups","getDirtyRows","isRowDirty","clearDirty","revertChanges","setConfig","undefined","getConfig","_type","groupKey","label","rows","totals","column","affectsColumns","affectedCol","_","includes","cascade","state","rId","cName","createElement","tag","attributes","element","document","entries","className","assign","style","startsWith","setAttribute","setAttributes","addClass","classNames","classList","removeClass","remove","TableRenderer","container","_container","_tableWrapper","_table","_thead","_tbody","_rowElements","_cellElements","_unsubscribers","_setupEventListeners","render","_createStructure","_updateContainerClasses","_renderHeader","_renderGroupedBody","_renderBody","cellKey","cell","_renderCellContent","updateRow","rowElement","rowData","getCellElement","getRowElement","unsubscribe","_updateGroupHeaders","_toggleGroupVisibility","_setAllGroupsVisibility","class","appendChild","innerHTML","headerRow","visibleIndex","visible","th","headerContent","textContent","width","_createRowElement","group","groupHeader","_createGroupHeaderRow","isCollapsed","tr","addEventListener","e","target","closest","td","_createCellElement","align","textAlign","isEditable","_editable","input","_createInputElement","displayValue","_formatDisplayValue","rendered","HTMLElement","inputType","opt","option","selected","step","onChange","String","decimals","toFixed","Intl","NumberFormat","currency","toLocaleDateString","visibleColumns","aggregates","toggleContent","toggleIcon","groupLabel","groupCount","_createTotalsRow","querySelectorAll","header","querySelector","icon","gId","RowManager","_setupListeners","addRow","afterRowId","newRow","insertIndex","afterIndex","i","splice","idx","addInfoRow","parentRowId","infoRowData","deleteRow","deletedRow","deleteRows","rowIds","deletedCount","rowIdSet","filteredData","duplicateRow","moveRow","newIndex","currentIndex","movedRow","getRowsByType","getDataRows","parentIndex","AggregateTypes","AggregateTypes_SUM","AggregateTypes_AVG","AggregateTypes_MIN","AggregateTypes_MAX","AggregateTypes_COUNT","AggregateTypes_FIRST","AggregateTypes_LAST","calculateGrandTotals","aggregateFn","GroupManager","recalculateTotals","recalculateRowTotals","calculateRowTotal","total","_rowTotal","updateRowTotal","oldTotal","getGroup","getGroupIds","getGroupRows","getGroupTotals","dataRows","_calculateAggregate","groupRowTotal","getGrandTotals","toggle","expand","collapse","expandAll","collapseAll","getExpansionState","groupIds","setExpansionState","expanded","moveRowToGroup","targetGroupId","getGroupStats","stats","rowCount","count","aggregateType","EditManager","renderer","_renderer","_focusedCell","_isEditing","enterEditMode","enterViewMode","toggleMode","focusCell","focus","select","getFocusedCell","moveFocus","direction","colIndex","newRowIndex","newColIndex","targetRow","newColumn","startEditing","stopEditing","isEditing","cancelEdit","originalRow","commitEdit","dispatchEvent","Event","bubbles","preventDefault","shiftKey","ctrlKey","ExportManager","toCSV","delimiter","includeHeaders","includeHidden","columnFilter","_escapeCSV","join","csvRow","exportFormat","csvString","toExcel","sheetName","worksheetData","excelRow","result","sheets","name","download","filename","_downloadCSV","_downloadExcel","csv","blob","Blob","_downloadBlob","link","url","URL","createObjectURL","visibility","body","click","removeChild","revokeObjectURL","stringValue","replace","preview","slice","headers","ThemeManager","theme","_defaultTheme","rowEven","rowOdd","rowHover","rowSelected","borderLight","borderStrong","headerBackground","headerText","cellBackground","cellText","fixedBackground","fixedShadow","fixedBorderColor","fixedBorderWidth","primary","primaryHover","success","warning","rowTotalBackground","rowTotalBackgroundAlt","rowTotalText","rowTotalHeaderBackground","rowTotalBorderColor","ungroupedRowBackground","ungroupedRowBackgroundAlt","ungroupedRowBackgroundHover","ungroupedRowText","_theme","_applyTheme","_resolveValue","setProperty","updateTheme","resetTheme","removeProperty","getTheme","Table","_validateConfig","_config","Error","_initModules","_registerCallbacks","_render","_rowManager","setColumnVisibility","updatedColumns","currentMode","exportCSV","_exportManager","exportExcel","_themeManager","_groupManager","_editManager","onRowClick","onRender","onRowChange","requestAnimationFrame","columnCount","Events"],"mappings":"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"}