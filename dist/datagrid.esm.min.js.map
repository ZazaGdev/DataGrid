{"version":3,"file":"datagrid.esm.min.js","sources":["../src/core/EventBus.js","../src/utils/helpers.js","../src/core/TableState.js","../src/utils/dom.js","../src/core/TableRenderer.js","../src/modules/RowManager.js","../src/utils/data.js","../src/modules/GroupManager.js","../src/modules/EditManager.js","../src/modules/ExportManager.js","../src/modules/ThemeManager.js","../src/core/Table.js"],"sourcesContent":["/**\n * EventBus - Lightweight pub/sub event system for decoupled communication\n *\n * This enables modules to communicate without direct dependencies,\n * improving maintainability and allowing for efficient cascade updates.\n */\n\nexport class EventBus {\n  constructor() {\n    /** @type {Map<string, Set<Function>>} */\n    this._listeners = new Map()\n\n    /** @type {Map<string, Function>} */\n    this._onceListeners = new Map() // TODO: Implement once listeners if needed\n\n    /** @type {boolean} */\n    this._isBatching = false\n\n    /** @type {Array<{event: string, data: any}>} */\n    this._batchQueue = []\n  }\n\n  /**\n   * Subscribe to an event\n   * @param {string} event - Event name\n   * @param {Function} callback - Handler function\n   * @returns {Function} Unsubscribe function\n   */\n  on(event, callback) {\n    if (!this._listeners.has(event)) {\n      this._listeners.set(event, new Set())\n    }\n    this._listeners.get(event).add(callback)\n\n    // Return unsubscribe function\n    return () => this.off(event, callback)\n  }\n\n  /**\n   * Subscribe to an event once\n   * @param {string} event - Event name\n   * @param {Function} callback - Handler function\n   */\n  once(event, callback) {\n    const wrapper = (data) => {\n      this.off(event, wrapper)\n      callback(data)\n    }\n    this.on(event, wrapper)\n  }\n\n  /**\n   * Unsubscribe from an event\n   * @param {string} event - Event name\n   * @param {Function} callback - Handler function\n   */\n  off(event, callback) {\n    if (this._listeners.has(event)) {\n      this._listeners.get(event).delete(callback)\n    }\n  }\n\n  /**\n   * Emit an event\n   * @param {string} event - Event name\n   * @param {any} data - Event data\n   */\n  emit(event, data) {\n    if (this._isBatching) {\n      this._batchQueue.push({ event, data })\n      return\n    }\n\n    if (this._listeners.has(event)) {\n      this._listeners.get(event).forEach((callback) => {\n        try {\n          callback(data)\n        } catch (error) {\n          console.error(`Error in event handler for \"${event}\":`, error)\n        }\n      })\n    }\n  }\n\n  /**\n   * Start batching events (for performance during bulk updates)\n   */\n  startBatch() {\n    this._isBatching = true\n    this._batchQueue = []\n  }\n\n  /**\n   * End batching and emit all queued events\n   * Deduplicates events of the same type, keeping latest data\n   */\n  endBatch() {\n    this._isBatching = false\n\n    // Deduplicate: for CELL_CHANGE events, use rowId:columnName as key\n    // For other events, use just the event name\n    const eventMap = new Map()\n    this._batchQueue.forEach(({ event, data }) => {\n      let key = event\n\n      // For cell-specific events, create unique key per cell\n      if (event === TableEvents.CELL_CHANGE && data.rowId && data.columnName) {\n        key = `${event}:${data.rowId}:${data.columnName}`\n      } else if (event === TableEvents.ROW_CHANGE && data.rowId) {\n        key = `${event}:${data.rowId}`\n      }\n\n      eventMap.set(key, { event, data })\n    })\n\n    // Emit deduplicated events\n    eventMap.forEach(({ event, data }) => {\n      this.emit(event, data)\n    })\n\n    this._batchQueue = []\n  }\n\n  /**\n   * Remove all listeners\n   */\n  destroy() {\n    this._listeners.clear()\n    this._batchQueue = []\n  }\n}\n\n// Predefined event types for consistency\nexport const TableEvents = {\n  // State events\n  STATE_CHANGE: \"state:change\",\n  DATA_CHANGE: \"data:change\",\n\n  // Row events\n  ROW_CLICK: \"row:click\",\n  ROW_CHANGE: \"row:change\",\n  ROW_ADD: \"row:add\",\n  ROW_DELETE: \"row:delete\",\n\n  // Cell events\n  CELL_CHANGE: \"cell:change\",\n  CELL_FOCUS: \"cell:focus\",\n  CELL_BLUR: \"cell:blur\",\n\n  // Action events\n  ACTION_CLICK: \"action:click\",\n\n  // Row total events\n  ROW_TOTAL_CHANGE: \"rowTotal:change\",\n\n  // Group events\n  GROUP_TOGGLE: \"group:toggle\",\n  GROUP_EXPAND_ALL: \"group:expandAll\",\n  GROUP_COLLAPSE_ALL: \"group:collapseAll\",\n\n  // Mode events\n  MODE_CHANGE: \"mode:change\",\n\n  // Lifecycle events\n  BEFORE_RENDER: \"lifecycle:beforeRender\",\n  RENDER: \"lifecycle:render\",\n  AFTER_RENDER: \"lifecycle:afterRender\",\n  DESTROY: \"lifecycle:destroy\",\n\n  // Scroll events\n  SCROLL: \"scroll:update\",\n\n  // Export events\n  EXPORT_START: \"export:start\",\n  EXPORT_COMPLETE: \"export:complete\",\n}\n","/**\n * General Helpers - Utility functions for data manipulation\n */\n\n/**\n * Generate a unique ID\n * @returns {string}\n */\nexport function generateId() {\n  return `et_${Date.now().toString(36)}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n/**\n * Deep clone an object/array\n * @param {any} obj - Object to clone\n * @returns {any}\n */\nexport function deepClone(obj) {\n  if (obj === null || typeof obj !== 'object') {\n    return obj;\n  }\n  \n  if (obj instanceof Date) {\n    return new Date(obj.getTime());\n  }\n  \n  if (obj instanceof Set) {\n    return new Set([...obj].map(item => deepClone(item)));\n  }\n  \n  if (obj instanceof Map) {\n    return new Map([...obj].map(([key, value]) => [deepClone(key), deepClone(value)]));\n  }\n  \n  if (Array.isArray(obj)) {\n    return obj.map(item => deepClone(item));\n  }\n  \n  const cloned = {};\n  for (const key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      cloned[key] = deepClone(obj[key]);\n    }\n  }\n  return cloned;\n}\n\n/**\n * Deep equality check\n * @param {any} a - First value\n * @param {any} b - Second value\n * @returns {boolean}\n */\nexport function deepEqual(a, b) {\n  if (a === b) return true;\n  \n  if (a === null || b === null) return false;\n  if (typeof a !== typeof b) return false;\n  \n  if (typeof a !== 'object') return a === b;\n  \n  if (Array.isArray(a) !== Array.isArray(b)) return false;\n  \n  if (Array.isArray(a)) {\n    if (a.length !== b.length) return false;\n    return a.every((item, index) => deepEqual(item, b[index]));\n  }\n  \n  const keysA = Object.keys(a);\n  const keysB = Object.keys(b);\n  \n  if (keysA.length !== keysB.length) return false;\n  \n  return keysA.every(key => deepEqual(a[key], b[key]));\n}\n\n/**\n * Get nested property value using dot notation\n * @param {Object} obj - Source object\n * @param {string} path - Property path (e.g., 'a.b.c')\n * @param {any} [defaultValue] - Default value if not found\n * @returns {any}\n */\nexport function getNestedValue(obj, path, defaultValue = undefined) {\n  const keys = path.split('.');\n  let result = obj;\n  \n  for (const key of keys) {\n    if (result === null || result === undefined) {\n      return defaultValue;\n    }\n    result = result[key];\n  }\n  \n  return result === undefined ? defaultValue : result;\n}\n\n/**\n * Set nested property value using dot notation\n * @param {Object} obj - Target object\n * @param {string} path - Property path\n * @param {any} value - Value to set\n */\nexport function setNestedValue(obj, path, value) {\n  const keys = path.split('.');\n  let current = obj;\n  \n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i];\n    if (!(key in current)) {\n      current[key] = {};\n    }\n    current = current[key];\n  }\n  \n  current[keys[keys.length - 1]] = value;\n}\n\n/**\n * Debounce a function\n * @param {Function} func - Function to debounce\n * @param {number} wait - Wait time in ms\n * @returns {Function}\n */\nexport function debounce(func, wait) {\n  let timeout;\n  \n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func.apply(this, args);\n    };\n    \n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n\n/**\n * Throttle a function\n * @param {Function} func - Function to throttle\n * @param {number} limit - Time limit in ms\n * @returns {Function}\n */\nexport function throttle(func, limit) {\n  let inThrottle;\n  \n  return function executedFunction(...args) {\n    if (!inThrottle) {\n      func.apply(this, args);\n      inThrottle = true;\n      setTimeout(() => (inThrottle = false), limit);\n    }\n  };\n}\n\n/**\n * Escape HTML special characters\n * @param {string} str - String to escape\n * @returns {string}\n */\nexport function escapeHtml(str) {\n  if (str === null || str === undefined) return '';\n  \n  const htmlEscapes = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;'\n  };\n  \n  return String(str).replace(/[&<>\"']/g, char => htmlEscapes[char]);\n}\n\n/**\n * Format number with thousands separator\n * @param {number} num - Number to format\n * @param {string} [separator=','] - Thousands separator\n * @returns {string}\n */\nexport function formatNumber(num, separator = ',') {\n  if (num === null || num === undefined || isNaN(num)) return '';\n  return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, separator);\n}\n\n/**\n * Parse a value to number safely\n * @param {any} value - Value to parse\n * @param {number} [defaultValue=0] - Default if parsing fails\n * @returns {number}\n */\nexport function toNumber(value, defaultValue = 0) {\n  if (value === null || value === undefined || value === '') {\n    return defaultValue;\n  }\n  const parsed = parseFloat(value);\n  return isNaN(parsed) ? defaultValue : parsed;\n}\n\n/**\n * Group array of objects by a key\n * @param {Array<Object>} array - Array to group\n * @param {string|Function} key - Key to group by\n * @returns {Object}\n */\nexport function groupBy(array, key) {\n  return array.reduce((result, item) => {\n    const groupKey = typeof key === 'function' ? key(item) : item[key];\n    (result[groupKey] = result[groupKey] || []).push(item);\n    return result;\n  }, {});\n}\n\n/**\n * Sort array of objects by multiple keys\n * @param {Array<Object>} array - Array to sort\n * @param {Array<{key: string, order?: 'asc'|'desc'}>} sortBy - Sort configuration\n * @returns {Array<Object>}\n */\nexport function sortByMultiple(array, sortBy) {\n  return [...array].sort((a, b) => {\n    for (const { key, order = 'asc' } of sortBy) {\n      const valueA = a[key];\n      const valueB = b[key];\n      \n      let comparison = 0;\n      \n      if (valueA < valueB) comparison = -1;\n      if (valueA > valueB) comparison = 1;\n      \n      if (comparison !== 0) {\n        return order === 'desc' ? -comparison : comparison;\n      }\n    }\n    return 0;\n  });\n}\n\n/**\n * Sum values in an array\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function sum(values) {\n  return values.reduce((acc, val) => acc + (toNumber(val)), 0);\n}\n\n/**\n * Calculate average of values\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function average(values) {\n  if (values.length === 0) return 0;\n  return sum(values) / values.length;\n}\n\n/**\n * Find minimum value\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function min(values) {\n  const nums = values.filter(v => !isNaN(toNumber(v)));\n  return nums.length ? Math.min(...nums.map(toNumber)) : 0;\n}\n\n/**\n * Find maximum value\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function max(values) {\n  const nums = values.filter(v => !isNaN(toNumber(v)));\n  return nums.length ? Math.max(...nums.map(toNumber)) : 0;\n}\n\n/**\n * Chunk array into smaller arrays\n * @param {Array} array - Array to chunk\n * @param {number} size - Chunk size\n * @returns {Array<Array>}\n */\nexport function chunk(array, size) {\n  const chunks = [];\n  for (let i = 0; i < array.length; i += size) {\n    chunks.push(array.slice(i, i + size));\n  }\n  return chunks;\n}\n\n/**\n * Create a range of numbers\n * @param {number} start - Start value\n * @param {number} end - End value\n * @param {number} [step=1] - Step value\n * @returns {Array<number>}\n */\nexport function range(start, end, step = 1) {\n  const result = [];\n  for (let i = start; i <= end; i += step) {\n    result.push(i);\n  }\n  return result;\n}\n","/**\n * TableState - Centralized state management with change tracking\n *\n * Manages all table data and state with efficient change detection\n * and cascade update support for totals, groups, and computed values.\n */\n\nimport { EventBus, TableEvents } from \"./EventBus.js\"\nimport { deepClone, deepEqual, generateId } from \"../utils/helpers.js\"\n\nexport class TableState {\n  /**\n   * @param {EventBus} eventBus - Event bus instance\n   * @param {Object} initialState - Initial state configuration\n   */\n  constructor(eventBus, initialState = {}) {\n    /** @type {EventBus} */\n    this._eventBus = eventBus\n\n    /** @type {Object} Internal state */\n    this._state = {\n      // Core data\n      data: [],\n      originalData: [],\n\n      // Column definitions\n      columns: [],\n\n      // UI state\n      mode: \"view\", // 'view' | 'edit'\n\n      // Group state\n      groups: {},\n      groupedData: null,\n      collapsedGroups: new Set(),\n\n      // Focus state\n      focusedCell: null,\n\n      // Computed values cache\n      computedCache: new Map(),\n\n      // Dirty tracking\n      dirtyRows: new Set(),\n      dirtyColumns: new Map(),\n\n      // Configuration\n      config: {\n        fixedFirstColumn: false,\n        enableGrouping: false,\n        groupBy: null,\n        enableInfoRows: false,\n        enableRowTotals: false,\n        actions: [],\n        ...initialState.config,\n      },\n    }\n\n    // Apply initial data\n    if (initialState.data) {\n      this.setData(initialState.data)\n    }\n    if (initialState.columns) {\n      this.setColumns(initialState.columns)\n    }\n  }\n\n  // ============================================\n  // Data Management\n  // ============================================\n\n  /**\n   * Set table data\n   * @param {Array<Object>} data - Row data array\n   */\n  setData(data) {\n    this._state.originalData = deepClone(data)\n    this._state.data = this._normalizeData(data)\n    this._state.dirtyRows.clear()\n    this._invalidateCache()\n\n    if (this._state.config.enableGrouping && this._state.config.groupBy) {\n      this._computeGroups()\n    }\n\n    this._eventBus.emit(TableEvents.DATA_CHANGE, {\n      data: this._state.data,\n      source: \"setData\",\n    })\n  }\n\n  /**\n   * Get current data (returns a copy to prevent mutation)\n   * @returns {Array<Object>}\n   */\n  getData() {\n    return deepClone(this._state.data)\n  }\n\n  /**\n   * Get a single row by ID\n   * @param {string|number} rowId - Row identifier\n   * @returns {Object|null}\n   */\n  getRow(rowId) {\n    const row = this._state.data.find((r) => r._id === rowId)\n    return row ? deepClone(row) : null\n  }\n\n  /**\n   * Update a specific cell value\n   * @param {string|number} rowId - Row identifier\n   * @param {string} columnName - Column name\n   * @param {any} value - New value\n   * @param {Object} options - Update options\n   */\n  updateCell(rowId, columnName, value, options = {}) {\n    const rowIndex = this._state.data.findIndex((r) => r._id === rowId)\n    if (rowIndex === -1) return\n\n    const row = this._state.data[rowIndex]\n    const oldValue = row[columnName]\n\n    // Skip if value hasn't changed\n    if (deepEqual(oldValue, value)) return\n\n    // Update the value\n    row[columnName] = value\n\n    // Mark as dirty\n    this._state.dirtyRows.add(rowId)\n    if (!this._state.dirtyColumns.has(rowId)) {\n      this._state.dirtyColumns.set(rowId, new Set())\n    }\n    this._state.dirtyColumns.get(rowId).add(columnName)\n\n    // Invalidate affected cache\n    this._invalidateCacheForRow(rowId, columnName)\n\n    // Emit cell change event\n    this._eventBus.emit(TableEvents.CELL_CHANGE, {\n      rowId,\n      rowIndex,\n      columnName,\n      oldValue,\n      newValue: value,\n      row: deepClone(row),\n    })\n\n    // Emit row change event\n    this._eventBus.emit(TableEvents.ROW_CHANGE, {\n      rowId,\n      rowIndex,\n      columnName,\n      row: deepClone(row),\n      dirtyColumns: Array.from(this._state.dirtyColumns.get(rowId) || []),\n    })\n\n    // Trigger cascade updates if needed\n    if (!options.skipCascade) {\n      this._triggerCascadeUpdate(rowId, columnName, value)\n    }\n  }\n\n  /**\n   * Batch update multiple cells (more efficient for bulk changes)\n   * @param {Array<{rowId, columnName, value}>} updates - Array of updates\n   */\n  batchUpdate(updates) {\n    this._eventBus.startBatch()\n\n    updates.forEach(({ rowId, columnName, value }) => {\n      this.updateCell(rowId, columnName, value, { skipCascade: true })\n    })\n\n    // Compute cascade updates once for all changes\n    this._computeAllCascades()\n\n    this._eventBus.endBatch()\n\n    this._eventBus.emit(TableEvents.DATA_CHANGE, {\n      data: this._state.data,\n      source: \"batchUpdate\",\n      updatedRows: updates.map((u) => u.rowId),\n    })\n  }\n\n  // ============================================\n  // Column Management\n  // ============================================\n\n  /**\n   * Set column definitions\n   * @param {Array<Object>} columns - Column configuration array\n   */\n  setColumns(columns) {\n    this._state.columns = columns.map((col, index) => ({\n      ...col,\n      _index: index,\n      _id: col.id || col.data || `col_${index}`,\n    }))\n\n    this._eventBus.emit(TableEvents.STATE_CHANGE, {\n      property: \"columns\",\n      value: this._state.columns,\n    })\n  }\n\n  /**\n   * Get column definitions\n   * @returns {Array<Object>}\n   */\n  getColumns() {\n    const columns = [...this._state.columns]\n\n    // Append row total column if enabled\n    if (this._state.config.enableRowTotals) {\n      // Default format: $X,XXX\n      const defaultFormat = (value) =>\n        value !== null && value !== undefined\n          ? `$${Number(value).toLocaleString()}`\n          : \"$0\"\n\n      columns.push({\n        data: \"_rowTotal\",\n        title: \"Total\",\n        type: \"number\",\n        editable: false,\n        aggregate: \"sum\",\n        _id: \"_rowTotal\",\n        _index: columns.length,\n        _isRowTotal: true,\n        format: this._state.config.rowTotalsFormat || defaultFormat,\n      })\n    }\n\n    return columns\n  }\n\n  /**\n   * Get a column by name/id\n   * @param {string} columnId - Column identifier\n   * @returns {Object|null}\n   */\n  getColumn(columnId) {\n    // Check for row total column\n    if (columnId === \"_rowTotal\" && this._state.config.enableRowTotals) {\n      // Default format: $X,XXX\n      const defaultFormat = (value) =>\n        value !== null && value !== undefined\n          ? `$${Number(value).toLocaleString()}`\n          : \"$0\"\n\n      return {\n        data: \"_rowTotal\",\n        title: \"Total\",\n        type: \"number\",\n        editable: false,\n        aggregate: \"sum\",\n        _id: \"_rowTotal\",\n        _isRowTotal: true,\n        format: this._state.config.rowTotalsFormat || defaultFormat,\n      }\n    }\n\n    return this._state.columns.find(\n      (c) => c._id === columnId || c.data === columnId\n    )\n  }\n\n  // ============================================\n  // Mode Management\n  // ============================================\n\n  /**\n   * Set table mode\n   * @param {'view'|'edit'} mode - Table mode\n   */\n  setMode(mode) {\n    if (mode !== \"view\" && mode !== \"edit\") {\n      console.warn(`Invalid mode: ${mode}. Must be 'view' or 'edit'.`)\n      return\n    }\n\n    const oldMode = this._state.mode\n    this._state.mode = mode\n\n    this._eventBus.emit(TableEvents.MODE_CHANGE, {\n      oldMode,\n      newMode: mode,\n    })\n  }\n\n  /**\n   * Get current mode\n   * @returns {'view'|'edit'}\n   */\n  getMode() {\n    return this._state.mode\n  }\n\n  /**\n   * Check if in edit mode\n   * @returns {boolean}\n   */\n  isEditMode() {\n    return this._state.mode === \"edit\"\n  }\n\n  // ============================================\n  // Group Management\n  // ============================================\n\n  /**\n   * Toggle group visibility\n   * @param {string} groupId - Group identifier\n   */\n  toggleGroup(groupId) {\n    if (this._state.collapsedGroups.has(groupId)) {\n      this._state.collapsedGroups.delete(groupId)\n    } else {\n      this._state.collapsedGroups.add(groupId)\n    }\n\n    this._eventBus.emit(TableEvents.GROUP_TOGGLE, {\n      groupId,\n      collapsed: this._state.collapsedGroups.has(groupId),\n    })\n  }\n\n  /**\n   * Check if a group is collapsed\n   * @param {string} groupId - Group identifier\n   * @returns {boolean}\n   */\n  isGroupCollapsed(groupId) {\n    return this._state.collapsedGroups.has(groupId)\n  }\n\n  /**\n   * Get grouped data structure\n   * @returns {Object|null}\n   */\n  getGroupedData() {\n    return this._state.groupedData\n  }\n\n  /**\n   * Get ungrouped rows (rows without a group value)\n   * @returns {Array}\n   */\n  getUngroupedRows() {\n    return this._state.ungroupedRows || []\n  }\n\n  /**\n   * Get info rows (informational header rows)\n   * @returns {Array}\n   */\n  getInfoRows() {\n    return this._state.infoRows || []\n  }\n\n  /**\n   * Expand all groups\n   */\n  expandAllGroups() {\n    this._state.collapsedGroups.clear()\n    this._eventBus.emit(TableEvents.GROUP_EXPAND_ALL, {})\n  }\n\n  /**\n   * Collapse all groups\n   */\n  collapseAllGroups() {\n    if (this._state.groupedData) {\n      Object.keys(this._state.groupedData).forEach((groupId) => {\n        this._state.collapsedGroups.add(groupId)\n      })\n    }\n    this._eventBus.emit(TableEvents.GROUP_COLLAPSE_ALL, {})\n  }\n\n  // ============================================\n  // Dirty State Management\n  // ============================================\n\n  /**\n   * Get all dirty (modified) rows\n   * @returns {Array<Object>}\n   */\n  getDirtyRows() {\n    return this._state.data\n      .filter((row) => this._state.dirtyRows.has(row._id))\n      .map((row) => deepClone(row))\n  }\n\n  /**\n   * Check if a row is dirty\n   * @param {string|number} rowId - Row identifier\n   * @returns {boolean}\n   */\n  isRowDirty(rowId) {\n    return this._state.dirtyRows.has(rowId)\n  }\n\n  /**\n   * Clear dirty state (e.g., after save)\n   */\n  clearDirty() {\n    this._state.dirtyRows.clear()\n    this._state.dirtyColumns.clear()\n    this._state.originalData = deepClone(this._state.data)\n  }\n\n  /**\n   * Revert all changes to original data\n   */\n  revertChanges() {\n    this.setData(this._state.originalData)\n  }\n\n  // ============================================\n  // Configuration\n  // ============================================\n\n  /**\n   * Update configuration\n   * @param {Object} config - Configuration updates\n   */\n  setConfig(config) {\n    this._state.config = { ...this._state.config, ...config }\n\n    if (config.groupBy !== undefined) {\n      this._computeGroups()\n    }\n\n    this._eventBus.emit(TableEvents.STATE_CHANGE, {\n      property: \"config\",\n      value: this._state.config,\n    })\n  }\n\n  /**\n   * Get current configuration\n   * @returns {Object}\n   */\n  getConfig() {\n    return { ...this._state.config }\n  }\n\n  // ============================================\n  // Private Methods\n  // ============================================\n\n  /**\n   * Normalize data by adding internal IDs\n   * @private\n   */\n  _normalizeData(data) {\n    return data.map((row, index) => ({\n      ...row,\n      _id: row._id || row.id || generateId(),\n      _index: index,\n      _type: row._type || \"data\", // 'data' | 'infoRow' | 'group-header' | 'total'\n    }))\n  }\n\n  /**\n   * Compute group structure from data\n   * @private\n   */\n  _computeGroups() {\n    const { groupBy } = this._state.config\n    if (!groupBy) {\n      this._state.groupedData = null\n      return\n    }\n\n    const groups = {}\n    const ungroupedRows = []\n    const infoRows = []\n\n    this._state.data.forEach((row) => {\n      // Info rows are rendered separately at the top\n      if (row._type === \"infoRow\") {\n        infoRows.push(row)\n        return\n      }\n\n      // Only include data rows in groups\n      if (row._type !== \"data\") return\n\n      const groupKey =\n        typeof groupBy === \"function\" ? groupBy(row) : row[groupBy]\n\n      // Handle rows without a group value\n      if (groupKey === null || groupKey === undefined || groupKey === \"\") {\n        ungroupedRows.push(row)\n        return\n      }\n\n      if (!groups[groupKey]) {\n        groups[groupKey] = {\n          id: groupKey,\n          label: groupKey,\n          rows: [],\n          totals: {},\n        }\n      }\n      groups[groupKey].rows.push(row)\n    })\n\n    // Store ungrouped rows and info rows separately\n    this._state.groupedData = groups\n    this._state.ungroupedRows = ungroupedRows\n    this._state.infoRows = infoRows\n  }\n\n  /**\n   * Invalidate entire computed cache\n   * @private\n   */\n  _invalidateCache() {\n    this._state.computedCache.clear()\n  }\n\n  /**\n   * Invalidate cache for specific row/column\n   * @private\n   */\n  _invalidateCacheForRow(rowId, columnName) {\n    // Invalidate direct cache\n    this._state.computedCache.delete(`${rowId}:${columnName}`)\n\n    // Invalidate dependent caches (totals, cumulative, etc.)\n    const column = this.getColumn(columnName)\n    if (column && column.affectsColumns) {\n      column.affectsColumns.forEach((affectedCol) => {\n        this._state.computedCache.forEach((_, key) => {\n          if (key.includes(`:${affectedCol}`)) {\n            this._state.computedCache.delete(key)\n          }\n        })\n      })\n    }\n  }\n\n  /**\n   * Trigger cascade updates for dependent rows/cells\n   * @private\n   */\n  _triggerCascadeUpdate(rowId, columnName, value) {\n    const column = this.getColumn(columnName)\n    if (!column) return\n\n    // Check for cascade configuration\n    if (column.cascade) {\n      column.cascade({\n        rowId,\n        columnName,\n        value,\n        state: this,\n        updateCell: (rId, cName, val) => {\n          this.updateCell(rId, cName, val, { skipCascade: true })\n        },\n      })\n    }\n\n    // Note: Group totals are recalculated by GroupManager which listens for CELL_CHANGE events\n  }\n\n  /**\n   * Compute all cascade updates (for batch operations)\n   * @private\n   */\n  _computeAllCascades() {\n    // Note: Group totals are recalculated by GroupManager which listens for DATA_CHANGE events\n  }\n\n  /**\n   * Destroy state and cleanup\n   */\n  destroy() {\n    this._state.data = []\n    this._state.columns = []\n    this._state.computedCache.clear()\n    this._state.dirtyRows.clear()\n    this._state.dirtyColumns.clear()\n    this._state.collapsedGroups.clear()\n  }\n}\n","/**\n * DOM Utilities - Helper functions for DOM manipulation\n */\n\n/**\n * Create an element with attributes\n * @param {string} tag - HTML tag name\n * @param {Object} [attributes] - Attributes to set\n * @returns {HTMLElement}\n */\nexport function createElement(tag, attributes = {}) {\n  const element = document.createElement(tag)\n  setAttributes(element, attributes)\n  return element\n}\n\n/**\n * Set multiple attributes on an element\n * @param {HTMLElement} element - Target element\n * @param {Object} attributes - Attributes object\n */\nexport function setAttributes(element, attributes) {\n  Object.entries(attributes).forEach(([key, value]) => {\n    if (key === \"class\") {\n      element.className = value\n    } else if (key === \"style\" && typeof value === \"object\") {\n      Object.assign(element.style, value)\n    } else if (key.startsWith(\"data-\")) {\n      element.setAttribute(key, value)\n    } else if (key in element) {\n      element[key] = value\n    } else {\n      element.setAttribute(key, value)\n    }\n  })\n}\n\n/**\n * Add one or more classes to an element\n * @param {HTMLElement} element - Target element\n * @param {...string} classNames - Class names to add\n */\nexport function addClass(element, ...classNames) {\n  classNames.forEach((className) => {\n    if (className) {\n      element.classList.add(className)\n    }\n  })\n}\n\n/**\n * Remove one or more classes from an element\n * @param {HTMLElement} element - Target element\n * @param {...string} classNames - Class names to remove\n */\nexport function removeClass(element, ...classNames) {\n  classNames.forEach((className) => {\n    if (className) {\n      element.classList.remove(className)\n    }\n  })\n}\n\n/**\n * Toggle a class on an element\n * @param {HTMLElement} element - Target element\n * @param {string} className - Class name to toggle\n * @param {boolean} [force] - Force add or remove\n * @returns {boolean} - Whether class is now present\n */\nexport function toggleClass(element, className, force) {\n  return element.classList.toggle(className, force)\n}\n\n/**\n * Check if element has a class\n * @param {HTMLElement} element - Target element\n * @param {string} className - Class name to check\n * @returns {boolean}\n */\nexport function hasClass(element, className) {\n  return element.classList.contains(className)\n}\n\n/**\n * Find closest ancestor matching selector\n * @param {HTMLElement} element - Starting element\n * @param {string} selector - CSS selector\n * @returns {HTMLElement|null}\n */\nexport function closest(element, selector) {\n  return element.closest(selector)\n}\n\n/**\n * Query selector wrapper\n * @param {string} selector - CSS selector\n * @param {HTMLElement} [context=document] - Context element\n * @returns {HTMLElement|null}\n */\nexport function $(selector, context = document) {\n  return context.querySelector(selector)\n}\n\n/**\n * Query selector all wrapper\n * @param {string} selector - CSS selector\n * @param {HTMLElement} [context=document] - Context element\n * @returns {NodeListOf<HTMLElement>}\n */\nexport function $$(selector, context = document) {\n  return context.querySelectorAll(selector)\n}\n\n/**\n * Get element's offset relative to document\n * @param {HTMLElement} element - Target element\n * @returns {{top: number, left: number}}\n */\nexport function getOffset(element) {\n  const rect = element.getBoundingClientRect()\n  return {\n    top: rect.top + window.scrollY,\n    left: rect.left + window.scrollX,\n  }\n}\n\n/**\n * Get element dimensions including padding and border\n * @param {HTMLElement} element - Target element\n * @returns {{width: number, height: number}}\n */\nexport function getOuterDimensions(element) {\n  return {\n    width: element.offsetWidth,\n    height: element.offsetHeight,\n  }\n}\n\n/**\n * Get element dimensions excluding padding and border\n * @param {HTMLElement} element - Target element\n * @returns {{width: number, height: number}}\n */\nexport function getInnerDimensions(element) {\n  const style = getComputedStyle(element)\n  return {\n    width:\n      element.clientWidth -\n      parseFloat(style.paddingLeft) -\n      parseFloat(style.paddingRight),\n    height:\n      element.clientHeight -\n      parseFloat(style.paddingTop) -\n      parseFloat(style.paddingBottom),\n  }\n}\n\n/**\n * Scroll element into view with options\n * @param {HTMLElement} element - Target element\n * @param {Object} [options] - ScrollIntoView options\n */\nexport function scrollIntoView(element, options = {}) {\n  element.scrollIntoView({\n    behavior: \"smooth\",\n    block: \"nearest\",\n    inline: \"nearest\",\n    ...options,\n  })\n}\n\n/**\n * Delegate event handling\n * @param {HTMLElement} parent - Parent element\n * @param {string} eventType - Event type\n * @param {string} selector - Child selector\n * @param {Function} handler - Event handler\n * @returns {Function} - Cleanup function\n */\nexport function delegate(parent, eventType, selector, handler) {\n  const listener = (event) => {\n    const target = event.target.closest(selector)\n    if (target && parent.contains(target)) {\n      handler.call(target, event, target)\n    }\n  }\n\n  parent.addEventListener(eventType, listener)\n\n  return () => parent.removeEventListener(eventType, listener)\n}\n\n/**\n * Create document fragment from HTML string\n * @param {string} html - HTML string\n * @returns {DocumentFragment}\n */\nexport function createFragment(html) {\n  const template = document.createElement(\"template\")\n  template.innerHTML = html.trim()\n  return template.content\n}\n\n/**\n * Empty an element's contents\n * @param {HTMLElement} element - Target element\n */\nexport function empty(element) {\n  while (element.firstChild) {\n    element.removeChild(element.firstChild)\n  }\n}\n\n/**\n * Check if element is visible in viewport\n * @param {HTMLElement} element - Target element\n * @returns {boolean}\n */\nexport function isInViewport(element) {\n  const rect = element.getBoundingClientRect()\n  return (\n    rect.top >= 0 &&\n    rect.left >= 0 &&\n    rect.bottom <=\n      (window.innerHeight || document.documentElement.clientHeight) &&\n    rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n  )\n}\n\n/**\n * Throttle function execution\n * @param {Function} func - Function to throttle\n * @param {number} wait - Wait time in milliseconds\n * @returns {Function} - Throttled function\n */\nexport function throttle(func, wait) {\n  let timeout = null\n  let lastRan = null\n\n  return function (...args) {\n    if (!lastRan) {\n      func.apply(this, args)\n      lastRan = Date.now()\n    } else {\n      clearTimeout(timeout)\n      timeout = setTimeout(() => {\n        if (Date.now() - lastRan >= wait) {\n          func.apply(this, args)\n          lastRan = Date.now()\n        }\n      }, wait - (Date.now() - lastRan))\n    }\n  }\n}\n\n/**\n * Debounce function execution\n * @param {Function} func - Function to debounce\n * @param {number} wait - Wait time in milliseconds\n * @returns {Function} - Debounced function\n */\nexport function debounce(func, wait) {\n  let timeout\n  return function (...args) {\n    clearTimeout(timeout)\n    timeout = setTimeout(() => func.apply(this, args), wait)\n  }\n}\n","/**\r\n * TableRenderer - Handles all DOM rendering operations\r\n *\r\n * Responsible for creating and updating the table DOM structure\r\n * with efficient differential updates for performance.\r\n */\r\n\r\nimport { TableEvents } from \"./EventBus.js\"\r\nimport {\r\n  createElement,\r\n  addClass,\r\n  removeClass,\r\n  setAttributes,\r\n} from \"../utils/dom.js\"\r\nimport { escapeHtml } from \"../utils/helpers.js\"\r\n\r\nexport class TableRenderer {\r\n  /**\r\n   * @param {HTMLElement} container - Container element\r\n   * @param {TableState} state - Table state instance\r\n   */\r\n  constructor(container, state) {\r\n    this._container = container\r\n    this._state = state\r\n    this._eventBus = state._eventBus\r\n\r\n    /** @type {HTMLElement} */\r\n    this._tableWrapper = null\r\n\r\n    /** @type {HTMLElement} */\r\n    this._table = null\r\n\r\n    /** @type {HTMLElement} */\r\n    this._thead = null\r\n\r\n    /** @type {HTMLElement} */\r\n    this._tbody = null\r\n\r\n    /** @type {Map<string, HTMLElement>} */\r\n    this._rowElements = new Map()\r\n\r\n    /** @type {Map<string, HTMLElement>} */\r\n    this._cellElements = new Map()\r\n\r\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\r\n    this._unsubscribers = []\r\n\r\n    // Subscribe to state changes\r\n    this._setupEventListeners()\r\n  }\r\n\r\n  /**\r\n   * Main render method\r\n   */\r\n  render() {\r\n    const config = this._state.getConfig()\r\n\r\n    // Create structure if it doesn't exist\r\n    if (!this._tableWrapper) {\r\n      this._createStructure()\r\n    }\r\n\r\n    // Update container classes based on config\r\n    this._updateContainerClasses(config)\r\n\r\n    // Render header\r\n    this._renderHeader()\r\n\r\n    // Render body based on grouping config\r\n    if (config.enableGrouping && this._state.getGroupedData()) {\r\n      this._renderGroupedBody()\r\n    } else {\r\n      this._renderBody()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a single cell without full re-render\r\n   * @param {string} rowId - Row identifier\r\n   * @param {string} columnName - Column name\r\n   * @param {any} value - New value\r\n   */\r\n  updateCell(rowId, columnName, value) {\r\n    const cellKey = `${rowId}:${columnName}`\r\n    const cell = this._cellElements.get(cellKey)\r\n\r\n    if (cell) {\r\n      const column = this._state.getColumn(columnName)\r\n      this._renderCellContent(cell, value, column, this._state.getRow(rowId))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a single row without full re-render\r\n   * @param {string} rowId - Row identifier\r\n   */\r\n  updateRow(rowId) {\r\n    const rowElement = this._rowElements.get(rowId)\r\n    const rowData = this._state.getRow(rowId)\r\n\r\n    if (rowElement && rowData) {\r\n      const columns = this._state.getColumns()\r\n      columns.forEach((column) => {\r\n        const cellKey = `${rowId}:${column.data}`\r\n        const cell = this._cellElements.get(cellKey)\r\n        if (cell) {\r\n          this._renderCellContent(cell, rowData[column.data], column, rowData)\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get cell element by row and column\r\n   * @param {string} rowId - Row identifier\r\n   * @param {string} columnName - Column name\r\n   * @returns {HTMLElement|null}\r\n   */\r\n  getCellElement(rowId, columnName) {\r\n    return this._cellElements.get(`${rowId}:${columnName}`) || null\r\n  }\r\n\r\n  /**\r\n   * Get row element by ID\r\n   * @param {string} rowId - Row identifier\r\n   * @returns {HTMLElement|null}\r\n   */\r\n  getRowElement(rowId) {\r\n    return this._rowElements.get(rowId) || null\r\n  }\r\n\r\n  /**\r\n   * Cleanup and destroy\r\n   */\r\n  destroy() {\r\n    // Unsubscribe from all event listeners\r\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\r\n    this._unsubscribers = []\r\n\r\n    // Clear element caches\r\n    this._rowElements.clear()\r\n    this._cellElements.clear()\r\n\r\n    // Remove DOM elements\r\n    if (this._tableWrapper) {\r\n      this._tableWrapper.remove()\r\n    }\r\n  }\r\n\r\n  // ============================================\r\n  // Private Methods\r\n  // ============================================\r\n\r\n  /**\r\n   * Setup event listeners for state changes\r\n   * @private\r\n   */\r\n  _setupEventListeners() {\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(\r\n        TableEvents.CELL_CHANGE,\r\n        ({ rowId, columnName, newValue }) => {\r\n          this.updateCell(rowId, columnName, newValue)\r\n        }\r\n      )\r\n    )\r\n\r\n    // Listen for data changes (row add/delete) to re-render\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.DATA_CHANGE, () => {\r\n        this.render()\r\n      })\r\n    )\r\n\r\n    // Listen for row total changes (emitted by GroupManager after calculation)\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.ROW_TOTAL_CHANGE, ({ rowId, newValue }) => {\r\n        this.updateCell(rowId, \"_rowTotal\", newValue)\r\n      })\r\n    )\r\n\r\n    // Listen for group totals updates to re-render group headers\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.STATE_CHANGE, ({ property, groupId }) => {\r\n        if (property === \"groupTotals\") {\r\n          // Re-render group headers to show updated aggregates\r\n          this._updateGroupHeaders(groupId)\r\n        }\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.MODE_CHANGE, () => {\r\n        this.render()\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.GROUP_TOGGLE, ({ groupId, collapsed }) => {\r\n        this._toggleGroupVisibility(groupId, collapsed)\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.GROUP_EXPAND_ALL, () => {\r\n        this._setAllGroupsVisibility(false)\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.GROUP_COLLAPSE_ALL, () => {\r\n        this._setAllGroupsVisibility(true)\r\n      })\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Create the base DOM structure\r\n   * @private\r\n   */\r\n  _createStructure() {\r\n    addClass(this._container, \"dg-container\")\r\n\r\n    // Create wrapper for scroll handling\r\n    this._tableWrapper = createElement(\"div\", { class: \"dg-table-wrapper\" })\r\n\r\n    // Create table\r\n    this._table = createElement(\"table\", { class: \"dg-table\" })\r\n\r\n    // Create header\r\n    this._thead = createElement(\"thead\", { class: \"dg-thead\" })\r\n\r\n    // Create body\r\n    this._tbody = createElement(\"tbody\", { class: \"dg-tbody\" })\r\n\r\n    // Assemble\r\n    this._table.appendChild(this._thead)\r\n    this._table.appendChild(this._tbody)\r\n    this._tableWrapper.appendChild(this._table)\r\n    this._container.appendChild(this._tableWrapper)\r\n  }\r\n\r\n  /**\r\n   * Update container classes based on config\r\n   * @private\r\n   */\r\n  _updateContainerClasses(config) {\r\n    const mode = this._state.getMode()\r\n\r\n    // Mode classes\r\n    removeClass(this._container, \"dg-mode-view\", \"dg-mode-edit\")\r\n    addClass(this._container, `dg-mode-${mode}`)\r\n\r\n    // Feature classes\r\n    if (config.fixedFirstColumn) {\r\n      addClass(this._container, \"dg-fixed-first-column\")\r\n    } else {\r\n      removeClass(this._container, \"dg-fixed-first-column\")\r\n    }\r\n\r\n    if (config.enableGrouping) {\r\n      addClass(this._container, \"dg-grouped\")\r\n    } else {\r\n      removeClass(this._container, \"dg-grouped\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render table header\r\n   * @private\r\n   */\r\n  _renderHeader() {\r\n    const columns = this._state.getColumns()\r\n    const config = this._state.getConfig()\r\n\r\n    this._thead.innerHTML = \"\"\r\n\r\n    const headerRow = createElement(\"tr\", { class: \"dg-header-row\" })\r\n\r\n    let visibleIndex = 0\r\n    columns.forEach((column) => {\r\n      if (column.visible === false) return\r\n\r\n      const th = createElement(\"th\", {\r\n        class: \"dg-header-cell\",\r\n        \"data-column\": column.data,\r\n        \"data-column-index\": visibleIndex,\r\n      })\r\n\r\n      // Fixed first column\r\n      if (visibleIndex === 0 && config.fixedFirstColumn) {\r\n        addClass(th, \"dg-cell-fixed\")\r\n      }\r\n\r\n      // Row total column header\r\n      if (column._isRowTotal) {\r\n        addClass(th, \"dg-header-row-total\")\r\n      }\r\n\r\n      // Header content\r\n      const headerContent = createElement(\"div\", { class: \"dg-header-content\" })\r\n      headerContent.textContent = column.title || column.data\r\n      th.appendChild(headerContent)\r\n\r\n      // Column width\r\n      if (column.width) {\r\n        th.style.width =\r\n          typeof column.width === \"number\" ? `${column.width}px` : column.width\r\n      }\r\n\r\n      headerRow.appendChild(th)\r\n      visibleIndex++\r\n    })\r\n\r\n    this._thead.appendChild(headerRow)\r\n  }\r\n\r\n  /**\r\n   * Render table body (ungrouped)\r\n   * @private\r\n   */\r\n  _renderBody() {\r\n    const data = this._state.getData()\r\n    const columns = this._state.getColumns()\r\n\r\n    this._tbody.innerHTML = \"\"\r\n    this._rowElements.clear()\r\n    this._cellElements.clear()\r\n\r\n    data.forEach((row) => {\r\n      const rowElement = this._createRowElement(row, columns)\r\n      this._tbody.appendChild(rowElement)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Render table body (grouped)\r\n   * @private\r\n   */\r\n  _renderGroupedBody() {\r\n    const groupedData = this._state.getGroupedData()\r\n    const ungroupedRows = this._state.getUngroupedRows()\r\n    const infoRows = this._state.getInfoRows()\r\n    const columns = this._state.getColumns()\r\n\r\n    this._tbody.innerHTML = \"\"\r\n    this._rowElements.clear()\r\n    this._cellElements.clear()\r\n\r\n    // Render info rows first (at the top, not part of any group)\r\n    if (infoRows && infoRows.length > 0) {\r\n      infoRows.forEach((row) => {\r\n        const rowElement = this._createRowElement(row, columns, null)\r\n        addClass(rowElement, \"dg-row-info\")\r\n        this._tbody.appendChild(rowElement)\r\n      })\r\n    }\r\n\r\n    // Render grouped rows\r\n    Object.entries(groupedData).forEach(([groupId, group]) => {\r\n      // Group header row (includes aggregate values)\r\n      const groupHeader = this._createGroupHeaderRow(groupId, group, columns)\r\n      this._tbody.appendChild(groupHeader)\r\n\r\n      // Group rows\r\n      const isCollapsed = this._state.isGroupCollapsed(groupId)\r\n      group.rows.forEach((row) => {\r\n        const rowElement = this._createRowElement(row, columns, groupId)\r\n        if (isCollapsed) {\r\n          addClass(rowElement, \"dg-row-hidden\")\r\n        }\r\n        this._tbody.appendChild(rowElement)\r\n      })\r\n    })\r\n\r\n    // Render ungrouped rows at the end (rows without a group value)\r\n    if (ungroupedRows.length > 0) {\r\n      ungroupedRows.forEach((row) => {\r\n        const rowElement = this._createRowElement(row, columns, null)\r\n        addClass(rowElement, \"dg-row-ungrouped\")\r\n        this._tbody.appendChild(rowElement)\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a data row element\r\n   * @private\r\n   */\r\n  _createRowElement(row, columns, groupId = null) {\r\n    const config = this._state.getConfig()\r\n    const isInfoRow = row._type === \"infoRow\"\r\n\r\n    const tr = createElement(\"tr\", {\r\n      class: `dg-row ${isInfoRow ? \"dg-row-info-row\" : \"dg-row-data\"}`,\r\n      \"data-row-id\": row._id,\r\n      \"data-row-index\": row._index,\r\n    })\r\n\r\n    if (groupId) {\r\n      tr.setAttribute(\"data-group\", groupId)\r\n    }\r\n\r\n    // Mark dirty rows\r\n    if (this._state.isRowDirty(row._id)) {\r\n      addClass(tr, \"dg-row-dirty\")\r\n    }\r\n\r\n    // Row click handler\r\n    tr.addEventListener(\"click\", (e) => {\r\n      if (!e.target.closest(\".dg-cell-input\")) {\r\n        this._eventBus.emit(TableEvents.ROW_CLICK, {\r\n          rowId: row._id,\r\n          rowIndex: row._index,\r\n          row: this._state.getRow(row._id),\r\n          event: e,\r\n        })\r\n      }\r\n    })\r\n\r\n    // Create cells\r\n    let visibleIndex = 0\r\n    columns.forEach((column) => {\r\n      if (column.visible === false) return\r\n\r\n      const td = this._createCellElement(row, column, visibleIndex, config)\r\n      tr.appendChild(td)\r\n\r\n      // Store reference\r\n      this._cellElements.set(`${row._id}:${column.data}`, td)\r\n      visibleIndex++\r\n    })\r\n\r\n    // Store reference\r\n    this._rowElements.set(row._id, tr)\r\n\r\n    return tr\r\n  }\r\n\r\n  /**\r\n   * Create a cell element\r\n   * @private\r\n   */\r\n  _createCellElement(row, column, index, config) {\r\n    const td = createElement(\"td\", {\r\n      class: \"dg-cell\",\r\n      \"data-column\": column.data,\r\n    })\r\n\r\n    // Fixed first column\r\n    if (index === 0 && config.fixedFirstColumn) {\r\n      addClass(td, \"dg-cell-fixed\")\r\n    }\r\n\r\n    // Row total column\r\n    if (column._isRowTotal) {\r\n      addClass(td, \"dg-cell-row-total\")\r\n    }\r\n\r\n    // Cell type classes\r\n    if (column.type) {\r\n      addClass(td, `dg-cell-${column.type}`)\r\n    }\r\n\r\n    // Alignment\r\n    if (column.align) {\r\n      td.style.textAlign = column.align\r\n    }\r\n\r\n    // Render content first (this clears innerHTML)\r\n    this._renderCellContent(td, row[column.data], column, row)\r\n\r\n    // Render actions for first column (if enabled for this column)\r\n    // Must be after _renderCellContent since it clears innerHTML\r\n    const actions = config.actions || []\r\n    const columnHasActions = column.actions !== false // Default true, can be disabled per column\r\n    if (\r\n      index === 0 &&\r\n      actions.length > 0 &&\r\n      columnHasActions &&\r\n      row._type !== \"infoRow\"\r\n    ) {\r\n      const actionsWrapper = this._createRowActions(actions, row)\r\n      // Insert actions at the beginning of the cell\r\n      td.insertBefore(actionsWrapper, td.firstChild)\r\n      addClass(td, \"dg-cell-has-actions\")\r\n    }\r\n\r\n    return td\r\n  }\r\n\r\n  /**\r\n   * Create row actions container with action icons\r\n   * @private\r\n   * @param {Array} actions - Array of action configurations\r\n   * @param {Object} row - Row data\r\n   * @returns {HTMLElement} Actions wrapper element\r\n   */\r\n  _createRowActions(actions, row) {\r\n    const wrapper = createElement(\"span\", { class: \"dg-row-actions\" })\r\n\r\n    actions.forEach((action, index) => {\r\n      const actionBtn = createElement(\"span\", {\r\n        class: \"dg-row-action\",\r\n        title: action.tooltip || \"\",\r\n        \"data-action-index\": index,\r\n      })\r\n\r\n      // Set the icon HTML\r\n      if (action.icon) {\r\n        if (typeof action.icon === \"string\") {\r\n          actionBtn.innerHTML = action.icon\r\n        } else if (action.icon instanceof HTMLElement) {\r\n          actionBtn.appendChild(action.icon.cloneNode(true))\r\n        }\r\n      }\r\n\r\n      // Click handler\r\n      actionBtn.addEventListener(\"click\", (e) => {\r\n        e.stopPropagation() // Prevent row click\r\n\r\n        // Get fresh row data\r\n        const rowData = this._state.getRow(row._id)\r\n\r\n        // Call the onClick handler if provided\r\n        if (typeof action.onClick === \"function\") {\r\n          action.onClick(rowData, e)\r\n        }\r\n\r\n        // Emit event for external listeners\r\n        this._eventBus.emit(TableEvents.ACTION_CLICK, {\r\n          actionIndex: index,\r\n          action,\r\n          rowId: row._id,\r\n          row: rowData,\r\n          event: e,\r\n        })\r\n      })\r\n\r\n      wrapper.appendChild(actionBtn)\r\n    })\r\n\r\n    return wrapper\r\n  }\r\n\r\n  /**\r\n   * Render cell content based on mode and column config\r\n   * @private\r\n   */\r\n  _renderCellContent(cell, value, column, row) {\r\n    const isEditMode = this._state.isEditMode()\r\n    // Check column, row type, and row-level editable override\r\n    const isEditable =\r\n      column.editable !== false &&\r\n      row._type !== \"infoRow\" &&\r\n      row._editable !== false\r\n\r\n    cell.innerHTML = \"\"\r\n\r\n    if (isEditMode && isEditable) {\r\n      // Edit mode - render input\r\n      const input = this._createInputElement(value, column, row)\r\n      cell.appendChild(input)\r\n    } else {\r\n      // View mode - render display value\r\n      const displayValue = this._formatDisplayValue(value, column, row)\r\n\r\n      if (column.render) {\r\n        // Custom render function\r\n        const rendered = column.render(value, row, column)\r\n        if (typeof rendered === \"string\") {\r\n          cell.innerHTML = rendered\r\n        } else if (rendered instanceof HTMLElement) {\r\n          cell.appendChild(rendered)\r\n        }\r\n      } else {\r\n        cell.textContent = displayValue\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create input element for edit mode\r\n   * @private\r\n   */\r\n  _createInputElement(value, column, row) {\r\n    const type = column.inputType || column.type || \"text\"\r\n\r\n    let input\r\n\r\n    if (type === \"select\" && column.options) {\r\n      input = createElement(\"select\", { class: \"dg-cell-input dg-cell-select\" })\r\n      column.options.forEach((opt) => {\r\n        const option = createElement(\"option\", { value: opt.value || opt })\r\n        option.textContent = opt.label || opt\r\n        if ((opt.value || opt) === value) {\r\n          option.selected = true\r\n        }\r\n        input.appendChild(option)\r\n      })\r\n    } else if (type === \"textarea\") {\r\n      input = createElement(\"textarea\", {\r\n        class: \"dg-cell-input dg-cell-textarea\",\r\n        value: value || \"\",\r\n      })\r\n      input.textContent = value || \"\"\r\n    } else {\r\n      input = createElement(\"input\", {\r\n        class: \"dg-cell-input\",\r\n        type: type === \"number\" ? \"number\" : \"text\",\r\n        value: value ?? \"\",\r\n      })\r\n\r\n      if (type === \"number\") {\r\n        if (column.min !== undefined) input.min = column.min\r\n        if (column.max !== undefined) input.max = column.max\r\n        if (column.step !== undefined) input.step = column.step\r\n      }\r\n    }\r\n\r\n    // Input event handlers\r\n    input.addEventListener(\"focus\", () => {\r\n      this._eventBus.emit(TableEvents.CELL_FOCUS, {\r\n        rowId: row._id,\r\n        columnName: column.data,\r\n        value,\r\n      })\r\n    })\r\n\r\n    input.addEventListener(\"blur\", () => {\r\n      this._eventBus.emit(TableEvents.CELL_BLUR, {\r\n        rowId: row._id,\r\n        columnName: column.data,\r\n        value: input.value,\r\n      })\r\n    })\r\n\r\n    input.addEventListener(\"change\", (e) => {\r\n      let newValue = e.target.value\r\n\r\n      // Type coercion\r\n      if (type === \"number\") {\r\n        newValue = newValue === \"\" ? null : parseFloat(newValue)\r\n      }\r\n\r\n      this._state.updateCell(row._id, column.data, newValue)\r\n\r\n      // Column-specific onChange\r\n      if (column.onChange) {\r\n        column.onChange({\r\n          value: newValue,\r\n          rowId: row._id,\r\n          row: this._state.getRow(row._id),\r\n          column,\r\n        })\r\n      }\r\n    })\r\n\r\n    return input\r\n  }\r\n\r\n  /**\r\n   * Format value for display\r\n   * @private\r\n   */\r\n  _formatDisplayValue(value, column, row) {\r\n    if (value === null || value === undefined) {\r\n      return column.defaultValue ?? \"\"\r\n    }\r\n\r\n    // Info rows display values as-is without column formatting\r\n    if (row._type === \"infoRow\") {\r\n      return String(value)\r\n    }\r\n\r\n    if (column.format) {\r\n      return column.format(value, row, column)\r\n    }\r\n\r\n    if (column.type === \"number\" && typeof value === \"number\") {\r\n      return column.decimals !== undefined\r\n        ? value.toFixed(column.decimals)\r\n        : value.toString()\r\n    }\r\n\r\n    if (column.type === \"currency\") {\r\n      const formatted = new Intl.NumberFormat(\"en-US\", {\r\n        style: \"currency\",\r\n        currency: column.currency || \"USD\",\r\n      }).format(value)\r\n      return formatted\r\n    }\r\n\r\n    if (column.type === \"date\" && value) {\r\n      const date = new Date(value)\r\n      return date.toLocaleDateString()\r\n    }\r\n\r\n    return String(value)\r\n  }\r\n\r\n  /**\r\n   * Create group header row\r\n   * @private\r\n   */\r\n  _createGroupHeaderRow(groupId, group, columns) {\r\n    const config = this._state.getConfig()\r\n    const isCollapsed = this._state.isGroupCollapsed(groupId)\r\n    const visibleColumns = columns.filter((c) => c.visible !== false)\r\n\r\n    const tr = createElement(\"tr\", {\r\n      class: \"dg-row dg-row-group-header\",\r\n      \"data-group\": groupId,\r\n    })\r\n\r\n    // Use pre-calculated totals from GroupManager\r\n    const aggregates = group.totals || {}\r\n\r\n    visibleColumns.forEach((column, index) => {\r\n      const td = createElement(\"td\", {\r\n        class: \"dg-cell dg-cell-group-header\",\r\n        \"data-column\": column.data,\r\n      })\r\n\r\n      // Fixed first column\r\n      if (index === 0 && config.fixedFirstColumn) {\r\n        addClass(td, \"dg-cell-fixed\")\r\n      }\r\n\r\n      // Row total column\r\n      if (column._isRowTotal) {\r\n        addClass(td, \"dg-cell-row-total\")\r\n      }\r\n\r\n      // First column: show toggle + group label\r\n      if (index === 0) {\r\n        const toggleContent = createElement(\"div\", {\r\n          class: \"dg-group-header-content\",\r\n        })\r\n\r\n        const toggleIcon = createElement(\"span\", {\r\n          class: `dg-group-toggle-icon ${\r\n            isCollapsed ? \"dg-collapsed\" : \"dg-expanded\"\r\n          }`,\r\n        })\r\n        toggleIcon.innerHTML = isCollapsed ? \"\" : \"\"\r\n\r\n        const groupLabel = createElement(\"span\", { class: \"dg-group-label\" })\r\n        groupLabel.textContent = group.label || groupId\r\n\r\n        const groupCount = createElement(\"span\", { class: \"dg-group-count\" })\r\n        groupCount.textContent = `(${group.rows.length})`\r\n\r\n        toggleContent.appendChild(toggleIcon)\r\n        toggleContent.appendChild(groupLabel)\r\n        toggleContent.appendChild(groupCount)\r\n        td.appendChild(toggleContent)\r\n      } else if (column.aggregate && aggregates[column.data] !== undefined) {\r\n        // Show aggregate value from GroupManager\r\n        td.textContent = this._formatDisplayValue(\r\n          aggregates[column.data],\r\n          column,\r\n          {}\r\n        )\r\n        addClass(td, \"dg-cell-aggregate\")\r\n      }\r\n\r\n      // Alignment\r\n      if (column.align) {\r\n        td.style.textAlign = column.align\r\n      }\r\n\r\n      tr.appendChild(td)\r\n    })\r\n\r\n    // Click handler for toggle\r\n    tr.addEventListener(\"click\", () => {\r\n      this._state.toggleGroup(groupId)\r\n    })\r\n\r\n    return tr\r\n  }\r\n\r\n  /**\r\n   * Create totals row for a group\r\n   * @private\r\n   */\r\n  _createTotalsRow(totals, columns, groupId) {\r\n    const config = this._state.getConfig()\r\n\r\n    const tr = createElement(\"tr\", {\r\n      class: \"dg-row dg-row-totals\",\r\n      \"data-group\": groupId,\r\n    })\r\n\r\n    columns.forEach((column, index) => {\r\n      if (column.visible === false) return\r\n\r\n      const td = createElement(\"td\", {\r\n        class: \"dg-cell dg-cell-total\",\r\n        \"data-column\": column.data,\r\n      })\r\n\r\n      if (index === 0 && config.fixedFirstColumn) {\r\n        addClass(td, \"dg-cell-fixed\")\r\n      }\r\n\r\n      if (totals[column.data] !== undefined) {\r\n        td.textContent = this._formatDisplayValue(\r\n          totals[column.data],\r\n          column,\r\n          {}\r\n        )\r\n      }\r\n\r\n      tr.appendChild(td)\r\n    })\r\n\r\n    return tr\r\n  }\r\n\r\n  /**\r\n   * Toggle group visibility\r\n   * @private\r\n   */\r\n  _toggleGroupVisibility(groupId, collapsed) {\r\n    const rows = this._tbody.querySelectorAll(\r\n      `[data-group=\"${groupId}\"]:not(.dg-row-group-header)`\r\n    )\r\n    const header = this._tbody.querySelector(\r\n      `.dg-row-group-header[data-group=\"${groupId}\"]`\r\n    )\r\n\r\n    rows.forEach((row) => {\r\n      if (collapsed) {\r\n        addClass(row, \"dg-row-hidden\")\r\n      } else {\r\n        removeClass(row, \"dg-row-hidden\")\r\n      }\r\n    })\r\n\r\n    // Update toggle icon\r\n    if (header) {\r\n      const icon = header.querySelector(\".dg-group-toggle-icon\")\r\n      if (icon) {\r\n        icon.innerHTML = collapsed ? \"\" : \"\"\r\n        if (collapsed) {\r\n          removeClass(icon, \"dg-expanded\")\r\n          addClass(icon, \"dg-collapsed\")\r\n        } else {\r\n          removeClass(icon, \"dg-collapsed\")\r\n          addClass(icon, \"dg-expanded\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set visibility for all groups\r\n   * @private\r\n   */\r\n  _setAllGroupsVisibility(collapsed) {\r\n    const groupedData = this._state.getGroupedData()\r\n    if (groupedData) {\r\n      Object.keys(groupedData).forEach((groupId) => {\r\n        this._toggleGroupVisibility(groupId, collapsed)\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update group header cells with new aggregate values\r\n   * @private\r\n   * @param {string} [groupId] - Specific group, or all if not provided\r\n   */\r\n  _updateGroupHeaders(groupId = null) {\r\n    // Guard: ensure tbody exists before trying to update\r\n    if (!this._tbody) return\r\n\r\n    const groupedData = this._state.getGroupedData()\r\n    if (!groupedData) return\r\n\r\n    const columns = this._state.getColumns()\r\n    const groupsToUpdate = groupId ? [groupId] : Object.keys(groupedData)\r\n\r\n    groupsToUpdate.forEach((gId) => {\r\n      const group = groupedData[gId]\r\n      if (!group) return\r\n\r\n      const headerRow = this._tbody.querySelector(\r\n        `.dg-row-group-header[data-group=\"${gId}\"]`\r\n      )\r\n      if (!headerRow) return\r\n\r\n      // Update each aggregate cell in the header\r\n      columns.forEach((column) => {\r\n        if (column.aggregate && group.totals[column.data] !== undefined) {\r\n          const cell = headerRow.querySelector(`[data-column=\"${column.data}\"]`)\r\n          if (cell && !cell.querySelector(\".dg-group-header-content\")) {\r\n            cell.textContent = this._formatDisplayValue(\r\n              group.totals[column.data],\r\n              column,\r\n              {}\r\n            )\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n}\r\n","/**\n * RowManager - Handles row-related operations\n *\n * Manages row CRUD operations and row types.\n */\n\nimport { TableEvents } from \"../core/EventBus.js\"\nimport { generateId, deepClone } from \"../utils/helpers.js\"\n\nexport class RowManager {\n  /**\n   * @param {TableState} state - Table state instance\n   * @param {EventBus} eventBus - Event bus instance\n   */\n  constructor(state, eventBus) {\n    this._state = state\n    this._eventBus = eventBus\n\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\n    this._unsubscribers = []\n\n    // Setup event listeners\n    this._setupListeners()\n  }\n\n  /**\n   * Add a new row\n   * @param {Object} rowData - Row data\n   * @param {Object} [options] - Options\n   * @param {number} [options.index] - Insert at specific index\n   * @param {string} [options.groupId] - Group to add row to\n   * @param {string} [options.afterRowId] - Insert after specific row\n   * @param {string} [options.type='data'] - Row type\n   * @returns {Object} Added row\n   */\n  addRow(rowData, options = {}) {\n    const data = this._state.getData()\n    const { index, groupId, afterRowId, type = \"data\" } = options\n\n    const newRow = {\n      ...rowData,\n      _id: rowData._id || generateId(),\n      _type: type,\n    }\n\n    let insertIndex = data.length\n\n    if (index !== undefined) {\n      insertIndex = Math.max(0, Math.min(index, data.length))\n    } else if (afterRowId) {\n      const afterIndex = data.findIndex((r) => r._id === afterRowId)\n      if (afterIndex !== -1) {\n        insertIndex = afterIndex + 1\n      }\n    } else if (groupId) {\n      // Find last row in group\n      const config = this._state.getConfig()\n      const groupBy = config.groupBy\n      for (let i = data.length - 1; i >= 0; i--) {\n        const rowGroup =\n          typeof groupBy === \"function\" ? groupBy(data[i]) : data[i][groupBy]\n        if (rowGroup === groupId) {\n          insertIndex = i + 1\n          break\n        }\n      }\n\n      // Set group key on new row\n      if (typeof groupBy === \"string\") {\n        newRow[groupBy] = groupId\n      }\n    }\n\n    // Insert row\n    data.splice(insertIndex, 0, newRow)\n\n    // Update indices\n    data.forEach((row, idx) => {\n      row._index = idx\n    })\n\n    this._state.setData(data)\n\n    this._eventBus.emit(TableEvents.ROW_ADD, {\n      row: newRow,\n      index: insertIndex,\n    })\n\n    return newRow\n  }\n\n  /**\n   * Add an info row (informational row)\n   * @param {string} parentRowId - Parent row ID\n   * @param {Object} infoRowData - Info row data\n   * @returns {Object} Added info row\n   */\n  addInfoRow(parentRowId, infoRowData) {\n    return this.addRow(infoRowData, {\n      afterRowId: parentRowId,\n      type: \"infoRow\",\n    })\n  }\n\n  /**\n   * Delete a row\n   * @param {string} rowId - Row ID to delete\n   * @returns {boolean} Success\n   */\n  deleteRow(rowId) {\n    const data = this._state.getData()\n    const rowIndex = data.findIndex((r) => r._id === rowId)\n\n    if (rowIndex === -1) {\n      return false\n    }\n\n    const deletedRow = data[rowIndex]\n    data.splice(rowIndex, 1)\n\n    // Update indices\n    data.forEach((row, idx) => {\n      row._index = idx\n    })\n\n    this._state.setData(data)\n\n    this._eventBus.emit(TableEvents.ROW_DELETE, {\n      rowId,\n      row: deletedRow,\n      index: rowIndex,\n    })\n\n    return true\n  }\n\n  /**\n   * Delete multiple rows\n   * @param {Array<string>} rowIds - Row IDs to delete\n   * @returns {number} Number of deleted rows\n   */\n  deleteRows(rowIds) {\n    let deletedCount = 0\n    const rowIdSet = new Set(rowIds)\n    const data = this._state.getData()\n\n    const filteredData = data.filter((row) => {\n      if (rowIdSet.has(row._id)) {\n        deletedCount++\n        return false\n      }\n      return true\n    })\n\n    if (deletedCount > 0) {\n      // Update indices\n      filteredData.forEach((row, idx) => {\n        row._index = idx\n      })\n\n      this._state.setData(filteredData)\n    }\n\n    return deletedCount\n  }\n\n  /**\n   * Duplicate a row\n   * @param {string} rowId - Row ID to duplicate\n   * @returns {Object|null} Duplicated row\n   */\n  duplicateRow(rowId) {\n    const row = this._state.getRow(rowId)\n    if (!row) return null\n\n    const { _id, _index, ...rowData } = row\n\n    return this.addRow(rowData, {\n      afterRowId: rowId,\n    })\n  }\n\n  /**\n   * Move row to a new position\n   * @param {string} rowId - Row ID to move\n   * @param {number} newIndex - New index\n   * @returns {boolean} Success\n   */\n  moveRow(rowId, newIndex) {\n    const data = this._state.getData()\n    const currentIndex = data.findIndex((r) => r._id === rowId)\n\n    if (currentIndex === -1) return false\n\n    const [movedRow] = data.splice(currentIndex, 1)\n    data.splice(newIndex, 0, movedRow)\n\n    // Update indices\n    data.forEach((row, idx) => {\n      row._index = idx\n    })\n\n    this._state.setData(data)\n\n    return true\n  }\n\n  /**\n   * Get rows by type\n   * @param {string} type - Row type ('data', 'infoRow', 'total', etc.)\n   * @returns {Array<Object>}\n   */\n  getRowsByType(type) {\n    return this._state.getData().filter((row) => row._type === type)\n  }\n\n  /**\n   * Get data rows only (excludes info rows, totals, etc.)\n   * @returns {Array<Object>}\n   */\n  getDataRows() {\n    return this.getRowsByType(\"data\")\n  }\n\n  /**\n   * Get info rows for a parent row\n   * @param {string} parentRowId - Parent row ID\n   * @returns {Array<Object>}\n   */\n  getInfoRows(parentRowId) {\n    const data = this._state.getData()\n    const parentIndex = data.findIndex((r) => r._id === parentRowId)\n\n    if (parentIndex === -1) return []\n\n    const infoRows = []\n    for (let i = parentIndex + 1; i < data.length; i++) {\n      if (data[i]._type === \"infoRow\") {\n        infoRows.push(data[i])\n      } else {\n        break // Info rows are contiguous after parent\n      }\n    }\n\n    return infoRows\n  }\n\n  /**\n   * Setup internal event listeners\n   * @private\n   */\n  _setupListeners() {\n    // No event listeners needed currently\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy() {\n    // Unsubscribe from all event listeners\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\n    this._unsubscribers = []\n  }\n}\n","/**\n * Data Utilities - Functions for data transformation and manipulation\n */\n\nimport { sum, average, min, max, toNumber, groupBy } from \"./helpers.js\"\n\n/**\n * Aggregate functions registry\n */\nexport const AggregateTypes = {\n  SUM: \"sum\",\n  AVG: \"average\",\n  MIN: \"min\",\n  MAX: \"max\",\n  COUNT: \"count\",\n  FIRST: \"first\",\n  LAST: \"last\",\n}\n\n/**\n * Built-in aggregate functions\n */\nexport const aggregates = {\n  [AggregateTypes.SUM]: (values) => sum(values),\n  [AggregateTypes.AVG]: (values) => average(values),\n  [AggregateTypes.MIN]: (values) => min(values),\n  [AggregateTypes.MAX]: (values) => max(values),\n  [AggregateTypes.COUNT]: (values) => values.length,\n  [AggregateTypes.FIRST]: (values) => values[0],\n  [AggregateTypes.LAST]: (values) => values[values.length - 1],\n}\n\n/**\n * Get aggregate function by type\n * @param {string|Function} type - Aggregate type or custom function\n * @returns {Function}\n */\nexport function getAggregateFunction(type) {\n  if (typeof type === \"function\") {\n    return type\n  }\n  return aggregates[type] || aggregates[AggregateTypes.SUM]\n}\n\n/**\n * Calculate group totals for all groups\n * @param {Object} groupedData - Grouped data object\n * @param {Array<Object>} columns - Column definitions\n * @returns {Object} - Groups with totals\n */\nexport function calculateGroupTotals(groupedData, columns) {\n  const result = {}\n\n  Object.entries(groupedData).forEach(([groupKey, rows]) => {\n    const totals = {}\n\n    columns.forEach((column) => {\n      if (column.aggregate) {\n        const values = rows\n          .map((row) => row[column.data])\n          .filter((v) => v !== null && v !== undefined)\n        const aggregateFn = getAggregateFunction(column.aggregate)\n        totals[column.data] = aggregateFn(values, rows)\n      }\n    })\n\n    result[groupKey] = {\n      rows,\n      totals,\n      count: rows.length,\n    }\n  })\n\n  return result\n}\n\n/**\n * Calculate grand totals for all data\n * @param {Array<Object>} data - All data rows\n * @param {Array<Object>} columns - Column definitions\n * @returns {Object} - Grand totals object\n */\nexport function calculateGrandTotals(data, columns) {\n  const totals = {}\n\n  columns.forEach((column) => {\n    if (column.aggregate) {\n      const values = data\n        .filter((row) => row._type === \"data\")\n        .map((row) => row[column.data])\n        .filter((v) => v !== null && v !== undefined)\n\n      const aggregateFn = getAggregateFunction(column.aggregate)\n      totals[column.data] = aggregateFn(values, data)\n    }\n  })\n\n  return totals\n}\n\n/**\n * Calculate cumulative values for a column\n * @param {Array<Object>} data - Data rows\n * @param {string} columnName - Column to calculate cumulative for\n * @param {string} [targetColumn] - Column to store result (defaults to columnName_cumulative)\n * @returns {Array<Object>} - Data with cumulative values\n */\nexport function calculateCumulative(data, columnName, targetColumn = null) {\n  const target = targetColumn || `${columnName}_cumulative`\n  let cumulative = 0\n\n  return data.map((row) => {\n    if (row._type !== \"data\") {\n      return { ...row, [target]: null }\n    }\n\n    cumulative += toNumber(row[columnName])\n    return { ...row, [target]: cumulative }\n  })\n}\n\n/**\n * Calculate percentage of total for each row\n * @param {Array<Object>} data - Data rows\n * @param {string} columnName - Column to calculate percentage for\n * @param {string} [targetColumn] - Column to store result\n * @returns {Array<Object>} - Data with percentage values\n */\nexport function calculatePercentage(data, columnName, targetColumn = null) {\n  const target = targetColumn || `${columnName}_percentage`\n  const total = sum(\n    data.filter((r) => r._type === \"data\").map((r) => toNumber(r[columnName]))\n  )\n\n  return data.map((row) => {\n    if (row._type !== \"data\" || total === 0) {\n      return { ...row, [target]: null }\n    }\n\n    const value = toNumber(row[columnName])\n    return { ...row, [target]: (value / total) * 100 }\n  })\n}\n\n/**\n * Filter data by criteria\n * @param {Array<Object>} data - Data to filter\n * @param {Object|Function} criteria - Filter criteria or function\n * @returns {Array<Object>}\n */\nexport function filterData(data, criteria) {\n  if (typeof criteria === \"function\") {\n    return data.filter(criteria)\n  }\n\n  return data.filter((row) => {\n    return Object.entries(criteria).every(([key, value]) => {\n      if (value === null || value === undefined) return true\n\n      if (typeof value === \"object\" && value !== null) {\n        // Handle comparison operators\n        if (\"$gt\" in value) return row[key] > value.$gt\n        if (\"$gte\" in value) return row[key] >= value.$gte\n        if (\"$lt\" in value) return row[key] < value.$lt\n        if (\"$lte\" in value) return row[key] <= value.$lte\n        if (\"$ne\" in value) return row[key] !== value.$ne\n        if (\"$in\" in value) return value.$in.includes(row[key])\n        if (\"$nin\" in value) return !value.$nin.includes(row[key])\n        if (\"$contains\" in value)\n          return String(row[key])\n            .toLowerCase()\n            .includes(value.$contains.toLowerCase())\n      }\n\n      return row[key] === value\n    })\n  })\n}\n\n/**\n * Flatten nested data structure\n * @param {Array<Object>} data - Data with potential children\n * @param {string} [childrenKey='children'] - Key containing child rows\n * @returns {Array<Object>} - Flat array\n */\nexport function flattenData(data, childrenKey = \"children\") {\n  const result = []\n\n  const flatten = (rows, level = 0, parentId = null) => {\n    rows.forEach((row) => {\n      const { [childrenKey]: children, ...rowData } = row\n\n      result.push({\n        ...rowData,\n        _level: level,\n        _parentId: parentId,\n        _hasChildren: children && children.length > 0,\n      })\n\n      if (children && children.length > 0) {\n        flatten(children, level + 1, row._id || row.id)\n      }\n    })\n  }\n\n  flatten(data)\n  return result\n}\n\n/**\n * Build tree structure from flat data\n * @param {Array<Object>} data - Flat data array\n * @param {string} [parentKey='parentId'] - Parent ID key\n * @returns {Array<Object>} - Tree structure\n */\nexport function buildTree(data, parentKey = \"parentId\") {\n  const map = new Map()\n  const roots = []\n\n  // Create map of all items\n  data.forEach((item) => {\n    map.set(item._id || item.id, { ...item, children: [] })\n  })\n\n  // Build tree\n  data.forEach((item) => {\n    const node = map.get(item._id || item.id)\n    const parentId = item[parentKey]\n\n    if (parentId && map.has(parentId)) {\n      map.get(parentId).children.push(node)\n    } else {\n      roots.push(node)\n    }\n  })\n\n  return roots\n}\n\n/**\n * Transform data for export\n * @param {Array<Object>} data - Data to transform\n * @param {Array<Object>} columns - Column definitions\n * @param {Object} [options] - Transform options\n * @returns {Array<Object>} - Transformed data\n */\nexport function transformForExport(data, columns, options = {}) {\n  const {\n    includeHidden = false,\n    formatValues = true,\n    excludeTypes = [\"infoRow\"],\n  } = options\n\n  const visibleColumns = columns.filter(\n    (col) => includeHidden || col.visible !== false\n  )\n\n  return data\n    .filter((row) => !excludeTypes.includes(row._type))\n    .map((row) => {\n      const transformed = {}\n\n      visibleColumns.forEach((column) => {\n        let value = row[column.data]\n\n        if (formatValues && column.format) {\n          value = column.format(value, row, column)\n        } else if (\n          formatValues &&\n          column.type === \"number\" &&\n          column.decimals !== undefined\n        ) {\n          value = toNumber(value).toFixed(column.decimals)\n        }\n\n        transformed[column.title || column.data] = value\n      })\n\n      return transformed\n    })\n}\n\n/**\n * Validate data against column definitions\n * @param {Array<Object>} data - Data to validate\n * @param {Array<Object>} columns - Column definitions\n * @returns {{valid: boolean, errors: Array<Object>}}\n */\nexport function validateData(data, columns) {\n  const errors = []\n\n  data.forEach((row, rowIndex) => {\n    columns.forEach((column) => {\n      if (\n        column.required &&\n        (row[column.data] === null ||\n          row[column.data] === undefined ||\n          row[column.data] === \"\")\n      ) {\n        errors.push({\n          rowIndex,\n          rowId: row._id,\n          column: column.data,\n          type: \"required\",\n          message: `${column.title || column.data} is required`,\n        })\n      }\n\n      if (\n        column.validator &&\n        row[column.data] !== null &&\n        row[column.data] !== undefined\n      ) {\n        const validationResult = column.validator(row[column.data], row, column)\n        if (validationResult !== true) {\n          errors.push({\n            rowIndex,\n            rowId: row._id,\n            column: column.data,\n            type: \"validation\",\n            message:\n              validationResult ||\n              `Invalid value for ${column.title || column.data}`,\n          })\n        }\n      }\n\n      if (\n        column.type === \"number\" &&\n        row[column.data] !== null &&\n        row[column.data] !== undefined\n      ) {\n        const numValue = toNumber(row[column.data], NaN)\n        if (isNaN(numValue)) {\n          errors.push({\n            rowIndex,\n            rowId: row._id,\n            column: column.data,\n            type: \"type\",\n            message: `${column.title || column.data} must be a number`,\n          })\n        } else {\n          if (column.min !== undefined && numValue < column.min) {\n            errors.push({\n              rowIndex,\n              rowId: row._id,\n              column: column.data,\n              type: \"range\",\n              message: `${column.title || column.data} must be at least ${\n                column.min\n              }`,\n            })\n          }\n          if (column.max !== undefined && numValue > column.max) {\n            errors.push({\n              rowIndex,\n              rowId: row._id,\n              column: column.data,\n              type: \"range\",\n              message: `${column.title || column.data} must be at most ${\n                column.max\n              }`,\n            })\n          }\n        }\n      }\n    })\n  })\n\n  return {\n    valid: errors.length === 0,\n    errors,\n  }\n}\n","/**\n * GroupManager - Handles row grouping operations\n *\n * Manages group creation, expansion/collapse, and group totals.\n */\n\nimport { TableEvents } from \"../core/EventBus.js\"\nimport { calculateGroupTotals, calculateGrandTotals } from \"../utils/data.js\"\nimport { sum, average, min, max } from \"../utils/helpers.js\"\n\nexport class GroupManager {\n  /**\n   * @param {TableState} state - Table state instance\n   * @param {EventBus} eventBus - Event bus instance\n   */\n  constructor(state, eventBus) {\n    this._state = state\n    this._eventBus = eventBus\n\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\n    this._unsubscribers = []\n\n    // Setup event listeners\n    this._setupListeners()\n\n    // Calculate initial totals if grouping is enabled\n    if (this._state.getConfig().enableGrouping) {\n      this.recalculateTotals()\n    }\n\n    // Calculate initial row totals if enabled\n    if (this._state.getConfig().enableRowTotals) {\n      this.recalculateRowTotals()\n    }\n  }\n\n  /**\n   * Calculate row total (sum of all numeric columns with aggregate) for a single row\n   * @param {Object} row - Row data\n   * @returns {number} Row total\n   */\n  calculateRowTotal(row) {\n    const columns = this._state.getColumns()\n    let total = 0\n\n    columns.forEach((column) => {\n      // Only sum columns that have aggregate defined (indicating they're numeric summable columns)\n      if (column.aggregate && column.data !== \"_rowTotal\") {\n        const value = row[column.data]\n        if (value !== null && value !== undefined && !isNaN(value)) {\n          total += Number(value)\n        }\n      }\n    })\n\n    return total\n  }\n\n  /**\n   * Recalculate row totals for all data rows\n   */\n  recalculateRowTotals() {\n    const config = this._state.getConfig()\n    if (!config.enableRowTotals) return\n\n    const data = this._state._state.data\n\n    data.forEach((row) => {\n      if (row._type === \"data\") {\n        row._rowTotal = this.calculateRowTotal(row)\n      }\n    })\n  }\n\n  /**\n   * Update row total for a specific row\n   * @param {string} rowId - Row identifier\n   */\n  updateRowTotal(rowId) {\n    const config = this._state.getConfig()\n    if (!config.enableRowTotals) return\n\n    const data = this._state._state.data\n    const row = data.find((r) => r._id === rowId)\n\n    if (row && row._type === \"data\") {\n      const oldTotal = row._rowTotal\n      row._rowTotal = this.calculateRowTotal(row)\n\n      // Emit event so TableRenderer can update the cell\n      if (oldTotal !== row._rowTotal) {\n        this._eventBus.emit(TableEvents.ROW_TOTAL_CHANGE, {\n          rowId,\n          oldValue: oldTotal,\n          newValue: row._rowTotal,\n        })\n      }\n    }\n  }\n\n  /**\n   * Get group information by ID\n   * @param {string} groupId - Group identifier\n   * @returns {Object|null}\n   */\n  getGroup(groupId) {\n    const groupedData = this._state.getGroupedData()\n    return groupedData ? groupedData[groupId] : null\n  }\n\n  /**\n   * Get all group IDs\n   * @returns {Array<string>}\n   */\n  getGroupIds() {\n    const groupedData = this._state.getGroupedData()\n    return groupedData ? Object.keys(groupedData) : []\n  }\n\n  /**\n   * Get rows in a specific group\n   * @param {string} groupId - Group identifier\n   * @returns {Array<Object>}\n   */\n  getGroupRows(groupId) {\n    const group = this.getGroup(groupId)\n    return group ? group.rows : []\n  }\n\n  /**\n   * Get group totals\n   * @param {string} groupId - Group identifier\n   * @returns {Object}\n   */\n  getGroupTotals(groupId) {\n    const group = this.getGroup(groupId)\n    return group ? group.totals : {}\n  }\n\n  /**\n   * Calculate and update group totals\n   * @param {string} [groupId] - Specific group, or all if not provided\n   */\n  recalculateTotals(groupId = null) {\n    const groupedData = this._state.getGroupedData()\n    const columns = this._state.getColumns()\n    const config = this._state.getConfig()\n\n    if (!groupedData) return\n\n    const groupsToUpdate = groupId\n      ? [groupId].filter((id) => groupedData[id])\n      : Object.keys(groupedData)\n\n    groupsToUpdate.forEach((gId) => {\n      const group = groupedData[gId]\n      const totals = {}\n\n      // Filter to only data rows (exclude infoRows and other special types)\n      const dataRows = group.rows.filter((row) => row._type === \"data\")\n\n      columns.forEach((column) => {\n        if (column.aggregate && column.data !== \"_rowTotal\") {\n          const values = dataRows\n            .map((row) => row[column.data])\n            .filter((v) => v !== null && v !== undefined && !isNaN(v))\n\n          totals[column.data] = this._calculateAggregate(\n            column.aggregate,\n            values,\n            dataRows\n          )\n        }\n      })\n\n      // Calculate row total for the group header (sum of all aggregated column totals)\n      if (config.enableRowTotals) {\n        let groupRowTotal = 0\n        columns.forEach((column) => {\n          if (\n            column.aggregate &&\n            column.data !== \"_rowTotal\" &&\n            totals[column.data] !== undefined\n          ) {\n            groupRowTotal += totals[column.data]\n          }\n        })\n        totals._rowTotal = groupRowTotal\n      }\n\n      group.totals = totals\n    })\n\n    this._eventBus.emit(TableEvents.STATE_CHANGE, {\n      property: \"groupTotals\",\n      groupId,\n    })\n  }\n\n  /**\n   * Get grand totals (across all groups)\n   * @returns {Object}\n   */\n  getGrandTotals() {\n    const data = this._state.getData().filter((r) => r._type === \"data\")\n    const columns = this._state.getColumns()\n\n    return calculateGrandTotals(data, columns)\n  }\n\n  /**\n   * Toggle group expansion\n   * @param {string} groupId - Group identifier\n   * @returns {boolean} New collapsed state\n   */\n  toggle(groupId) {\n    this._state.toggleGroup(groupId)\n    return this._state.isGroupCollapsed(groupId)\n  }\n\n  /**\n   * Expand a specific group\n   * @param {string} groupId - Group identifier\n   */\n  expand(groupId) {\n    if (this._state.isGroupCollapsed(groupId)) {\n      this._state.toggleGroup(groupId)\n    }\n  }\n\n  /**\n   * Collapse a specific group\n   * @param {string} groupId - Group identifier\n   */\n  collapse(groupId) {\n    if (!this._state.isGroupCollapsed(groupId)) {\n      this._state.toggleGroup(groupId)\n    }\n  }\n\n  /**\n   * Expand all groups\n   */\n  expandAll() {\n    this._state.expandAllGroups()\n  }\n\n  /**\n   * Collapse all groups\n   */\n  collapseAll() {\n    this._state.collapseAllGroups()\n  }\n\n  /**\n   * Check if group is collapsed\n   * @param {string} groupId - Group identifier\n   * @returns {boolean}\n   */\n  isCollapsed(groupId) {\n    return this._state.isGroupCollapsed(groupId)\n  }\n\n  /**\n   * Get expansion state of all groups\n   * @returns {Object<string, boolean>}\n   */\n  getExpansionState() {\n    const groupIds = this.getGroupIds()\n    const state = {}\n\n    groupIds.forEach((id) => {\n      state[id] = !this._state.isGroupCollapsed(id)\n    })\n\n    return state\n  }\n\n  /**\n   * Set expansion state for all groups\n   * @param {Object<string, boolean>} state - Expansion state map\n   */\n  setExpansionState(state) {\n    Object.entries(state).forEach(([groupId, expanded]) => {\n      if (expanded) {\n        this.expand(groupId)\n      } else {\n        this.collapse(groupId)\n      }\n    })\n  }\n\n  /**\n   * Move row to a different group\n   * @param {string} rowId - Row ID to move\n   * @param {string} targetGroupId - Target group ID\n   */\n  moveRowToGroup(rowId, targetGroupId) {\n    const config = this._state.getConfig()\n    const groupBy = config.groupBy\n\n    if (typeof groupBy !== \"string\") {\n      console.warn(\"Cannot move row when groupBy is a function\")\n      return\n    }\n\n    this._state.updateCell(rowId, groupBy, targetGroupId)\n    this.recalculateTotals()\n  }\n\n  /**\n   * Get group statistics\n   * @param {string} groupId - Group identifier\n   * @returns {Object}\n   */\n  getGroupStats(groupId) {\n    const group = this.getGroup(groupId)\n    if (!group) return null\n\n    const columns = this._state.getColumns()\n    const stats = {\n      rowCount: group.rows.length,\n      columns: {},\n    }\n\n    columns.forEach((column) => {\n      if (column.type === \"number\") {\n        const values = group.rows\n          .map((row) => row[column.data])\n          .filter((v) => v !== null && v !== undefined && !isNaN(v))\n\n        stats.columns[column.data] = {\n          sum: sum(values),\n          average: average(values),\n          min: min(values),\n          max: max(values),\n          count: values.length,\n        }\n      }\n    })\n\n    return stats\n  }\n\n  /**\n   * Calculate aggregate value\n   * @private\n   */\n  _calculateAggregate(aggregateType, values, rows) {\n    if (typeof aggregateType === \"function\") {\n      return aggregateType(values, rows)\n    }\n\n    switch (aggregateType) {\n      case \"sum\":\n        return sum(values)\n      case \"average\":\n      case \"avg\":\n        return average(values)\n      case \"min\":\n        return min(values)\n      case \"max\":\n        return max(values)\n      case \"count\":\n        return values.length\n      case \"first\":\n        return values[0]\n      case \"last\":\n        return values[values.length - 1]\n      default:\n        return sum(values)\n    }\n  }\n\n  /**\n   * Setup internal event listeners\n   * @private\n   */\n  _setupListeners() {\n    // Recalculate totals when cells change\n    this._unsubscribers.push(\n      this._eventBus.on(TableEvents.CELL_CHANGE, ({ rowId, columnName }) => {\n        const column = this._state.getColumn(columnName)\n        const config = this._state.getConfig()\n\n        // Update row total for this row if enabled\n        if (config.enableRowTotals && column && column.aggregate) {\n          this.updateRowTotal(rowId)\n        }\n\n        // Update group totals if grouping is enabled\n        if (column && column.aggregate && config.enableGrouping) {\n          // Find which group this row belongs to\n          const row = this._state.getRow(rowId)\n          if (row) {\n            const groupBy = config.groupBy\n            const groupId =\n              typeof groupBy === \"function\" ? groupBy(row) : row[groupBy]\n            this.recalculateTotals(groupId)\n          }\n        }\n      })\n    )\n\n    // Recalculate all totals when data changes\n    this._unsubscribers.push(\n      this._eventBus.on(TableEvents.DATA_CHANGE, () => {\n        const config = this._state.getConfig()\n\n        if (config.enableRowTotals) {\n          this.recalculateRowTotals()\n        }\n\n        if (config.enableGrouping) {\n          this.recalculateTotals()\n        }\n      })\n    )\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy() {\n    // Unsubscribe from all event listeners\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\n    this._unsubscribers = []\n  }\n}\n","/**\r\n * EditManager - Handles edit mode operations\r\n *\r\n * Manages view/edit mode switching, keyboard navigation,\r\n * and cell editing behavior.\r\n */\r\n\r\nimport { TableEvents } from \"../core/EventBus.js\"\r\nimport { addClass, removeClass, $ } from \"../utils/dom.js\"\r\n\r\nexport class EditManager {\r\n  /**\r\n   * @param {TableState} state - Table state instance\r\n   * @param {EventBus} eventBus - Event bus instance\r\n   * @param {TableRenderer} renderer - Table renderer instance\r\n   */\r\n  constructor(state, eventBus, renderer) {\r\n    this._state = state\r\n    this._eventBus = eventBus\r\n    this._renderer = renderer\r\n\r\n    /** @type {{rowId: string, columnName: string}|null} */\r\n    this._focusedCell = null\r\n\r\n    /** @type {boolean} */\r\n    this._isEditing = false\r\n\r\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\r\n    this._unsubscribers = []\r\n\r\n    // Setup event listeners\r\n    this._setupListeners()\r\n  }\r\n\r\n  /**\r\n   * Enter edit mode\r\n   */\r\n  enterEditMode() {\r\n    this._state.setMode(\"edit\")\r\n  }\r\n\r\n  /**\r\n   * Enter view mode\r\n   */\r\n  enterViewMode() {\r\n    this._state.setMode(\"view\")\r\n    this._focusedCell = null\r\n  }\r\n\r\n  /**\r\n   * Toggle between modes\r\n   * @returns {'view'|'edit'} New mode\r\n   */\r\n  toggleMode() {\r\n    const currentMode = this._state.getMode()\r\n    const newMode = currentMode === \"view\" ? \"edit\" : \"view\"\r\n    this._state.setMode(newMode)\r\n    return newMode\r\n  }\r\n\r\n  /**\r\n   * Check if currently in edit mode\r\n   * @returns {boolean}\r\n   */\r\n  isEditMode() {\r\n    return this._state.isEditMode()\r\n  }\r\n\r\n  /**\r\n   * Focus a specific cell\r\n   * @param {string} rowId - Row identifier\r\n   * @param {string} columnName - Column name\r\n   */\r\n  focusCell(rowId, columnName) {\r\n    this._focusedCell = { rowId, columnName }\r\n\r\n    // If in edit mode, focus the input\r\n    if (this._state.isEditMode()) {\r\n      const cell = this._renderer.getCellElement(rowId, columnName)\r\n      if (cell) {\r\n        const input = cell.querySelector(\".dg-cell-input\")\r\n        if (input) {\r\n          input.focus()\r\n          if (input.select) {\r\n            input.select()\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this._eventBus.emit(TableEvents.CELL_FOCUS, {\r\n      rowId,\r\n      columnName,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Get currently focused cell\r\n   * @returns {{rowId: string, columnName: string}|null}\r\n   */\r\n  getFocusedCell() {\r\n    return this._focusedCell\r\n  }\r\n\r\n  /**\r\n   * Move focus to adjacent cell\r\n   * @param {'up'|'down'|'left'|'right'} direction - Direction to move\r\n   */\r\n  moveFocus(direction) {\r\n    if (!this._focusedCell) return\r\n\r\n    const { rowId, columnName } = this._focusedCell\r\n    const data = this._state.getData()\r\n    const columns = this._state.getColumns().filter((c) => c.visible !== false)\r\n\r\n    const rowIndex = data.findIndex((r) => r._id === rowId)\r\n    const colIndex = columns.findIndex((c) => c.data === columnName)\r\n\r\n    if (rowIndex === -1 || colIndex === -1) return\r\n\r\n    let newRowIndex = rowIndex\r\n    let newColIndex = colIndex\r\n\r\n    switch (direction) {\r\n      case \"up\":\r\n        newRowIndex = Math.max(0, rowIndex - 1)\r\n        break\r\n      case \"down\":\r\n        newRowIndex = Math.min(data.length - 1, rowIndex + 1)\r\n        break\r\n      case \"left\":\r\n        newColIndex = Math.max(0, colIndex - 1)\r\n        break\r\n      case \"right\":\r\n        newColIndex = Math.min(columns.length - 1, colIndex + 1)\r\n        break\r\n    }\r\n\r\n    // Skip non-editable rows (like totals) when moving vertically\r\n    if (direction === \"up\" || direction === \"down\") {\r\n      const targetRow = data[newRowIndex]\r\n      if (targetRow && targetRow._type !== \"data\") {\r\n        // Try to skip to next valid row\r\n        const step = direction === \"up\" ? -1 : 1\r\n        while (newRowIndex >= 0 && newRowIndex < data.length) {\r\n          if (data[newRowIndex]._type === \"data\") break\r\n          newRowIndex += step\r\n        }\r\n\r\n        // Clamp to valid range\r\n        newRowIndex = Math.max(0, Math.min(data.length - 1, newRowIndex))\r\n      }\r\n    }\r\n\r\n    const newRow = data[newRowIndex]\r\n    const newColumn = columns[newColIndex]\r\n\r\n    if (newRow && newColumn) {\r\n      this.focusCell(newRow._id, newColumn.data)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start editing current cell (for inline edit on click)\r\n   */\r\n  startEditing() {\r\n    if (!this._focusedCell || !this._state.isEditMode()) return\r\n\r\n    this._isEditing = true\r\n    const { rowId, columnName } = this._focusedCell\r\n\r\n    const cell = this._renderer.getCellElement(rowId, columnName)\r\n    if (cell) {\r\n      addClass(cell, \"dg-cell-editing\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop editing current cell\r\n   */\r\n  stopEditing() {\r\n    if (!this._focusedCell) return\r\n\r\n    this._isEditing = false\r\n    const { rowId, columnName } = this._focusedCell\r\n\r\n    const cell = this._renderer.getCellElement(rowId, columnName)\r\n    if (cell) {\r\n      removeClass(cell, \"dg-cell-editing\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if currently editing a cell\r\n   * @returns {boolean}\r\n   */\r\n  isEditing() {\r\n    return this._isEditing\r\n  }\r\n\r\n  /**\r\n   * Cancel current edit and revert value\r\n   */\r\n  cancelEdit() {\r\n    if (!this._focusedCell || !this._isEditing) return\r\n\r\n    const { rowId, columnName } = this._focusedCell\r\n    const originalData = this._state._state.originalData\r\n    const originalRow = originalData.find((r) => r._id === rowId)\r\n\r\n    if (originalRow) {\r\n      this._state.updateCell(rowId, columnName, originalRow[columnName])\r\n    }\r\n\r\n    this.stopEditing()\r\n  }\r\n\r\n  /**\r\n   * Commit current edit\r\n   */\r\n  commitEdit() {\r\n    if (!this._focusedCell || !this._isEditing) return\r\n\r\n    const { rowId, columnName } = this._focusedCell\r\n    const cell = this._renderer.getCellElement(rowId, columnName)\r\n\r\n    if (cell) {\r\n      const input = cell.querySelector(\".dg-cell-input\")\r\n      if (input) {\r\n        // Trigger change event\r\n        input.dispatchEvent(new Event(\"change\", { bubbles: true }))\r\n      }\r\n    }\r\n\r\n    this.stopEditing()\r\n  }\r\n\r\n  /**\r\n   * Setup keyboard navigation\r\n   * @private\r\n   */\r\n  _setupListeners() {\r\n    // Handle keyboard navigation\r\n    document.addEventListener(\"keydown\", (e) => {\r\n      if (!this._state.isEditMode()) return\r\n\r\n      switch (e.key) {\r\n        case \"Tab\":\r\n          e.preventDefault()\r\n          this.moveFocus(e.shiftKey ? \"left\" : \"right\")\r\n          break\r\n\r\n        case \"Enter\":\r\n          if (this._isEditing) {\r\n            e.preventDefault()\r\n            this.commitEdit()\r\n            this.moveFocus(\"down\")\r\n          }\r\n          break\r\n\r\n        case \"Escape\":\r\n          if (this._isEditing) {\r\n            e.preventDefault()\r\n            this.cancelEdit()\r\n          }\r\n          break\r\n\r\n        case \"ArrowUp\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"up\")\r\n          }\r\n          break\r\n\r\n        case \"ArrowDown\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"down\")\r\n          }\r\n          break\r\n\r\n        case \"ArrowLeft\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"left\")\r\n          }\r\n          break\r\n\r\n        case \"ArrowRight\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"right\")\r\n          }\r\n          break\r\n      }\r\n    })\r\n\r\n    // Track cell focus\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.CELL_FOCUS, ({ rowId, columnName }) => {\r\n        this._focusedCell = { rowId, columnName }\r\n      })\r\n    )\r\n\r\n    // Track cell blur\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.CELL_BLUR, () => {\r\n        this._isEditing = false\r\n      })\r\n    )\r\n\r\n    // Clear focus when mode changes to view\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.MODE_CHANGE, ({ newMode }) => {\r\n        if (newMode === \"view\") {\r\n          this._focusedCell = null\r\n          this._isEditing = false\r\n        }\r\n      })\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy() {\r\n    // Unsubscribe from all event listeners\r\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\r\n    this._unsubscribers = []\r\n\r\n    this._focusedCell = null\r\n    this._isEditing = false\r\n  }\r\n}\r\n","/**\n * ExportManager - Handles data export operations\n *\n * Exports table data to CSV and Excel formats.\n */\n\nimport { TableEvents } from \"../core/EventBus.js\"\nimport { transformForExport } from \"../utils/data.js\"\n\nexport class ExportManager {\n  /**\n   * @param {TableState} state - Table state instance\n   * @param {EventBus} eventBus - Event bus instance\n   */\n  constructor(state, eventBus) {\n    this._state = state\n    this._eventBus = eventBus\n  }\n\n  /**\n   * Export to CSV string\n   * @param {Object} [options] - Export options\n   * @param {string} [options.delimiter=','] - Field delimiter\n   * @param {boolean} [options.includeHeaders=true] - Include header row\n   * @param {boolean} [options.includeHidden=false] - Include hidden columns\n   * @param {Array<string>} [options.columns] - Specific columns to export\n   * @param {Function} [options.filter] - Row filter function\n   * @returns {string} CSV string\n   */\n  toCSV(options = {}) {\n    const {\n      delimiter = \",\",\n      includeHeaders = true,\n      includeHidden = false,\n      columns: columnFilter = null,\n      filter = null,\n    } = options\n\n    this._eventBus.emit(TableEvents.EXPORT_START, { format: \"csv\" })\n\n    let data = this._state.getData()\n    let columns = this._state.getColumns()\n\n    // Filter columns\n    if (columnFilter) {\n      columns = columns.filter((col) => columnFilter.includes(col.data))\n    } else if (!includeHidden) {\n      columns = columns.filter((col) => col.visible !== false)\n    }\n\n    // Filter rows\n    if (filter) {\n      data = data.filter(filter)\n    }\n\n    // Build CSV\n    const rows = []\n\n    // Header row\n    if (includeHeaders) {\n      const headerRow = columns.map((col) =>\n        this._escapeCSV(col.title || col.data, delimiter)\n      )\n      rows.push(headerRow.join(delimiter))\n    }\n\n    // Data rows\n    data.forEach((row) => {\n      if (row._type !== \"data\" && row._type !== \"infoRow\") return\n\n      const csvRow = columns.map((col) => {\n        let value = row[col.data]\n\n        // Format value if formatter exists\n        if (col.exportFormat) {\n          value = col.exportFormat(value, row, col)\n        } else if (col.format) {\n          value = col.format(value, row, col)\n        }\n\n        return this._escapeCSV(value, delimiter)\n      })\n\n      rows.push(csvRow.join(delimiter))\n    })\n\n    const csvString = rows.join(\"\\n\")\n\n    this._eventBus.emit(TableEvents.EXPORT_COMPLETE, {\n      format: \"csv\",\n      rowCount: rows.length - (includeHeaders ? 1 : 0),\n    })\n\n    return csvString\n  }\n\n  /**\n   * Export to Excel-compatible format (simplified XLSX-like)\n   * For full XLSX support, integrate with SheetJS\n   * @param {Object} [options] - Export options\n   * @returns {Object} Excel data structure\n   */\n  toExcel(options = {}) {\n    const {\n      sheetName = \"Sheet1\",\n      includeHeaders = true,\n      includeHidden = false,\n      columns: columnFilter = null,\n      filter = null,\n    } = options\n\n    this._eventBus.emit(TableEvents.EXPORT_START, { format: \"excel\" })\n\n    let data = this._state.getData()\n    let columns = this._state.getColumns()\n\n    // Filter columns\n    if (columnFilter) {\n      columns = columns.filter((col) => columnFilter.includes(col.data))\n    } else if (!includeHidden) {\n      columns = columns.filter((col) => col.visible !== false)\n    }\n\n    // Filter rows\n    if (filter) {\n      data = data.filter(filter)\n    }\n\n    // Build Excel data structure\n    const worksheetData = []\n\n    // Header row\n    if (includeHeaders) {\n      worksheetData.push(columns.map((col) => col.title || col.data))\n    }\n\n    // Data rows\n    data.forEach((row) => {\n      if (row._type !== \"data\" && row._type !== \"infoRow\") return\n\n      const excelRow = columns.map((col) => {\n        let value = row[col.data]\n\n        // Keep numbers as numbers for Excel\n        if (col.type === \"number\" && typeof value === \"number\") {\n          return value\n        }\n\n        // Format other values\n        if (col.exportFormat) {\n          value = col.exportFormat(value, row, col)\n        }\n\n        return value\n      })\n\n      worksheetData.push(excelRow)\n    })\n\n    const result = {\n      sheets: [\n        {\n          name: sheetName,\n          data: worksheetData,\n          columns: columns.map((col) => ({\n            width: col.width || 100,\n            type: col.type || \"string\",\n          })),\n        },\n      ],\n    }\n\n    this._eventBus.emit(TableEvents.EXPORT_COMPLETE, {\n      format: \"excel\",\n      rowCount: worksheetData.length - (includeHeaders ? 1 : 0),\n    })\n\n    return result\n  }\n\n  /**\n   * Download export as file\n   * @param {'csv'|'excel'} format - Export format\n   * @param {string} [filename] - File name (without extension)\n   * @param {Object} [options] - Export options\n   */\n  download(format, filename = \"table-export\", options = {}) {\n    if (format === \"csv\") {\n      this._downloadCSV(filename, options)\n    } else if (format === \"excel\") {\n      this._downloadExcel(filename, options)\n    }\n  }\n\n  /**\n   * Download as CSV file\n   * @private\n   */\n  _downloadCSV(filename, options) {\n    const csv = this.toCSV(options)\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" })\n    this._downloadBlob(blob, `${filename}.csv`)\n  }\n\n  /**\n   * Download as Excel file (using CSV with .xls extension for basic support)\n   * For full XLSX support, integrate with SheetJS\n   * @private\n   */\n  _downloadExcel(filename, options) {\n    // Basic Excel export using tab-delimited format\n    const csv = this.toCSV({ ...options, delimiter: \"\\t\" })\n    const blob = new Blob([csv], {\n      type: \"application/vnd.ms-excel;charset=utf-8;\",\n    })\n    this._downloadBlob(blob, `${filename}.xls`)\n  }\n\n  /**\n   * Download blob as file\n   * @private\n   */\n  _downloadBlob(blob, filename) {\n    const link = document.createElement(\"a\")\n\n    if (link.download !== undefined) {\n      const url = URL.createObjectURL(blob)\n      link.setAttribute(\"href\", url)\n      link.setAttribute(\"download\", filename)\n      link.style.visibility = \"hidden\"\n      document.body.appendChild(link)\n      link.click()\n      document.body.removeChild(link)\n      URL.revokeObjectURL(url)\n    }\n  }\n\n  /**\n   * Escape value for CSV\n   * @private\n   */\n  _escapeCSV(value, delimiter = \",\") {\n    if (value === null || value === undefined) {\n      return \"\"\n    }\n\n    const stringValue = String(value)\n\n    // Check if escaping is needed\n    if (\n      stringValue.includes(delimiter) ||\n      stringValue.includes('\"') ||\n      stringValue.includes(\"\\n\") ||\n      stringValue.includes(\"\\r\")\n    ) {\n      // Escape double quotes and wrap in quotes\n      return `\"${stringValue.replace(/\"/g, '\"\"')}\"`\n    }\n\n    return stringValue\n  }\n\n  /**\n   * Get export preview (first N rows)\n   * @param {number} [rowCount=5] - Number of rows to preview\n   * @param {'csv'|'excel'} [format='csv'] - Format to preview\n   * @returns {string|Object}\n   */\n  preview(rowCount = 5, format = \"csv\") {\n    const data = this._state.getData().slice(0, rowCount)\n    const columns = this._state.getColumns().filter((c) => c.visible !== false)\n\n    if (format === \"csv\") {\n      // Build preview CSV\n      const headers = columns.map((c) => c.title || c.data).join(\",\")\n      const rows = data.map((row) =>\n        columns.map((col) => this._escapeCSV(row[col.data])).join(\",\")\n      )\n      return [headers, ...rows].join(\"\\n\")\n    }\n\n    return {\n      headers: columns.map((c) => c.title || c.data),\n      rows: data.map((row) => columns.map((col) => row[col.data])),\n    }\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy() {\n    // Nothing specific to cleanup\n  }\n}\n","/**\r\n * ThemeManager - Handles theme customization\r\n *\r\n * Allows users to customize table colors through configuration.\r\n * Falls back to default CSS variables if not specified.\r\n */\r\n\r\nexport class ThemeManager {\r\n  /**\r\n   * @param {HTMLElement} container - Table container element\r\n   * @param {Object} [theme] - Theme configuration\r\n   */\r\n  constructor(container, theme = {}) {\r\n    this._container = container\r\n\r\n    /** @type {Object} Default theme */\r\n    this._defaultTheme = {\r\n      // Row colors\r\n      rowEven: null, // Falls back to --dg-color-bg-alt\r\n      rowOdd: null, // Falls back to --dg-color-bg\r\n      rowHover: null, // Falls back to --dg-color-bg-hover\r\n      rowSelected: null, // Falls back to --dg-color-bg-selected\r\n\r\n      // Border colors\r\n      borderLight: null, // Falls back to --dg-color-border\r\n      borderStrong: null, // Falls back to --dg-color-border-strong\r\n\r\n      // Header colors\r\n      headerBackground: null, // Falls back to --dg-color-bg-alt\r\n      headerText: null, // Falls back to --dg-color-text\r\n\r\n      // Cell colors\r\n      cellBackground: null, // Falls back to --dg-color-bg\r\n      cellText: null, // Falls back to --dg-color-text\r\n\r\n      // Sticky/Fixed column colors\r\n      fixedBackground: null, // Inherits from row\r\n      fixedShadow: null, // Falls back to --dg-shadow-fixed\r\n      fixedBorderColor: null, // Falls back to --dg-fixed-border-color\r\n      fixedBorderWidth: null, // Falls back to --dg-fixed-border-width\r\n\r\n      // Interactive colors\r\n      primary: null, // Falls back to --dg-color-primary\r\n      primaryHover: null, // Falls back to --dg-color-primary-hover\r\n\r\n      // Status colors\r\n      success: null, // Falls back to --dg-color-success\r\n      warning: null, // Falls back to --dg-color-warning\r\n      error: null, // Falls back to --dg-color-error\r\n\r\n      // Row totals column colors\r\n      rowTotalBackground: null, // Falls back to --dg-row-total-bg\r\n      rowTotalBackgroundAlt: null, // Falls back to --dg-row-total-bg-alt\r\n      rowTotalText: null, // Falls back to --dg-row-total-text\r\n      rowTotalHeaderBackground: null, // Falls back to --dg-row-total-header-bg\r\n      rowTotalBorderColor: null, // Falls back to --dg-row-total-border-color\r\n\r\n      // Ungrouped rows colors\r\n      ungroupedRowBackground: null, // Falls back to --dg-ungrouped-row-bg\r\n      ungroupedRowBackgroundAlt: null, // Falls back to --dg-ungrouped-row-bg-alt\r\n      ungroupedRowBackgroundHover: null, // Falls back to --dg-ungrouped-row-bg-hover\r\n      ungroupedRowText: null, // Falls back to --dg-ungrouped-row-text\r\n    }\r\n\r\n    this._theme = { ...this._defaultTheme, ...theme }\r\n    this._applyTheme()\r\n  }\r\n\r\n  /**\r\n   * Resolve a theme value - if it starts with '--', wrap it in var()\r\n   * This allows passing CSS variable names like '--bc-c-primary-500'\r\n   * @private\r\n   * @param {string} value - The theme value\r\n   * @returns {string} - Resolved value (wrapped in var() if CSS variable)\r\n   */\r\n  _resolveValue(value) {\r\n    if (!value) return value\r\n    // If value starts with '--', it's a CSS variable reference\r\n    if (typeof value === \"string\" && value.startsWith(\"--\")) {\r\n      return `var(${value})`\r\n    }\r\n    return value\r\n  }\r\n\r\n  /**\r\n   * Apply theme to container\r\n   * @private\r\n   */\r\n  _applyTheme() {\r\n    const style = this._container.style\r\n\r\n    // Row colors\r\n    if (this._theme.rowEven) {\r\n      style.setProperty(\r\n        \"--dg-color-bg-alt\",\r\n        this._resolveValue(this._theme.rowEven)\r\n      )\r\n    }\r\n    if (this._theme.rowOdd) {\r\n      style.setProperty(\"--dg-color-bg\", this._resolveValue(this._theme.rowOdd))\r\n    }\r\n    if (this._theme.rowHover) {\r\n      style.setProperty(\r\n        \"--dg-color-bg-hover\",\r\n        this._resolveValue(this._theme.rowHover)\r\n      )\r\n    }\r\n    if (this._theme.rowSelected) {\r\n      style.setProperty(\r\n        \"--dg-color-bg-selected\",\r\n        this._resolveValue(this._theme.rowSelected)\r\n      )\r\n    }\r\n\r\n    // Border colors\r\n    if (this._theme.borderLight) {\r\n      style.setProperty(\r\n        \"--dg-color-border\",\r\n        this._resolveValue(this._theme.borderLight)\r\n      )\r\n    }\r\n    if (this._theme.borderStrong) {\r\n      style.setProperty(\r\n        \"--dg-color-border-strong\",\r\n        this._resolveValue(this._theme.borderStrong)\r\n      )\r\n    }\r\n\r\n    // Header colors\r\n    if (this._theme.headerBackground) {\r\n      style.setProperty(\r\n        \"--dg-color-header-bg\",\r\n        this._resolveValue(this._theme.headerBackground)\r\n      )\r\n    }\r\n    if (this._theme.headerText) {\r\n      style.setProperty(\r\n        \"--dg-color-header-text\",\r\n        this._resolveValue(this._theme.headerText)\r\n      )\r\n    }\r\n\r\n    // Cell colors\r\n    if (this._theme.cellBackground) {\r\n      style.setProperty(\r\n        \"--dg-color-cell-bg\",\r\n        this._resolveValue(this._theme.cellBackground)\r\n      )\r\n    }\r\n    if (this._theme.cellText) {\r\n      style.setProperty(\r\n        \"--dg-color-text\",\r\n        this._resolveValue(this._theme.cellText)\r\n      )\r\n    }\r\n\r\n    // Fixed column\r\n    if (this._theme.fixedShadow) {\r\n      style.setProperty(\r\n        \"--dg-shadow-fixed\",\r\n        this._resolveValue(this._theme.fixedShadow)\r\n      )\r\n    }\r\n    if (this._theme.fixedBorderColor) {\r\n      style.setProperty(\r\n        \"--dg-fixed-border-color\",\r\n        this._resolveValue(this._theme.fixedBorderColor)\r\n      )\r\n    }\r\n    if (this._theme.fixedBorderWidth) {\r\n      style.setProperty(\r\n        \"--dg-fixed-border-width\",\r\n        this._resolveValue(this._theme.fixedBorderWidth)\r\n      )\r\n    }\r\n\r\n    // Interactive colors\r\n    if (this._theme.primary) {\r\n      style.setProperty(\r\n        \"--dg-color-primary\",\r\n        this._resolveValue(this._theme.primary)\r\n      )\r\n    }\r\n    if (this._theme.primaryHover) {\r\n      style.setProperty(\r\n        \"--dg-color-primary-hover\",\r\n        this._resolveValue(this._theme.primaryHover)\r\n      )\r\n    }\r\n\r\n    // Status colors\r\n    if (this._theme.success) {\r\n      style.setProperty(\r\n        \"--dg-color-success\",\r\n        this._resolveValue(this._theme.success)\r\n      )\r\n    }\r\n    if (this._theme.warning) {\r\n      style.setProperty(\r\n        \"--dg-color-warning\",\r\n        this._resolveValue(this._theme.warning)\r\n      )\r\n    }\r\n    if (this._theme.error) {\r\n      style.setProperty(\r\n        \"--dg-color-error\",\r\n        this._resolveValue(this._theme.error)\r\n      )\r\n    }\r\n\r\n    // Row totals column\r\n    if (this._theme.rowTotalBackground) {\r\n      style.setProperty(\r\n        \"--dg-row-total-bg\",\r\n        this._resolveValue(this._theme.rowTotalBackground)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalBackgroundAlt) {\r\n      style.setProperty(\r\n        \"--dg-row-total-bg-alt\",\r\n        this._resolveValue(this._theme.rowTotalBackgroundAlt)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalText) {\r\n      style.setProperty(\r\n        \"--dg-row-total-text\",\r\n        this._resolveValue(this._theme.rowTotalText)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalHeaderBackground) {\r\n      style.setProperty(\r\n        \"--dg-row-total-header-bg\",\r\n        this._resolveValue(this._theme.rowTotalHeaderBackground)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalBorderColor) {\r\n      style.setProperty(\r\n        \"--dg-row-total-border-color\",\r\n        this._resolveValue(this._theme.rowTotalBorderColor)\r\n      )\r\n    }\r\n\r\n    // Ungrouped rows\r\n    if (this._theme.ungroupedRowBackground) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-bg\",\r\n        this._resolveValue(this._theme.ungroupedRowBackground)\r\n      )\r\n    }\r\n    if (this._theme.ungroupedRowBackgroundAlt) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-bg-alt\",\r\n        this._resolveValue(this._theme.ungroupedRowBackgroundAlt)\r\n      )\r\n    }\r\n    if (this._theme.ungroupedRowBackgroundHover) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-bg-hover\",\r\n        this._resolveValue(this._theme.ungroupedRowBackgroundHover)\r\n      )\r\n    }\r\n    if (this._theme.ungroupedRowText) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-text\",\r\n        this._resolveValue(this._theme.ungroupedRowText)\r\n      )\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update theme at runtime\r\n   * @param {Object} theme - Partial theme configuration to merge\r\n   */\r\n  updateTheme(theme) {\r\n    this._theme = { ...this._theme, ...theme }\r\n    this._applyTheme()\r\n  }\r\n\r\n  /**\r\n   * Reset to default theme\r\n   */\r\n  resetTheme() {\r\n    const style = this._container.style\r\n\r\n    // Remove all custom properties\r\n    Object.keys(this._theme).forEach(() => {\r\n      style.removeProperty(\"--dg-color-bg-alt\")\r\n      style.removeProperty(\"--dg-color-bg\")\r\n      style.removeProperty(\"--dg-color-bg-hover\")\r\n      style.removeProperty(\"--dg-color-bg-selected\")\r\n      style.removeProperty(\"--dg-color-border\")\r\n      style.removeProperty(\"--dg-color-border-strong\")\r\n      style.removeProperty(\"--dg-color-header-bg\")\r\n      style.removeProperty(\"--dg-color-header-text\")\r\n      style.removeProperty(\"--dg-color-cell-bg\")\r\n      style.removeProperty(\"--dg-color-text\")\r\n      style.removeProperty(\"--dg-shadow-fixed\")\r\n      style.removeProperty(\"--dg-fixed-border-color\")\r\n      style.removeProperty(\"--dg-fixed-border-width\")\r\n      style.removeProperty(\"--dg-color-primary\")\r\n      style.removeProperty(\"--dg-color-primary-hover\")\r\n      style.removeProperty(\"--dg-color-success\")\r\n      style.removeProperty(\"--dg-color-warning\")\r\n      style.removeProperty(\"--dg-color-error\")\r\n      style.removeProperty(\"--dg-row-total-bg\")\r\n      style.removeProperty(\"--dg-row-total-bg-alt\")\r\n      style.removeProperty(\"--dg-row-total-text\")\r\n      style.removeProperty(\"--dg-row-total-header-bg\")\r\n      style.removeProperty(\"--dg-row-total-border-color\")\r\n      style.removeProperty(\"--dg-ungrouped-row-bg\")\r\n      style.removeProperty(\"--dg-ungrouped-row-bg-alt\")\r\n      style.removeProperty(\"--dg-ungrouped-row-bg-hover\")\r\n      style.removeProperty(\"--dg-ungrouped-row-text\")\r\n    })\r\n\r\n    this._theme = { ...this._defaultTheme }\r\n  }\r\n\r\n  /**\r\n   * Get current theme\r\n   * @returns {Object} Current theme configuration\r\n   */\r\n  getTheme() {\r\n    return { ...this._theme }\r\n  }\r\n}\r\n","/**\n * Table - Main orchestrator class for the editable table\n *\n * This is the primary entry point that coordinates all modules,\n * manages the lifecycle, and exposes the public API.\n */\n\nimport { EventBus, TableEvents } from \"./EventBus.js\"\nimport { TableState } from \"./TableState.js\"\nimport { TableRenderer } from \"./TableRenderer.js\"\nimport { RowManager } from \"../modules/RowManager.js\"\nimport { GroupManager } from \"../modules/GroupManager.js\"\nimport { EditManager } from \"../modules/EditManager.js\"\nimport { ExportManager } from \"../modules/ExportManager.js\"\nimport { ThemeManager } from \"../modules/ThemeManager.js\"\nimport { addClass, removeClass } from \"../utils/dom.js\"\n\n/**\n * @typedef {Object} TableConfig\n * @property {HTMLElement|string} container - Container element or selector\n * @property {Array<Object>} columns - Column definitions\n * @property {Array<Object>} data - Table data\n * @property {boolean} [fixedFirstColumn=false] - Enable fixed first column\n * @property {boolean} [enableGrouping=false] - Enable row grouping\n * @property {string|Function} [groupBy] - Group by column name or function\n * @property {boolean} [enableInfoRows=false] - Enable info rows\n * @property {boolean} [enableRowTotals=false] - Enable row totals column\n * @property {Function} [rowTotalsFormat] - Format function for row totals column\n * @property {Array<Object>} [actions] - Row actions configuration\n * @property {'view'|'edit'} [mode='view'] - Initial mode\n * @property {Function} [onRowClick] - Row click callback\n * @property {Function} [onRender] - Render complete callback\n * @property {Function} [onChange] - Table data change callback\n * @property {Function} [onRowChange] - Individual row change callback\n * @property {Object} [theme] - Theme customization\n */\n\nexport class Table {\n  /**\n   * Create a new Table instance\n   * @param {TableConfig} config - Table configuration\n   */\n  constructor(config) {\n    this._validateConfig(config)\n\n    // Store configuration\n    this._config = {\n      fixedFirstColumn: false,\n      enableGrouping: false,\n      enableInfoRows: false,\n      enableRowTotals: false,\n      mode: \"view\",\n      ...config,\n    }\n\n    // Get container element\n    this._container =\n      typeof config.container === \"string\"\n        ? document.querySelector(config.container)\n        : config.container\n\n    if (!this._container) {\n      throw new Error(\"Table: Container element not found\")\n    }\n\n    // Initialize core systems\n    this._eventBus = new EventBus()\n    this._state = new TableState(this._eventBus, {\n      data: config.data || [],\n      columns: config.columns || [],\n      config: {\n        fixedFirstColumn: config.fixedFirstColumn,\n        enableGrouping: config.enableGrouping,\n        groupBy: config.groupBy,\n        enableInfoRows: config.enableInfoRows,\n        enableRowTotals: config.enableRowTotals,\n        rowTotalsFormat: config.rowTotalsFormat,\n        actions: config.actions || [],\n      },\n    })\n\n    // Initialize modules\n    this._initModules()\n\n    // Set initial mode\n    this._state.setMode(config.mode || \"view\")\n\n    // Register callbacks\n    this._registerCallbacks()\n\n    // Initial render\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Data\n  // ============================================\n\n  /**\n   * Get current table data\n   * @returns {Array<Object>}\n   */\n  getData() {\n    return this._state.getData()\n  }\n\n  /**\n   * Set table data\n   * @param {Array<Object>} data - New data array\n   */\n  setData(data) {\n    this._state.setData(data)\n    this._render()\n  }\n\n  /**\n   * Get a single row by ID\n   * @param {string|number} rowId - Row identifier\n   * @returns {Object|null}\n   */\n  getRow(rowId) {\n    return this._state.getRow(rowId)\n  }\n\n  /**\n   * Update a specific cell\n   * @param {string|number} rowId - Row identifier\n   * @param {string} columnName - Column name\n   * @param {any} value - New value\n   */\n  updateCell(rowId, columnName, value) {\n    this._state.updateCell(rowId, columnName, value)\n  }\n\n  /**\n   * Batch update multiple cells\n   * @param {Array<{rowId, columnName, value}>} updates - Updates array\n   */\n  batchUpdate(updates) {\n    this._state.batchUpdate(updates)\n  }\n\n  /**\n   * Add a new row\n   * @param {Object} rowData - Row data\n   * @param {Object} [options] - Options (position, groupId, etc.)\n   */\n  addRow(rowData, options = {}) {\n    this._rowManager.addRow(rowData, options)\n  }\n\n  /**\n   * Delete a row\n   * @param {string|number} rowId - Row identifier\n   */\n  deleteRow(rowId) {\n    this._rowManager.deleteRow(rowId)\n  }\n\n  /**\n   * Get all modified rows\n   * @returns {Array<Object>}\n   */\n  getDirtyRows() {\n    return this._state.getDirtyRows()\n  }\n\n  /**\n   * Clear dirty state\n   */\n  clearDirty() {\n    this._state.clearDirty()\n  }\n\n  /**\n   * Revert all changes\n   */\n  revertChanges() {\n    this._state.revertChanges()\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Columns\n  // ============================================\n\n  /**\n   * Get column definitions\n   * @returns {Array<Object>}\n   */\n  getColumns() {\n    return this._state.getColumns()\n  }\n\n  /**\n   * Update column definitions\n   * @param {Array<Object>} columns - New column definitions\n   */\n  setColumns(columns) {\n    this._state.setColumns(columns)\n    this._render()\n  }\n\n  /**\n   * Show/hide a column\n   * @param {string} columnId - Column identifier\n   * @param {boolean} visible - Visibility state\n   */\n  setColumnVisibility(columnId, visible) {\n    const columns = this._state.getColumns()\n    const updatedColumns = columns.map((col) => {\n      if (col._id === columnId || col.data === columnId) {\n        return { ...col, visible }\n      }\n      return col\n    })\n    this._state.setColumns(updatedColumns)\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Mode\n  // ============================================\n\n  /**\n   * Get current mode\n   * @returns {'view'|'edit'}\n   */\n  getMode() {\n    return this._state.getMode()\n  }\n\n  /**\n   * Set table mode\n   * @param {'view'|'edit'} mode - Mode to set\n   */\n  setMode(mode) {\n    this._state.setMode(mode)\n  }\n\n  /**\n   * Toggle between view and edit mode\n   */\n  toggleMode() {\n    const currentMode = this._state.getMode()\n    this._state.setMode(currentMode === \"view\" ? \"edit\" : \"view\")\n  }\n\n  // ============================================\n  // Public API - Groups\n  // ============================================\n\n  /**\n   * Toggle a group's visibility\n   * @param {string} groupId - Group identifier\n   */\n  toggleGroup(groupId) {\n    this._state.toggleGroup(groupId)\n  }\n\n  /**\n   * Expand all groups\n   */\n  expandAllGroups() {\n    this._state.expandAllGroups()\n  }\n\n  /**\n   * Collapse all groups\n   */\n  collapseAllGroups() {\n    this._state.collapseAllGroups()\n  }\n\n  // ============================================\n  // Public API - Export\n  // ============================================\n\n  /**\n   * Export table to CSV\n   * @param {Object} [options] - Export options\n   * @returns {string} CSV string\n   */\n  exportCSV(options = {}) {\n    return this._exportManager.toCSV(options)\n  }\n\n  /**\n   * Export table to Excel\n   * @param {Object} [options] - Export options\n   */\n  exportExcel(options = {}) {\n    return this._exportManager.toExcel(options)\n  }\n\n  /**\n   * Download export as file\n   * @param {'csv'|'excel'} format - Export format\n   * @param {string} [filename] - File name\n   */\n  download(format, filename) {\n    this._exportManager.download(format, filename)\n  }\n\n  // ============================================\n  // Public API - Utilities\n  // ============================================\n\n  /**\n   * Force re-render of the table\n   */\n  render() {\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Theme\n  // ============================================\n\n  /**\n   * Update theme at runtime\n   * @param {Object} theme - Partial theme configuration\n   */\n  updateTheme(theme) {\n    this._themeManager.updateTheme(theme)\n  }\n\n  /**\n   * Reset to default theme\n   */\n  resetTheme() {\n    this._themeManager.resetTheme()\n  }\n\n  /**\n   * Get current theme\n   * @returns {Object} Current theme configuration\n   */\n  getTheme() {\n    return this._themeManager.getTheme()\n  }\n\n  /**\n   * Subscribe to table events\n   * @param {string} event - Event name\n   * @param {Function} callback - Event handler\n   * @returns {Function} Unsubscribe function\n   */\n  on(event, callback) {\n    return this._eventBus.on(event, callback)\n  }\n\n  /**\n   * Unsubscribe from table events\n   * @param {string} event - Event name\n   * @param {Function} callback - Event handler\n   */\n  off(event, callback) {\n    this._eventBus.off(event, callback)\n  }\n\n  /**\n   * Destroy the table instance\n   */\n  destroy() {\n    this._eventBus.emit(TableEvents.DESTROY, {})\n\n    // Destroy modules\n    this._renderer.destroy()\n    this._themeManager.resetTheme()\n    this._rowManager.destroy()\n    this._groupManager.destroy()\n    this._editManager.destroy()\n    this._exportManager.destroy()\n\n    // Destroy core\n    this._state.destroy()\n    this._eventBus.destroy()\n\n    // Clear container\n    this._container.innerHTML = \"\"\n    removeClass(this._container, \"dg-container\")\n  }\n\n  // ============================================\n  // Private Methods\n  // ============================================\n\n  /**\n   * Validate configuration\n   * @private\n   */\n  _validateConfig(config) {\n    if (!config) {\n      throw new Error(\"Table: Configuration object is required\")\n    }\n    if (!config.container) {\n      throw new Error(\"Table: Container element or selector is required\")\n    }\n    if (!config.columns || !Array.isArray(config.columns)) {\n      throw new Error(\"Table: Columns array is required\")\n    }\n  }\n\n  /**\n   * Initialize all modules\n   * @private\n   */\n  _initModules() {\n    // Initialize renderer first\n    this._renderer = new TableRenderer(this._container, this._state)\n\n    // Initialize theme manager\n    this._themeManager = new ThemeManager(this._container, this._config.theme)\n\n    // Initialize feature modules\n    this._rowManager = new RowManager(this._state, this._eventBus)\n    this._groupManager = new GroupManager(this._state, this._eventBus)\n    this._editManager = new EditManager(\n      this._state,\n      this._eventBus,\n      this._renderer\n    )\n    this._exportManager = new ExportManager(this._state, this._eventBus)\n  }\n\n  /**\n   * Register user callbacks\n   * @private\n   */\n  _registerCallbacks() {\n    const { onRowClick, onRender, onChange, onRowChange } = this._config\n\n    if (onRowClick) {\n      this._eventBus.on(TableEvents.ROW_CLICK, onRowClick)\n    }\n\n    if (onRender) {\n      this._eventBus.on(TableEvents.AFTER_RENDER, onRender)\n    }\n\n    if (onChange) {\n      this._eventBus.on(TableEvents.DATA_CHANGE, onChange)\n    }\n\n    if (onRowChange) {\n      this._eventBus.on(TableEvents.ROW_CHANGE, onRowChange)\n    }\n  }\n\n  /**\n   * Render the table\n   * @private\n   */\n  _render() {\n    this._eventBus.emit(TableEvents.BEFORE_RENDER, {})\n    this._renderer.render()\n    this._eventBus.emit(TableEvents.RENDER, {})\n\n    // Use requestAnimationFrame to ensure DOM is ready\n    requestAnimationFrame(() => {\n      this._eventBus.emit(TableEvents.AFTER_RENDER, {\n        rowCount: this._state.getData().length,\n        columnCount: this._state.getColumns().length,\n      })\n    })\n  }\n}\n\n// Expose event types for external use\nTable.Events = TableEvents\n"],"names":["EventBus","constructor","this","_listeners","Map","_onceListeners","_isBatching","_batchQueue","on","event","callback","has","set","Set","get","add","off","once","wrapper","data","delete","emit","push","forEach","error","console","startBatch","endBatch","eventMap","key","TableEvents","CELL_CHANGE","rowId","columnName","ROW_CHANGE","destroy","clear","STATE_CHANGE","DATA_CHANGE","ROW_CLICK","ROW_ADD","ROW_DELETE","CELL_FOCUS","CELL_BLUR","ACTION_CLICK","ROW_TOTAL_CHANGE","GROUP_TOGGLE","GROUP_EXPAND_ALL","GROUP_COLLAPSE_ALL","MODE_CHANGE","BEFORE_RENDER","RENDER","AFTER_RENDER","DESTROY","SCROLL","EXPORT_START","EXPORT_COMPLETE","generateId","Date","now","toString","Math","random","substr","deepClone","obj","getTime","map","item","value","Array","isArray","cloned","Object","prototype","hasOwnProperty","call","deepEqual","a","b","length","every","index","keysA","keys","keysB","toNumber","defaultValue","parsed","parseFloat","isNaN","sum","values","reduce","acc","val","average","min","nums","filter","v","max","TableState","eventBus","initialState","_eventBus","_state","originalData","columns","mode","groups","groupedData","collapsedGroups","focusedCell","computedCache","dirtyRows","dirtyColumns","config","fixedFirstColumn","enableGrouping","groupBy","enableInfoRows","enableRowTotals","actions","setData","setColumns","_normalizeData","_invalidateCache","_computeGroups","source","getData","getRow","row","find","r","_id","updateCell","options","rowIndex","findIndex","oldValue","_invalidateCacheForRow","newValue","from","skipCascade","_triggerCascadeUpdate","batchUpdate","updates","_computeAllCascades","updatedRows","u","col","_index","id","property","getColumns","defaultFormat","Number","toLocaleString","title","type","editable","aggregate","_isRowTotal","format","rowTotalsFormat","getColumn","columnId","c","setMode","warn","oldMode","newMode","getMode","isEditMode","toggleGroup","groupId","collapsed","isGroupCollapsed","getGroupedData","getUngroupedRows","ungroupedRows","getInfoRows","infoRows","expandAllGroups","collapseAllGroups","getDirtyRows","isRowDirty","clearDirty","revertChanges","setConfig","undefined","getConfig","_type","groupKey","label","rows","totals","column","affectsColumns","affectedCol","_","includes","cascade","state","rId","cName","createElement","tag","attributes","element","document","entries","className","assign","style","startsWith","setAttribute","setAttributes","addClass","classNames","classList","removeClass","remove","TableRenderer","container","_container","_tableWrapper","_table","_thead","_tbody","_rowElements","_cellElements","_unsubscribers","_setupEventListeners","render","_createStructure","_updateContainerClasses","_renderHeader","_renderGroupedBody","_renderBody","cellKey","cell","_renderCellContent","updateRow","rowElement","rowData","getCellElement","getRowElement","unsubscribe","_updateGroupHeaders","_toggleGroupVisibility","_setAllGroupsVisibility","class","appendChild","innerHTML","headerRow","visibleIndex","visible","th","headerContent","textContent","width","_createRowElement","group","groupHeader","_createGroupHeaderRow","isCollapsed","tr","addEventListener","e","target","closest","td","_createCellElement","align","textAlign","columnHasActions","actionsWrapper","_createRowActions","insertBefore","firstChild","action","actionBtn","tooltip","icon","HTMLElement","cloneNode","stopPropagation","onClick","actionIndex","isEditable","_editable","input","_createInputElement","displayValue","_formatDisplayValue","rendered","inputType","opt","option","selected","step","onChange","String","decimals","toFixed","Intl","NumberFormat","currency","toLocaleDateString","visibleColumns","aggregates","toggleContent","toggleIcon","groupLabel","groupCount","_createTotalsRow","querySelectorAll","header","querySelector","gId","RowManager","_setupListeners","addRow","afterRowId","newRow","insertIndex","afterIndex","i","splice","idx","addInfoRow","parentRowId","infoRowData","deleteRow","deletedRow","deleteRows","rowIds","deletedCount","rowIdSet","filteredData","duplicateRow","moveRow","newIndex","currentIndex","movedRow","getRowsByType","getDataRows","parentIndex","AggregateTypes","AggregateTypes_SUM","AggregateTypes_AVG","AggregateTypes_MIN","AggregateTypes_MAX","AggregateTypes_COUNT","AggregateTypes_FIRST","AggregateTypes_LAST","calculateGrandTotals","aggregateFn","GroupManager","recalculateTotals","recalculateRowTotals","calculateRowTotal","total","_rowTotal","updateRowTotal","oldTotal","getGroup","getGroupIds","getGroupRows","getGroupTotals","dataRows","_calculateAggregate","groupRowTotal","getGrandTotals","toggle","expand","collapse","expandAll","collapseAll","getExpansionState","groupIds","setExpansionState","expanded","moveRowToGroup","targetGroupId","getGroupStats","stats","rowCount","count","aggregateType","EditManager","renderer","_renderer","_focusedCell","_isEditing","enterEditMode","enterViewMode","toggleMode","focusCell","focus","select","getFocusedCell","moveFocus","direction","colIndex","newRowIndex","newColIndex","targetRow","newColumn","startEditing","stopEditing","isEditing","cancelEdit","originalRow","commitEdit","dispatchEvent","Event","bubbles","preventDefault","shiftKey","ctrlKey","ExportManager","toCSV","delimiter","includeHeaders","includeHidden","columnFilter","_escapeCSV","join","csvRow","exportFormat","csvString","toExcel","sheetName","worksheetData","excelRow","result","sheets","name","download","filename","_downloadCSV","_downloadExcel","csv","blob","Blob","_downloadBlob","link","url","URL","createObjectURL","visibility","body","click","removeChild","revokeObjectURL","stringValue","replace","preview","slice","headers","ThemeManager","theme","_defaultTheme","rowEven","rowOdd","rowHover","rowSelected","borderLight","borderStrong","headerBackground","headerText","cellBackground","cellText","fixedBackground","fixedShadow","fixedBorderColor","fixedBorderWidth","primary","primaryHover","success","warning","rowTotalBackground","rowTotalBackgroundAlt","rowTotalText","rowTotalHeaderBackground","rowTotalBorderColor","ungroupedRowBackground","ungroupedRowBackgroundAlt","ungroupedRowBackgroundHover","ungroupedRowText","_theme","_applyTheme","_resolveValue","setProperty","updateTheme","resetTheme","removeProperty","getTheme","Table","_validateConfig","_config","Error","_initModules","_registerCallbacks","_render","_rowManager","setColumnVisibility","updatedColumns","currentMode","exportCSV","_exportManager","exportExcel","_themeManager","_groupManager","_editManager","onRowClick","onRender","onRowChange","requestAnimationFrame","columnCount","Events"],"mappings":"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"}