{"version":3,"file":"datagrid.umd.min.js","sources":["../src/core/EventBus.js","../src/utils/helpers.js","../src/core/TableState.js","../src/utils/dom.js","../src/core/TableRenderer.js","../src/modules/RowManager.js","../src/utils/data.js","../src/modules/GroupManager.js","../src/modules/EditManager.js","../src/modules/ExportManager.js","../src/modules/ThemeManager.js","../src/core/Table.js"],"sourcesContent":["/**\n * EventBus - Lightweight pub/sub event system for decoupled communication\n *\n * This enables modules to communicate without direct dependencies,\n * improving maintainability and allowing for efficient cascade updates.\n */\n\nexport class EventBus {\n  constructor() {\n    /** @type {Map<string, Set<Function>>} */\n    this._listeners = new Map()\n\n    /** @type {Map<string, Function>} */\n    this._onceListeners = new Map() // TODO: Implement once listeners if needed\n\n    /** @type {boolean} */\n    this._isBatching = false\n\n    /** @type {Array<{event: string, data: any}>} */\n    this._batchQueue = []\n  }\n\n  /**\n   * Subscribe to an event\n   * @param {string} event - Event name\n   * @param {Function} callback - Handler function\n   * @returns {Function} Unsubscribe function\n   */\n  on(event, callback) {\n    if (!this._listeners.has(event)) {\n      this._listeners.set(event, new Set())\n    }\n    this._listeners.get(event).add(callback)\n\n    // Return unsubscribe function\n    return () => this.off(event, callback)\n  }\n\n  /**\n   * Subscribe to an event once\n   * @param {string} event - Event name\n   * @param {Function} callback - Handler function\n   */\n  once(event, callback) {\n    const wrapper = (data) => {\n      this.off(event, wrapper)\n      callback(data)\n    }\n    this.on(event, wrapper)\n  }\n\n  /**\n   * Unsubscribe from an event\n   * @param {string} event - Event name\n   * @param {Function} callback - Handler function\n   */\n  off(event, callback) {\n    if (this._listeners.has(event)) {\n      this._listeners.get(event).delete(callback)\n    }\n  }\n\n  /**\n   * Emit an event\n   * @param {string} event - Event name\n   * @param {any} data - Event data\n   */\n  emit(event, data) {\n    if (this._isBatching) {\n      this._batchQueue.push({ event, data })\n      return\n    }\n\n    if (this._listeners.has(event)) {\n      this._listeners.get(event).forEach((callback) => {\n        try {\n          callback(data)\n        } catch (error) {\n          console.error(`Error in event handler for \"${event}\":`, error)\n        }\n      })\n    }\n  }\n\n  /**\n   * Start batching events (for performance during bulk updates)\n   */\n  startBatch() {\n    this._isBatching = true\n    this._batchQueue = []\n  }\n\n  /**\n   * End batching and emit all queued events\n   * Deduplicates events of the same type, keeping latest data\n   */\n  endBatch() {\n    this._isBatching = false\n\n    // Deduplicate: for CELL_CHANGE events, use rowId:columnName as key\n    // For other events, use just the event name\n    const eventMap = new Map()\n    this._batchQueue.forEach(({ event, data }) => {\n      let key = event\n\n      // For cell-specific events, create unique key per cell\n      if (event === TableEvents.CELL_CHANGE && data.rowId && data.columnName) {\n        key = `${event}:${data.rowId}:${data.columnName}`\n      } else if (event === TableEvents.ROW_CHANGE && data.rowId) {\n        key = `${event}:${data.rowId}`\n      }\n\n      eventMap.set(key, { event, data })\n    })\n\n    // Emit deduplicated events\n    eventMap.forEach(({ event, data }) => {\n      this.emit(event, data)\n    })\n\n    this._batchQueue = []\n  }\n\n  /**\n   * Remove all listeners\n   */\n  destroy() {\n    this._listeners.clear()\n    this._batchQueue = []\n  }\n}\n\n// Predefined event types for consistency\nexport const TableEvents = {\n  // State events\n  STATE_CHANGE: \"state:change\",\n  DATA_CHANGE: \"data:change\",\n\n  // Row events\n  ROW_CLICK: \"row:click\",\n  ROW_CHANGE: \"row:change\",\n  ROW_ADD: \"row:add\",\n  ROW_DELETE: \"row:delete\",\n\n  // Cell events\n  CELL_CHANGE: \"cell:change\",\n  CELL_FOCUS: \"cell:focus\",\n  CELL_BLUR: \"cell:blur\",\n\n  // Action events\n  ACTION_CLICK: \"action:click\",\n\n  // Row total events\n  ROW_TOTAL_CHANGE: \"rowTotal:change\",\n\n  // Group events\n  GROUP_TOGGLE: \"group:toggle\",\n  GROUP_EXPAND_ALL: \"group:expandAll\",\n  GROUP_COLLAPSE_ALL: \"group:collapseAll\",\n\n  // Mode events\n  MODE_CHANGE: \"mode:change\",\n\n  // Lifecycle events\n  BEFORE_RENDER: \"lifecycle:beforeRender\",\n  RENDER: \"lifecycle:render\",\n  AFTER_RENDER: \"lifecycle:afterRender\",\n  DESTROY: \"lifecycle:destroy\",\n\n  // Scroll events\n  SCROLL: \"scroll:update\",\n\n  // Export events\n  EXPORT_START: \"export:start\",\n  EXPORT_COMPLETE: \"export:complete\",\n}\n","/**\n * General Helpers - Utility functions for data manipulation\n */\n\n/**\n * Generate a unique ID\n * @returns {string}\n */\nexport function generateId() {\n  return `et_${Date.now().toString(36)}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n/**\n * Deep clone an object/array\n * @param {any} obj - Object to clone\n * @returns {any}\n */\nexport function deepClone(obj) {\n  if (obj === null || typeof obj !== 'object') {\n    return obj;\n  }\n  \n  if (obj instanceof Date) {\n    return new Date(obj.getTime());\n  }\n  \n  if (obj instanceof Set) {\n    return new Set([...obj].map(item => deepClone(item)));\n  }\n  \n  if (obj instanceof Map) {\n    return new Map([...obj].map(([key, value]) => [deepClone(key), deepClone(value)]));\n  }\n  \n  if (Array.isArray(obj)) {\n    return obj.map(item => deepClone(item));\n  }\n  \n  const cloned = {};\n  for (const key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      cloned[key] = deepClone(obj[key]);\n    }\n  }\n  return cloned;\n}\n\n/**\n * Deep equality check\n * @param {any} a - First value\n * @param {any} b - Second value\n * @returns {boolean}\n */\nexport function deepEqual(a, b) {\n  if (a === b) return true;\n  \n  if (a === null || b === null) return false;\n  if (typeof a !== typeof b) return false;\n  \n  if (typeof a !== 'object') return a === b;\n  \n  if (Array.isArray(a) !== Array.isArray(b)) return false;\n  \n  if (Array.isArray(a)) {\n    if (a.length !== b.length) return false;\n    return a.every((item, index) => deepEqual(item, b[index]));\n  }\n  \n  const keysA = Object.keys(a);\n  const keysB = Object.keys(b);\n  \n  if (keysA.length !== keysB.length) return false;\n  \n  return keysA.every(key => deepEqual(a[key], b[key]));\n}\n\n/**\n * Get nested property value using dot notation\n * @param {Object} obj - Source object\n * @param {string} path - Property path (e.g., 'a.b.c')\n * @param {any} [defaultValue] - Default value if not found\n * @returns {any}\n */\nexport function getNestedValue(obj, path, defaultValue = undefined) {\n  const keys = path.split('.');\n  let result = obj;\n  \n  for (const key of keys) {\n    if (result === null || result === undefined) {\n      return defaultValue;\n    }\n    result = result[key];\n  }\n  \n  return result === undefined ? defaultValue : result;\n}\n\n/**\n * Set nested property value using dot notation\n * @param {Object} obj - Target object\n * @param {string} path - Property path\n * @param {any} value - Value to set\n */\nexport function setNestedValue(obj, path, value) {\n  const keys = path.split('.');\n  let current = obj;\n  \n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i];\n    if (!(key in current)) {\n      current[key] = {};\n    }\n    current = current[key];\n  }\n  \n  current[keys[keys.length - 1]] = value;\n}\n\n/**\n * Debounce a function\n * @param {Function} func - Function to debounce\n * @param {number} wait - Wait time in ms\n * @returns {Function}\n */\nexport function debounce(func, wait) {\n  let timeout;\n  \n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func.apply(this, args);\n    };\n    \n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n\n/**\n * Throttle a function\n * @param {Function} func - Function to throttle\n * @param {number} limit - Time limit in ms\n * @returns {Function}\n */\nexport function throttle(func, limit) {\n  let inThrottle;\n  \n  return function executedFunction(...args) {\n    if (!inThrottle) {\n      func.apply(this, args);\n      inThrottle = true;\n      setTimeout(() => (inThrottle = false), limit);\n    }\n  };\n}\n\n/**\n * Escape HTML special characters\n * @param {string} str - String to escape\n * @returns {string}\n */\nexport function escapeHtml(str) {\n  if (str === null || str === undefined) return '';\n  \n  const htmlEscapes = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;'\n  };\n  \n  return String(str).replace(/[&<>\"']/g, char => htmlEscapes[char]);\n}\n\n/**\n * Format number with thousands separator\n * @param {number} num - Number to format\n * @param {string} [separator=','] - Thousands separator\n * @returns {string}\n */\nexport function formatNumber(num, separator = ',') {\n  if (num === null || num === undefined || isNaN(num)) return '';\n  return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, separator);\n}\n\n/**\n * Parse a value to number safely\n * @param {any} value - Value to parse\n * @param {number} [defaultValue=0] - Default if parsing fails\n * @returns {number}\n */\nexport function toNumber(value, defaultValue = 0) {\n  if (value === null || value === undefined || value === '') {\n    return defaultValue;\n  }\n  const parsed = parseFloat(value);\n  return isNaN(parsed) ? defaultValue : parsed;\n}\n\n/**\n * Group array of objects by a key\n * @param {Array<Object>} array - Array to group\n * @param {string|Function} key - Key to group by\n * @returns {Object}\n */\nexport function groupBy(array, key) {\n  return array.reduce((result, item) => {\n    const groupKey = typeof key === 'function' ? key(item) : item[key];\n    (result[groupKey] = result[groupKey] || []).push(item);\n    return result;\n  }, {});\n}\n\n/**\n * Sort array of objects by multiple keys\n * @param {Array<Object>} array - Array to sort\n * @param {Array<{key: string, order?: 'asc'|'desc'}>} sortBy - Sort configuration\n * @returns {Array<Object>}\n */\nexport function sortByMultiple(array, sortBy) {\n  return [...array].sort((a, b) => {\n    for (const { key, order = 'asc' } of sortBy) {\n      const valueA = a[key];\n      const valueB = b[key];\n      \n      let comparison = 0;\n      \n      if (valueA < valueB) comparison = -1;\n      if (valueA > valueB) comparison = 1;\n      \n      if (comparison !== 0) {\n        return order === 'desc' ? -comparison : comparison;\n      }\n    }\n    return 0;\n  });\n}\n\n/**\n * Sum values in an array\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function sum(values) {\n  return values.reduce((acc, val) => acc + (toNumber(val)), 0);\n}\n\n/**\n * Calculate average of values\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function average(values) {\n  if (values.length === 0) return 0;\n  return sum(values) / values.length;\n}\n\n/**\n * Find minimum value\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function min(values) {\n  const nums = values.filter(v => !isNaN(toNumber(v)));\n  return nums.length ? Math.min(...nums.map(toNumber)) : 0;\n}\n\n/**\n * Find maximum value\n * @param {Array<number>} values - Array of numbers\n * @returns {number}\n */\nexport function max(values) {\n  const nums = values.filter(v => !isNaN(toNumber(v)));\n  return nums.length ? Math.max(...nums.map(toNumber)) : 0;\n}\n\n/**\n * Chunk array into smaller arrays\n * @param {Array} array - Array to chunk\n * @param {number} size - Chunk size\n * @returns {Array<Array>}\n */\nexport function chunk(array, size) {\n  const chunks = [];\n  for (let i = 0; i < array.length; i += size) {\n    chunks.push(array.slice(i, i + size));\n  }\n  return chunks;\n}\n\n/**\n * Create a range of numbers\n * @param {number} start - Start value\n * @param {number} end - End value\n * @param {number} [step=1] - Step value\n * @returns {Array<number>}\n */\nexport function range(start, end, step = 1) {\n  const result = [];\n  for (let i = start; i <= end; i += step) {\n    result.push(i);\n  }\n  return result;\n}\n","/**\n * TableState - Centralized state management with change tracking\n *\n * Manages all table data and state with efficient change detection\n * and cascade update support for totals, groups, and computed values.\n */\n\nimport { EventBus, TableEvents } from \"./EventBus.js\"\nimport { deepClone, deepEqual, generateId } from \"../utils/helpers.js\"\n\nexport class TableState {\n  /**\n   * @param {EventBus} eventBus - Event bus instance\n   * @param {Object} initialState - Initial state configuration\n   */\n  constructor(eventBus, initialState = {}) {\n    /** @type {EventBus} */\n    this._eventBus = eventBus\n\n    /** @type {Object} Internal state */\n    this._state = {\n      // Core data\n      data: [],\n      originalData: [],\n\n      // Column definitions\n      columns: [],\n\n      // UI state\n      mode: \"view\", // 'view' | 'edit'\n\n      // Group state\n      groups: {},\n      groupedData: null,\n      collapsedGroups: new Set(),\n\n      // Focus state\n      focusedCell: null,\n\n      // Computed values cache\n      computedCache: new Map(),\n\n      // Dirty tracking\n      dirtyRows: new Set(),\n      dirtyColumns: new Map(),\n\n      // Batch operation tracking\n      isBatchOperation: false,\n\n      // Configuration\n      config: {\n        fixedFirstColumn: false,\n        enableGrouping: false,\n        groupBy: null,\n        groups: {},\n        enableInfoRows: false,\n        enableRowTotals: false,\n        actions: [],\n        ...initialState.config,\n      },\n    }\n\n    // Apply initial data\n    if (initialState.data) {\n      this.setData(initialState.data)\n    }\n    if (initialState.columns) {\n      this.setColumns(initialState.columns)\n    }\n  }\n\n  // ============================================\n  // Data Management\n  // ============================================\n\n  /**\n   * Set table data\n   * @param {Array<Object>} data - Row data array\n   */\n  setData(data) {\n    this._state.originalData = deepClone(data)\n    this._state.data = this._normalizeData(data)\n    this._state.dirtyRows.clear()\n    this._invalidateCache()\n\n    if (this._state.config.enableGrouping && this._state.config.groupBy) {\n      this._computeGroups()\n    }\n\n    this._eventBus.emit(TableEvents.DATA_CHANGE, {\n      data: this._state.data,\n      source: \"setData\",\n    })\n  }\n\n  /**\n   * Get current data (returns a copy to prevent mutation)\n   * @returns {Array<Object>}\n   */\n  getData() {\n    return deepClone(this._state.data)\n  }\n\n  /**\n   * Get a single row by ID\n   * @param {string|number} rowId - Row identifier\n   * @returns {Object|null}\n   */\n  getRow(rowId) {\n    const row = this._state.data.find((r) => r._id === rowId)\n    return row ? deepClone(row) : null\n  }\n\n  /**\n   * Check if currently in a batch operation\n   * @returns {boolean}\n   */\n  isBatchOperation() {\n    return this._state.isBatchOperation\n  }\n\n  /**\n   * Update a specific cell value\n   * @param {string|number} rowId - Row identifier\n   * @param {string} columnName - Column name\n   * @param {any} value - New value\n   * @param {Object} options - Update options\n   */\n  updateCell(rowId, columnName, value, options = {}) {\n    const rowIndex = this._state.data.findIndex((r) => r._id === rowId)\n    if (rowIndex === -1) return\n\n    const row = this._state.data[rowIndex]\n    const oldValue = row[columnName]\n\n    // Skip if value hasn't changed\n    if (deepEqual(oldValue, value)) return\n\n    // Update the value\n    row[columnName] = value\n\n    // Mark as dirty\n    this._state.dirtyRows.add(rowId)\n    if (!this._state.dirtyColumns.has(rowId)) {\n      this._state.dirtyColumns.set(rowId, new Set())\n    }\n    this._state.dirtyColumns.get(rowId).add(columnName)\n\n    // Invalidate affected cache\n    this._invalidateCacheForRow(rowId, columnName)\n\n    // Skip emitting individual cell/row change events during batch operations\n    // The full render will happen after the batch completes via DATA_CHANGE\n    if (!this._state.isBatchOperation) {\n      // Emit cell change event\n      this._eventBus.emit(TableEvents.CELL_CHANGE, {\n        rowId,\n        rowIndex,\n        columnName,\n        oldValue,\n        newValue: value,\n        row: deepClone(row),\n      })\n\n      // Emit row change event\n      this._eventBus.emit(TableEvents.ROW_CHANGE, {\n        rowId,\n        rowIndex,\n        columnName,\n        row: deepClone(row),\n        dirtyColumns: Array.from(this._state.dirtyColumns.get(rowId) || []),\n      })\n    }\n\n    // Trigger cascade updates if needed\n    if (!options.skipCascade) {\n      this._triggerCascadeUpdate(rowId, columnName, value)\n    }\n  }\n\n  /**\n   * Batch update multiple cells (more efficient for bulk changes)\n   * @param {Array<{rowId, columnName, value}>} updates - Array of updates\n   */\n  batchUpdate(updates) {\n    // Mark that we're in a batch operation\n    this._state.isBatchOperation = true\n\n    this._eventBus.startBatch()\n\n    updates.forEach(({ rowId, columnName, value }) => {\n      this.updateCell(rowId, columnName, value, { skipCascade: true })\n    })\n\n    // Compute cascade updates once for all changes\n    this._computeAllCascades()\n\n    this._eventBus.endBatch()\n\n    // Mark batch operation as complete before emitting DATA_CHANGE\n    this._state.isBatchOperation = false\n\n    this._eventBus.emit(TableEvents.DATA_CHANGE, {\n      data: this._state.data,\n      source: \"batchUpdate\",\n      updatedRows: updates.map((u) => u.rowId),\n    })\n  }\n\n  // ============================================\n  // Column Management\n  // ============================================\n\n  /**\n   * Set column definitions\n   * @param {Array<Object>} columns - Column configuration array\n   */\n  setColumns(columns) {\n    this._state.columns = columns.map((col, index) => ({\n      ...col,\n      _index: index,\n      _id: col.id || col.data || `col_${index}`,\n    }))\n\n    this._eventBus.emit(TableEvents.STATE_CHANGE, {\n      property: \"columns\",\n      value: this._state.columns,\n    })\n  }\n\n  /**\n   * Get column definitions\n   * @returns {Array<Object>}\n   */\n  getColumns() {\n    const columns = [...this._state.columns]\n\n    // Append row total column if enabled\n    if (this._state.config.enableRowTotals) {\n      // Default format: $X,XXX\n      const defaultFormat = (value) =>\n        value !== null && value !== undefined\n          ? `$${Number(value).toLocaleString()}`\n          : \"$0\"\n\n      columns.push({\n        data: \"_rowTotal\",\n        title: \"Total\",\n        type: \"number\",\n        editable: false,\n        aggregate: \"sum\",\n        _id: \"_rowTotal\",\n        _index: columns.length,\n        _isRowTotal: true,\n        format: this._state.config.rowTotalsFormat || defaultFormat,\n      })\n    }\n\n    return columns\n  }\n\n  /**\n   * Get a column by name/id\n   * @param {string} columnId - Column identifier\n   * @returns {Object|null}\n   */\n  getColumn(columnId) {\n    // Check for row total column\n    if (columnId === \"_rowTotal\" && this._state.config.enableRowTotals) {\n      // Default format: $X,XXX\n      const defaultFormat = (value) =>\n        value !== null && value !== undefined\n          ? `$${Number(value).toLocaleString()}`\n          : \"$0\"\n\n      return {\n        data: \"_rowTotal\",\n        title: \"Total\",\n        type: \"number\",\n        editable: false,\n        aggregate: \"sum\",\n        _id: \"_rowTotal\",\n        _isRowTotal: true,\n        format: this._state.config.rowTotalsFormat || defaultFormat,\n      }\n    }\n\n    return this._state.columns.find(\n      (c) => c._id === columnId || c.data === columnId\n    )\n  }\n\n  // ============================================\n  // Mode Management\n  // ============================================\n\n  /**\n   * Set table mode\n   * @param {'view'|'edit'} mode - Table mode\n   */\n  setMode(mode) {\n    if (mode !== \"view\" && mode !== \"edit\") {\n      console.warn(`Invalid mode: ${mode}. Must be 'view' or 'edit'.`)\n      return\n    }\n\n    const oldMode = this._state.mode\n    this._state.mode = mode\n\n    this._eventBus.emit(TableEvents.MODE_CHANGE, {\n      oldMode,\n      newMode: mode,\n    })\n  }\n\n  /**\n   * Get current mode\n   * @returns {'view'|'edit'}\n   */\n  getMode() {\n    return this._state.mode\n  }\n\n  /**\n   * Check if in edit mode\n   * @returns {boolean}\n   */\n  isEditMode() {\n    return this._state.mode === \"edit\"\n  }\n\n  // ============================================\n  // Group Management\n  // ============================================\n\n  /**\n   * Toggle group visibility\n   * @param {string} groupId - Group identifier\n   */\n  toggleGroup(groupId) {\n    if (this._state.collapsedGroups.has(groupId)) {\n      this._state.collapsedGroups.delete(groupId)\n    } else {\n      this._state.collapsedGroups.add(groupId)\n    }\n\n    this._eventBus.emit(TableEvents.GROUP_TOGGLE, {\n      groupId,\n      collapsed: this._state.collapsedGroups.has(groupId),\n    })\n  }\n\n  /**\n   * Check if a group is collapsed\n   * @param {string} groupId - Group identifier\n   * @returns {boolean}\n   */\n  isGroupCollapsed(groupId) {\n    return this._state.collapsedGroups.has(groupId)\n  }\n\n  /**\n   * Get grouped data structure\n   * @returns {Object|null}\n   */\n  getGroupedData() {\n    return this._state.groupedData\n  }\n\n  /**\n   * Get ungrouped rows (rows without a group value)\n   * @returns {Array}\n   */\n  getUngroupedRows() {\n    return this._state.ungroupedRows || []\n  }\n\n  /**\n   * Get info rows (informational header rows)\n   * @returns {Array}\n   */\n  getInfoRows() {\n    return this._state.infoRows || []\n  }\n\n  /**\n   * Expand all groups\n   */\n  expandAllGroups() {\n    this._state.collapsedGroups.clear()\n    this._eventBus.emit(TableEvents.GROUP_EXPAND_ALL, {})\n  }\n\n  /**\n   * Collapse all groups\n   */\n  collapseAllGroups() {\n    if (this._state.groupedData) {\n      Object.keys(this._state.groupedData).forEach((groupId) => {\n        this._state.collapsedGroups.add(groupId)\n      })\n    }\n    this._eventBus.emit(TableEvents.GROUP_COLLAPSE_ALL, {})\n  }\n\n  // ============================================\n  // Dirty State Management\n  // ============================================\n\n  /**\n   * Get all dirty (modified) rows\n   * @returns {Array<Object>}\n   */\n  getDirtyRows() {\n    return this._state.data\n      .filter((row) => this._state.dirtyRows.has(row._id))\n      .map((row) => deepClone(row))\n  }\n\n  /**\n   * Check if a row is dirty\n   * @param {string|number} rowId - Row identifier\n   * @returns {boolean}\n   */\n  isRowDirty(rowId) {\n    return this._state.dirtyRows.has(rowId)\n  }\n\n  /**\n   * Clear dirty state (e.g., after save)\n   */\n  clearDirty() {\n    this._state.dirtyRows.clear()\n    this._state.dirtyColumns.clear()\n    this._state.originalData = deepClone(this._state.data)\n  }\n\n  /**\n   * Revert all changes to original data\n   */\n  revertChanges() {\n    this.setData(this._state.originalData)\n  }\n\n  // ============================================\n  // Configuration\n  // ============================================\n\n  /**\n   * Update configuration\n   * @param {Object} config - Configuration updates\n   */\n  setConfig(config) {\n    this._state.config = { ...this._state.config, ...config }\n\n    if (config.groupBy !== undefined) {\n      this._computeGroups()\n    }\n\n    this._eventBus.emit(TableEvents.STATE_CHANGE, {\n      property: \"config\",\n      value: this._state.config,\n    })\n  }\n\n  /**\n   * Get current configuration\n   * @returns {Object}\n   */\n  getConfig() {\n    return { ...this._state.config }\n  }\n\n  // ============================================\n  // Private Methods\n  // ============================================\n\n  /**\n   * Normalize data by adding internal IDs\n   * @private\n   */\n  _normalizeData(data) {\n    return data.map((row, index) => ({\n      ...row,\n      _id: row._id || row.id || generateId(),\n      _index: index,\n      _type: row._type || \"data\", // 'data' | 'infoRow' | 'group-header' | 'total'\n    }))\n  }\n\n  /**\n   * Compute group structure from data\n   * @private\n   */\n  _computeGroups() {\n    const { groupBy } = this._state.config\n    if (!groupBy) {\n      this._state.groupedData = null\n      return\n    }\n\n    const groups = {}\n    const ungroupedRows = []\n    const infoRows = []\n\n    this._state.data.forEach((row) => {\n      // Info rows are rendered separately at the top\n      if (row._type === \"infoRow\") {\n        infoRows.push(row)\n        return\n      }\n\n      // Only include data rows in groups\n      if (row._type !== \"data\") return\n\n      const groupKey =\n        typeof groupBy === \"function\" ? groupBy(row) : row[groupBy]\n\n      // Handle rows without a group value\n      if (groupKey === null || groupKey === undefined || groupKey === \"\") {\n        ungroupedRows.push(row)\n        return\n      }\n\n      if (!groups[groupKey]) {\n        // Check if there's a custom label in config.groups.labels\n        const customLabels = this._state.config.groups?.labels || {}\n        const customLabel = customLabels[groupKey]\n\n        groups[groupKey] = {\n          id: groupKey,\n          label: customLabel || groupKey,\n          rows: [],\n          totals: {},\n        }\n      }\n      groups[groupKey].rows.push(row)\n    })\n\n    // Store ungrouped rows and info rows separately\n    this._state.groupedData = groups\n    this._state.ungroupedRows = ungroupedRows\n    this._state.infoRows = infoRows\n  }\n\n  /**\n   * Invalidate entire computed cache\n   * @private\n   */\n  _invalidateCache() {\n    this._state.computedCache.clear()\n  }\n\n  /**\n   * Invalidate cache for specific row/column\n   * @private\n   */\n  _invalidateCacheForRow(rowId, columnName) {\n    // Invalidate direct cache\n    this._state.computedCache.delete(`${rowId}:${columnName}`)\n\n    // Invalidate dependent caches (totals, cumulative, etc.)\n    const column = this.getColumn(columnName)\n    if (column && column.affectsColumns) {\n      column.affectsColumns.forEach((affectedCol) => {\n        this._state.computedCache.forEach((_, key) => {\n          if (key.includes(`:${affectedCol}`)) {\n            this._state.computedCache.delete(key)\n          }\n        })\n      })\n    }\n  }\n\n  /**\n   * Trigger cascade updates for dependent rows/cells\n   * @private\n   */\n  _triggerCascadeUpdate(rowId, columnName, value) {\n    const column = this.getColumn(columnName)\n    if (!column) return\n\n    // Check for cascade configuration\n    if (column.cascade) {\n      column.cascade({\n        rowId,\n        columnName,\n        value,\n        state: this,\n        updateCell: (rId, cName, val) => {\n          this.updateCell(rId, cName, val, { skipCascade: true })\n        },\n      })\n    }\n\n    // Note: Group totals are recalculated by GroupManager which listens for CELL_CHANGE events\n  }\n\n  /**\n   * Compute all cascade updates (for batch operations)\n   * @private\n   */\n  _computeAllCascades() {\n    // Note: Group totals are recalculated by GroupManager which listens for DATA_CHANGE events\n  }\n\n  /**\n   * Destroy state and cleanup\n   */\n  destroy() {\n    this._state.data = []\n    this._state.columns = []\n    this._state.computedCache.clear()\n    this._state.dirtyRows.clear()\n    this._state.dirtyColumns.clear()\n    this._state.collapsedGroups.clear()\n  }\n}\n","/**\n * DOM Utilities - Helper functions for DOM manipulation\n */\n\n/**\n * Create an element with attributes\n * @param {string} tag - HTML tag name\n * @param {Object} [attributes] - Attributes to set\n * @returns {HTMLElement}\n */\nexport function createElement(tag, attributes = {}) {\n  const element = document.createElement(tag)\n  setAttributes(element, attributes)\n  return element\n}\n\n/**\n * Set multiple attributes on an element\n * @param {HTMLElement} element - Target element\n * @param {Object} attributes - Attributes object\n */\nexport function setAttributes(element, attributes) {\n  Object.entries(attributes).forEach(([key, value]) => {\n    if (key === \"class\") {\n      element.className = value\n    } else if (key === \"style\" && typeof value === \"object\") {\n      Object.assign(element.style, value)\n    } else if (key.startsWith(\"data-\")) {\n      element.setAttribute(key, value)\n    } else if (key in element) {\n      element[key] = value\n    } else {\n      element.setAttribute(key, value)\n    }\n  })\n}\n\n/**\n * Add one or more classes to an element\n * @param {HTMLElement} element - Target element\n * @param {...string} classNames - Class names to add\n */\nexport function addClass(element, ...classNames) {\n  classNames.forEach((className) => {\n    if (className) {\n      element.classList.add(className)\n    }\n  })\n}\n\n/**\n * Remove one or more classes from an element\n * @param {HTMLElement} element - Target element\n * @param {...string} classNames - Class names to remove\n */\nexport function removeClass(element, ...classNames) {\n  classNames.forEach((className) => {\n    if (className) {\n      element.classList.remove(className)\n    }\n  })\n}\n\n/**\n * Toggle a class on an element\n * @param {HTMLElement} element - Target element\n * @param {string} className - Class name to toggle\n * @param {boolean} [force] - Force add or remove\n * @returns {boolean} - Whether class is now present\n */\nexport function toggleClass(element, className, force) {\n  return element.classList.toggle(className, force)\n}\n\n/**\n * Check if element has a class\n * @param {HTMLElement} element - Target element\n * @param {string} className - Class name to check\n * @returns {boolean}\n */\nexport function hasClass(element, className) {\n  return element.classList.contains(className)\n}\n\n/**\n * Find closest ancestor matching selector\n * @param {HTMLElement} element - Starting element\n * @param {string} selector - CSS selector\n * @returns {HTMLElement|null}\n */\nexport function closest(element, selector) {\n  return element.closest(selector)\n}\n\n/**\n * Query selector wrapper\n * @param {string} selector - CSS selector\n * @param {HTMLElement} [context=document] - Context element\n * @returns {HTMLElement|null}\n */\nexport function $(selector, context = document) {\n  return context.querySelector(selector)\n}\n\n/**\n * Query selector all wrapper\n * @param {string} selector - CSS selector\n * @param {HTMLElement} [context=document] - Context element\n * @returns {NodeListOf<HTMLElement>}\n */\nexport function $$(selector, context = document) {\n  return context.querySelectorAll(selector)\n}\n\n/**\n * Get element's offset relative to document\n * @param {HTMLElement} element - Target element\n * @returns {{top: number, left: number}}\n */\nexport function getOffset(element) {\n  const rect = element.getBoundingClientRect()\n  return {\n    top: rect.top + window.scrollY,\n    left: rect.left + window.scrollX,\n  }\n}\n\n/**\n * Get element dimensions including padding and border\n * @param {HTMLElement} element - Target element\n * @returns {{width: number, height: number}}\n */\nexport function getOuterDimensions(element) {\n  return {\n    width: element.offsetWidth,\n    height: element.offsetHeight,\n  }\n}\n\n/**\n * Get element dimensions excluding padding and border\n * @param {HTMLElement} element - Target element\n * @returns {{width: number, height: number}}\n */\nexport function getInnerDimensions(element) {\n  const style = getComputedStyle(element)\n  return {\n    width:\n      element.clientWidth -\n      parseFloat(style.paddingLeft) -\n      parseFloat(style.paddingRight),\n    height:\n      element.clientHeight -\n      parseFloat(style.paddingTop) -\n      parseFloat(style.paddingBottom),\n  }\n}\n\n/**\n * Scroll element into view with options\n * @param {HTMLElement} element - Target element\n * @param {Object} [options] - ScrollIntoView options\n */\nexport function scrollIntoView(element, options = {}) {\n  element.scrollIntoView({\n    behavior: \"smooth\",\n    block: \"nearest\",\n    inline: \"nearest\",\n    ...options,\n  })\n}\n\n/**\n * Delegate event handling\n * @param {HTMLElement} parent - Parent element\n * @param {string} eventType - Event type\n * @param {string} selector - Child selector\n * @param {Function} handler - Event handler\n * @returns {Function} - Cleanup function\n */\nexport function delegate(parent, eventType, selector, handler) {\n  const listener = (event) => {\n    const target = event.target.closest(selector)\n    if (target && parent.contains(target)) {\n      handler.call(target, event, target)\n    }\n  }\n\n  parent.addEventListener(eventType, listener)\n\n  return () => parent.removeEventListener(eventType, listener)\n}\n\n/**\n * Create document fragment from HTML string\n * @param {string} html - HTML string\n * @returns {DocumentFragment}\n */\nexport function createFragment(html) {\n  const template = document.createElement(\"template\")\n  template.innerHTML = html.trim()\n  return template.content\n}\n\n/**\n * Empty an element's contents\n * @param {HTMLElement} element - Target element\n */\nexport function empty(element) {\n  while (element.firstChild) {\n    element.removeChild(element.firstChild)\n  }\n}\n\n/**\n * Check if element is visible in viewport\n * @param {HTMLElement} element - Target element\n * @returns {boolean}\n */\nexport function isInViewport(element) {\n  const rect = element.getBoundingClientRect()\n  return (\n    rect.top >= 0 &&\n    rect.left >= 0 &&\n    rect.bottom <=\n      (window.innerHeight || document.documentElement.clientHeight) &&\n    rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n  )\n}\n\n/**\n * Throttle function execution\n * @param {Function} func - Function to throttle\n * @param {number} wait - Wait time in milliseconds\n * @returns {Function} - Throttled function\n */\nexport function throttle(func, wait) {\n  let timeout = null\n  let lastRan = null\n\n  return function (...args) {\n    if (!lastRan) {\n      func.apply(this, args)\n      lastRan = Date.now()\n    } else {\n      clearTimeout(timeout)\n      timeout = setTimeout(() => {\n        if (Date.now() - lastRan >= wait) {\n          func.apply(this, args)\n          lastRan = Date.now()\n        }\n      }, wait - (Date.now() - lastRan))\n    }\n  }\n}\n\n/**\n * Debounce function execution\n * @param {Function} func - Function to debounce\n * @param {number} wait - Wait time in milliseconds\n * @returns {Function} - Debounced function\n */\nexport function debounce(func, wait) {\n  let timeout\n  return function (...args) {\n    clearTimeout(timeout)\n    timeout = setTimeout(() => func.apply(this, args), wait)\n  }\n}\n","/**\r\n * TableRenderer - Handles all DOM rendering operations\r\n *\r\n * Responsible for creating and updating the table DOM structure\r\n * with efficient differential updates for performance.\r\n */\r\n\r\nimport { TableEvents } from \"./EventBus.js\"\r\nimport {\r\n  createElement,\r\n  addClass,\r\n  removeClass,\r\n  setAttributes,\r\n} from \"../utils/dom.js\"\r\nimport { escapeHtml } from \"../utils/helpers.js\"\r\n\r\nexport class TableRenderer {\r\n  /**\r\n   * @param {HTMLElement} container - Container element\r\n   * @param {TableState} state - Table state instance\r\n   */\r\n  constructor(container, state) {\r\n    this._container = container\r\n    this._state = state\r\n    this._eventBus = state._eventBus\r\n\r\n    /** @type {HTMLElement} */\r\n    this._tableWrapper = null\r\n\r\n    /** @type {HTMLElement} */\r\n    this._table = null\r\n\r\n    /** @type {HTMLElement} */\r\n    this._thead = null\r\n\r\n    /** @type {HTMLElement} */\r\n    this._tbody = null\r\n\r\n    /** @type {Map<string, HTMLElement>} */\r\n    this._rowElements = new Map()\r\n\r\n    /** @type {Map<string, HTMLElement>} */\r\n    this._cellElements = new Map()\r\n\r\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\r\n    this._unsubscribers = []\r\n\r\n    // Subscribe to state changes\r\n    this._setupEventListeners()\r\n  }\r\n\r\n  /**\r\n   * Main render method\r\n   */\r\n  render() {\r\n    const config = this._state.getConfig()\r\n\r\n    // Create structure if it doesn't exist\r\n    if (!this._tableWrapper) {\r\n      this._createStructure()\r\n    }\r\n\r\n    // Update container classes based on config\r\n    this._updateContainerClasses(config)\r\n\r\n    // Render header\r\n    this._renderHeader()\r\n\r\n    // Render body based on grouping config\r\n    if (config.enableGrouping && this._state.getGroupedData()) {\r\n      this._renderGroupedBody()\r\n    } else {\r\n      this._renderBody()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a single cell without full re-render\r\n   * @param {string} rowId - Row identifier\r\n   * @param {string} columnName - Column name\r\n   * @param {any} value - New value\r\n   */\r\n  updateCell(rowId, columnName, value) {\r\n    const cellKey = `${rowId}:${columnName}`\r\n    const cell = this._cellElements.get(cellKey)\r\n\r\n    if (cell && cell.isConnected) {\r\n      const column = this._state.getColumn(columnName)\r\n      const row = this._state.getRow(rowId)\r\n      if (column && row) {\r\n        this._renderCellContent(cell, value, column, row)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a single row without full re-render\r\n   * @param {string} rowId - Row identifier\r\n   */\r\n  updateRow(rowId) {\r\n    const rowElement = this._rowElements.get(rowId)\r\n    const rowData = this._state.getRow(rowId)\r\n\r\n    if (rowElement && rowData) {\r\n      const columns = this._state.getColumns()\r\n      columns.forEach((column) => {\r\n        const cellKey = `${rowId}:${column.data}`\r\n        const cell = this._cellElements.get(cellKey)\r\n        if (cell) {\r\n          this._renderCellContent(cell, rowData[column.data], column, rowData)\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get cell element by row and column\r\n   * @param {string} rowId - Row identifier\r\n   * @param {string} columnName - Column name\r\n   * @returns {HTMLElement|null}\r\n   */\r\n  getCellElement(rowId, columnName) {\r\n    return this._cellElements.get(`${rowId}:${columnName}`) || null\r\n  }\r\n\r\n  /**\r\n   * Get row element by ID\r\n   * @param {string} rowId - Row identifier\r\n   * @returns {HTMLElement|null}\r\n   */\r\n  getRowElement(rowId) {\r\n    return this._rowElements.get(rowId) || null\r\n  }\r\n\r\n  /**\r\n   * Cleanup and destroy\r\n   */\r\n  destroy() {\r\n    // Unsubscribe from all event listeners\r\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\r\n    this._unsubscribers = []\r\n\r\n    // Clear element caches\r\n    this._rowElements.clear()\r\n    this._cellElements.clear()\r\n\r\n    // Remove DOM elements\r\n    if (this._tableWrapper) {\r\n      this._tableWrapper.remove()\r\n    }\r\n  }\r\n\r\n  // ============================================\r\n  // Private Methods\r\n  // ============================================\r\n\r\n  /**\r\n   * Setup event listeners for state changes\r\n   * @private\r\n   */\r\n  _setupEventListeners() {\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(\r\n        TableEvents.CELL_CHANGE,\r\n        ({ rowId, columnName, newValue }) => {\r\n          // Skip individual cell updates during batch operations\r\n          // The full render will happen after the batch completes\r\n          if (this._state.isBatchOperation && this._state.isBatchOperation()) {\r\n            return\r\n          }\r\n          this.updateCell(rowId, columnName, newValue)\r\n        }\r\n      )\r\n    )\r\n\r\n    // Listen for data changes (row add/delete) to re-render\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.DATA_CHANGE, () => {\r\n        this.render()\r\n      })\r\n    )\r\n\r\n    // Listen for row total changes (emitted by GroupManager after calculation)\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.ROW_TOTAL_CHANGE, ({ rowId, newValue }) => {\r\n        this.updateCell(rowId, \"_rowTotal\", newValue)\r\n      })\r\n    )\r\n\r\n    // Listen for group totals updates to re-render group headers\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.STATE_CHANGE, ({ property, groupId }) => {\r\n        if (property === \"groupTotals\") {\r\n          // Re-render group headers to show updated aggregates\r\n          this._updateGroupHeaders(groupId)\r\n        }\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.MODE_CHANGE, () => {\r\n        this.render()\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.GROUP_TOGGLE, ({ groupId, collapsed }) => {\r\n        this._toggleGroupVisibility(groupId, collapsed)\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.GROUP_EXPAND_ALL, () => {\r\n        this._setAllGroupsVisibility(false)\r\n      })\r\n    )\r\n\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.GROUP_COLLAPSE_ALL, () => {\r\n        this._setAllGroupsVisibility(true)\r\n      })\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Create the base DOM structure\r\n   * @private\r\n   */\r\n  _createStructure() {\r\n    addClass(this._container, \"dg-container\")\r\n\r\n    // Create wrapper for scroll handling\r\n    this._tableWrapper = createElement(\"div\", { class: \"dg-table-wrapper\" })\r\n\r\n    // Create table\r\n    this._table = createElement(\"table\", { class: \"dg-table\" })\r\n\r\n    // Create header\r\n    this._thead = createElement(\"thead\", { class: \"dg-thead\" })\r\n\r\n    // Create body\r\n    this._tbody = createElement(\"tbody\", { class: \"dg-tbody\" })\r\n\r\n    // Assemble\r\n    this._table.appendChild(this._thead)\r\n    this._table.appendChild(this._tbody)\r\n    this._tableWrapper.appendChild(this._table)\r\n    this._container.appendChild(this._tableWrapper)\r\n  }\r\n\r\n  /**\r\n   * Update container classes based on config\r\n   * @private\r\n   */\r\n  _updateContainerClasses(config) {\r\n    const mode = this._state.getMode()\r\n\r\n    // Mode classes\r\n    removeClass(this._container, \"dg-mode-view\", \"dg-mode-edit\")\r\n    addClass(this._container, `dg-mode-${mode}`)\r\n\r\n    // Feature classes\r\n    if (config.fixedFirstColumn) {\r\n      addClass(this._container, \"dg-fixed-first-column\")\r\n    } else {\r\n      removeClass(this._container, \"dg-fixed-first-column\")\r\n    }\r\n\r\n    if (config.enableGrouping) {\r\n      addClass(this._container, \"dg-grouped\")\r\n    } else {\r\n      removeClass(this._container, \"dg-grouped\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render table header\r\n   * @private\r\n   */\r\n  _renderHeader() {\r\n    const columns = this._state.getColumns()\r\n    const config = this._state.getConfig()\r\n\r\n    this._thead.innerHTML = \"\"\r\n\r\n    const headerRow = createElement(\"tr\", { class: \"dg-header-row\" })\r\n\r\n    let visibleIndex = 0\r\n    columns.forEach((column) => {\r\n      if (column.visible === false) return\r\n\r\n      const th = createElement(\"th\", {\r\n        class: \"dg-header-cell\",\r\n        \"data-column\": column.data,\r\n        \"data-column-index\": visibleIndex,\r\n      })\r\n\r\n      // Fixed first column\r\n      if (visibleIndex === 0 && config.fixedFirstColumn) {\r\n        addClass(th, \"dg-cell-fixed\")\r\n      }\r\n\r\n      // Row total column header\r\n      if (column._isRowTotal) {\r\n        addClass(th, \"dg-header-row-total\")\r\n      }\r\n\r\n      // Header content\r\n      const headerContent = createElement(\"div\", { class: \"dg-header-content\" })\r\n      headerContent.textContent = column.title || column.data\r\n      th.appendChild(headerContent)\r\n\r\n      // Column width\r\n      if (column.width) {\r\n        th.style.width =\r\n          typeof column.width === \"number\" ? `${column.width}px` : column.width\r\n      }\r\n\r\n      headerRow.appendChild(th)\r\n      visibleIndex++\r\n    })\r\n\r\n    this._thead.appendChild(headerRow)\r\n  }\r\n\r\n  /**\r\n   * Render table body (ungrouped)\r\n   * @private\r\n   */\r\n  _renderBody() {\r\n    const data = this._state.getData()\r\n    const columns = this._state.getColumns()\r\n\r\n    this._tbody.innerHTML = \"\"\r\n    this._rowElements.clear()\r\n    this._cellElements.clear()\r\n\r\n    data.forEach((row) => {\r\n      const rowElement = this._createRowElement(row, columns)\r\n      this._tbody.appendChild(rowElement)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Render table body (grouped)\r\n   * @private\r\n   */\r\n  _renderGroupedBody() {\r\n    const groupedData = this._state.getGroupedData()\r\n    const ungroupedRows = this._state.getUngroupedRows()\r\n    const infoRows = this._state.getInfoRows()\r\n    const columns = this._state.getColumns()\r\n\r\n    this._tbody.innerHTML = \"\"\r\n    this._rowElements.clear()\r\n    this._cellElements.clear()\r\n\r\n    // Render info rows first (at the top, not part of any group)\r\n    if (infoRows && infoRows.length > 0) {\r\n      infoRows.forEach((row) => {\r\n        const rowElement = this._createRowElement(row, columns, null)\r\n        addClass(rowElement, \"dg-row-info\")\r\n        this._tbody.appendChild(rowElement)\r\n      })\r\n    }\r\n\r\n    // Render grouped rows\r\n    Object.entries(groupedData).forEach(([groupId, group]) => {\r\n      // Group header row (includes aggregate values)\r\n      const groupHeader = this._createGroupHeaderRow(groupId, group, columns)\r\n      this._tbody.appendChild(groupHeader)\r\n\r\n      // Group rows\r\n      const isCollapsed = this._state.isGroupCollapsed(groupId)\r\n      group.rows.forEach((row) => {\r\n        const rowElement = this._createRowElement(row, columns, groupId)\r\n        if (isCollapsed) {\r\n          addClass(rowElement, \"dg-row-hidden\")\r\n        }\r\n        this._tbody.appendChild(rowElement)\r\n      })\r\n    })\r\n\r\n    // Render ungrouped rows at the end (rows without a group value)\r\n    if (ungroupedRows.length > 0) {\r\n      ungroupedRows.forEach((row) => {\r\n        const rowElement = this._createRowElement(row, columns, null)\r\n        addClass(rowElement, \"dg-row-ungrouped\")\r\n        this._tbody.appendChild(rowElement)\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a data row element\r\n   * @private\r\n   */\r\n  _createRowElement(row, columns, groupId = null) {\r\n    const config = this._state.getConfig()\r\n    const isInfoRow = row._type === \"infoRow\"\r\n\r\n    const tr = createElement(\"tr\", {\r\n      class: `dg-row ${isInfoRow ? \"dg-row-info-row\" : \"dg-row-data\"}`,\r\n      \"data-row-id\": row._id,\r\n      \"data-row-index\": row._index,\r\n    })\r\n\r\n    if (groupId) {\r\n      tr.setAttribute(\"data-group\", groupId)\r\n    }\r\n\r\n    // Mark dirty rows\r\n    if (this._state.isRowDirty(row._id)) {\r\n      addClass(tr, \"dg-row-dirty\")\r\n    }\r\n\r\n    // Row click handler\r\n    tr.addEventListener(\"click\", (e) => {\r\n      if (!e.target.closest(\".dg-cell-input\")) {\r\n        this._eventBus.emit(TableEvents.ROW_CLICK, {\r\n          rowId: row._id,\r\n          rowIndex: row._index,\r\n          row: this._state.getRow(row._id),\r\n          event: e,\r\n        })\r\n      }\r\n    })\r\n\r\n    // Create cells\r\n    let visibleIndex = 0\r\n    columns.forEach((column) => {\r\n      if (column.visible === false) return\r\n\r\n      const td = this._createCellElement(row, column, visibleIndex, config)\r\n      tr.appendChild(td)\r\n\r\n      // Store reference\r\n      this._cellElements.set(`${row._id}:${column.data}`, td)\r\n      visibleIndex++\r\n    })\r\n\r\n    // Store reference\r\n    this._rowElements.set(row._id, tr)\r\n\r\n    return tr\r\n  }\r\n\r\n  /**\r\n   * Create a cell element\r\n   * @private\r\n   */\r\n  _createCellElement(row, column, index, config) {\r\n    const td = createElement(\"td\", {\r\n      class: \"dg-cell\",\r\n      \"data-column\": column.data,\r\n    })\r\n\r\n    // Fixed first column\r\n    if (index === 0 && config.fixedFirstColumn) {\r\n      addClass(td, \"dg-cell-fixed\")\r\n    }\r\n\r\n    // Row total column\r\n    if (column._isRowTotal) {\r\n      addClass(td, \"dg-cell-row-total\")\r\n    }\r\n\r\n    // Cell type classes\r\n    if (column.type) {\r\n      addClass(td, `dg-cell-${column.type}`)\r\n    }\r\n\r\n    // Alignment\r\n    if (column.align) {\r\n      td.style.textAlign = column.align\r\n    }\r\n\r\n    // Render actions for first column FIRST (before content)\r\n    // This ensures actions are at the beginning of the cell\r\n    const actions = config.actions || []\r\n    const columnHasActions = column.actions !== false // Default true, can be disabled per column\r\n    // Check if row should have actions (skip infoRows and check showIf callback if provided)\r\n    const rowHasActions =\r\n      row._type !== \"infoRow\" &&\r\n      (!config.actionsShowIf || config.actionsShowIf(row))\r\n    if (\r\n      index === 0 &&\r\n      actions.length > 0 &&\r\n      columnHasActions &&\r\n      rowHasActions\r\n    ) {\r\n      const actionsWrapper = this._createRowActions(actions, row)\r\n      td.appendChild(actionsWrapper)\r\n      addClass(td, \"dg-cell-has-actions\")\r\n    }\r\n\r\n    // Render content (pass flag to skip action handling since we did it above)\r\n    this._renderCellContent(td, row[column.data], column, row, true)\r\n\r\n    // Render badge for first column if row has _badge property\r\n    if (index === 0 && row._badge && row._type !== \"infoRow\") {\r\n      const badge = this._createBadgeElement(row._badge)\r\n      td.appendChild(badge)\r\n      addClass(td, \"dg-cell-has-badge\")\r\n    }\r\n\r\n    return td\r\n  }\r\n\r\n  /**\r\n   * Create badge element for a cell\r\n   * @private\r\n   * @param {string|HTMLElement} badgeContent - Badge HTML string or element\r\n   * @returns {HTMLElement} Badge element\r\n   */\r\n  _createBadgeElement(badgeContent) {\r\n    // Check if content contains HTML tags (custom styled element)\r\n    const containsHtml =\r\n      typeof badgeContent === \"string\" && /<[^>]+>/.test(badgeContent)\r\n\r\n    if (containsHtml) {\r\n      // Custom HTML provided - create wrapper without default badge styling\r\n      const wrapper = createElement(\"span\", { class: \"dg-cell-badge-wrapper\" })\r\n      wrapper.innerHTML = badgeContent\r\n      return wrapper\r\n    } else if (badgeContent instanceof HTMLElement) {\r\n      // HTMLElement provided - wrap without default styling\r\n      const wrapper = createElement(\"span\", { class: \"dg-cell-badge-wrapper\" })\r\n      wrapper.appendChild(badgeContent.cloneNode(true))\r\n      return wrapper\r\n    } else {\r\n      // Plain text - apply default badge styling\r\n      const badge = createElement(\"span\", { class: \"dg-cell-badge\" })\r\n      badge.textContent = badgeContent\r\n      return badge\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update badge for a specific row\r\n   * @param {string} rowId - Row identifier\r\n   * @param {string|HTMLElement|null} badgeContent - New badge content (null to remove)\r\n   */\r\n  updateRowBadge(rowId, badgeContent) {\r\n    // Update the badge in the actual state data (not a clone)\r\n    const data = this._state._state.data\r\n    const row = data.find((r) => r._id === rowId)\r\n    if (!row) return\r\n\r\n    // Update the data\r\n    row._badge = badgeContent\r\n\r\n    // Find the first cell of the row\r\n    const columns = this._state.getColumns()\r\n    const firstVisibleColumn = columns.find((col) => col.visible !== false)\r\n    if (!firstVisibleColumn) return\r\n\r\n    const cellKey = `${rowId}:${firstVisibleColumn.data}`\r\n    const td = this._cellElements.get(cellKey)\r\n    if (!td) return\r\n\r\n    // Remove existing badge (could be either class)\r\n    const existingBadge = td.querySelector(\r\n      \".dg-cell-badge, .dg-cell-badge-wrapper\"\r\n    )\r\n    if (existingBadge) {\r\n      existingBadge.remove()\r\n      removeClass(td, \"dg-cell-has-badge\")\r\n    }\r\n\r\n    // Add new badge if content provided\r\n    if (badgeContent) {\r\n      const badge = this._createBadgeElement(badgeContent)\r\n      td.appendChild(badge)\r\n      addClass(td, \"dg-cell-has-badge\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create row actions container with action icons\r\n   * @private\r\n   * @param {Array} actions - Array of action configurations\r\n   * @param {Object} row - Row data\r\n   * @returns {HTMLElement} Actions wrapper element\r\n   */\r\n  _createRowActions(actions, row) {\r\n    const wrapper = createElement(\"span\", { class: \"dg-row-actions\" })\r\n\r\n    actions.forEach((action, index) => {\r\n      const actionBtn = createElement(\"span\", {\r\n        class: \"dg-row-action\",\r\n        title: action.tooltip || \"\",\r\n        \"data-action-index\": index,\r\n      })\r\n\r\n      // Set the icon HTML\r\n      if (action.icon) {\r\n        if (typeof action.icon === \"string\") {\r\n          actionBtn.innerHTML = action.icon\r\n        } else if (action.icon instanceof HTMLElement) {\r\n          actionBtn.appendChild(action.icon.cloneNode(true))\r\n        }\r\n      }\r\n\r\n      // Click handler\r\n      actionBtn.addEventListener(\"click\", (e) => {\r\n        e.stopPropagation() // Prevent row click\r\n\r\n        // Get fresh row data\r\n        const rowData = this._state.getRow(row._id)\r\n\r\n        // Call the onClick handler if provided\r\n        if (typeof action.onClick === \"function\") {\r\n          action.onClick(rowData, e)\r\n        }\r\n\r\n        // Emit event for external listeners\r\n        this._eventBus.emit(TableEvents.ACTION_CLICK, {\r\n          actionIndex: index,\r\n          action,\r\n          rowId: row._id,\r\n          row: rowData,\r\n          event: e,\r\n        })\r\n      })\r\n\r\n      wrapper.appendChild(actionBtn)\r\n    })\r\n\r\n    return wrapper\r\n  }\r\n\r\n  /**\r\n   * Render cell content based on mode and column config\r\n   * @private\r\n   * @param {HTMLElement} cell - Cell element\r\n   * @param {any} value - Cell value\r\n   * @param {Object} column - Column configuration\r\n   * @param {Object} row - Row data\r\n   * @param {boolean} skipSpecialElements - Skip handling of actions/badges (used during initial creation)\r\n   */\r\n  _renderCellContent(cell, value, column, row, skipSpecialElements = false) {\r\n    const isEditMode = this._state.isEditMode()\r\n    // Check column, row type, and row-level editable override\r\n    const isEditable =\r\n      column.editable !== false &&\r\n      row._type !== \"infoRow\" &&\r\n      row._editable !== false\r\n\r\n    if (skipSpecialElements) {\r\n      // During initial creation, just render the content\r\n      // Actions and badges are handled by _createCellElement\r\n      if (isEditMode && isEditable) {\r\n        // Edit mode - render input\r\n        const input = this._createInputElement(value, column, row)\r\n        cell.appendChild(input)\r\n      } else {\r\n        // View mode - render display value\r\n        const displayValue = this._formatDisplayValue(value, column, row)\r\n\r\n        if (column.render) {\r\n          // Custom render function\r\n          const rendered = column.render(value, row, column)\r\n          if (typeof rendered === \"string\") {\r\n            // Create a text node or span for the content\r\n            const content = document.createElement(\"span\")\r\n            content.innerHTML = rendered\r\n            cell.appendChild(content)\r\n          } else if (rendered instanceof HTMLElement) {\r\n            cell.appendChild(rendered)\r\n          }\r\n        } else {\r\n          // Create text content\r\n          const textNode = document.createTextNode(displayValue)\r\n          cell.appendChild(textNode)\r\n        }\r\n      }\r\n    } else {\r\n      // During updates, we need to preserve actions and badges\r\n      // Find and temporarily remove special elements\r\n      const existingBadge = cell.querySelector(\r\n        \".dg-cell-badge, .dg-cell-badge-wrapper\"\r\n      )\r\n      const existingActions = cell.querySelector(\".dg-row-actions\")\r\n\r\n      // Remove special elements temporarily (they keep their references and event listeners)\r\n      if (existingBadge) existingBadge.remove()\r\n      if (existingActions) existingActions.remove()\r\n\r\n      // Clear remaining content (text nodes, inputs, spans)\r\n      cell.innerHTML = \"\"\r\n\r\n      // Re-add actions at the beginning (with their original event listeners intact)\r\n      if (existingActions) {\r\n        cell.appendChild(existingActions)\r\n      }\r\n\r\n      // Render content\r\n      if (isEditMode && isEditable) {\r\n        // Edit mode - render input\r\n        const input = this._createInputElement(value, column, row)\r\n        cell.appendChild(input)\r\n      } else {\r\n        // View mode - render display value\r\n        const displayValue = this._formatDisplayValue(value, column, row)\r\n\r\n        if (column.render) {\r\n          // Custom render function\r\n          const rendered = column.render(value, row, column)\r\n          if (typeof rendered === \"string\") {\r\n            // Create a text node or span for the content\r\n            const content = document.createElement(\"span\")\r\n            content.innerHTML = rendered\r\n            cell.appendChild(content)\r\n          } else if (rendered instanceof HTMLElement) {\r\n            cell.appendChild(rendered)\r\n          }\r\n        } else {\r\n          // Create text content\r\n          const textNode = document.createTextNode(displayValue)\r\n          cell.appendChild(textNode)\r\n        }\r\n      }\r\n\r\n      // Re-add badge at the end (with its original structure intact)\r\n      if (existingBadge) {\r\n        cell.appendChild(existingBadge)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create input element for edit mode\r\n   * @private\r\n   */\r\n  _createInputElement(value, column, row) {\r\n    const type = column.inputType || column.type || \"text\"\r\n\r\n    let input\r\n\r\n    if (type === \"select\" && column.options) {\r\n      input = createElement(\"select\", { class: \"dg-cell-input dg-cell-select\" })\r\n      column.options.forEach((opt) => {\r\n        const option = createElement(\"option\", { value: opt.value || opt })\r\n        option.textContent = opt.label || opt\r\n        if ((opt.value || opt) === value) {\r\n          option.selected = true\r\n        }\r\n        input.appendChild(option)\r\n      })\r\n    } else if (type === \"textarea\") {\r\n      input = createElement(\"textarea\", {\r\n        class: \"dg-cell-input dg-cell-textarea\",\r\n        value: value || \"\",\r\n      })\r\n      input.textContent = value || \"\"\r\n    } else {\r\n      input = createElement(\"input\", {\r\n        class: \"dg-cell-input\",\r\n        type: type === \"number\" ? \"number\" : \"text\",\r\n        value: value ?? \"\",\r\n      })\r\n\r\n      if (type === \"number\") {\r\n        if (column.min !== undefined) input.min = column.min\r\n        if (column.max !== undefined) input.max = column.max\r\n        if (column.step !== undefined) input.step = column.step\r\n      }\r\n    }\r\n\r\n    // Input event handlers\r\n    input.addEventListener(\"focus\", () => {\r\n      this._eventBus.emit(TableEvents.CELL_FOCUS, {\r\n        rowId: row._id,\r\n        columnName: column.data,\r\n        value,\r\n      })\r\n    })\r\n\r\n    input.addEventListener(\"blur\", () => {\r\n      this._eventBus.emit(TableEvents.CELL_BLUR, {\r\n        rowId: row._id,\r\n        columnName: column.data,\r\n        value: input.value,\r\n      })\r\n    })\r\n\r\n    input.addEventListener(\"change\", (e) => {\r\n      let newValue = e.target.value\r\n\r\n      // Type coercion\r\n      if (type === \"number\") {\r\n        newValue = newValue === \"\" ? null : parseFloat(newValue)\r\n      }\r\n\r\n      this._state.updateCell(row._id, column.data, newValue)\r\n\r\n      // Column-specific onChange\r\n      if (column.onChange) {\r\n        column.onChange({\r\n          value: newValue,\r\n          rowId: row._id,\r\n          row: this._state.getRow(row._id),\r\n          column,\r\n        })\r\n      }\r\n    })\r\n\r\n    return input\r\n  }\r\n\r\n  /**\r\n   * Format value for display\r\n   * @private\r\n   */\r\n  _formatDisplayValue(value, column, row) {\r\n    if (value === null || value === undefined) {\r\n      return column.defaultValue ?? \"\"\r\n    }\r\n\r\n    // Info rows display values as-is without column formatting\r\n    if (row._type === \"infoRow\") {\r\n      return String(value)\r\n    }\r\n\r\n    if (column.format) {\r\n      return column.format(value, row, column)\r\n    }\r\n\r\n    if (column.type === \"number\" && typeof value === \"number\") {\r\n      return column.decimals !== undefined\r\n        ? value.toFixed(column.decimals)\r\n        : value.toString()\r\n    }\r\n\r\n    if (column.type === \"currency\") {\r\n      const formatted = new Intl.NumberFormat(\"en-US\", {\r\n        style: \"currency\",\r\n        currency: column.currency || \"USD\",\r\n      }).format(value)\r\n      return formatted\r\n    }\r\n\r\n    if (column.type === \"date\" && value) {\r\n      const date = new Date(value)\r\n      return date.toLocaleDateString()\r\n    }\r\n\r\n    return String(value)\r\n  }\r\n\r\n  /**\r\n   * Create group header row\r\n   * @private\r\n   */\r\n  _createGroupHeaderRow(groupId, group, columns) {\r\n    const config = this._state.getConfig()\r\n    const isCollapsed = this._state.isGroupCollapsed(groupId)\r\n    const visibleColumns = columns.filter((c) => c.visible !== false)\r\n\r\n    const tr = createElement(\"tr\", {\r\n      class: \"dg-row dg-row-group-header\",\r\n      \"data-group\": groupId,\r\n    })\r\n\r\n    // Use pre-calculated totals from GroupManager\r\n    const aggregates = group.totals || {}\r\n\r\n    visibleColumns.forEach((column, index) => {\r\n      const td = createElement(\"td\", {\r\n        class: \"dg-cell dg-cell-group-header\",\r\n        \"data-column\": column.data,\r\n      })\r\n\r\n      // Fixed first column\r\n      if (index === 0 && config.fixedFirstColumn) {\r\n        addClass(td, \"dg-cell-fixed\")\r\n      }\r\n\r\n      // Row total column\r\n      if (column._isRowTotal) {\r\n        addClass(td, \"dg-cell-row-total\")\r\n      }\r\n\r\n      // First column: show toggle + group label\r\n      if (index === 0) {\r\n        const toggleContent = createElement(\"div\", {\r\n          class: \"dg-group-header-content\",\r\n        })\r\n\r\n        const toggleIcon = createElement(\"span\", {\r\n          class: `dg-group-toggle-icon ${\r\n            isCollapsed ? \"dg-collapsed\" : \"dg-expanded\"\r\n          }`,\r\n        })\r\n        toggleIcon.innerHTML = isCollapsed ? \"\" : \"\"\r\n\r\n        const groupLabel = createElement(\"span\", { class: \"dg-group-label\" })\r\n        const labelContent = group.label || groupId\r\n        // Check if label contains HTML (starts with < or contains < followed by a letter)\r\n        if (typeof labelContent === \"string\" && labelContent.includes(\"<\")) {\r\n          groupLabel.innerHTML = labelContent\r\n        } else {\r\n          groupLabel.textContent = labelContent\r\n        }\r\n\r\n        const groupCount = createElement(\"span\", { class: \"dg-group-count\" })\r\n        groupCount.textContent = `(${group.rows.length})`\r\n\r\n        toggleContent.appendChild(toggleIcon)\r\n        toggleContent.appendChild(groupLabel)\r\n        toggleContent.appendChild(groupCount)\r\n        td.appendChild(toggleContent)\r\n      } else if (column.aggregate && aggregates[column.data] !== undefined) {\r\n        // Show aggregate value from GroupManager\r\n        td.textContent = this._formatDisplayValue(\r\n          aggregates[column.data],\r\n          column,\r\n          {}\r\n        )\r\n        addClass(td, \"dg-cell-aggregate\")\r\n      }\r\n\r\n      // Alignment\r\n      if (column.align) {\r\n        td.style.textAlign = column.align\r\n      }\r\n\r\n      tr.appendChild(td)\r\n    })\r\n\r\n    // Click handler for toggle\r\n    tr.addEventListener(\"click\", () => {\r\n      this._state.toggleGroup(groupId)\r\n    })\r\n\r\n    return tr\r\n  }\r\n\r\n  /**\r\n   * Create totals row for a group\r\n   * @private\r\n   */\r\n  _createTotalsRow(totals, columns, groupId) {\r\n    const config = this._state.getConfig()\r\n\r\n    const tr = createElement(\"tr\", {\r\n      class: \"dg-row dg-row-totals\",\r\n      \"data-group\": groupId,\r\n    })\r\n\r\n    columns.forEach((column, index) => {\r\n      if (column.visible === false) return\r\n\r\n      const td = createElement(\"td\", {\r\n        class: \"dg-cell dg-cell-total\",\r\n        \"data-column\": column.data,\r\n      })\r\n\r\n      if (index === 0 && config.fixedFirstColumn) {\r\n        addClass(td, \"dg-cell-fixed\")\r\n      }\r\n\r\n      if (totals[column.data] !== undefined) {\r\n        td.textContent = this._formatDisplayValue(\r\n          totals[column.data],\r\n          column,\r\n          {}\r\n        )\r\n      }\r\n\r\n      tr.appendChild(td)\r\n    })\r\n\r\n    return tr\r\n  }\r\n\r\n  /**\r\n   * Toggle group visibility\r\n   * @private\r\n   */\r\n  _toggleGroupVisibility(groupId, collapsed) {\r\n    const rows = this._tbody.querySelectorAll(\r\n      `[data-group=\"${groupId}\"]:not(.dg-row-group-header)`\r\n    )\r\n    const header = this._tbody.querySelector(\r\n      `.dg-row-group-header[data-group=\"${groupId}\"]`\r\n    )\r\n\r\n    rows.forEach((row) => {\r\n      if (collapsed) {\r\n        addClass(row, \"dg-row-hidden\")\r\n      } else {\r\n        removeClass(row, \"dg-row-hidden\")\r\n      }\r\n    })\r\n\r\n    // Update toggle icon\r\n    if (header) {\r\n      const icon = header.querySelector(\".dg-group-toggle-icon\")\r\n      if (icon) {\r\n        icon.innerHTML = collapsed ? \"\" : \"\"\r\n        if (collapsed) {\r\n          removeClass(icon, \"dg-expanded\")\r\n          addClass(icon, \"dg-collapsed\")\r\n        } else {\r\n          removeClass(icon, \"dg-collapsed\")\r\n          addClass(icon, \"dg-expanded\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set visibility for all groups\r\n   * @private\r\n   */\r\n  _setAllGroupsVisibility(collapsed) {\r\n    const groupedData = this._state.getGroupedData()\r\n    if (groupedData) {\r\n      Object.keys(groupedData).forEach((groupId) => {\r\n        this._toggleGroupVisibility(groupId, collapsed)\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update group header cells with new aggregate values\r\n   * @private\r\n   * @param {string} [groupId] - Specific group, or all if not provided\r\n   */\r\n  _updateGroupHeaders(groupId = null) {\r\n    // Guard: ensure tbody exists before trying to update\r\n    if (!this._tbody) return\r\n\r\n    const groupedData = this._state.getGroupedData()\r\n    if (!groupedData) return\r\n\r\n    const columns = this._state.getColumns()\r\n    const groupsToUpdate = groupId ? [groupId] : Object.keys(groupedData)\r\n\r\n    groupsToUpdate.forEach((gId) => {\r\n      const group = groupedData[gId]\r\n      if (!group) return\r\n\r\n      const headerRow = this._tbody.querySelector(\r\n        `.dg-row-group-header[data-group=\"${gId}\"]`\r\n      )\r\n      if (!headerRow) return\r\n\r\n      // Update each aggregate cell in the header\r\n      columns.forEach((column) => {\r\n        if (column.aggregate && group.totals[column.data] !== undefined) {\r\n          const cell = headerRow.querySelector(`[data-column=\"${column.data}\"]`)\r\n          if (cell && !cell.querySelector(\".dg-group-header-content\")) {\r\n            cell.textContent = this._formatDisplayValue(\r\n              group.totals[column.data],\r\n              column,\r\n              {}\r\n            )\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n}\r\n","/**\n * RowManager - Handles row-related operations\n *\n * Manages row CRUD operations and row types.\n */\n\nimport { TableEvents } from \"../core/EventBus.js\"\nimport { generateId, deepClone } from \"../utils/helpers.js\"\n\nexport class RowManager {\n  /**\n   * @param {TableState} state - Table state instance\n   * @param {EventBus} eventBus - Event bus instance\n   */\n  constructor(state, eventBus) {\n    this._state = state\n    this._eventBus = eventBus\n\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\n    this._unsubscribers = []\n\n    // Setup event listeners\n    this._setupListeners()\n  }\n\n  /**\n   * Add a new row\n   * @param {Object} rowData - Row data\n   * @param {Object} [options] - Options\n   * @param {number} [options.index] - Insert at specific index\n   * @param {string} [options.groupId] - Group to add row to\n   * @param {string} [options.afterRowId] - Insert after specific row\n   * @param {string} [options.type='data'] - Row type\n   * @returns {Object} Added row\n   */\n  addRow(rowData, options = {}) {\n    const data = this._state.getData()\n    const { index, groupId, afterRowId, type = \"data\" } = options\n\n    const newRow = {\n      ...rowData,\n      _id: rowData._id || generateId(),\n      _type: type,\n    }\n\n    let insertIndex = data.length\n\n    if (index !== undefined) {\n      insertIndex = Math.max(0, Math.min(index, data.length))\n    } else if (afterRowId) {\n      const afterIndex = data.findIndex((r) => r._id === afterRowId)\n      if (afterIndex !== -1) {\n        insertIndex = afterIndex + 1\n      }\n    } else if (groupId) {\n      // Find last row in group\n      const config = this._state.getConfig()\n      const groupBy = config.groupBy\n      for (let i = data.length - 1; i >= 0; i--) {\n        const rowGroup =\n          typeof groupBy === \"function\" ? groupBy(data[i]) : data[i][groupBy]\n        if (rowGroup === groupId) {\n          insertIndex = i + 1\n          break\n        }\n      }\n\n      // Set group key on new row\n      if (typeof groupBy === \"string\") {\n        newRow[groupBy] = groupId\n      }\n    }\n\n    // Insert row\n    data.splice(insertIndex, 0, newRow)\n\n    // Update indices\n    data.forEach((row, idx) => {\n      row._index = idx\n    })\n\n    this._state.setData(data)\n\n    this._eventBus.emit(TableEvents.ROW_ADD, {\n      row: newRow,\n      index: insertIndex,\n    })\n\n    return newRow\n  }\n\n  /**\n   * Add an info row (informational row)\n   * @param {string} parentRowId - Parent row ID\n   * @param {Object} infoRowData - Info row data\n   * @returns {Object} Added info row\n   */\n  addInfoRow(parentRowId, infoRowData) {\n    return this.addRow(infoRowData, {\n      afterRowId: parentRowId,\n      type: \"infoRow\",\n    })\n  }\n\n  /**\n   * Delete a row\n   * @param {string} rowId - Row ID to delete\n   * @returns {boolean} Success\n   */\n  deleteRow(rowId) {\n    const data = this._state.getData()\n    const rowIndex = data.findIndex((r) => r._id === rowId)\n\n    if (rowIndex === -1) {\n      return false\n    }\n\n    const deletedRow = data[rowIndex]\n    data.splice(rowIndex, 1)\n\n    // Update indices\n    data.forEach((row, idx) => {\n      row._index = idx\n    })\n\n    this._state.setData(data)\n\n    this._eventBus.emit(TableEvents.ROW_DELETE, {\n      rowId,\n      row: deletedRow,\n      index: rowIndex,\n    })\n\n    return true\n  }\n\n  /**\n   * Delete multiple rows\n   * @param {Array<string>} rowIds - Row IDs to delete\n   * @returns {number} Number of deleted rows\n   */\n  deleteRows(rowIds) {\n    let deletedCount = 0\n    const rowIdSet = new Set(rowIds)\n    const data = this._state.getData()\n\n    const filteredData = data.filter((row) => {\n      if (rowIdSet.has(row._id)) {\n        deletedCount++\n        return false\n      }\n      return true\n    })\n\n    if (deletedCount > 0) {\n      // Update indices\n      filteredData.forEach((row, idx) => {\n        row._index = idx\n      })\n\n      this._state.setData(filteredData)\n    }\n\n    return deletedCount\n  }\n\n  /**\n   * Duplicate a row\n   * @param {string} rowId - Row ID to duplicate\n   * @returns {Object|null} Duplicated row\n   */\n  duplicateRow(rowId) {\n    const row = this._state.getRow(rowId)\n    if (!row) return null\n\n    const { _id, _index, ...rowData } = row\n\n    return this.addRow(rowData, {\n      afterRowId: rowId,\n    })\n  }\n\n  /**\n   * Move row to a new position\n   * @param {string} rowId - Row ID to move\n   * @param {number} newIndex - New index\n   * @returns {boolean} Success\n   */\n  moveRow(rowId, newIndex) {\n    const data = this._state.getData()\n    const currentIndex = data.findIndex((r) => r._id === rowId)\n\n    if (currentIndex === -1) return false\n\n    const [movedRow] = data.splice(currentIndex, 1)\n    data.splice(newIndex, 0, movedRow)\n\n    // Update indices\n    data.forEach((row, idx) => {\n      row._index = idx\n    })\n\n    this._state.setData(data)\n\n    return true\n  }\n\n  /**\n   * Get rows by type\n   * @param {string} type - Row type ('data', 'infoRow', 'total', etc.)\n   * @returns {Array<Object>}\n   */\n  getRowsByType(type) {\n    return this._state.getData().filter((row) => row._type === type)\n  }\n\n  /**\n   * Get data rows only (excludes info rows, totals, etc.)\n   * @returns {Array<Object>}\n   */\n  getDataRows() {\n    return this.getRowsByType(\"data\")\n  }\n\n  /**\n   * Get info rows for a parent row\n   * @param {string} parentRowId - Parent row ID\n   * @returns {Array<Object>}\n   */\n  getInfoRows(parentRowId) {\n    const data = this._state.getData()\n    const parentIndex = data.findIndex((r) => r._id === parentRowId)\n\n    if (parentIndex === -1) return []\n\n    const infoRows = []\n    for (let i = parentIndex + 1; i < data.length; i++) {\n      if (data[i]._type === \"infoRow\") {\n        infoRows.push(data[i])\n      } else {\n        break // Info rows are contiguous after parent\n      }\n    }\n\n    return infoRows\n  }\n\n  /**\n   * Setup internal event listeners\n   * @private\n   */\n  _setupListeners() {\n    // No event listeners needed currently\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy() {\n    // Unsubscribe from all event listeners\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\n    this._unsubscribers = []\n  }\n}\n","/**\n * Data Utilities - Functions for data transformation and manipulation\n */\n\nimport { sum, average, min, max, toNumber, groupBy } from \"./helpers.js\"\n\n/**\n * Aggregate functions registry\n */\nexport const AggregateTypes = {\n  SUM: \"sum\",\n  AVG: \"average\",\n  MIN: \"min\",\n  MAX: \"max\",\n  COUNT: \"count\",\n  FIRST: \"first\",\n  LAST: \"last\",\n}\n\n/**\n * Built-in aggregate functions\n */\nexport const aggregates = {\n  [AggregateTypes.SUM]: (values) => sum(values),\n  [AggregateTypes.AVG]: (values) => average(values),\n  [AggregateTypes.MIN]: (values) => min(values),\n  [AggregateTypes.MAX]: (values) => max(values),\n  [AggregateTypes.COUNT]: (values) => values.length,\n  [AggregateTypes.FIRST]: (values) => values[0],\n  [AggregateTypes.LAST]: (values) => values[values.length - 1],\n}\n\n/**\n * Get aggregate function by type\n * @param {string|Function} type - Aggregate type or custom function\n * @returns {Function}\n */\nexport function getAggregateFunction(type) {\n  if (typeof type === \"function\") {\n    return type\n  }\n  return aggregates[type] || aggregates[AggregateTypes.SUM]\n}\n\n/**\n * Calculate group totals for all groups\n * @param {Object} groupedData - Grouped data object\n * @param {Array<Object>} columns - Column definitions\n * @returns {Object} - Groups with totals\n */\nexport function calculateGroupTotals(groupedData, columns) {\n  const result = {}\n\n  Object.entries(groupedData).forEach(([groupKey, rows]) => {\n    const totals = {}\n\n    columns.forEach((column) => {\n      if (column.aggregate) {\n        const values = rows\n          .map((row) => row[column.data])\n          .filter((v) => v !== null && v !== undefined)\n        const aggregateFn = getAggregateFunction(column.aggregate)\n        totals[column.data] = aggregateFn(values, rows)\n      }\n    })\n\n    result[groupKey] = {\n      rows,\n      totals,\n      count: rows.length,\n    }\n  })\n\n  return result\n}\n\n/**\n * Calculate grand totals for all data\n * @param {Array<Object>} data - All data rows\n * @param {Array<Object>} columns - Column definitions\n * @returns {Object} - Grand totals object\n */\nexport function calculateGrandTotals(data, columns) {\n  const totals = {}\n\n  columns.forEach((column) => {\n    if (column.aggregate) {\n      const values = data\n        .filter((row) => row._type === \"data\")\n        .map((row) => row[column.data])\n        .filter((v) => v !== null && v !== undefined)\n\n      const aggregateFn = getAggregateFunction(column.aggregate)\n      totals[column.data] = aggregateFn(values, data)\n    }\n  })\n\n  return totals\n}\n\n/**\n * Calculate cumulative values for a column\n * @param {Array<Object>} data - Data rows\n * @param {string} columnName - Column to calculate cumulative for\n * @param {string} [targetColumn] - Column to store result (defaults to columnName_cumulative)\n * @returns {Array<Object>} - Data with cumulative values\n */\nexport function calculateCumulative(data, columnName, targetColumn = null) {\n  const target = targetColumn || `${columnName}_cumulative`\n  let cumulative = 0\n\n  return data.map((row) => {\n    if (row._type !== \"data\") {\n      return { ...row, [target]: null }\n    }\n\n    cumulative += toNumber(row[columnName])\n    return { ...row, [target]: cumulative }\n  })\n}\n\n/**\n * Calculate percentage of total for each row\n * @param {Array<Object>} data - Data rows\n * @param {string} columnName - Column to calculate percentage for\n * @param {string} [targetColumn] - Column to store result\n * @returns {Array<Object>} - Data with percentage values\n */\nexport function calculatePercentage(data, columnName, targetColumn = null) {\n  const target = targetColumn || `${columnName}_percentage`\n  const total = sum(\n    data.filter((r) => r._type === \"data\").map((r) => toNumber(r[columnName]))\n  )\n\n  return data.map((row) => {\n    if (row._type !== \"data\" || total === 0) {\n      return { ...row, [target]: null }\n    }\n\n    const value = toNumber(row[columnName])\n    return { ...row, [target]: (value / total) * 100 }\n  })\n}\n\n/**\n * Filter data by criteria\n * @param {Array<Object>} data - Data to filter\n * @param {Object|Function} criteria - Filter criteria or function\n * @returns {Array<Object>}\n */\nexport function filterData(data, criteria) {\n  if (typeof criteria === \"function\") {\n    return data.filter(criteria)\n  }\n\n  return data.filter((row) => {\n    return Object.entries(criteria).every(([key, value]) => {\n      if (value === null || value === undefined) return true\n\n      if (typeof value === \"object\" && value !== null) {\n        // Handle comparison operators\n        if (\"$gt\" in value) return row[key] > value.$gt\n        if (\"$gte\" in value) return row[key] >= value.$gte\n        if (\"$lt\" in value) return row[key] < value.$lt\n        if (\"$lte\" in value) return row[key] <= value.$lte\n        if (\"$ne\" in value) return row[key] !== value.$ne\n        if (\"$in\" in value) return value.$in.includes(row[key])\n        if (\"$nin\" in value) return !value.$nin.includes(row[key])\n        if (\"$contains\" in value)\n          return String(row[key])\n            .toLowerCase()\n            .includes(value.$contains.toLowerCase())\n      }\n\n      return row[key] === value\n    })\n  })\n}\n\n/**\n * Flatten nested data structure\n * @param {Array<Object>} data - Data with potential children\n * @param {string} [childrenKey='children'] - Key containing child rows\n * @returns {Array<Object>} - Flat array\n */\nexport function flattenData(data, childrenKey = \"children\") {\n  const result = []\n\n  const flatten = (rows, level = 0, parentId = null) => {\n    rows.forEach((row) => {\n      const { [childrenKey]: children, ...rowData } = row\n\n      result.push({\n        ...rowData,\n        _level: level,\n        _parentId: parentId,\n        _hasChildren: children && children.length > 0,\n      })\n\n      if (children && children.length > 0) {\n        flatten(children, level + 1, row._id || row.id)\n      }\n    })\n  }\n\n  flatten(data)\n  return result\n}\n\n/**\n * Build tree structure from flat data\n * @param {Array<Object>} data - Flat data array\n * @param {string} [parentKey='parentId'] - Parent ID key\n * @returns {Array<Object>} - Tree structure\n */\nexport function buildTree(data, parentKey = \"parentId\") {\n  const map = new Map()\n  const roots = []\n\n  // Create map of all items\n  data.forEach((item) => {\n    map.set(item._id || item.id, { ...item, children: [] })\n  })\n\n  // Build tree\n  data.forEach((item) => {\n    const node = map.get(item._id || item.id)\n    const parentId = item[parentKey]\n\n    if (parentId && map.has(parentId)) {\n      map.get(parentId).children.push(node)\n    } else {\n      roots.push(node)\n    }\n  })\n\n  return roots\n}\n\n/**\n * Transform data for export\n * @param {Array<Object>} data - Data to transform\n * @param {Array<Object>} columns - Column definitions\n * @param {Object} [options] - Transform options\n * @returns {Array<Object>} - Transformed data\n */\nexport function transformForExport(data, columns, options = {}) {\n  const {\n    includeHidden = false,\n    formatValues = true,\n    excludeTypes = [\"infoRow\"],\n  } = options\n\n  const visibleColumns = columns.filter(\n    (col) => includeHidden || col.visible !== false\n  )\n\n  return data\n    .filter((row) => !excludeTypes.includes(row._type))\n    .map((row) => {\n      const transformed = {}\n\n      visibleColumns.forEach((column) => {\n        let value = row[column.data]\n\n        if (formatValues && column.format) {\n          value = column.format(value, row, column)\n        } else if (\n          formatValues &&\n          column.type === \"number\" &&\n          column.decimals !== undefined\n        ) {\n          value = toNumber(value).toFixed(column.decimals)\n        }\n\n        transformed[column.title || column.data] = value\n      })\n\n      return transformed\n    })\n}\n\n/**\n * Validate data against column definitions\n * @param {Array<Object>} data - Data to validate\n * @param {Array<Object>} columns - Column definitions\n * @returns {{valid: boolean, errors: Array<Object>}}\n */\nexport function validateData(data, columns) {\n  const errors = []\n\n  data.forEach((row, rowIndex) => {\n    columns.forEach((column) => {\n      if (\n        column.required &&\n        (row[column.data] === null ||\n          row[column.data] === undefined ||\n          row[column.data] === \"\")\n      ) {\n        errors.push({\n          rowIndex,\n          rowId: row._id,\n          column: column.data,\n          type: \"required\",\n          message: `${column.title || column.data} is required`,\n        })\n      }\n\n      if (\n        column.validator &&\n        row[column.data] !== null &&\n        row[column.data] !== undefined\n      ) {\n        const validationResult = column.validator(row[column.data], row, column)\n        if (validationResult !== true) {\n          errors.push({\n            rowIndex,\n            rowId: row._id,\n            column: column.data,\n            type: \"validation\",\n            message:\n              validationResult ||\n              `Invalid value for ${column.title || column.data}`,\n          })\n        }\n      }\n\n      if (\n        column.type === \"number\" &&\n        row[column.data] !== null &&\n        row[column.data] !== undefined\n      ) {\n        const numValue = toNumber(row[column.data], NaN)\n        if (isNaN(numValue)) {\n          errors.push({\n            rowIndex,\n            rowId: row._id,\n            column: column.data,\n            type: \"type\",\n            message: `${column.title || column.data} must be a number`,\n          })\n        } else {\n          if (column.min !== undefined && numValue < column.min) {\n            errors.push({\n              rowIndex,\n              rowId: row._id,\n              column: column.data,\n              type: \"range\",\n              message: `${column.title || column.data} must be at least ${\n                column.min\n              }`,\n            })\n          }\n          if (column.max !== undefined && numValue > column.max) {\n            errors.push({\n              rowIndex,\n              rowId: row._id,\n              column: column.data,\n              type: \"range\",\n              message: `${column.title || column.data} must be at most ${\n                column.max\n              }`,\n            })\n          }\n        }\n      }\n    })\n  })\n\n  return {\n    valid: errors.length === 0,\n    errors,\n  }\n}\n","/**\n * GroupManager - Handles row grouping operations\n *\n * Manages group creation, expansion/collapse, and group totals.\n */\n\nimport { TableEvents } from \"../core/EventBus.js\"\nimport { calculateGroupTotals, calculateGrandTotals } from \"../utils/data.js\"\nimport { sum, average, min, max } from \"../utils/helpers.js\"\n\nexport class GroupManager {\n  /**\n   * @param {TableState} state - Table state instance\n   * @param {EventBus} eventBus - Event bus instance\n   */\n  constructor(state, eventBus) {\n    this._state = state\n    this._eventBus = eventBus\n\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\n    this._unsubscribers = []\n\n    // Setup event listeners\n    this._setupListeners()\n\n    // Calculate initial totals if grouping is enabled\n    if (this._state.getConfig().enableGrouping) {\n      this.recalculateTotals()\n    }\n\n    // Calculate initial row totals if enabled\n    if (this._state.getConfig().enableRowTotals) {\n      this.recalculateRowTotals()\n    }\n  }\n\n  /**\n   * Calculate row total (sum of all numeric columns with aggregate) for a single row\n   * @param {Object} row - Row data\n   * @returns {number} Row total\n   */\n  calculateRowTotal(row) {\n    const columns = this._state.getColumns()\n    let total = 0\n\n    columns.forEach((column) => {\n      // Only sum columns that have aggregate defined (indicating they're numeric summable columns)\n      if (column.aggregate && column.data !== \"_rowTotal\") {\n        const value = row[column.data]\n        if (value !== null && value !== undefined && !isNaN(value)) {\n          total += Number(value)\n        }\n      }\n    })\n\n    return total\n  }\n\n  /**\n   * Recalculate row totals for all data rows\n   */\n  recalculateRowTotals() {\n    const config = this._state.getConfig()\n    if (!config.enableRowTotals) return\n\n    const data = this._state._state.data\n\n    data.forEach((row) => {\n      if (row._type === \"data\") {\n        row._rowTotal = this.calculateRowTotal(row)\n      }\n    })\n  }\n\n  /**\n   * Update row total for a specific row\n   * @param {string} rowId - Row identifier\n   */\n  updateRowTotal(rowId) {\n    const config = this._state.getConfig()\n    if (!config.enableRowTotals) return\n\n    const data = this._state._state.data\n    const row = data.find((r) => r._id === rowId)\n\n    if (row && row._type === \"data\") {\n      const oldTotal = row._rowTotal\n      row._rowTotal = this.calculateRowTotal(row)\n\n      // Emit event so TableRenderer can update the cell\n      if (oldTotal !== row._rowTotal) {\n        this._eventBus.emit(TableEvents.ROW_TOTAL_CHANGE, {\n          rowId,\n          oldValue: oldTotal,\n          newValue: row._rowTotal,\n        })\n      }\n    }\n  }\n\n  /**\n   * Get group information by ID\n   * @param {string} groupId - Group identifier\n   * @returns {Object|null}\n   */\n  getGroup(groupId) {\n    const groupedData = this._state.getGroupedData()\n    return groupedData ? groupedData[groupId] : null\n  }\n\n  /**\n   * Get all group IDs\n   * @returns {Array<string>}\n   */\n  getGroupIds() {\n    const groupedData = this._state.getGroupedData()\n    return groupedData ? Object.keys(groupedData) : []\n  }\n\n  /**\n   * Get rows in a specific group\n   * @param {string} groupId - Group identifier\n   * @returns {Array<Object>}\n   */\n  getGroupRows(groupId) {\n    const group = this.getGroup(groupId)\n    return group ? group.rows : []\n  }\n\n  /**\n   * Get group totals\n   * @param {string} groupId - Group identifier\n   * @returns {Object}\n   */\n  getGroupTotals(groupId) {\n    const group = this.getGroup(groupId)\n    return group ? group.totals : {}\n  }\n\n  /**\n   * Calculate and update group totals\n   * @param {string} [groupId] - Specific group, or all if not provided\n   */\n  recalculateTotals(groupId = null) {\n    const groupedData = this._state.getGroupedData()\n    const columns = this._state.getColumns()\n    const config = this._state.getConfig()\n\n    if (!groupedData) return\n\n    const groupsToUpdate = groupId\n      ? [groupId].filter((id) => groupedData[id])\n      : Object.keys(groupedData)\n\n    groupsToUpdate.forEach((gId) => {\n      const group = groupedData[gId]\n      const totals = {}\n\n      // Filter to only data rows (exclude infoRows and other special types)\n      const dataRows = group.rows.filter((row) => row._type === \"data\")\n\n      columns.forEach((column) => {\n        if (column.aggregate && column.data !== \"_rowTotal\") {\n          const values = dataRows\n            .map((row) => row[column.data])\n            .filter((v) => v !== null && v !== undefined && !isNaN(v))\n\n          totals[column.data] = this._calculateAggregate(\n            column.aggregate,\n            values,\n            dataRows\n          )\n        }\n      })\n\n      // Calculate row total for the group header (sum of all aggregated column totals)\n      if (config.enableRowTotals) {\n        let groupRowTotal = 0\n        columns.forEach((column) => {\n          if (\n            column.aggregate &&\n            column.data !== \"_rowTotal\" &&\n            totals[column.data] !== undefined\n          ) {\n            groupRowTotal += totals[column.data]\n          }\n        })\n        totals._rowTotal = groupRowTotal\n      }\n\n      group.totals = totals\n    })\n\n    this._eventBus.emit(TableEvents.STATE_CHANGE, {\n      property: \"groupTotals\",\n      groupId,\n    })\n  }\n\n  /**\n   * Get grand totals (across all groups)\n   * @returns {Object}\n   */\n  getGrandTotals() {\n    const data = this._state.getData().filter((r) => r._type === \"data\")\n    const columns = this._state.getColumns()\n\n    return calculateGrandTotals(data, columns)\n  }\n\n  /**\n   * Toggle group expansion\n   * @param {string} groupId - Group identifier\n   * @returns {boolean} New collapsed state\n   */\n  toggle(groupId) {\n    this._state.toggleGroup(groupId)\n    return this._state.isGroupCollapsed(groupId)\n  }\n\n  /**\n   * Expand a specific group\n   * @param {string} groupId - Group identifier\n   */\n  expand(groupId) {\n    if (this._state.isGroupCollapsed(groupId)) {\n      this._state.toggleGroup(groupId)\n    }\n  }\n\n  /**\n   * Collapse a specific group\n   * @param {string} groupId - Group identifier\n   */\n  collapse(groupId) {\n    if (!this._state.isGroupCollapsed(groupId)) {\n      this._state.toggleGroup(groupId)\n    }\n  }\n\n  /**\n   * Expand all groups\n   */\n  expandAll() {\n    this._state.expandAllGroups()\n  }\n\n  /**\n   * Collapse all groups\n   */\n  collapseAll() {\n    this._state.collapseAllGroups()\n  }\n\n  /**\n   * Check if group is collapsed\n   * @param {string} groupId - Group identifier\n   * @returns {boolean}\n   */\n  isCollapsed(groupId) {\n    return this._state.isGroupCollapsed(groupId)\n  }\n\n  /**\n   * Get expansion state of all groups\n   * @returns {Object<string, boolean>}\n   */\n  getExpansionState() {\n    const groupIds = this.getGroupIds()\n    const state = {}\n\n    groupIds.forEach((id) => {\n      state[id] = !this._state.isGroupCollapsed(id)\n    })\n\n    return state\n  }\n\n  /**\n   * Set expansion state for all groups\n   * @param {Object<string, boolean>} state - Expansion state map\n   */\n  setExpansionState(state) {\n    Object.entries(state).forEach(([groupId, expanded]) => {\n      if (expanded) {\n        this.expand(groupId)\n      } else {\n        this.collapse(groupId)\n      }\n    })\n  }\n\n  /**\n   * Move row to a different group\n   * @param {string} rowId - Row ID to move\n   * @param {string} targetGroupId - Target group ID\n   */\n  moveRowToGroup(rowId, targetGroupId) {\n    const config = this._state.getConfig()\n    const groupBy = config.groupBy\n\n    if (typeof groupBy !== \"string\") {\n      console.warn(\"Cannot move row when groupBy is a function\")\n      return\n    }\n\n    this._state.updateCell(rowId, groupBy, targetGroupId)\n    this.recalculateTotals()\n  }\n\n  /**\n   * Get group statistics\n   * @param {string} groupId - Group identifier\n   * @returns {Object}\n   */\n  getGroupStats(groupId) {\n    const group = this.getGroup(groupId)\n    if (!group) return null\n\n    const columns = this._state.getColumns()\n    const stats = {\n      rowCount: group.rows.length,\n      columns: {},\n    }\n\n    columns.forEach((column) => {\n      if (column.type === \"number\") {\n        const values = group.rows\n          .map((row) => row[column.data])\n          .filter((v) => v !== null && v !== undefined && !isNaN(v))\n\n        stats.columns[column.data] = {\n          sum: sum(values),\n          average: average(values),\n          min: min(values),\n          max: max(values),\n          count: values.length,\n        }\n      }\n    })\n\n    return stats\n  }\n\n  /**\n   * Calculate aggregate value\n   * @private\n   */\n  _calculateAggregate(aggregateType, values, rows) {\n    if (typeof aggregateType === \"function\") {\n      return aggregateType(values, rows)\n    }\n\n    switch (aggregateType) {\n      case \"sum\":\n        return sum(values)\n      case \"average\":\n      case \"avg\":\n        return average(values)\n      case \"min\":\n        return min(values)\n      case \"max\":\n        return max(values)\n      case \"count\":\n        return values.length\n      case \"first\":\n        return values[0]\n      case \"last\":\n        return values[values.length - 1]\n      default:\n        return sum(values)\n    }\n  }\n\n  /**\n   * Setup internal event listeners\n   * @private\n   */\n  _setupListeners() {\n    // Recalculate totals when cells change\n    this._unsubscribers.push(\n      this._eventBus.on(TableEvents.CELL_CHANGE, ({ rowId, columnName }) => {\n        const column = this._state.getColumn(columnName)\n        const config = this._state.getConfig()\n\n        // Update row total for this row if enabled\n        if (config.enableRowTotals && column && column.aggregate) {\n          this.updateRowTotal(rowId)\n        }\n\n        // Update group totals if grouping is enabled\n        if (column && column.aggregate && config.enableGrouping) {\n          // Find which group this row belongs to\n          const row = this._state.getRow(rowId)\n          if (row) {\n            const groupBy = config.groupBy\n            const groupId =\n              typeof groupBy === \"function\" ? groupBy(row) : row[groupBy]\n            this.recalculateTotals(groupId)\n          }\n        }\n      })\n    )\n\n    // Recalculate all totals when data changes\n    this._unsubscribers.push(\n      this._eventBus.on(TableEvents.DATA_CHANGE, () => {\n        const config = this._state.getConfig()\n\n        if (config.enableRowTotals) {\n          this.recalculateRowTotals()\n        }\n\n        if (config.enableGrouping) {\n          this.recalculateTotals()\n        }\n      })\n    )\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy() {\n    // Unsubscribe from all event listeners\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\n    this._unsubscribers = []\n  }\n}\n","/**\r\n * EditManager - Handles edit mode operations\r\n *\r\n * Manages view/edit mode switching, keyboard navigation,\r\n * and cell editing behavior.\r\n */\r\n\r\nimport { TableEvents } from \"../core/EventBus.js\"\r\nimport { addClass, removeClass, $ } from \"../utils/dom.js\"\r\n\r\nexport class EditManager {\r\n  /**\r\n   * @param {TableState} state - Table state instance\r\n   * @param {EventBus} eventBus - Event bus instance\r\n   * @param {TableRenderer} renderer - Table renderer instance\r\n   */\r\n  constructor(state, eventBus, renderer) {\r\n    this._state = state\r\n    this._eventBus = eventBus\r\n    this._renderer = renderer\r\n\r\n    /** @type {{rowId: string, columnName: string}|null} */\r\n    this._focusedCell = null\r\n\r\n    /** @type {boolean} */\r\n    this._isEditing = false\r\n\r\n    /** @type {Array<Function>} - Unsubscribe functions for cleanup */\r\n    this._unsubscribers = []\r\n\r\n    // Setup event listeners\r\n    this._setupListeners()\r\n  }\r\n\r\n  /**\r\n   * Enter edit mode\r\n   */\r\n  enterEditMode() {\r\n    this._state.setMode(\"edit\")\r\n  }\r\n\r\n  /**\r\n   * Enter view mode\r\n   */\r\n  enterViewMode() {\r\n    this._state.setMode(\"view\")\r\n    this._focusedCell = null\r\n  }\r\n\r\n  /**\r\n   * Toggle between modes\r\n   * @returns {'view'|'edit'} New mode\r\n   */\r\n  toggleMode() {\r\n    const currentMode = this._state.getMode()\r\n    const newMode = currentMode === \"view\" ? \"edit\" : \"view\"\r\n    this._state.setMode(newMode)\r\n    return newMode\r\n  }\r\n\r\n  /**\r\n   * Check if currently in edit mode\r\n   * @returns {boolean}\r\n   */\r\n  isEditMode() {\r\n    return this._state.isEditMode()\r\n  }\r\n\r\n  /**\r\n   * Focus a specific cell\r\n   * @param {string} rowId - Row identifier\r\n   * @param {string} columnName - Column name\r\n   */\r\n  focusCell(rowId, columnName) {\r\n    this._focusedCell = { rowId, columnName }\r\n\r\n    // If in edit mode, focus the input\r\n    if (this._state.isEditMode()) {\r\n      const cell = this._renderer.getCellElement(rowId, columnName)\r\n      if (cell) {\r\n        const input = cell.querySelector(\".dg-cell-input\")\r\n        if (input) {\r\n          input.focus()\r\n          if (input.select) {\r\n            input.select()\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this._eventBus.emit(TableEvents.CELL_FOCUS, {\r\n      rowId,\r\n      columnName,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Get currently focused cell\r\n   * @returns {{rowId: string, columnName: string}|null}\r\n   */\r\n  getFocusedCell() {\r\n    return this._focusedCell\r\n  }\r\n\r\n  /**\r\n   * Move focus to adjacent cell\r\n   * @param {'up'|'down'|'left'|'right'} direction - Direction to move\r\n   */\r\n  moveFocus(direction) {\r\n    if (!this._focusedCell) return\r\n\r\n    const { rowId, columnName } = this._focusedCell\r\n    const data = this._state.getData()\r\n    const columns = this._state.getColumns().filter((c) => c.visible !== false)\r\n\r\n    const rowIndex = data.findIndex((r) => r._id === rowId)\r\n    const colIndex = columns.findIndex((c) => c.data === columnName)\r\n\r\n    if (rowIndex === -1 || colIndex === -1) return\r\n\r\n    let newRowIndex = rowIndex\r\n    let newColIndex = colIndex\r\n\r\n    switch (direction) {\r\n      case \"up\":\r\n        newRowIndex = Math.max(0, rowIndex - 1)\r\n        break\r\n      case \"down\":\r\n        newRowIndex = Math.min(data.length - 1, rowIndex + 1)\r\n        break\r\n      case \"left\":\r\n        newColIndex = Math.max(0, colIndex - 1)\r\n        break\r\n      case \"right\":\r\n        newColIndex = Math.min(columns.length - 1, colIndex + 1)\r\n        break\r\n    }\r\n\r\n    // Skip non-editable rows (like totals) when moving vertically\r\n    if (direction === \"up\" || direction === \"down\") {\r\n      const targetRow = data[newRowIndex]\r\n      if (targetRow && targetRow._type !== \"data\") {\r\n        // Try to skip to next valid row\r\n        const step = direction === \"up\" ? -1 : 1\r\n        while (newRowIndex >= 0 && newRowIndex < data.length) {\r\n          if (data[newRowIndex]._type === \"data\") break\r\n          newRowIndex += step\r\n        }\r\n\r\n        // Clamp to valid range\r\n        newRowIndex = Math.max(0, Math.min(data.length - 1, newRowIndex))\r\n      }\r\n    }\r\n\r\n    const newRow = data[newRowIndex]\r\n    const newColumn = columns[newColIndex]\r\n\r\n    if (newRow && newColumn) {\r\n      this.focusCell(newRow._id, newColumn.data)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start editing current cell (for inline edit on click)\r\n   */\r\n  startEditing() {\r\n    if (!this._focusedCell || !this._state.isEditMode()) return\r\n\r\n    this._isEditing = true\r\n    const { rowId, columnName } = this._focusedCell\r\n\r\n    const cell = this._renderer.getCellElement(rowId, columnName)\r\n    if (cell) {\r\n      addClass(cell, \"dg-cell-editing\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop editing current cell\r\n   */\r\n  stopEditing() {\r\n    if (!this._focusedCell) return\r\n\r\n    this._isEditing = false\r\n    const { rowId, columnName } = this._focusedCell\r\n\r\n    const cell = this._renderer.getCellElement(rowId, columnName)\r\n    if (cell) {\r\n      removeClass(cell, \"dg-cell-editing\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if currently editing a cell\r\n   * @returns {boolean}\r\n   */\r\n  isEditing() {\r\n    return this._isEditing\r\n  }\r\n\r\n  /**\r\n   * Cancel current edit and revert value\r\n   */\r\n  cancelEdit() {\r\n    if (!this._focusedCell || !this._isEditing) return\r\n\r\n    const { rowId, columnName } = this._focusedCell\r\n    const originalData = this._state._state.originalData\r\n    const originalRow = originalData.find((r) => r._id === rowId)\r\n\r\n    if (originalRow) {\r\n      this._state.updateCell(rowId, columnName, originalRow[columnName])\r\n    }\r\n\r\n    this.stopEditing()\r\n  }\r\n\r\n  /**\r\n   * Commit current edit\r\n   */\r\n  commitEdit() {\r\n    if (!this._focusedCell || !this._isEditing) return\r\n\r\n    const { rowId, columnName } = this._focusedCell\r\n    const cell = this._renderer.getCellElement(rowId, columnName)\r\n\r\n    if (cell) {\r\n      const input = cell.querySelector(\".dg-cell-input\")\r\n      if (input) {\r\n        // Trigger change event\r\n        input.dispatchEvent(new Event(\"change\", { bubbles: true }))\r\n      }\r\n    }\r\n\r\n    this.stopEditing()\r\n  }\r\n\r\n  /**\r\n   * Setup keyboard navigation\r\n   * @private\r\n   */\r\n  _setupListeners() {\r\n    // Handle keyboard navigation\r\n    document.addEventListener(\"keydown\", (e) => {\r\n      if (!this._state.isEditMode()) return\r\n\r\n      switch (e.key) {\r\n        case \"Tab\":\r\n          e.preventDefault()\r\n          this.moveFocus(e.shiftKey ? \"left\" : \"right\")\r\n          break\r\n\r\n        case \"Enter\":\r\n          if (this._isEditing) {\r\n            e.preventDefault()\r\n            this.commitEdit()\r\n            this.moveFocus(\"down\")\r\n          }\r\n          break\r\n\r\n        case \"Escape\":\r\n          if (this._isEditing) {\r\n            e.preventDefault()\r\n            this.cancelEdit()\r\n          }\r\n          break\r\n\r\n        case \"ArrowUp\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"up\")\r\n          }\r\n          break\r\n\r\n        case \"ArrowDown\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"down\")\r\n          }\r\n          break\r\n\r\n        case \"ArrowLeft\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"left\")\r\n          }\r\n          break\r\n\r\n        case \"ArrowRight\":\r\n          if (!this._isEditing || e.ctrlKey) {\r\n            e.preventDefault()\r\n            this.moveFocus(\"right\")\r\n          }\r\n          break\r\n      }\r\n    })\r\n\r\n    // Track cell focus\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.CELL_FOCUS, ({ rowId, columnName }) => {\r\n        this._focusedCell = { rowId, columnName }\r\n      })\r\n    )\r\n\r\n    // Track cell blur\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.CELL_BLUR, () => {\r\n        this._isEditing = false\r\n      })\r\n    )\r\n\r\n    // Clear focus when mode changes to view\r\n    this._unsubscribers.push(\r\n      this._eventBus.on(TableEvents.MODE_CHANGE, ({ newMode }) => {\r\n        if (newMode === \"view\") {\r\n          this._focusedCell = null\r\n          this._isEditing = false\r\n        }\r\n      })\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy() {\r\n    // Unsubscribe from all event listeners\r\n    this._unsubscribers.forEach((unsubscribe) => unsubscribe())\r\n    this._unsubscribers = []\r\n\r\n    this._focusedCell = null\r\n    this._isEditing = false\r\n  }\r\n}\r\n","/**\n * ExportManager - Handles data export operations\n *\n * Exports table data to CSV and Excel formats.\n */\n\nimport { TableEvents } from \"../core/EventBus.js\"\nimport { transformForExport } from \"../utils/data.js\"\n\nexport class ExportManager {\n  /**\n   * @param {TableState} state - Table state instance\n   * @param {EventBus} eventBus - Event bus instance\n   */\n  constructor(state, eventBus) {\n    this._state = state\n    this._eventBus = eventBus\n  }\n\n  /**\n   * Export to CSV string\n   * @param {Object} [options] - Export options\n   * @param {string} [options.delimiter=','] - Field delimiter\n   * @param {boolean} [options.includeHeaders=true] - Include header row\n   * @param {boolean} [options.includeHidden=false] - Include hidden columns\n   * @param {Array<string>} [options.columns] - Specific columns to export\n   * @param {Function} [options.filter] - Row filter function\n   * @returns {string} CSV string\n   */\n  toCSV(options = {}) {\n    const {\n      delimiter = \",\",\n      includeHeaders = true,\n      includeHidden = false,\n      columns: columnFilter = null,\n      filter = null,\n    } = options\n\n    this._eventBus.emit(TableEvents.EXPORT_START, { format: \"csv\" })\n\n    let data = this._state.getData()\n    let columns = this._state.getColumns()\n\n    // Filter columns\n    if (columnFilter) {\n      columns = columns.filter((col) => columnFilter.includes(col.data))\n    } else if (!includeHidden) {\n      columns = columns.filter((col) => col.visible !== false)\n    }\n\n    // Filter rows\n    if (filter) {\n      data = data.filter(filter)\n    }\n\n    // Build CSV\n    const rows = []\n\n    // Header row\n    if (includeHeaders) {\n      const headerRow = columns.map((col) =>\n        this._escapeCSV(col.title || col.data, delimiter)\n      )\n      rows.push(headerRow.join(delimiter))\n    }\n\n    // Data rows\n    data.forEach((row) => {\n      if (row._type !== \"data\" && row._type !== \"infoRow\") return\n\n      const csvRow = columns.map((col) => {\n        let value = row[col.data]\n\n        // Format value if formatter exists\n        if (col.exportFormat) {\n          value = col.exportFormat(value, row, col)\n        } else if (col.format) {\n          value = col.format(value, row, col)\n        }\n\n        return this._escapeCSV(value, delimiter)\n      })\n\n      rows.push(csvRow.join(delimiter))\n    })\n\n    const csvString = rows.join(\"\\n\")\n\n    this._eventBus.emit(TableEvents.EXPORT_COMPLETE, {\n      format: \"csv\",\n      rowCount: rows.length - (includeHeaders ? 1 : 0),\n    })\n\n    return csvString\n  }\n\n  /**\n   * Export to Excel-compatible format (simplified XLSX-like)\n   * For full XLSX support, integrate with SheetJS\n   * @param {Object} [options] - Export options\n   * @returns {Object} Excel data structure\n   */\n  toExcel(options = {}) {\n    const {\n      sheetName = \"Sheet1\",\n      includeHeaders = true,\n      includeHidden = false,\n      columns: columnFilter = null,\n      filter = null,\n    } = options\n\n    this._eventBus.emit(TableEvents.EXPORT_START, { format: \"excel\" })\n\n    let data = this._state.getData()\n    let columns = this._state.getColumns()\n\n    // Filter columns\n    if (columnFilter) {\n      columns = columns.filter((col) => columnFilter.includes(col.data))\n    } else if (!includeHidden) {\n      columns = columns.filter((col) => col.visible !== false)\n    }\n\n    // Filter rows\n    if (filter) {\n      data = data.filter(filter)\n    }\n\n    // Build Excel data structure\n    const worksheetData = []\n\n    // Header row\n    if (includeHeaders) {\n      worksheetData.push(columns.map((col) => col.title || col.data))\n    }\n\n    // Data rows\n    data.forEach((row) => {\n      if (row._type !== \"data\" && row._type !== \"infoRow\") return\n\n      const excelRow = columns.map((col) => {\n        let value = row[col.data]\n\n        // Keep numbers as numbers for Excel\n        if (col.type === \"number\" && typeof value === \"number\") {\n          return value\n        }\n\n        // Format other values\n        if (col.exportFormat) {\n          value = col.exportFormat(value, row, col)\n        }\n\n        return value\n      })\n\n      worksheetData.push(excelRow)\n    })\n\n    const result = {\n      sheets: [\n        {\n          name: sheetName,\n          data: worksheetData,\n          columns: columns.map((col) => ({\n            width: col.width || 100,\n            type: col.type || \"string\",\n          })),\n        },\n      ],\n    }\n\n    this._eventBus.emit(TableEvents.EXPORT_COMPLETE, {\n      format: \"excel\",\n      rowCount: worksheetData.length - (includeHeaders ? 1 : 0),\n    })\n\n    return result\n  }\n\n  /**\n   * Download export as file\n   * @param {'csv'|'excel'} format - Export format\n   * @param {string} [filename] - File name (without extension)\n   * @param {Object} [options] - Export options\n   */\n  download(format, filename = \"table-export\", options = {}) {\n    if (format === \"csv\") {\n      this._downloadCSV(filename, options)\n    } else if (format === \"excel\") {\n      this._downloadExcel(filename, options)\n    }\n  }\n\n  /**\n   * Download as CSV file\n   * @private\n   */\n  _downloadCSV(filename, options) {\n    const csv = this.toCSV(options)\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" })\n    this._downloadBlob(blob, `${filename}.csv`)\n  }\n\n  /**\n   * Download as Excel file (using CSV with .xls extension for basic support)\n   * For full XLSX support, integrate with SheetJS\n   * @private\n   */\n  _downloadExcel(filename, options) {\n    // Basic Excel export using tab-delimited format\n    const csv = this.toCSV({ ...options, delimiter: \"\\t\" })\n    const blob = new Blob([csv], {\n      type: \"application/vnd.ms-excel;charset=utf-8;\",\n    })\n    this._downloadBlob(blob, `${filename}.xls`)\n  }\n\n  /**\n   * Download blob as file\n   * @private\n   */\n  _downloadBlob(blob, filename) {\n    const link = document.createElement(\"a\")\n\n    if (link.download !== undefined) {\n      const url = URL.createObjectURL(blob)\n      link.setAttribute(\"href\", url)\n      link.setAttribute(\"download\", filename)\n      link.style.visibility = \"hidden\"\n      document.body.appendChild(link)\n      link.click()\n      document.body.removeChild(link)\n      URL.revokeObjectURL(url)\n    }\n  }\n\n  /**\n   * Escape value for CSV\n   * @private\n   */\n  _escapeCSV(value, delimiter = \",\") {\n    if (value === null || value === undefined) {\n      return \"\"\n    }\n\n    const stringValue = String(value)\n\n    // Check if escaping is needed\n    if (\n      stringValue.includes(delimiter) ||\n      stringValue.includes('\"') ||\n      stringValue.includes(\"\\n\") ||\n      stringValue.includes(\"\\r\")\n    ) {\n      // Escape double quotes and wrap in quotes\n      return `\"${stringValue.replace(/\"/g, '\"\"')}\"`\n    }\n\n    return stringValue\n  }\n\n  /**\n   * Get export preview (first N rows)\n   * @param {number} [rowCount=5] - Number of rows to preview\n   * @param {'csv'|'excel'} [format='csv'] - Format to preview\n   * @returns {string|Object}\n   */\n  preview(rowCount = 5, format = \"csv\") {\n    const data = this._state.getData().slice(0, rowCount)\n    const columns = this._state.getColumns().filter((c) => c.visible !== false)\n\n    if (format === \"csv\") {\n      // Build preview CSV\n      const headers = columns.map((c) => c.title || c.data).join(\",\")\n      const rows = data.map((row) =>\n        columns.map((col) => this._escapeCSV(row[col.data])).join(\",\")\n      )\n      return [headers, ...rows].join(\"\\n\")\n    }\n\n    return {\n      headers: columns.map((c) => c.title || c.data),\n      rows: data.map((row) => columns.map((col) => row[col.data])),\n    }\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy() {\n    // Nothing specific to cleanup\n  }\n}\n","/**\r\n * ThemeManager - Handles theme customization\r\n *\r\n * Allows users to customize table colors through configuration.\r\n * Falls back to default CSS variables if not specified.\r\n */\r\n\r\nexport class ThemeManager {\r\n  /**\r\n   * @param {HTMLElement} container - Table container element\r\n   * @param {Object} [theme] - Theme configuration\r\n   */\r\n  constructor(container, theme = {}) {\r\n    this._container = container\r\n\r\n    /** @type {Object} Default theme */\r\n    this._defaultTheme = {\r\n      // Row colors\r\n      rowEven: null, // Falls back to --dg-color-bg-alt\r\n      rowOdd: null, // Falls back to --dg-color-bg\r\n      rowHover: null, // Falls back to --dg-color-bg-hover\r\n      rowSelected: null, // Falls back to --dg-color-bg-selected\r\n\r\n      // Border colors\r\n      borderLight: null, // Falls back to --dg-color-border\r\n      borderStrong: null, // Falls back to --dg-color-border-strong\r\n\r\n      // Header colors\r\n      headerBackground: null, // Falls back to --dg-color-bg-alt\r\n      headerText: null, // Falls back to --dg-color-text\r\n\r\n      // Cell colors\r\n      cellBackground: null, // Falls back to --dg-color-bg\r\n      cellText: null, // Falls back to --dg-color-text\r\n\r\n      // Sticky/Fixed column colors\r\n      fixedBackground: null, // Inherits from row\r\n      fixedShadow: null, // Falls back to --dg-shadow-fixed\r\n      fixedBorderColor: null, // Falls back to --dg-fixed-border-color\r\n      fixedBorderWidth: null, // Falls back to --dg-fixed-border-width\r\n\r\n      // Interactive colors\r\n      primary: null, // Falls back to --dg-color-primary\r\n      primaryHover: null, // Falls back to --dg-color-primary-hover\r\n\r\n      // Status colors\r\n      success: null, // Falls back to --dg-color-success\r\n      warning: null, // Falls back to --dg-color-warning\r\n      error: null, // Falls back to --dg-color-error\r\n\r\n      // Row totals column colors\r\n      rowTotalBackground: null, // Falls back to --dg-row-total-bg\r\n      rowTotalBackgroundAlt: null, // Falls back to --dg-row-total-bg-alt\r\n      rowTotalText: null, // Falls back to --dg-row-total-text\r\n      rowTotalHeaderBackground: null, // Falls back to --dg-row-total-header-bg\r\n      rowTotalBorderColor: null, // Falls back to --dg-row-total-border-color\r\n\r\n      // Ungrouped rows colors\r\n      ungroupedRowBackground: null, // Falls back to --dg-ungrouped-row-bg\r\n      ungroupedRowBackgroundAlt: null, // Falls back to --dg-ungrouped-row-bg-alt\r\n      ungroupedRowBackgroundHover: null, // Falls back to --dg-ungrouped-row-bg-hover\r\n      ungroupedRowText: null, // Falls back to --dg-ungrouped-row-text\r\n    }\r\n\r\n    this._theme = { ...this._defaultTheme, ...theme }\r\n    this._applyTheme()\r\n  }\r\n\r\n  /**\r\n   * Resolve a theme value - if it starts with '--', wrap it in var()\r\n   * This allows passing CSS variable names like '--bc-c-primary-500'\r\n   * @private\r\n   * @param {string} value - The theme value\r\n   * @returns {string} - Resolved value (wrapped in var() if CSS variable)\r\n   */\r\n  _resolveValue(value) {\r\n    if (!value) return value\r\n    // If value starts with '--', it's a CSS variable reference\r\n    if (typeof value === \"string\" && value.startsWith(\"--\")) {\r\n      return `var(${value})`\r\n    }\r\n    return value\r\n  }\r\n\r\n  /**\r\n   * Apply theme to container\r\n   * @private\r\n   */\r\n  _applyTheme() {\r\n    const style = this._container.style\r\n\r\n    // Row colors\r\n    if (this._theme.rowEven) {\r\n      style.setProperty(\r\n        \"--dg-color-bg-alt\",\r\n        this._resolveValue(this._theme.rowEven)\r\n      )\r\n    }\r\n    if (this._theme.rowOdd) {\r\n      style.setProperty(\"--dg-color-bg\", this._resolveValue(this._theme.rowOdd))\r\n    }\r\n    if (this._theme.rowHover) {\r\n      style.setProperty(\r\n        \"--dg-color-bg-hover\",\r\n        this._resolveValue(this._theme.rowHover)\r\n      )\r\n    }\r\n    if (this._theme.rowSelected) {\r\n      style.setProperty(\r\n        \"--dg-color-bg-selected\",\r\n        this._resolveValue(this._theme.rowSelected)\r\n      )\r\n    }\r\n\r\n    // Border colors\r\n    if (this._theme.borderLight) {\r\n      style.setProperty(\r\n        \"--dg-color-border\",\r\n        this._resolveValue(this._theme.borderLight)\r\n      )\r\n    }\r\n    if (this._theme.borderStrong) {\r\n      style.setProperty(\r\n        \"--dg-color-border-strong\",\r\n        this._resolveValue(this._theme.borderStrong)\r\n      )\r\n    }\r\n\r\n    // Header colors\r\n    if (this._theme.headerBackground) {\r\n      style.setProperty(\r\n        \"--dg-color-header-bg\",\r\n        this._resolveValue(this._theme.headerBackground)\r\n      )\r\n    }\r\n    if (this._theme.headerText) {\r\n      style.setProperty(\r\n        \"--dg-color-header-text\",\r\n        this._resolveValue(this._theme.headerText)\r\n      )\r\n    }\r\n\r\n    // Cell colors\r\n    if (this._theme.cellBackground) {\r\n      style.setProperty(\r\n        \"--dg-color-cell-bg\",\r\n        this._resolveValue(this._theme.cellBackground)\r\n      )\r\n    }\r\n    if (this._theme.cellText) {\r\n      style.setProperty(\r\n        \"--dg-color-text\",\r\n        this._resolveValue(this._theme.cellText)\r\n      )\r\n    }\r\n\r\n    // Fixed column\r\n    if (this._theme.fixedShadow) {\r\n      style.setProperty(\r\n        \"--dg-shadow-fixed\",\r\n        this._resolveValue(this._theme.fixedShadow)\r\n      )\r\n    }\r\n    if (this._theme.fixedBorderColor) {\r\n      style.setProperty(\r\n        \"--dg-fixed-border-color\",\r\n        this._resolveValue(this._theme.fixedBorderColor)\r\n      )\r\n    }\r\n    if (this._theme.fixedBorderWidth) {\r\n      style.setProperty(\r\n        \"--dg-fixed-border-width\",\r\n        this._resolveValue(this._theme.fixedBorderWidth)\r\n      )\r\n    }\r\n\r\n    // Interactive colors\r\n    if (this._theme.primary) {\r\n      style.setProperty(\r\n        \"--dg-color-primary\",\r\n        this._resolveValue(this._theme.primary)\r\n      )\r\n    }\r\n    if (this._theme.primaryHover) {\r\n      style.setProperty(\r\n        \"--dg-color-primary-hover\",\r\n        this._resolveValue(this._theme.primaryHover)\r\n      )\r\n    }\r\n\r\n    // Status colors\r\n    if (this._theme.success) {\r\n      style.setProperty(\r\n        \"--dg-color-success\",\r\n        this._resolveValue(this._theme.success)\r\n      )\r\n    }\r\n    if (this._theme.warning) {\r\n      style.setProperty(\r\n        \"--dg-color-warning\",\r\n        this._resolveValue(this._theme.warning)\r\n      )\r\n    }\r\n    if (this._theme.error) {\r\n      style.setProperty(\r\n        \"--dg-color-error\",\r\n        this._resolveValue(this._theme.error)\r\n      )\r\n    }\r\n\r\n    // Row totals column\r\n    if (this._theme.rowTotalBackground) {\r\n      style.setProperty(\r\n        \"--dg-row-total-bg\",\r\n        this._resolveValue(this._theme.rowTotalBackground)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalBackgroundAlt) {\r\n      style.setProperty(\r\n        \"--dg-row-total-bg-alt\",\r\n        this._resolveValue(this._theme.rowTotalBackgroundAlt)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalText) {\r\n      style.setProperty(\r\n        \"--dg-row-total-text\",\r\n        this._resolveValue(this._theme.rowTotalText)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalHeaderBackground) {\r\n      style.setProperty(\r\n        \"--dg-row-total-header-bg\",\r\n        this._resolveValue(this._theme.rowTotalHeaderBackground)\r\n      )\r\n    }\r\n    if (this._theme.rowTotalBorderColor) {\r\n      style.setProperty(\r\n        \"--dg-row-total-border-color\",\r\n        this._resolveValue(this._theme.rowTotalBorderColor)\r\n      )\r\n    }\r\n\r\n    // Ungrouped rows\r\n    if (this._theme.ungroupedRowBackground) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-bg\",\r\n        this._resolveValue(this._theme.ungroupedRowBackground)\r\n      )\r\n    }\r\n    if (this._theme.ungroupedRowBackgroundAlt) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-bg-alt\",\r\n        this._resolveValue(this._theme.ungroupedRowBackgroundAlt)\r\n      )\r\n    }\r\n    if (this._theme.ungroupedRowBackgroundHover) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-bg-hover\",\r\n        this._resolveValue(this._theme.ungroupedRowBackgroundHover)\r\n      )\r\n    }\r\n    if (this._theme.ungroupedRowText) {\r\n      style.setProperty(\r\n        \"--dg-ungrouped-row-text\",\r\n        this._resolveValue(this._theme.ungroupedRowText)\r\n      )\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update theme at runtime\r\n   * @param {Object} theme - Partial theme configuration to merge\r\n   */\r\n  updateTheme(theme) {\r\n    this._theme = { ...this._theme, ...theme }\r\n    this._applyTheme()\r\n  }\r\n\r\n  /**\r\n   * Reset to default theme\r\n   */\r\n  resetTheme() {\r\n    const style = this._container.style\r\n\r\n    // Remove all custom properties\r\n    Object.keys(this._theme).forEach(() => {\r\n      style.removeProperty(\"--dg-color-bg-alt\")\r\n      style.removeProperty(\"--dg-color-bg\")\r\n      style.removeProperty(\"--dg-color-bg-hover\")\r\n      style.removeProperty(\"--dg-color-bg-selected\")\r\n      style.removeProperty(\"--dg-color-border\")\r\n      style.removeProperty(\"--dg-color-border-strong\")\r\n      style.removeProperty(\"--dg-color-header-bg\")\r\n      style.removeProperty(\"--dg-color-header-text\")\r\n      style.removeProperty(\"--dg-color-cell-bg\")\r\n      style.removeProperty(\"--dg-color-text\")\r\n      style.removeProperty(\"--dg-shadow-fixed\")\r\n      style.removeProperty(\"--dg-fixed-border-color\")\r\n      style.removeProperty(\"--dg-fixed-border-width\")\r\n      style.removeProperty(\"--dg-color-primary\")\r\n      style.removeProperty(\"--dg-color-primary-hover\")\r\n      style.removeProperty(\"--dg-color-success\")\r\n      style.removeProperty(\"--dg-color-warning\")\r\n      style.removeProperty(\"--dg-color-error\")\r\n      style.removeProperty(\"--dg-row-total-bg\")\r\n      style.removeProperty(\"--dg-row-total-bg-alt\")\r\n      style.removeProperty(\"--dg-row-total-text\")\r\n      style.removeProperty(\"--dg-row-total-header-bg\")\r\n      style.removeProperty(\"--dg-row-total-border-color\")\r\n      style.removeProperty(\"--dg-ungrouped-row-bg\")\r\n      style.removeProperty(\"--dg-ungrouped-row-bg-alt\")\r\n      style.removeProperty(\"--dg-ungrouped-row-bg-hover\")\r\n      style.removeProperty(\"--dg-ungrouped-row-text\")\r\n    })\r\n\r\n    this._theme = { ...this._defaultTheme }\r\n  }\r\n\r\n  /**\r\n   * Get current theme\r\n   * @returns {Object} Current theme configuration\r\n   */\r\n  getTheme() {\r\n    return { ...this._theme }\r\n  }\r\n}\r\n","/**\n * Table - Main orchestrator class for the editable table\n *\n * This is the primary entry point that coordinates all modules,\n * manages the lifecycle, and exposes the public API.\n */\n\nimport { EventBus, TableEvents } from \"./EventBus.js\"\nimport { TableState } from \"./TableState.js\"\nimport { TableRenderer } from \"./TableRenderer.js\"\nimport { RowManager } from \"../modules/RowManager.js\"\nimport { GroupManager } from \"../modules/GroupManager.js\"\nimport { EditManager } from \"../modules/EditManager.js\"\nimport { ExportManager } from \"../modules/ExportManager.js\"\nimport { ThemeManager } from \"../modules/ThemeManager.js\"\nimport { addClass, removeClass } from \"../utils/dom.js\"\n\n/**\n * @typedef {Object} TableConfig\n * @property {HTMLElement|string} container - Container element or selector\n * @property {Array<Object>} columns - Column definitions\n * @property {Array<Object>} data - Table data\n * @property {boolean} [fixedFirstColumn=false] - Enable fixed first column\n * @property {boolean} [enableGrouping=false] - Enable row grouping\n * @property {string|Function} [groupBy] - Group by column name or function\n * @property {boolean} [enableInfoRows=false] - Enable info rows\n * @property {boolean} [enableRowTotals=false] - Enable row totals column\n * @property {Function} [rowTotalsFormat] - Format function for row totals column\n * @property {Array<Object>} [actions] - Row actions configuration\n * @property {'view'|'edit'} [mode='view'] - Initial mode\n * @property {Function} [onRowClick] - Row click callback\n * @property {Function} [onRender] - Render complete callback\n * @property {Function} [onChange] - Table data change callback\n * @property {Function} [onRowChange] - Individual row change callback\n * @property {Object} [theme] - Theme customization\n */\n\nexport class Table {\n  /**\n   * Create a new Table instance\n   * @param {TableConfig} config - Table configuration\n   */\n  constructor(config) {\n    this._validateConfig(config)\n\n    // Store configuration\n    this._config = {\n      fixedFirstColumn: false,\n      enableGrouping: false,\n      enableInfoRows: false,\n      enableRowTotals: false,\n      mode: \"view\",\n      ...config,\n    }\n\n    // Get container element\n    this._container =\n      typeof config.container === \"string\"\n        ? document.querySelector(config.container)\n        : config.container\n\n    if (!this._container) {\n      throw new Error(\"Table: Container element not found\")\n    }\n\n    // Initialize core systems\n    this._eventBus = new EventBus()\n    this._state = new TableState(this._eventBus, {\n      data: config.data || [],\n      columns: config.columns || [],\n      config: {\n        fixedFirstColumn: config.fixedFirstColumn,\n        enableGrouping: config.enableGrouping,\n        groupBy: config.groupBy,\n        groups: config.groups || {},\n        enableInfoRows: config.enableInfoRows,\n        enableRowTotals: config.enableRowTotals,\n        rowTotalsFormat: config.rowTotalsFormat,\n        actions: config.actions || [],\n        actionsShowIf: config.actionsShowIf,\n      },\n    })\n\n    // Initialize modules\n    this._initModules()\n\n    // Set initial mode\n    this._state.setMode(config.mode || \"view\")\n\n    // Register callbacks\n    this._registerCallbacks()\n\n    // Initial render\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Data\n  // ============================================\n\n  /**\n   * Get current table data\n   * @returns {Array<Object>}\n   */\n  getData() {\n    return this._state.getData()\n  }\n\n  /**\n   * Set table data\n   * @param {Array<Object>} data - New data array\n   */\n  setData(data) {\n    this._state.setData(data)\n    this._render()\n  }\n\n  /**\n   * Get a single row by ID\n   * @param {string|number} rowId - Row identifier\n   * @returns {Object|null}\n   */\n  getRow(rowId) {\n    return this._state.getRow(rowId)\n  }\n\n  /**\n   * Update a specific cell\n   * @param {string|number} rowId - Row identifier\n   * @param {string} columnName - Column name\n   * @param {any} value - New value\n   */\n  updateCell(rowId, columnName, value) {\n    this._state.updateCell(rowId, columnName, value)\n  }\n\n  /**\n   * Update badge for a specific row\n   * @param {string|number} rowId - Row identifier\n   * @param {string|HTMLElement|null} badgeContent - Badge HTML content (null to remove)\n   */\n  updateRowBadge(rowId, badgeContent) {\n    this._renderer.updateRowBadge(rowId, badgeContent)\n  }\n\n  /**\n   * Batch update multiple cells\n   * @param {Array<{rowId, columnName, value}>} updates - Updates array\n   */\n  batchUpdate(updates) {\n    this._state.batchUpdate(updates)\n  }\n\n  /**\n   * Add a new row\n   * @param {Object} rowData - Row data\n   * @param {Object} [options] - Options (position, groupId, etc.)\n   */\n  addRow(rowData, options = {}) {\n    this._rowManager.addRow(rowData, options)\n  }\n\n  /**\n   * Delete a row\n   * @param {string|number} rowId - Row identifier\n   */\n  deleteRow(rowId) {\n    this._rowManager.deleteRow(rowId)\n  }\n\n  /**\n   * Get all modified rows\n   * @returns {Array<Object>}\n   */\n  getDirtyRows() {\n    return this._state.getDirtyRows()\n  }\n\n  /**\n   * Clear dirty state\n   */\n  clearDirty() {\n    this._state.clearDirty()\n  }\n\n  /**\n   * Revert all changes\n   */\n  revertChanges() {\n    this._state.revertChanges()\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Columns\n  // ============================================\n\n  /**\n   * Get column definitions\n   * @returns {Array<Object>}\n   */\n  getColumns() {\n    return this._state.getColumns()\n  }\n\n  /**\n   * Update column definitions\n   * @param {Array<Object>} columns - New column definitions\n   */\n  setColumns(columns) {\n    this._state.setColumns(columns)\n    this._render()\n  }\n\n  /**\n   * Show/hide a column\n   * @param {string} columnId - Column identifier\n   * @param {boolean} visible - Visibility state\n   */\n  setColumnVisibility(columnId, visible) {\n    const columns = this._state.getColumns()\n    const updatedColumns = columns.map((col) => {\n      if (col._id === columnId || col.data === columnId) {\n        return { ...col, visible }\n      }\n      return col\n    })\n    this._state.setColumns(updatedColumns)\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Mode\n  // ============================================\n\n  /**\n   * Get current mode\n   * @returns {'view'|'edit'}\n   */\n  getMode() {\n    return this._state.getMode()\n  }\n\n  /**\n   * Set table mode\n   * @param {'view'|'edit'} mode - Mode to set\n   */\n  setMode(mode) {\n    this._state.setMode(mode)\n  }\n\n  /**\n   * Toggle between view and edit mode\n   */\n  toggleMode() {\n    const currentMode = this._state.getMode()\n    this._state.setMode(currentMode === \"view\" ? \"edit\" : \"view\")\n  }\n\n  // ============================================\n  // Public API - Groups\n  // ============================================\n\n  /**\n   * Toggle a group's visibility\n   * @param {string} groupId - Group identifier\n   */\n  toggleGroup(groupId) {\n    this._state.toggleGroup(groupId)\n  }\n\n  /**\n   * Expand all groups\n   */\n  expandAllGroups() {\n    this._state.expandAllGroups()\n  }\n\n  /**\n   * Collapse all groups\n   */\n  collapseAllGroups() {\n    this._state.collapseAllGroups()\n  }\n\n  // ============================================\n  // Public API - Export\n  // ============================================\n\n  /**\n   * Export table to CSV\n   * @param {Object} [options] - Export options\n   * @returns {string} CSV string\n   */\n  exportCSV(options = {}) {\n    return this._exportManager.toCSV(options)\n  }\n\n  /**\n   * Export table to Excel\n   * @param {Object} [options] - Export options\n   */\n  exportExcel(options = {}) {\n    return this._exportManager.toExcel(options)\n  }\n\n  /**\n   * Download export as file\n   * @param {'csv'|'excel'} format - Export format\n   * @param {string} [filename] - File name\n   */\n  download(format, filename) {\n    this._exportManager.download(format, filename)\n  }\n\n  // ============================================\n  // Public API - Utilities\n  // ============================================\n\n  /**\n   * Force re-render of the table\n   */\n  render() {\n    this._render()\n  }\n\n  // ============================================\n  // Public API - Theme\n  // ============================================\n\n  /**\n   * Update theme at runtime\n   * @param {Object} theme - Partial theme configuration\n   */\n  updateTheme(theme) {\n    this._themeManager.updateTheme(theme)\n  }\n\n  /**\n   * Reset to default theme\n   */\n  resetTheme() {\n    this._themeManager.resetTheme()\n  }\n\n  /**\n   * Get current theme\n   * @returns {Object} Current theme configuration\n   */\n  getTheme() {\n    return this._themeManager.getTheme()\n  }\n\n  /**\n   * Subscribe to table events\n   * @param {string} event - Event name\n   * @param {Function} callback - Event handler\n   * @returns {Function} Unsubscribe function\n   */\n  on(event, callback) {\n    return this._eventBus.on(event, callback)\n  }\n\n  /**\n   * Unsubscribe from table events\n   * @param {string} event - Event name\n   * @param {Function} callback - Event handler\n   */\n  off(event, callback) {\n    this._eventBus.off(event, callback)\n  }\n\n  /**\n   * Destroy the table instance\n   */\n  destroy() {\n    this._eventBus.emit(TableEvents.DESTROY, {})\n\n    // Destroy modules\n    this._renderer.destroy()\n    this._themeManager.resetTheme()\n    this._rowManager.destroy()\n    this._groupManager.destroy()\n    this._editManager.destroy()\n    this._exportManager.destroy()\n\n    // Destroy core\n    this._state.destroy()\n    this._eventBus.destroy()\n\n    // Clear container\n    this._container.innerHTML = \"\"\n    removeClass(this._container, \"dg-container\")\n  }\n\n  // ============================================\n  // Private Methods\n  // ============================================\n\n  /**\n   * Validate configuration\n   * @private\n   */\n  _validateConfig(config) {\n    if (!config) {\n      throw new Error(\"Table: Configuration object is required\")\n    }\n    if (!config.container) {\n      throw new Error(\"Table: Container element or selector is required\")\n    }\n    if (!config.columns || !Array.isArray(config.columns)) {\n      throw new Error(\"Table: Columns array is required\")\n    }\n  }\n\n  /**\n   * Initialize all modules\n   * @private\n   */\n  _initModules() {\n    // Initialize renderer first\n    this._renderer = new TableRenderer(this._container, this._state)\n\n    // Initialize theme manager\n    this._themeManager = new ThemeManager(this._container, this._config.theme)\n\n    // Initialize feature modules\n    this._rowManager = new RowManager(this._state, this._eventBus)\n    this._groupManager = new GroupManager(this._state, this._eventBus)\n    this._editManager = new EditManager(\n      this._state,\n      this._eventBus,\n      this._renderer\n    )\n    this._exportManager = new ExportManager(this._state, this._eventBus)\n  }\n\n  /**\n   * Register user callbacks\n   * @private\n   */\n  _registerCallbacks() {\n    const { onRowClick, onRender, onChange, onRowChange } = this._config\n\n    if (onRowClick) {\n      this._eventBus.on(TableEvents.ROW_CLICK, onRowClick)\n    }\n\n    if (onRender) {\n      this._eventBus.on(TableEvents.AFTER_RENDER, onRender)\n    }\n\n    if (onChange) {\n      this._eventBus.on(TableEvents.DATA_CHANGE, onChange)\n    }\n\n    if (onRowChange) {\n      this._eventBus.on(TableEvents.ROW_CHANGE, onRowChange)\n    }\n  }\n\n  /**\n   * Render the table\n   * @private\n   */\n  _render() {\n    this._eventBus.emit(TableEvents.BEFORE_RENDER, {})\n    this._renderer.render()\n    this._eventBus.emit(TableEvents.RENDER, {})\n\n    // Use requestAnimationFrame to ensure DOM is ready\n    requestAnimationFrame(() => {\n      this._eventBus.emit(TableEvents.AFTER_RENDER, {\n        rowCount: this._state.getData().length,\n        columnCount: this._state.getColumns().length,\n      })\n    })\n  }\n}\n\n// Expose event types for external use\nTable.Events = TableEvents\n"],"names":["EventBus","constructor","this","_listeners","Map","_onceListeners","_isBatching","_batchQueue","on","event","callback","has","set","Set","get","add","off","once","wrapper","data","delete","emit","push","forEach","error","console","startBatch","endBatch","eventMap","key","TableEvents","CELL_CHANGE","rowId","columnName","ROW_CHANGE","destroy","clear","STATE_CHANGE","DATA_CHANGE","ROW_CLICK","ROW_ADD","ROW_DELETE","CELL_FOCUS","CELL_BLUR","ACTION_CLICK","ROW_TOTAL_CHANGE","GROUP_TOGGLE","GROUP_EXPAND_ALL","GROUP_COLLAPSE_ALL","MODE_CHANGE","BEFORE_RENDER","RENDER","AFTER_RENDER","DESTROY","SCROLL","EXPORT_START","EXPORT_COMPLETE","generateId","Date","now","toString","Math","random","substr","deepClone","obj","getTime","map","item","value","Array","isArray","cloned","Object","prototype","hasOwnProperty","call","deepEqual","a","b","length","every","index","keysA","keys","keysB","toNumber","defaultValue","parsed","parseFloat","isNaN","sum","values","reduce","acc","val","average","min","nums","filter","v","max","TableState","eventBus","initialState","_eventBus","_state","originalData","columns","mode","groups","groupedData","collapsedGroups","focusedCell","computedCache","dirtyRows","dirtyColumns","isBatchOperation","config","fixedFirstColumn","enableGrouping","groupBy","enableInfoRows","enableRowTotals","actions","setData","setColumns","_normalizeData","_invalidateCache","_computeGroups","source","getData","getRow","row","find","r","_id","updateCell","options","rowIndex","findIndex","oldValue","_invalidateCacheForRow","newValue","from","skipCascade","_triggerCascadeUpdate","batchUpdate","updates","_computeAllCascades","updatedRows","u","col","_index","id","property","getColumns","defaultFormat","Number","toLocaleString","title","type","editable","aggregate","_isRowTotal","format","rowTotalsFormat","getColumn","columnId","c","setMode","warn","oldMode","newMode","getMode","isEditMode","toggleGroup","groupId","collapsed","isGroupCollapsed","getGroupedData","getUngroupedRows","ungroupedRows","getInfoRows","infoRows","expandAllGroups","collapseAllGroups","getDirtyRows","isRowDirty","clearDirty","revertChanges","setConfig","undefined","getConfig","_type","groupKey","customLabel","labels","label","rows","totals","column","affectsColumns","affectedCol","_","includes","cascade","state","rId","cName","createElement","tag","attributes","element","document","entries","className","assign","style","startsWith","setAttribute","setAttributes","addClass","classNames","classList","removeClass","remove","TableRenderer","container","_container","_tableWrapper","_table","_thead","_tbody","_rowElements","_cellElements","_unsubscribers","_setupEventListeners","render","_createStructure","_updateContainerClasses","_renderHeader","_renderGroupedBody","_renderBody","cellKey","cell","isConnected","_renderCellContent","updateRow","rowElement","rowData","getCellElement","getRowElement","unsubscribe","_updateGroupHeaders","_toggleGroupVisibility","_setAllGroupsVisibility","class","appendChild","innerHTML","headerRow","visibleIndex","visible","th","headerContent","textContent","width","_createRowElement","group","groupHeader","_createGroupHeaderRow","isCollapsed","tr","addEventListener","e","target","closest","td","_createCellElement","align","textAlign","columnHasActions","rowHasActions","actionsShowIf","actionsWrapper","_createRowActions","_badge","badge","_createBadgeElement","badgeContent","test","HTMLElement","cloneNode","updateRowBadge","firstVisibleColumn","existingBadge","querySelector","action","actionBtn","tooltip","icon","stopPropagation","onClick","actionIndex","skipSpecialElements","isEditable","_editable","input","_createInputElement","displayValue","_formatDisplayValue","rendered","content","textNode","createTextNode","existingActions","inputType","opt","option","selected","step","onChange","String","decimals","toFixed","Intl","NumberFormat","currency","toLocaleDateString","visibleColumns","aggregates","toggleContent","toggleIcon","groupLabel","labelContent","groupCount","_createTotalsRow","querySelectorAll","header","gId","RowManager","_setupListeners","addRow","afterRowId","newRow","insertIndex","afterIndex","i","splice","idx","addInfoRow","parentRowId","infoRowData","deleteRow","deletedRow","deleteRows","rowIds","deletedCount","rowIdSet","filteredData","duplicateRow","moveRow","newIndex","currentIndex","movedRow","getRowsByType","getDataRows","parentIndex","AggregateTypes","AggregateTypes_SUM","AggregateTypes_AVG","AggregateTypes_MIN","AggregateTypes_MAX","AggregateTypes_COUNT","AggregateTypes_FIRST","AggregateTypes_LAST","calculateGrandTotals","aggregateFn","GroupManager","recalculateTotals","recalculateRowTotals","calculateRowTotal","total","_rowTotal","updateRowTotal","oldTotal","getGroup","getGroupIds","getGroupRows","getGroupTotals","dataRows","_calculateAggregate","groupRowTotal","getGrandTotals","toggle","expand","collapse","expandAll","collapseAll","getExpansionState","groupIds","setExpansionState","expanded","moveRowToGroup","targetGroupId","getGroupStats","stats","rowCount","count","aggregateType","EditManager","renderer","_renderer","_focusedCell","_isEditing","enterEditMode","enterViewMode","toggleMode","focusCell","focus","select","getFocusedCell","moveFocus","direction","colIndex","newRowIndex","newColIndex","targetRow","newColumn","startEditing","stopEditing","isEditing","cancelEdit","originalRow","commitEdit","dispatchEvent","Event","bubbles","preventDefault","shiftKey","ctrlKey","ExportManager","toCSV","delimiter","includeHeaders","includeHidden","columnFilter","_escapeCSV","join","csvRow","exportFormat","csvString","toExcel","sheetName","worksheetData","excelRow","result","sheets","name","download","filename","_downloadCSV","_downloadExcel","csv","blob","Blob","_downloadBlob","link","url","URL","createObjectURL","visibility","body","click","removeChild","revokeObjectURL","stringValue","replace","preview","slice","headers","ThemeManager","theme","_defaultTheme","rowEven","rowOdd","rowHover","rowSelected","borderLight","borderStrong","headerBackground","headerText","cellBackground","cellText","fixedBackground","fixedShadow","fixedBorderColor","fixedBorderWidth","primary","primaryHover","success","warning","rowTotalBackground","rowTotalBackgroundAlt","rowTotalText","rowTotalHeaderBackground","rowTotalBorderColor","ungroupedRowBackground","ungroupedRowBackgroundAlt","ungroupedRowBackgroundHover","ungroupedRowText","_theme","_applyTheme","_resolveValue","setProperty","updateTheme","resetTheme","removeProperty","getTheme","Table","_validateConfig","_config","Error","_initModules","_registerCallbacks","_render","_rowManager","setColumnVisibility","updatedColumns","currentMode","exportCSV","_exportManager","exportExcel","_themeManager","_groupManager","_editManager","onRowClick","onRender","onRowChange","requestAnimationFrame","columnCount","Events"],"mappings":"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"}