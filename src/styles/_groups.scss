/**
 * Group Styles
 * Styles for grouped rows, group headers, and totals
 */

@use "variables" as *;

// ============================================
// Group Header Row
// ============================================

.dg-row-group-header {
  background-color: var(--dg-color-bg-alt);
  border-bottom: var(--dg-border-width) solid var(--dg-color-border-strong);
  cursor: pointer;

  // Ensure all cells and their contents in group header use pointer cursor
  .dg-cell-group-header {
    cursor: pointer;

    // Override input cursor in group headers
    input,
    select,
    .dg-cell-input {
      cursor: pointer;
      pointer-events: none;
    }
  }

  &:hover {
    background-color: var(--dg-color-bg-hover);

    .dg-cell-group-header {
      background-color: var(--dg-color-bg-hover);
    }

    .dg-cell-group-header.dg-cell-row-total {
      background-color: var(--dg-row-total-bg-alt);
    }
  }

  .dg-cell-group-header {
    font-weight: var(--dg-font-weight-medium);
    background-color: var(--dg-color-bg-alt);

    // Row total in group header
    &.dg-cell-row-total {
      background-color: var(--dg-row-total-header-bg);
      color: var(--dg-row-total-text);
      border-left: 2px solid var(--dg-row-total-border-color) !important;
    }
  }

  .dg-cell-aggregate {
    color: var(--dg-color-text);
  }
}

.dg-cell-group-toggle {
  padding: var(--dg-cell-padding-y) var(--dg-cell-padding-x);
  font-weight: var(--dg-font-weight-medium);
}

.dg-group-header-content {
  display: flex;
  align-items: center;
  gap: var(--dg-spacing-sm);
}

.dg-group-toggle-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1.25rem;
  height: 1.25rem;
  font-size: var(--dg-font-size-sm);
  color: var(--dg-color-text-muted);
  @include dg-transition(transform, color);

  &.dg-expanded {
    color: var(--dg-color-text);
  }

  &.dg-collapsed {
    color: var(--dg-color-text-muted);
  }

  &:hover {
    color: var(--dg-color-primary);
  }
}

.dg-group-label {
  font-weight: var(--dg-font-weight-medium);
  color: var(--dg-color-text);
}

.dg-group-count {
  font-size: var(--dg-font-size-sm);
  font-weight: var(--dg-font-weight-normal);
  color: var(--dg-color-text-muted);
}

// ============================================
// Totals Row
// ============================================

.dg-row-totals {
  background-color: var(--dg-color-bg-alt);
  border-top: var(--dg-border-width) solid var(--dg-color-border-strong);
  font-weight: var(--dg-font-weight-medium);

  &:hover {
    background-color: var(--dg-color-bg-alt); // No hover effect for totals
  }
}

.dg-cell-total {
  color: var(--dg-color-text);
  background-color: var(--dg-color-bg-alt);
}

// ============================================
// Grand Totals Row
// ============================================

.dg-row-grand-total {
  background-color: #e0e7ff; // Slightly highlighted
  border-top: 2px solid var(--dg-color-primary);
  font-weight: var(--dg-font-weight-bold);

  &:hover {
    background-color: #e0e7ff;
  }

  .dg-cell {
    background-color: inherit;
  }
}

// ============================================
// Group Indentation (for nested groups)
// ============================================

.dg-group-level-1 {
  .dg-group-header-content {
    padding-left: var(--dg-spacing-lg);
  }
}

.dg-group-level-2 {
  .dg-group-header-content {
    padding-left: calc(var(--dg-spacing-lg) * 2);
  }
}

.dg-group-level-3 {
  .dg-group-header-content {
    padding-left: calc(var(--dg-spacing-lg) * 3);
  }
}

// ============================================
// Grouped Container Modifier
// ============================================

.dg-container.dg-grouped {
  // Indent child rows under group headers
  .dg-row-data {
    position: relative;

    // Indent the first cell content
    td:first-child {
      padding-left: calc(var(--dg-cell-padding-x) + 1.5rem);
    }

    &::after {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: transparent;
    }
  }
}

// ============================================
// Ungrouped Rows
// ============================================

.dg-row-ungrouped {
  // Ungrouped rows appear without indentation
  td {
    background-color: var(--dg-ungrouped-row-bg, var(--dg-color-bg)) !important;
    color: var(--dg-ungrouped-row-text, var(--dg-color-text));
  }

  &:nth-child(odd) td {
    background-color: var(
      --dg-ungrouped-row-bg-alt,
      var(--dg-color-bg-alt)
    ) !important;
  }

  &:hover td {
    background-color: var(
      --dg-ungrouped-row-bg-hover,
      var(--dg-color-bg-hover)
    );
  }

  td:first-child {
    padding-left: var(--dg-cell-padding-x);
  }
}

// ============================================
// Collapse/Expand Animation
// ============================================

.dg-row {
  &.dg-row-collapsing {
    animation: dg-collapse $dg-animation-duration ease-out forwards;
  }

  &.dg-row-expanding {
    animation: dg-expand $dg-animation-duration ease-out forwards;
  }
}

@keyframes dg-collapse {
  from {
    opacity: 1;
    max-height: var(--dg-row-height);
  }
  to {
    opacity: 0;
    max-height: 0;
    padding-top: 0;
    padding-bottom: 0;
    border-bottom-width: 0;
  }
}

@keyframes dg-expand {
  from {
    opacity: 0;
    max-height: 0;
  }
  to {
    opacity: 1;
    max-height: var(--dg-row-height);
  }
}
