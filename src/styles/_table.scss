/**
 * Table Base Styles
 */

@use "variables" as *;

// ============================================
// Container
// ============================================

.dg-container {
  position: relative;
  width: 100%;
  font-family: var(--dg-font-family);
  font-size: var(--dg-font-size-base);
  color: var(--dg-color-text);
  background-color: var(--dg-color-bg);
  border: var(--dg-border-width) solid var(--dg-color-border);
  border-radius: var(--dg-border-radius);
  overflow: hidden;
}

// ============================================
// Table Wrapper (for scroll handling)
// ============================================

.dg-table-wrapper {
  width: 100%;
  overflow-x: auto;
  overflow-y: auto;
  max-height: 100%;
  @include dg-scrollbar;
}

// ============================================
// Table
// ============================================

.dg-table {
  width: max-content;
  min-width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
  table-layout: fixed;
}

// ============================================
// Header
// ============================================

.dg-thead {
  position: sticky;
  top: 0;
  z-index: var(--dg-z-header);
  background-color: var(--dg-color-bg);
}

.dg-header-row {
  background-color: var(--dg-color-bg-alt);
  border-bottom: var(--dg-border-width) solid var(--dg-color-border-strong);
}

.dg-header-cell {
  position: relative;
  height: var(--dg-header-height);
  padding: var(--dg-cell-padding-y) var(--dg-cell-padding-x);
  font-weight: var(--dg-font-weight-medium);
  text-align: left;
  vertical-align: middle;
  background-color: var(--dg-color-bg-alt);
  border-right: var(--dg-border-width) solid var(--dg-color-border);
  user-select: none;

  &:last-child {
    border-right: none;
  }

  // Fixed column header
  &.dg-cell-fixed {
    position: sticky;
    left: 0;
    z-index: var(--dg-z-fixed-header);
    background-color: var(--dg-color-bg-alt);

    // Use pseudo-element for border (stays with sticky element)
    &::after {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      width: var(--dg-fixed-border-width);
      background-color: var(--dg-fixed-border-color);
    }
  }

  // Row total column header
  &.dg-header-row-total {
    background-color: var(--dg-row-total-header-bg);
    color: var(--dg-row-total-text);
    border-left: 2px solid var(--dg-row-total-border-color) !important;
  }
}

.dg-header-content {
  display: flex;
  align-items: center;
  gap: var(--dg-spacing-sm);
}

// ============================================
// Body
// ============================================

.dg-tbody {
  background-color: var(--dg-color-bg);
}

// ============================================
// Rows
// ============================================

.dg-row {
  @include dg-transition(background-color);

  &:hover {
    background-color: var(--dg-color-bg-hover);
  }

  // Data row
  &.dg-row-data {
    cursor: default;

    &:nth-child(even) {
      background-color: var(--dg-color-bg-alt);

      &:hover {
        background-color: var(--dg-color-bg-hover);
      }
    }
  }

  // Selected row
  &.dg-row-selected {
    background-color: var(--dg-color-bg-selected) !important;
  }

  // Dirty (modified) row
  &.dg-row-dirty {
    position: relative;

    &::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background-color: var(--dg-color-warning);
    }
  }

  // Hidden row (for collapsed groups)
  &.dg-row-hidden {
    display: none;
  }
}

// ============================================
// Cells
// ============================================

.dg-cell {
  height: var(--dg-row-height);
  vertical-align: middle;
  border-right: var(--dg-border-width) solid var(--dg-color-border);
  border-bottom: var(--dg-border-width) solid var(--dg-color-border);
  overflow: hidden; // Keep content within cell boundaries
  @include dg-transition(background-color, box-shadow);
  padding: 5px;

  &:last-child {
    border-right: none;
  }

  // Fixed column cell
  &.dg-cell-fixed {
    position: sticky;
    left: 0;
    z-index: var(--dg-z-fixed);
    background-color: var(--dg-color-bg); // Explicit background for odd rows
    overflow: hidden; // Ensure fixed cell content stays within boundaries

    // Use pseudo-element for border (stays with sticky element)
    &::after {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      width: var(--dg-fixed-border-width);
      background-color: var(--dg-fixed-border-color);
    }

    // Even rows
    .dg-row-data:nth-child(even) & {
      background-color: var(--dg-color-bg-alt);
    }

    // Odd rows (explicit)
    .dg-row-data:nth-child(odd) & {
      background-color: var(--dg-color-bg);
    }

    .dg-row:hover & {
      background-color: var(--dg-color-bg-hover);
    }

    .dg-row-selected & {
      background-color: var(--dg-color-bg-selected);
    }
  }

  // Row total column cell
  &.dg-cell-row-total {
    background-color: var(--dg-row-total-bg);
    color: var(--dg-row-total-text);
    font-weight: var(--dg-font-weight-medium);
    border-left: 2px solid var(--dg-row-total-border-color) !important;

    // Even rows
    .dg-row-data:nth-child(even) & {
      background-color: var(--dg-row-total-bg-alt);
    }

    // Hover state
    .dg-row:hover & {
      background-color: var(--dg-row-total-bg-alt);
    }
  }

  // Cell type alignments
  &.dg-cell-number {
    font-variant-numeric: tabular-nums;
  }

  &.dg-cell-currency {
    text-align: right;
    font-variant-numeric: tabular-nums;
  }

  &.dg-cell-date {
    text-align: center;
  }

  // Cell in edit mode
  &.dg-cell-editing {
    padding: 0;
    box-shadow: inset 0 0 0 2px var(--dg-color-primary);
  }
}

// ============================================
// Fixed Column Shadow
// ============================================

.dg-container.dg-scrolled {
  .dg-cell-fixed,
  .dg-header-cell.dg-cell-fixed {
    box-shadow: var(--dg-shadow-fixed);
  }
}

// ============================================
// Row Actions
// ============================================

.dg-row-actions {
  display: inline-flex;
  align-items: center;
  gap: var(--dg-spacing-xs);
  margin-right: var(--dg-spacing-sm);
  vertical-align: middle;
}

.dg-row-action {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1.25rem;
  height: 1.25rem;
  padding: 2px;
  cursor: pointer;
  color: var(--dg-color-text-muted);
  border-radius: var(--dg-border-radius);
  @include dg-transition(color, background-color);

  &:hover {
    color: var(--dg-color-primary);
    background-color: var(--dg-color-primary-light);
  }

  // Icon sizing
  svg,
  img {
    width: 100%;
    height: 100%;
    display: block;
  }
}

.dg-cell-has-actions {
  // Use flexbox to properly size input alongside actions
  display: flex;
  align-items: center;
  white-space: nowrap;

  // Actions container should not shrink
  .dg-row-actions {
    flex-shrink: 0;
  }

  // Input/content should take remaining space
  .dg-cell-input {
    flex: 1;
    min-width: 0; // Allow input to shrink below content size
  }

  // For non-input content (view mode)
  > span:not(.dg-row-actions),
  > div:not(.dg-row-actions) {
    flex: 1;
    min-width: 0;
    overflow: hidden;
  }
}
